<?xml version="1.0" encoding="UTF-8"?>
<!--
    License CC BY-NC-SA 3.0
  
   This work is licensed under the 
   "Namensnennung – Keine kommerzielle Nutzung – Weitergabe unter
    gleichen Bedingungen 3.0 Deutschland (CC BY-NC-SA 3.0)" 
   http://creativecommons.org/licenses/by-nc-sa/3.0/de/deed.de
   
   Read the English translation here:
   
   "Attribution-NonCommercial-ShareAlike 3.0 Unported (CC BY-NC-SA 3.0)" 
   http://creativecommons.org/licenses/by-nc-sa/3.0/
   
-->
<?xml-model href="5.1/dbref.rng" 
  schematypens="http://relaxng.org/ns/structure/1.0"?>
<!DOCTYPE book [
<!ENTITY projectname "The DBCookBook Project">
<!ENTITY gh.uri "https://github.com/&gh.project;">
<!ENTITY gh.project "tomschr/dbcookbook">
<!ENTITY prj.mail "docbook-xml@online.ms">
<!ENTITY uri.db "http://www.docbook.org">
<!ENTITY gh.git.repo.url "git@github.com:&gh.project;.git">
<!ENTITY gh.https.repo.url "https://github.com/&gh.project;.git">
<!ENTITY uri.dbxsl "http://docbook.sf.net/release/xsl/current">
]>
<book xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" version="5.1" xml:lang="en" xml:id="dbcookbook" status="draft">
  <title>The DoCookBook</title>
  <subtitle>Recipes for DocBook Developers</subtitle>
  <info>
    <pubdate role="currentdatetime">2018-03-10</pubdate>
    <releaseinfo>0.7.3</releaseinfo>
    <definitions definitionfile="defs.xml"/>
    <rdf:RDF xmlns="http://creativecommons.org/ns#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#">
      <License rdf:about="http://creativecommons.org/licenses/by-nc-sa/3.0/de/">
        <permits rdf:resource="http://creativecommons.org/ns#Reproduction"/>
        <permits rdf:resource="http://creativecommons.org/ns#Distribution"/>
        <requires rdf:resource="http://creativecommons.org/ns#Notice"/>
        <requires rdf:resource="http://creativecommons.org/ns#Attribution"/>
        <prohibits rdf:resource="http://creativecommons.org/ns#CommercialUse"/>
        <permits rdf:resource="http://creativecommons.org/ns#DerivativeWorks"/>
        <requires rdf:resource="http://creativecommons.org/ns#ShareAlike"/>
      </License>
    </rdf:RDF>
    <!--
    License CC BY-NC-SA 3.0
  
   This work is licensed under the 
   "Namensnennung – Keine kommerzielle Nutzung – Weitergabe unter
    gleichen Bedingungen 3.0 Deutschland (CC BY-NC-SA 3.0)" 
   http://creativecommons.org/licenses/by-nc-sa/3.0/de/deed.de
   
   Read the English translation here:
   
   "Attribution-NonCommercial-ShareAlike 3.0 Unported (CC BY-NC-SA 3.0)" 
   http://creativecommons.org/licenses/by-nc-sa/3.0/
   
--><legalnotice xmlns:xlink="http://www.w3.org/1999/xlink" xmlns="http://docbook.org/ns/docbook" version="5.1" xml:lang="en" xml:id="legalnotice">
  <title>Licensed under Creative Commons</title>
  <info>
    <keywordset>
      <keyword>license</keyword>
      <keyword>Creative Commons</keyword>
      <keyword>CC</keyword>
      <keyword>CC BY-NC-SA 3.0 DE</keyword>
    </keywordset>
  </info>
  
  <sidebar>
    <title>This Work is Licensed under Creative Commons</title>
    <informaltable border="0" frame="void" rules="none" class="ccbox">
      <tbody>
        <tr>
          <td valign="top"><inlinemediaobject>
              <imageobject>
                <imagedata fileref="png/by-nc-sa-3.0-de-88x31.png" width="88px"/>
              </imageobject>
              <textobject>
                <phrase>Creative Commons License Agreement</phrase>
              </textobject>
            </inlinemediaobject></td>
          <td><para>This work is licensed as Creative Commons
              Attribution-NonCommercial-ShareAlike 3.0 Germany License (CC
              BY-NC-SA 3.0 DE). For more information, refer to <xref linkend="dbc.preface.license"/> <!--or go to <link
                xlink:show="new"
                xlink:href="http://creativecommons.org/licenses/by-nc-sa/3.0/de/deed.en"
              />-->
            </para>
            <!--<para>See also the license texts <xref linkend="cc-by-nc-sa-30-de"/>
              and <xref linkend="cc-by-nc-sa-30-unported"/>.</para>-->
          </td>
        </tr>
      </tbody>
    </informaltable>
  </sidebar>
  
</legalnotice>
    <biblioid class="uri" role="project">http://sf.net/p/doccookbook/</biblioid>
    <biblioid class="uri" role="home">http://doccookbook.sf.net/html/en/</biblioid>
    <bibliosource class="other" otherclass="rss" role="code" xlink:href="http://sf.net/p/doccookbook/code/feed.rss">[DoCookBook] Recent Code Changes (RSS)</bibliosource>
    <bibliosource class="other" otherclass="atom" role="code" xlink:href="http://sf.net/p/doccookbook/code/feed.atom">[DoCookBook] Recent Code Changes (Atom)</bibliosource>
    <bibliosource class="other" otherclass="rss" role="ticket" xlink:href="http://sf.net/p/doccookbook/tickets/feed.rss">[DoCookBook] Recent Ticket Changes (RSS)</bibliosource>
    <bibliosource class="other" otherclass="atom" role="ticket" xlink:href="http://sf.net/p/doccookbook/tickets/feed.atom">[DoCookBook] Recent Ticket Changes (Atom)</bibliosource>
    <extendedlink role="feeds">
      <locator xlink:label="code" xlink:role="rss" xlink:title="[DoCookBook] Recent Code Changes (RSS)" xlink:href="http://sf.net/p/doccookbook/code/feed.rss"/>
      <locator xlink:label="code" xlink:role="atom" xlink:title="[DoCookBook] Recent Code Changes (Atom)" xlink:href="http://sf.net/p/doccookbook/code/feed.atom"/>
      <locator xlink:label="ticket" xlink:role="rss" xlink:title="[DoCookBook] Recent Ticket Changes (RSS)" xlink:href="http://sf.net/p/doccookbook/tickets/feed.rss"/>
      <locator xlink:label="ticket" xlink:role="atom" xlink:title="[DoCookBook] Recent Ticket Changes (Atom)" xlink:href="http://sf.net/p/doccookbook/tickets/feed.atom"/>
    </extendedlink>
    
    <author xml:id="author">
      <personname>
        <firstname>Thomas</firstname>
        <surname>Schraitle</surname>
      </personname>
      <email>docbook-xml@online.ms</email>
    </author>
    <othercredit class="proofreader">
      <personname>
        <firstname>Antje</firstname>
        <surname>Faber</surname>
      </personname>
      <contrib>Proofreading, suggestions, and ideas</contrib>
    </othercredit>
    <edition>1</edition>
    <keywordset>
      <keyword>DocBook</keyword>
      <keyword>DocBook Stylesheets</keyword>
      <keyword>Customization</keyword>
      <keyword>XSLT</keyword>
    </keywordset>
    
    <cover xml:id="draftahead">
      <para>
        <note>
          <title>Draft Ahead!</title>
          <para>This book is a draft and is still a work in progress. You
            will find funny typos, mistakes in English grammar 
            (being a native German speaker) annoying inconsistencies,
            missing topics, and plain errors. Nevertheless, I hope the
            topics are useful and a source of ideas.</para>
          
          <para>Visit this site from time to time and see how the book
            grows and how more and more of these irritants vanish.
            To accelerate this process, send me praise, critisism,
            patches, donations, or even write a topic. Read <xref linkend="dbc.preface.contrib"/> to find out more about
            supporting this project.</para>
        </note>
      </para>      
    </cover>
    <?xml-model href="../../frameworks/rng/5.1/dbref.rnc" type="application/relax-ng-compact-syntax"?><revhistory xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" version="5.1" xml:id="revisionhistory">
  <title>Revision History</title>
  
  <revision xml:id="r0.7">
    <revnumber>0.7</revnumber>
    <date>2014-04-18</date>
    <author>
      <personname>
        <firstname>Thomas</firstname>
        <surname>Schraitle</surname>
      </personname>
    </author>
    <authorinitials>toms</authorinitials>
    <revdescription>
      <para>Seventh public release, see <link xlink:href="https://sf.net/mailarchive/message.php"/></para>
    </revdescription>
  </revision>
  
  <revision xml:id="r0.6">
    <revnumber>0.6</revnumber>
    <date>2012-06-10</date>
    <author>
      <personname>
        <firstname>Thomas</firstname>
        <surname>Schraitle</surname>
      </personname>
    </author>
    <authorinitials>toms</authorinitials>
    <revdescription>
      <para>Sixth public release, see <link xlink:href="https://sf.net/mailarchive/message.php?msg_id=29388815"/></para>
    </revdescription>
  </revision>
  
  <revision xml:id="r0.5">
    <revnumber>0.5</revnumber>
    <date>2012-04-22</date>
    <author>
      <personname>
        <firstname>Thomas</firstname>
        <surname>Schraitle</surname>
      </personname>
    </author>
    <authorinitials>toms</authorinitials>
    <revdescription>
      <para>Fifth public release, see <link xlink:href="https://sf.net/mailarchive/message.php?msg_id=29164534"/></para>
    </revdescription>
  </revision>
  
  <revision xml:id="r0.4">
    <revnumber>0.4</revnumber>
    <date>2012-01-29</date>
    <author>
      <personname>
        <firstname>Thomas</firstname>
        <surname>Schraitle</surname>
      </personname>
    </author>
    <authorinitials>toms</authorinitials>
    <revdescription>
      <para>Fourth public release, see <link xlink:href="https://sf.net/mailarchive/message.php?msg_id=28755847"/></para>
    </revdescription>
  </revision>
  
  <revision xml:id="r0.3">
    <revnumber>0.3</revnumber>
    <date>2011-12-28</date>
    <author>
      <personname>
        <firstname>Thomas</firstname>
        <surname>Schraitle</surname>
      </personname>
    </author>
    <authorinitials>toms</authorinitials>
    <revdescription>
      <para>Third public release, see <link xlink:href="http://sf.net/mailarchive/message.php?msg_id=28599375"/></para>
    </revdescription>
  </revision>
  
  <revision xml:id="r0.2">
    <revnumber>0.2</revnumber>
    <date>2011-12-23</date>
    <author>
      <personname>
        <firstname>Thomas</firstname>
        <surname>Schraitle</surname>
      </personname>
    </author>
    <authorinitials>toms</authorinitials>
    <revdescription>
      <para>Second public release, see <link xlink:href="https://sf.net/mailarchive/message.php?msg_id=28585391"/></para>
    </revdescription>
  </revision>
  
  <revision xml:id="r0.1">
    <revnumber>0.1</revnumber>
    <date>2011-12-07</date>
    <author>
      <personname>
        <firstname>Thomas</firstname>
        <surname>Schraitle</surname>
      </personname>
    </author>
    <authorinitials>toms</authorinitials>    
    <revdescription>
      <para>First public revision announced</para>
    </revdescription>
  </revision>
</revhistory>
  </info>
    
  <!--
    License CC BY-NC-SA 3.0

   This work is licensed under the 
   "Namensnennung – Keine kommerzielle Nutzung – Weitergabe unter
    gleichen Bedingungen 3.0 Deutschland (CC BY-NC-SA 3.0)"
   http://creativecommons.org/licenses/by-nc-sa/3.0/de/deed.de

   Read the English translation here:

   "Attribution-NonCommercial-ShareAlike 3.0 Unported (CC BY-NC-SA 3.0)"
   http://creativecommons.org/licenses/by-nc-sa/3.0/

--><preface xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="dbc.preface" version="5.1">
  <title>Welcome!</title>
  <info>
    <definitions definitionfile="defs.xml"/>
    <keywordset>
      <keyword>preface</keyword>
    </keywordset>
  </info>

  <blockquote>
    <title>Mission</title>
    <para><citetitle xlink:href="https://doccookbook.sf.net">&projectname;</citetitle> aims to create an open source
      book about <phrase xlink:href="http://www.docbook.org/">DocBook</phrase> and the <phrase xlink:href="&uri.dbxsl;/doc/">DocBook XSL stylesheets</phrase> written as cookbook
      and released under Creative Commons license.
    </para>
  </blockquote>

  <para>According to its <phrase xlink:href="http://www.docbook.org/whatis">homepage</phrase>,
      <quote>DocBook is a schema (available in several languages
      including RELAX NG, SGML and XML DTDs, and W3C XML Schema)
      maintained by the DocBook Technical Committee of OASIS. It is
      particularly well suited to books and papers about computer
      hardware and software (though it is by no means limited to these
      applications).</quote></para>
  <para>Although there are helpful and valuable documentation―be it as a
    printed book<footnote xml:id="fnt.tdg">
      <para>Like the reference <citetitle xlink:href="http://www.docbook.org/tdg51/en/html/docbook.html">DocBook 5: The Definitive Guide</citetitle> from <personname>
          <firstname>Norman</firstname>
          <surname>Walsh</surname>
        </personname> or <personname>
          <firstname>Bob</firstname>
          <surname>Stayton</surname>
        </personname>'s <citetitle xlink:href="http://www.sagehill.net/docbookxsl/">DocBook
          XSL</citetitle></para>
    </footnote> or online<footnote>
      <para><personname>
          <firstname>Dave</firstname>
          <surname>Pawson</surname>
        </personname> maintains a <link xlink:href="http://www.dpawson.co.uk/">DocBook FAQ</link> and
        the previous mentioned books can be found online too.</para>
    </footnote>―I always felt there is a gap. This gap could be bridged
    with a guide that only concentrates on problems and their solution
    in a concise manner explained by step-by-step procedures. Until now
    nobody wrote a book that combines possible problems, pitfalls,
      <quote>how to do this</quote>, and the benefits in a cookbook
    style. My book is intented to be such a book. However, it
      <emphasis>does not</emphasis> seek to replace any other
    information, be it printed or online. It aims for
      <emphasis>enhancing</emphasis> the world of DocBook with a
    different view. </para>
  <para> The topics in this book are mostly based on my own experiences
    with DocBook and the DocBook XSL stylesheets. However, it also
    includes questions and answers from other sources: from the DocBook
    mailinglists, other sites that inspired me, or questions from
    collegues. It is the nature of such topics that there might be some
    overlap with other sources. When other authors inspired me, I have
    included their names. If you think your name is missing, please let
    me know. </para>
  <para>As I have learned (and still do) a lot from the masters of DocBook,
    it is time to give something back. What you are reading is the first
    draft of the fruits of these efforts.
    Currently, this book is available under a
    Creative Commons license (see <xref linkend="legalnotice"/> if you
    want to know more). I hope you enjoy reading this book as much as I
    enjoy writing it. </para>

  <section xml:id="dbc.preface.audience">
    <title>Audience</title>
    <para>This book covers topics which range from very easy to pretty
      demanding. The more challenging a problems is the more you need
      experience from different domains (CSS, FO, XSLT, etc.) As such,
      this book does not and cannot attempt to teach you DocBook or any
      such related technology (with the exception of <xref linkend="dbc.markup"/>). If you want to learn DocBook or need
      some help with XML or XSLT, search elsewhere. There are plenty of
      information available either online or printed. </para>
    <para>This book is aimed at DocBook users who write
        <emphasis>and</emphasis> seek answers for their customization
      problems. However, with some try-and-error, it can also be useful
      for ordinary writers who want to try something out. For readers
      who want further information, links are included in the <citetitle>See
        Also</citetitle> section at the end of each topic. </para>
  </section>

  <section xml:id="dbc.preface.db4-vs-5">
    <title>DocBook 4 or 5?</title>
    <para>Although a lot of these topics can be used for both versions
      with minimal changes, this book focuses on DocBook 5. Why?
      There are several reasons: </para>

    <itemizedlist>
      <listitem>
        <para>DocBook 4 is in maintenance mode and DocBook 5
          is the future.</para>
      </listitem>
      <listitem>
        <para>I wanted to show exhaustive examples for
          DocBook 5. With this book, I hope, users can learn how to
          adopt and use it.</para>
      </listitem>
      <listitem>
        <para>It is easy to transform DocBook 4 into version 5 as
          shown in <xref linkend="dbc.structure.db4-to-db5"/>.</para>
      </listitem>
      <listitem>
        <para>It simplifies writing <emphasis>a lot</emphasis> if you
          can concentrate on only one version and not on two. It is also
          easier to read for you.</para>
      </listitem>
    </itemizedlist>

    <para>The differences are documented in the <citetitle>DocBook5: The
        Definitive Guide</citetitle> book, section <citetitle xlink:href="http://www.docbook.org/tdg5/en/html/ch01.html#introduction-whats-new">What’s New in DocBook V5.0?</citetitle>.</para>

    <para>Apart from the DocBook examples, the transformation examples
      are currently based on the DocBook XSL 1.0 stylesheets.
      They are stable, well-documented and can be used with any XSLT 1.0
      processor.
    </para>
    <para>On the other side, there is always the tension between
      implementing new concepts and retaining backward compatibility.
      For this reason, the XSLT 1.0 stylesheets are rewritten for XSLT
      2.0. This task is not finished yet. As soon as they are
      production-stable, they will be covered in this book too.</para>
  </section>

  <section xml:id="dbc.preface.further-reading">
    <title>Further Readings</title>
    <para>By no means is this book complete. As this book is based on
      technologies like CSS, XML, (X)HTML, and XSLT, it is always a good
      idea to seek other information. I highly recommend to read the
      books by <personname>
        <firstname>Norman</firstname>
        <surname>Walsh</surname>
      </personname> and <personname>
        <firstname>Bob</firstname>
        <surname>Stayton</surname>
      </personname> as mentioned before.</para>
  </section>
  
  <section xml:id="dbc.preface.typo">
    <title>Typographical Conventions</title>
    <para>The following typographical conventions are used in this book:</para>
    <itemizedlist>
      <listitem>
        <para><emphasis>Italic</emphasis> is used for definition of new
          terms or emphasised text.</para>
      </listitem>
      <listitem>
        <para><literal>Monospace text</literal> is used for code
          listings, XML structures, URLs, filenames, namespaces, or links.</para>
      </listitem>
      <listitem>
        <para><command>Monospace bold text</command> for commands or
          emphasised text in listings.</para>
      </listitem>
      <listitem>
        <para><emphasis><literal>Monospace italic
        text</literal></emphasis> is used for placeholders in
          listings.</para>
      </listitem>
    </itemizedlist>
  </section>

<!--  <section xml:id="dbc.preface.code">
    <title>About the Code Examples</title>
    <para>As XML code tend to be verbose, all code examples in this book
      are intentionally kept concise. That means, in same cases, only
      the relevant portions of the code is shown to avoid distraction.
      Code that is not important is reduced to three dots
        (<literal>...</literal>). Unfortunately, this could lead to
      examples which are not well-formed or even invalid.</para>

    <para>Another important point about the examples are namespaces. The
      namespace declarations are usually not shown if they aren't
      necessary or <quote>well-known</quote>. In most cases it is
      recommended to declare them in the root element anyway. In this
      book all the well-known namespace prefixes (if given) and
      namespace URLs are collected in <xref linkend="tab.prefix-and-ns"
      />. Although a namespace prefix can be selected freely, it is
      common practise to use the well-established name in the
      table.</para>
    <para>For example, to use XLink (a syntax for referencing content),
      declare the XLink namespace in the root element by using the
      prefix (here: <tag class="prefix">xlink</tag>) with the XLink
      namespace:</para>
    <screen>&lt;book <emphasis 
      role="bold">xmlns:xlink="http://www.w3.org/1999/xlink"</emphasis
      > ...></screen>
    <para>Once declared, the namespace prefix is bound to its namespace
      URL and can be used wherever it is needed:</para>
    <screen>&lt;link <emphasis role="bold">xlink</emphasis>:href="...">...&lt;/link></screen>

    <table xml:id="tab.prefix-and-ns">
      <title>Common Prefixes and Their Namespaces</title>
      <tgroup cols="2">
        <colspec colwidth="1*"/>
        <colspec colwidth="3*"/>
        <thead>
          <row>
            <entry>Prefix</entry>
            <entry>Namespace</entry>
          </row>
        </thead>
        <tbody>
          <row>
            <entry><tag class="prefix">d</tag><footnote>
              <para>In this book the DocBook prefix is omitted and the
                standard namespace is used.</para>
            </footnote>, <tag class="prefix">db</tag></entry>
            <entry><tag class="namespace">http://docbook.org/ns/docbook</tag></entry>
          </row>
          <row>
            <entry><tag class="prefix">fo</tag></entry>
            <entry><tag class="namespace">http://www.w3.org/1999/XSL/Format</tag></entry>
          </row>
          <row>
            <entry><tag class="prefix">h</tag></entry>
            <entry><tag class="namespace">http://www.w3.org/1999/xhtml</tag></entry>
          </row>
          <row>
            <entry><tag class="prefix">mml</tag></entry>
            <entry><tag class="namespace">http://www.w3.org/1998/Math/MathML</tag></entry>
          </row>
          <row>
            <entry><tag class="prefix">rng</tag></entry>
            <entry><tag class="namespace">http://relaxng.org/ns/structure/1.0</tag></entry>
          </row>
          <row>
            <entry><tag class="prefix">svg</tag></entry>
            <entry><tag class="namespace">http://www.w3.org/2000/svg</tag></entry>
          </row>
          <row>
            <entry><tag class="prefix">xi</tag></entry>
            <entry><tag class="namespace">http://www.w3.org/2001/XInclude</tag></entry>
          </row>
          <row>
            <entry><tag class="prefix">xlink</tag></entry>
            <entry><tag class="namespace">http://www.w3.org/1999/xlink</tag></entry>
          </row>
          <row>
            <entry><tag class="prefix">xsd</tag></entry>
            <entry><tag class="namespace">http://www.w3.org/2001/XMLSchema</tag></entry>
          </row>
          <row>
            <entry><tag class="prefix">xsl</tag></entry>
            <entry><tag class="namespace">http://www.w3.org/1999/XSL/Transform</tag></entry>
          </row>
        </tbody>
      </tgroup>
    </table>
  </section>-->

  <section xml:id="dbc.preface.feedback">
    <title>Feedback</title>
    <para>The project is hosted on <trademark xlink:show="new" xlink:href="https://github.com" class="registered">GitHub</trademark> under the
      name <link xlink:show="new" xlink:href="&gh.uri;">&gh.project;</link>.
      Or write me directly to <email>&prj.mail;</email>.
      Feel free to send me praise, constructive criticism, suggestions,
      ideas, improvements, or anything else.
    </para>
  </section>

  <section xml:id="dbc.preface.contrib">
    <title>Contribute to the Book</title>
    <para>The source code of this book is published and maintained as a
      <application xlink:href="https://git-scm.com">Git</application> repository.
      Feel free to clone it, make improvements and
      mail me your changes to <email>&prj.mail;</email><!--
        or use the link <link
        xlink:href="https://sourceforge.net/sendmessage.php?touser=27667"
      />-->.
    </para>
    <para>
      Getting a copy takes just a few seconds.
      If you have Git already installed on your system, run the
      following command:</para>
    <screen>git clone &gh.git.repo.url;</screen>
    <para>Git is a free, distributed version control system and
      available for Mac, Linux, and Windows. Download it from <link xlink:href="https://git-scm.com/downloads"/>.</para>
    <para>If you do not want to change the source code, but want to
    contribute, open a ticket. Describe your bugs, grammar errors, typos,
    or other inconveniences you have found and add them to the list at
    <link xlink:href="&gh.uri;/issues/new"/>.
    </para>
  </section>

  <section xml:id="dbc.preface.piwik">
    <title>A Few Words About Piwik</title>
    <para>If you are reading this text online, you may have noticed that
      this project uses <application xlink:href="http://piwik.org">Piwik</application>. According to its home page, Piwik is a
        <quote>real time web analytics software program</quote>. The
      results from Piwik give me detailed reports about my Web site
      visitors: where do they come from, which browser and operating
      system they use and so on. </para>
    <para>Why Piwik? First it is open source, but that is not the main
      reason. The main reason why I use Piwik is it collects data
      anonymously to create statistical studies. With these results I
      can not only improve the HTML page but make the whole project
      better.</para>
    <para>For example, if my visitors browsing the Web through Firefox,
      Opera, and Chromium instead of Internet Explorer, I can focus more
      on the first three browsers. Focusing on one area gives me more
      time to write cool new topics. Or improve existing text. Or draw
      nice graphics. Furthermore with the collected data I can see which
      topics are the most popular and which needs additional devotion. I
      hope you get the idea.</para>
    <para>Just to make it clear: The collected data is completely
      anonymous and <emphasis>only</emphasis> used to improve this project.
      It will <emphasis>never</emphasis> be sold nor will it be used to spam
      you.</para>
  </section>

  <!--<section xml:id="dbc.preface.faq">
    <title>FAQ</title>
    <qandaset>
      <qandaentry>
        <question>
          <para>Why is my problem not covered?</para>
        </question>
        <answer>
          <para>This can have several reasons: it is already planned but
          not written yet or I was not aware of this issue. Probably it
          is just a lack of time. If you think, you have covered or know
          some topic, I would really appreciate it if you contribute
          your ideas. Just fill out a ticket on <link 
            xlink:href="https://sourceforge.net/p/doccookbook/tickets/"/>
            or write me an email to <email>&mymail;</email>.
          </para>
        </answer>
      </qandaentry>
      <qandaentry>
        <question>
          <para>aaa</para>
        </question>
        <answer>
          <para>bbb</para>
        </answer>
      </qandaentry>
    </qandaset>
  </section>-->

  <section xml:id="dbc.preface.license">
    <title>Licensed under Creative Commons</title>
    <para>The book is currently released under a Creative Commons
        <acronym xlink:href="http://creativecommons.org/licenses/by-nc-sa/3.0/de/deed.en">CC BY-NC-SA 3.0 DE<alt>Creative Commons
          Attribution-NonCommercial-ShareAlike 3.0</alt></acronym>
      license (see original German text in <xref linkend="cc-by-nc-sa-30-de" xrefstyle="select:label"/> or the
      English translation in <xref linkend="cc-by-nc-sa-30-unported" xrefstyle="select:label"/>). After this book is finished, the
      license will be changed to <acronym xlink:href="http://creativecommons.org/licenses/by-sa/3.0/de/deed.en">CC BY-SA 3.0 DE<alt>Creative Commons Attribution-ShareAlike 3.0</alt></acronym>.</para>
  </section>

  <section xml:id="dbc.preface.ack">
    <title>Acknowledgments</title>
    <para>Such a large project is usually not a one man show. Many
    people contributed to this book:</para>
    <!--  -->
    <!--<para>Written <?dbtimestamp?></para>-->
    <itemizedlist>
      <listitem>
        <para><personname>
          <firstname>Antje</firstname>
          <surname>Faber</surname>
        </personname> for proofreading some of my texts and the original
          idea.</para>
      </listitem>
      <listitem>
         <para><personname>
          <firstname>Stefan</firstname>
          <surname>Hinz</surname>
        </personname> for providing me with valuable feedback and improvements.</para>
      </listitem>
      <listitem>
        <para><personname>
          <firstname>Lars</firstname>
          <surname>Vogel</surname>
        </personname> for his suggestions and improvements.</para>
      </listitem>
      <listitem>
        <para><personname>
          <firstname>Norman</firstname>
          <surname>Walsh</surname>
        </personname> for DocBook, the DocBook stylesheets, and all the
          nice tools that makes live with DocBook so much easier.</para>
      </listitem>
      <listitem>
        <para><personname>
          <firstname>Matthias</firstname>
          <surname>Weckbecker</surname>
        </personname> for helping me with some wording and ideas.</para>
      </listitem>
    </itemizedlist>
  </section>
</preface>
  
  <!--
    License CC BY-NC-SA 3.0
  
   This work is licensed under the 
   "Namensnennung – Keine kommerzielle Nutzung – Weitergabe unter
    gleichen Bedingungen 3.0 Deutschland (CC BY-NC-SA 3.0)" 
   http://creativecommons.org/licenses/by-nc-sa/3.0/de/deed.de
   
   Read the English translation here:
   
   "Attribution-NonCommercial-ShareAlike 3.0 Unported (CC BY-NC-SA 3.0)" 
   http://creativecommons.org/licenses/by-nc-sa/3.0/
   
--><?xml-model href="5.1/dbref.rnc" type="application/relax-ng-compact-syntax"?><chapter xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="dbc.markup" remap="topic">
  <title>Knowing DocBook’s Structure</title>
  <info>
    <definitions definitionfile="defs.xml"/>
    <biblioid class="other" otherclass="ticket">6</biblioid>
    <keywordset>
      <keyword>docbook markup</keyword>
    </keywordset>
    <abstract>
      <para>DocBook has a wide variety of elements covering different
        semantics: from structural elements like <tag>book</tag>,
        <tag>chapter</tag>, <tag>appendix</tag>, to block elements like
          <tag>orderedlist</tag>, <tag>table</tag>, <tag>figure</tag>,
        to inline elements like <tag>filename</tag>, <tag>quote</tag>,
        or <tag>link</tag>. All of these elements are well covered in
          <citetitle xlink:href="http://www.docbook.org/tdg51/en/html/docbook.html">The Definitive Guide</citetitle>. This chapter
        shows more the unknown parts and how to avoid pitfalls and
        improve consistency throughout your documentation. </para>
    </abstract>
  </info>
  
  <section xml:id="dbc.markup.intro">
    <title>Introduction</title>
    <para>To successfully use DocBook you basically
      need to know how to <quote>transform</quote> your ideas into DocBook’s
      structure. Usually, the DocBook elements are mostly
      self-explanatory: if you want to write a book, use
      <tag>book</tag>, for a chapter use <tag>chapter</tag> and so on.
      All you need is covered in the <citetitle xlink:href="http://www.docbook.org/tdg51/en/html/docbook.html">Definitive
        Guide</citetitle> with examples and the reference of all
      elements.</para>
    <para>However, a reference usually do not cover the finer details.
      For example, should I use <tag>sect1</tag> or <tag>section</tag>?
      How do I modularize my documentation? What is the recommendation
      to use multiple indices?</para>
  </section>
  
  <!-- 
   * Knowing the Differences Between DocBook's Version 4 and Version 5
   * Modularize your Document with XIncludes
   * Modularize your Document with Assemblies
   * Differentiate DocBook Elements (Divisions, Block, Inline)
   * Writing Topics with DocBook
   * Distinguish Between Section and SectX
   * Using Lists
   * Using Tables
   * Adding Codelistings
   * Implementing Cross References
   * Writing a Glossary
   * Inserting Remarks
   * Writing a Reference
   * Writing Bibliographies
   * Inserting Indexterms
   * Adding Images
   * Utilize Extended XLinks
     http://www.balisage.net/Proceedings/vol7/html/Vlist01/BalisageVol7-Vlist01.html
   * Knowing DocBook Derivates: Simple DocBook, Publishers Schema
   * Using Alternative Description for Acronyms
     <acronym><alt>extensible Markup Language</alt>XML</acronym>
   * Using Manpage Notation
     <citerefentry>
      <refentrytitle>foo</refentrytitle><manvolnum>1</manvolnum>
    </citerefentry>
   * Inserting Inline Quotes
  -->
  <!--
    License CC BY-NC-SA 3.0
  
   This work is licensed under the 
   "Namensnennung – Keine kommerzielle Nutzung – Weitergabe unter
    gleichen Bedingungen 3.0 Deutschland (CC BY-NC-SA 3.0)" 
   http://creativecommons.org/licenses/by-nc-sa/3.0/de/deed.de
   
   Read the English translation here:
   
   "Attribution-NonCommercial-ShareAlike 3.0 Unported (CC BY-NC-SA 3.0)" 
   http://creativecommons.org/licenses/by-nc-sa/3.0/
   
--><!--<?xml-model href="file:../5.1/dbref.rnc" type="application/relax-ng-compact-syntax"?>--><section xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="dbc.markup.rootelement" remap="topic" userlevel="easy" xml:base="db/topic.toplevel.xml">
  <title>Selecting the Right Top Level Element</title>
  <info>
    <definitions definitionfile="defs.xml"/>
    <keywordset>
      <keyword>top level</keyword>
      <keyword>namespace</keyword>
    </keywordset>
    <!--
    <subjectset>
      <subject>
        <subjectterm></subjectterm>
      </subject>
    </subjectset>
    -->
  </info>
  
  <section role="problem">
    <title>Problem</title>
    <para>You want to know what root elements are possible and what
      else is needed to create a DocBook V5 document.</para>
  </section>
  <section role="solution">
    <title>Solution</title>
    <para>A document type definition (DTD) allows
      <emphasis>every</emphasis> definied element to become a root element. 
      A DTD cannot create any constraints to limit this set.
      On the other hand, RELAX NG -- the official schema language for 
      DocBook 5 and up -- can impose such constraints.</para>
    
    <para>To create a valid DocBook V5 document you need:</para>
    
    <itemizedlist>
      <listitem>
        <para>A valid DocBook V5 element to begin your document.</para>
      </listitem>
      <listitem>
        <para>An attribute <tag class="attribute">version</tag>
          containing the used DocBook version.</para>
      </listitem>
      <listitem>
        <para>The DocBook 5 namespace, possibly other namespaces too.</para>
      </listitem>
    </itemizedlist>
    
    <para>To assemble all the above hints, a valid DocBook 5 document
      could look like this:</para>
    
    <example>
      <title>A Valid DocBook 5 Book</title>
      <screen>&lt;book version="5.0" xmlns="http://docbook.org/ns/docbook"&gt;
  &lt;title&gt;The Example Book&lt;/title&gt;
  &lt;chapter&gt; 
     &lt;title&gt;An Example Chapter&lt;/title&gt;
     &lt;para&gt;This is a paragraph.&lt;/para&gt;
  &lt;/chapter&gt; 
&lt;/book&gt;</screen>
    </example>
    
  </section>
  <section role="discussion">
    <title>Discussion</title>
    <para>There a many more possible root elements, not only <tag>book</tag>.
      Using the list from the last section, a valid DocBook V5
      element to start with can be:</para>
    <simplelist columns="4" type="vert">
      <member><tag>acknowledgements</tag></member>
      <member><tag>appendix</tag></member>
      <member><tag>article</tag></member>
      <member><tag>bibliography</tag></member>
      <member><tag>book</tag></member>
      <member><tag>chapter</tag></member>
      <member><tag>colophon</tag></member>
      <member><tag>dedication</tag></member>
      <member><tag>glossary</tag></member>
      <member><tag>index</tag></member>
      <member><tag>para</tag></member>
      <member><tag>part</tag></member>
      <member><tag>preface</tag></member>
      <member><tag>refentry</tag></member>
      <member><tag>reference</tag></member>
      <member><tag>refsect1</tag></member>
      <member><tag>refsect2</tag></member>
      <member><tag>refsect3</tag></member>
      <member><tag>refsection</tag></member>
      <member><tag>sect1</tag></member>
      <member><tag>sect2</tag></member>
      <member><tag>sect3</tag></member>
      <member><tag>sect4</tag></member>
      <member><tag>sect5</tag></member>
      <member><tag>section</tag></member>
      <member><tag>set</tag></member>
      <member><tag>setindex</tag></member>
      <member><tag>toc</tag></member>
    </simplelist>
    <para>For the next DocBook release, V5.1, the technical committee
      plans to include all elements that can contain an info wrapper. </para>

    <para>Regarding namespaces, DocBook 5 uses only one namespace (which is
    <tag class="namespace">http://docbook.org/ns/docbook</tag>).
      However, sometimes it is needed to include other in order to 
      adhere to the XML specification. </para>
    <para>A namespace declaration consists of an (optional) namespace prefix and a
      namespace URI. The prefix can be selected freely, however, it is
      recommended to use the prefixes in <xref linkend="tab.prefix-and-ns"/>. 
      Although they are not a <quote>standard</quote> in its strict
      sense, but over time they have been extensively used.</para>

    <table xml:id="tab.prefix-and-ns">
      <title>Common Prefixes and Their Namespaces</title>
      <tgroup cols="2">
        <colspec colwidth="1*"/>
        <colspec colwidth="3*"/>
        <thead>
          <row>
            <entry>Prefix</entry>
            <entry>Namespace</entry>
          </row>
        </thead>
        <tbody>
          <row>
            <entry><tag class="prefix">d</tag><footnote>
              <para>In this book the DocBook prefix is omitted and the
                standard namespace is used.</para>
            </footnote>, <tag class="prefix">db</tag></entry>
            <entry><tag class="namespace">http://docbook.org/ns/docbook</tag></entry>
          </row>
          <row>
            <entry><tag class="prefix">fo</tag></entry>
            <entry><tag class="namespace">http://www.w3.org/1999/XSL/Format</tag></entry>
          </row>
          <row>
            <entry><tag class="prefix">h</tag></entry>
            <entry><tag class="namespace">http://www.w3.org/1999/xhtml</tag></entry>
          </row>
          <row>
            <entry><tag class="prefix">mml</tag></entry>
            <entry><tag class="namespace">http://www.w3.org/1998/Math/MathML</tag></entry>
          </row>
          <row>
            <entry><tag class="prefix">rng</tag></entry>
            <entry><tag class="namespace">http://relaxng.org/ns/structure/1.0</tag></entry>
          </row>
          <row>
            <entry><tag class="prefix">svg</tag></entry>
            <entry><tag class="namespace">http://www.w3.org/2000/svg</tag></entry>
          </row>
          <row>
            <entry><tag class="prefix">xi</tag></entry>
            <entry><tag class="namespace">http://www.w3.org/2001/XInclude</tag></entry>
          </row>
          <row>
            <entry><tag class="prefix">xlink</tag></entry>
            <entry><tag class="namespace">http://www.w3.org/1999/xlink</tag></entry>
          </row>
          <row>
            <entry><tag class="prefix">xsd</tag></entry>
            <entry><tag class="namespace">http://www.w3.org/2001/XMLSchema</tag></entry>
          </row>
          <row>
            <entry><tag class="prefix">xsl</tag></entry>
            <entry><tag class="namespace">http://www.w3.org/1999/XSL/Transform</tag></entry>
          </row>
        </tbody>
      </tgroup>
    </table>

    <para>Usually it is a good idea to insert all the namespaces used in
      the document in the root element. For example, <xref linkend="ex.markup.rootelement.nsdecl"/>, shows three namespace
      declarations: the DocBook namespace, using no prefix; the XInclude
      namespace using the <tag class="prefix">xi</tag> prefix, and the XLink
      namespace using the <tag class="prefix">xlink</tag> prefix.</para>
    
    <example xml:id="ex.markup.rootelement.nsdecl">
      <title>Start Tag with Several Namespace Declarations</title>
      <screen>&lt;book version="5.0"
   xmlns="http://docbook.org/ns/docbook"
   xmlns:xi="http://www.w3.org/2001/XInclude"
   xmlns:xlink="http://www.w3.org/1999/xlink"&gt;</screen>
    </example>
  </section>
  <!--<section role="seealso">
    <title>See Also</title>
    <para>Include URL or bibliographic references.</para>
  </section>-->
</section> 
  <!--
    License CC BY-NC-SA 3.0
  
   This work is licensed under the 
   "Namensnennung – Keine kommerzielle Nutzung – Weitergabe unter
    gleichen Bedingungen 3.0 Deutschland (CC BY-NC-SA 3.0)" 
   http://creativecommons.org/licenses/by-nc-sa/3.0/de/deed.de
   
   Read the English translation here:
   
   "Attribution-NonCommercial-ShareAlike 3.0 Unported (CC BY-NC-SA 3.0)" 
   http://creativecommons.org/licenses/by-nc-sa/3.0/
   
--><?xml-model href="../5.1/dbref.rnc" type="application/relax-ng-compact-syntax"?><section xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="dbc.markup.xincludes" remap="topic" userlevel="easy" xml:base="db/topic.modularize.xml">
  <title>Modularize Your Document with XIncludes</title>
  <info>
    <definitions definitionfile="defs.xml"/>
    <keywordset>
      <keyword>XInclude</keyword>
      <keyword>modularization</keyword>
    </keywordset>
    <subjectset>
      <subject>
        <subjectterm>modules</subjectterm>
        <subjectterm>markup</subjectterm>
        <!--<subjectterm>xref</subjectterm>-->
        <subjectterm>xinclude</subjectterm>
      </subject>
    </subjectset>
  </info>
  
  <section role="problem">
    <title>Problem</title>
    <para>You need a method to split your document into several
        <quote>modules</quote> and put it together afterwards.</para>
  </section>
  <section role="solution">
    <title>Solution</title>
    <para>Use <emphasis role="italic">XInclude</emphasis>. It is a <acronym>W3C<alt>World Wide Web Consortium</alt></acronym>
      specification and defines the elements <tag>xi:include</tag> and
        <tag>xi:fallback</tag>. They are not DocBook elements (as they
      are definied by the <acronym>W3C</acronym> and not <acronym>OASIS<alt>Organization for the Advancement of Structured Information Standards</alt></acronym>), however 
      they have been integrated in version 5.x<footnote>
        <para>To use XInclude with DocBook 5.x, use the
            <filename>docbookxi.rnc</filename> RELAX NG schema. </para>
      </footnote>. Note, XIncludes work in DocBook regardless which
      version (4.x or 5.x) you use.</para>
    <para>If you want to use XIncludes, you need these things:</para>
    <itemizedlist>
      <listitem>
        <para>A XML parser who supports XIncludes.</para>
      </listitem>
      <listitem>
        <para>The XInclude namespace <uri>http://www.w3.org/2001/XInclude</uri>, usually bound to
          the <tag class="prefix">xi</tag> prefix.</para>
      </listitem>
      <listitem>
        <para>The element <tag>xi:include</tag>. In general, it can be placed everywhere where you
          can place DocBook elements. It is a placeholder for the real content and works as a
            reference. </para>
      </listitem>
      <listitem>
        <para>The attribute <tag class="attribute">href</tag> inside the
            <tag class="starttag">xi:include</tag> start tag. It is an URI which refers to
          your included file.</para>
      </listitem>
      <listitem>
        <para>The file which is referenced by the <tag class="attribute">href</tag> attribute. The content of the
          file will replace the <tag>xi:include</tag> element. It
          contains usually a DocBook element with its content.</para>
      </listitem>
    </itemizedlist>
    <para>The following example shows a book which points to a
      substructure assuming chapters:</para>
    <example xml:id="ex.db.xincludes.book-with-3-chapters">
      <title>A Book with XIncluded Chapters</title>
      <programlisting language="xml">&lt;book version="5.0"
  xmlns="http://docbook.org/ns/docbook"
  xmlns:xi="http://www.w3.org/2001/XInclude"&gt;
  &lt;title&gt;...&lt;/title&gt;
  <emphasis role="bold">&lt;xi:include href="intro.xml"/&gt;
  &lt;xi:include href="conceptual-overview.xml"/&gt;</emphasis>
&lt;/book&gt;</programlisting>
    </example>
    <para>The above book contains an introduction (file
        <filename>intro.xml</filename>) and a conceptual overview (file
        <filename>conceptual-overview.xml</filename>). Both are
      referenced by the XInclude´s <tag class="attribute">href</tag>
      attribute. </para>
    <para>Before you transform your document, you need to resolve your XIncludes first, either by
      your XML parser or <quote>manually</quote> by a XSLT transformation. The following procedure
      shows a typical workflow:</para>
    <procedure>
      <title>Typical Workflow with XIncludes</title>
      <step>
        <para>Write your document structure, usually it will be a book or an article. Do not forget
          to include the XInclude namespace <uri>http://www.w3.org/2001/XInclude</uri> into the root
          element, commonly bound to the prefix <tag class="prefix">xi</tag>.</para>
      </step>
      <step>
        <para>Add <tag>xi:include</tag> elements for those content you want to maintain in a
          separate file. Typically, this can be an appendix, chapter, preface, glossary, or any
          other DocBook element.</para>
      </step>
      <step>
        <para>Resolve your XIncludes. Use a XML parser who supports XIncludes, for example,
            <command>xmllint</command> from the <link xlink:href="http://xmlsoft.org">libxml2
            library</link>. This XML parser brings the <option>--xinclude</option> option to resolve
          all your XInclude elements in one step:</para>
        <screen><command>xmllint</command> --xinclude --output big.xml book.xml</screen>
        <para>The above command resolves all XIncludes and saves the
          result in the file <filename>big.xml</filename>. Note, this
          does not perform any validation! It just replaces
            <tag>xi:include</tag> with the content of the referenced
          file. After the XInclude elements are resolved, the file looks
          now like this:</para>
        <programlisting language="xml">&lt;book version="5.0"
  xmlns="http://docbook.org/ns/docbook"
  xmlns:xi="http://www.w3.org/2001/XInclude"&gt;
  &lt;title&gt;...&lt;/title&gt;
  &lt;chapter&gt;
    &lt;title&gt;Introduction&lt;/title&gt;
    &lt;para&gt;...&lt;/para&gt;
  &lt;/chapter&gt;
  &lt;chapter&gt;
   &lt;title&gt;Conceptual Overview&lt;/title&gt;
   &lt;para&gt;...&lt;/para&gt;
  &lt;/chapter&gt;
&lt;/book&gt;</programlisting>
      </step>
      <step>
        <para>Validate the result (in our example, it is
            <filename>big.xml</filename>) with your DocBook schema. </para>
      </step>
      <step>
        <para>Transform the result file with your stylesheets into your
          target format.</para>
      </step>
    </procedure>
  </section>
  <section role="discussion">
    <title>Discussion</title>
    <para>The previous procedure showed a book with xincluded chapters.
      It is possible to even go deeper and include also section into a
      chapter. Actually, there is no limit. You should only be aware
      that you do not create circular references (file A includes file B
      and B includes A).</para>
    <para>As XIncludes are very common nowadays, resolving
        <tag>xi:include</tag> and transforming into the output format
      can be done in one step. This is the case for most tools:
    </para>

    <variablelist>
      <varlistentry>
        <term><command>xmllint</command> from the libxslt library</term>
        <listitem>
          <para>Use the <option>--xinclude</option> option as shown:</para>
          <screen><command>xsltproc</command> --xinclude<!--
    --> <replaceable>STYLESHEET</replaceable><!--
    --> <replaceable>XMLFILE</replaceable></screen>
        </listitem>
      </varlistentry>
      <varlistentry>
        <term>Saxon 6</term>
        <listitem>
          <para>Unfortunately, Saxon 6 needs some more configuration. Most
            Linux distribution have already a <command>saxon6</command> command.
            However, it can be difficult to customize it correctly, so
            this is the line you need:
          </para>
          <screen><command>java</command> -Dorg.apache.xerces.xni.parser.XMLParserConfiguration=org.apache.xerces.parsers.XIncludeParserConfiguration \
   <replaceable>JARPATH</replaceable>/saxon6.jar:<replaceable>JARPATH</replaceable>/xml-commons-apis.jar:<replaceable>JARPATH</replaceable>/jaxp_parser_impl.jar:<replaceable>JARPATH</replaceable>/xml-commons-resolver.jar \
   com.icl.saxon.StyleSheet \
   -x org.apache.xml.resolver.tools.ResolvingXMLReader \
   -y org.apache.xml.resolver.tools.ResolvingXMLReader \
   -r org.apache.xml.resolver.tools.CatalogResolver\
   <replaceable>ARGS</replaceable></screen>
          <para>The line contains different properties:</para>
          <itemizedlist>
            <listitem>
              <para>The <property>org.apache.xerces.xni.parser.XMLParserConfiguration</property>
              property sets the XInclude processor which is done by Xerces
              in this case.
              </para>
            </listitem>
            <listitem>
              <para>The <replaceable>JARPATH</replaceable> is the path to your
                JAR files. In most FHS conformant Linux distributions,
                nowadays this is usually <filename>/usr/share/java</filename>.
              </para>
            </listitem>
            <listitem>
              <para>Additionally, with the <filename>xml-commons-resolver.jar</filename>
              file, Saxon 6 is able to resolve catalogs. To tell Saxon
              you need to set the <option>-r</option>, <option>-x</option>,
                and <option>-y</option> options the a URI resolver class, and
                the specified Sax parser for source file and stylesheet.
              </para>
            </listitem>
            <listitem>
              <para>The <replaceable>ARGS</replaceable> are the specific
              arguments for Saxon and contains source document and stylesheet.
              To list all available options, use <option>-h</option>.
              </para>
            </listitem>
          </itemizedlist>
        </listitem>
      </varlistentry>
      <varlistentry>
        <term>Saxon 9</term>
        <listitem>
          <para>Version 9 contains the <option>-xi</option> option to resolve
            XIncludes (assuming you have a script <command>saxon9</command>
            which does all the heavy Java lifting):</para>
          <screen><command>saxon9</command> -xi -xsl:<replaceable>STYLESHEET</replaceable> -s:<replaceable>XMLFILE</replaceable></screen>
        </listitem>
      </varlistentry>
    </variablelist>

    <para>The last section showed a general method to work with
      XIncludes. In most cases this is enough. However, XIncludes offers
      more benefits which are discovered in the following
      subsections.</para>
    <section xml:id="sec.db.modularize.xifallback">
      <title>Fallbacks</title>
      <para>If the referenced file in the <tag>xi:include</tag> element
        is not available, the XInclude step will fail. How can you avoid
        that? The XInclude specification defines also the
          <tag>xi:fallback</tag> element. This element can be used to
        add code when a referenced resource could not be retrieved:</para>
      <example xml:id="ex.db.modularize.xifallback">
        <title>Fallback Possibility with <tag>xi:fallback</tag></title>        
        <programlisting language="xml">&lt;xi:include href="revhistory.xml"&gt;
  &lt;xi:fallback&gt;
    &lt;para&gt;The revision history could not be retrieved.&lt;/para&gt;
  &lt;/xi:fallback&gt;
&lt;/xi:include&gt;</programlisting>
      </example>
      <para>The previous code does the following: When the
          <tag>xi:include</tag> element is being processed, the XML
        parser tries to include the file
          <filename>revhistory.xml</filename>. If the file can not be
        retrieved, the XML parser will consider the <tag>xi:fallback</tag> element
        and include the contents. In the above case it includes a
        <tag>para</tag> element showing the failed attempt.</para>
      <para>This method is useful when you want to process files which
        cannot be expected to always be there. For example, the previous
        revision history needs to be generated first. However, it is not
        always sure that the revision history can be generated from an
        possible offline version control system.</para>
    </section>
    
    <section xml:id="sec.db.modularize.include-text">
      <title>Including Text</title>
      <para>The previous examples dealt with included resources in XML
        only. If you need to include text, this can also be done with
        XInclude.</para>
      <para>Most common usecase is including source code which is
      maintained separately. The following example points to a C source
      code which needs to be included as text:</para>
      <example xml:id="ex.db.modularize.include-text">
        <title>Included Text in a Programlisting</title>
        <programlisting language="xml">&lt;programlisting language="c"&gt;&lt;xi:include
   <emphasis role="bold">parse="text"</emphasis>
   href="parser.c"/&gt;&lt;/programlisting&gt;</programlisting>
      </example>
      <para>The important line is <code>parse="text"</code>. This
        advises the XInclude processor to handle the referenced file
        as text and not as XML. The default value for <tag class="attribute">parse</tag> is <tag class="attvalue">xml</tag>.</para>
      <para>It is recommended to remove any whitespaces inside
          <tag>programlisting</tag> as shown above to avoid spurious
        indendation or linebreaks.</para>
      <para>More explanations can be found in <xref linkend="dbc.markup.programlistings-external"/>.</para>
    </section>
    
    <!-- TODO: Move it to another topic? -->
    <!--
    <section xml:id="sec.db.modularize.xpointer">
      <title>Partial Inclusion with XPointer</title>
      <para>Previous examples showed how to include a file with an XML
        structure. The inclusion pulled always the
          <emphasis>complete</emphasis> file. If you need only a
        fragment of this file (for example, a note) use
          <emphasis>XPointers</emphasis>. </para>
      <para>However, XPointers are only partially implemented and some
        parts of the specification are not released as a W3C
        recommendation. Nevertheless they are sometimes helpful if
        used carefully.
      </para>
    </section>
    -->
  </section>
  <section role="seealso">
    <title>See Also</title>
    <itemizedlist>
      <listitem>
        <para><xref linkend="dbc.markup.programlistings-external"/></para>
      </listitem>
      <listitem>
        <para><link xlink:href="http://www.w3.org/TR/xinclude/">XML Inclusions (XInclude) Version 1.0</link></para>
      </listitem>
      <listitem>
        <para><link xlink:href="http://www.sagehill.net/docbookxsl/ModularDoc.html#UsingXinclude">Using XInclude</link></para>
      </listitem>
    </itemizedlist>
  </section>
</section>
  <!--<xi:include href="db/topic.glossary.xml"/>-->
  <!--
    License CC BY-NC-SA 3.0
  
   This work is licensed under the 
   "Namensnennung – Keine kommerzielle Nutzung – Weitergabe unter
    gleichen Bedingungen 3.0 Deutschland (CC BY-NC-SA 3.0)" 
   http://creativecommons.org/licenses/by-nc-sa/3.0/de/deed.de
   
   Read the English translation here:
   
   "Attribution-NonCommercial-ShareAlike 3.0 Unported (CC BY-NC-SA 3.0)" 
   http://creativecommons.org/licenses/by-nc-sa/3.0/
   
--><!--<?xml-model href="file:../5.1/dbref.rnc" type="application/relax-ng-compact-syntax"?>--><section xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="dbc.markup.multiple-indices" remap="topic" userlevel="easy" xml:base="db/topic.multiple-indices.xml">
  <title>Mastering Multiple Indices</title>
  <info>
    <definitions definitionfile="defs.xml"/>
    <keywordset>
      <keyword>index</keyword>
      <keyword>indices</keyword>
    </keywordset>
    <subjectset>
      <subject>
        <subjectterm>index</subjectterm>
      </subject>
    </subjectset>
  </info>
  
  <section role="problem">
    <title>Problem</title>
    <para>You need in your document two separate indices, a general one
      and another one for persons.</para>
  </section>
  <section role="solution">
    <title>Solution</title>
    <para>Use the <tag class="attribute">type</tag> attribute both on
      <tag>indexterm</tag> and <tag>index</tag>. The content of the <tag class="attribute">type</tag> attribute can be any value. Usually
      it is a descriptive name (in our case, <quote>persons</quote> would be fine).
    </para>
    <para>For example, the following paragraph contains two indexterms.
      However, Guido is marked up as a <quote>person's index</quote>:</para>
    <programlisting language="xml">&lt;para&gt; The Python&lt;indexterm&gt;
   &lt;primary&gt;Python&lt;/primary&gt;&lt;/indexterm&gt; programming
   language was designed by 
   Guido van Rossum.&lt;indexterm type="persons"&gt;
   &lt;primary&gt;van Rossum, Guido&lt;/primary&gt;&lt;/indexterm&gt; 
&lt;/para&gt;</programlisting>
    <para>Use two <tag>index</tag> element at the end of your document
      to distinguish between the two:</para>
    <programlisting language="xml">&lt;index/&gt; <co xml:id="co.idx.type.normal"/>
    
&lt;index type="persons"&gt; <co xml:id="co.idx.type.persons"/>
  &lt;title&gt;Persons&lt;/title&gt;
&lt;/index&gt;</programlisting>
    <calloutlist>
      <callout arearefs="co.idx.type.normal">
        <para>Generates the <quote>normal</quote> index as it has no
          <tag class="attribute">type</tag> attribute.</para>
      </callout>
      <callout arearefs="co.idx.type.persons">
        <para>Collects only those index entries which contains a
          <tag class="attribute">type</tag> attribute with the value
          <tag class="attvalue">persons</tag> (as with Guido in the
          above example).</para>
      </callout>
    </calloutlist>
    
  </section>
  <section role="discussion">
    <title>Discussion</title>
    <para>Some documents contain two indices, a general and one for
      persons. This is quite common thesedays as it simplifies where to
      find your search term.  You can add as many indices as you need,
      but more than two are normally uncommon.</para>
    <para>By default, multiple indices are turned on by the DocBook
      stylesheets. So no special customization are needed. However, if
      you want to collect all index terms in one index, set the
      parameter <parameter xlink:href="http://docbook.sf.net/release/xsl/current/doc/html/index.on.type.html">index.on.type</parameter> to <literal>0</literal> (zero). In
      that case, the <tag class="attribute">type</tag> attribute has no
      effect.</para>
  </section>
  <section role="seealso">
    <title>See Also</title>
    <itemizedlist>
      <listitem>
        <para><xref linkend="dbc.structure.adding-indexterms"/></para>
      </listitem>
    </itemizedlist>
  </section>
</section>
  <!--
    License CC BY-NC-SA 3.0
  
   This work is licensed under the 
   "Namensnennung – Keine kommerzielle Nutzung – Weitergabe unter
    gleichen Bedingungen 3.0 Deutschland (CC BY-NC-SA 3.0)" 
   http://creativecommons.org/licenses/by-nc-sa/3.0/de/deed.de
   
   Read the English translation here:
   
   "Attribution-NonCommercial-ShareAlike 3.0 Unported (CC BY-NC-SA 3.0)" 
   http://creativecommons.org/licenses/by-nc-sa/3.0/
   
--><!--<?xml-model href="file:../5.1/dbref.rnc" type="application/relax-ng-compact-syntax"?>--><section xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="dbc.markup.section.vs.sectx" remap="topic" userlevel="easy" xml:base="db/topic.section.vs.sectx.xml">
  <title>Distinguish Between Section and SectX Elements</title>
  <info>
    <definitions definitionfile="defs.xml"/>
    <keywordset>
      <keyword>section</keyword>
      <keyword>sectX</keyword>
      <keyword>sect1</keyword>
      <keyword>nesting sections</keyword>
    </keywordset>
  </info>
  
  <section role="problem">
    <title>Problem</title>
    <para>You need to know what the differences and advantages are of
      using a <tag>section</tag> over a <tag>sectX</tag> element.</para>
  </section>
  <section role="solution">
    <title>Solution</title>
    <para>The differences between <tag>section</tag> against
      <tag>sectX</tag> are depicted in <xref linkend="tab.section.vs.sectx.comparison"/>: </para>
    
    <table xml:id="tab.section.vs.sectx.comparison">
      <title>Comparison Between <tag>section</tag> and <tag>sectX</tag> Elements</title>
      <tgroup cols="3">
        <thead>
          <row>
            <entry>Issue</entry>
            <entry><tag>section</tag></entry>
            <entry><tag>sectX</tag></entry>
          </row>
        </thead>
        <tbody>
          <row>
            <entry>Nesting Level?</entry>
            <entry>Undefinied<footnote>
              <para>See discussion.</para>
            </footnote></entry>
            <entry>Up to five levels (<tag>sect5</tag>)</entry>
          </row>
          <row>
            <entry>Readability?</entry>
            <entry>Worse</entry>
            <entry>Better</entry>
          </row>
          <row>
            <entry>Easy Relocation?</entry>
            <entry>Yes</entry>
            <entry>No, needs to be renamed</entry>
          </row>
          <row>
            <entry>Renaming after relocation?</entry>
            <entry>No</entry>
            <entry>Yes</entry>
          </row>
        </tbody>
      </tgroup>
    </table>
  </section>
  <section role="discussion">
    <title>Discussion</title>
    <para>Apart from technical issues, using <tag>section</tag> or
        <tag>sect1</tag> is in most cases a matter of taste. However,
      knowing some of the differences in <xref linkend="tab.section.vs.sectx.comparison" xrefstyle="select:label"/> can be helpful to decide which is for
      your document the better element.
    </para>
    <formalpara>
      <title>Nesting Level</title>
      <para>If you have documents which goes further than level five,
        use the <tag>section</tag> element. This can be indefinitely
        nested. On the other side, if you want to restrict the level up to
        five, better use the <tag>sectX</tag> elements. You can, however,
        use DocBook's RELAX NG schema to customize it further (see next
        section).</para>
    </formalpara>
    <formalpara>
      <title>Readability</title>
      <para>This issue depends on how you edit your DocBook source code.
        If you edit it manually in your editor (in other words: without
        the aid of some kind of <quote>WYSYWYG</quote>), you can see and
        understand the level straight from the tag name when using
          <tag>sectX</tag>. Especially if you have lots of nested
        section this makes it a lot easier than <tag>section</tag>.
        However, modern XML editors can show the XPath where
        you are, so it may be negligible.</para>
    </formalpara>
    <formalpara>
      <title>Relocation</title>
      <para>If you have to change the structure a lot, using
        <tag>section</tag> elements make it a lot easier. When you use a
      <tag>sect2</tag> element and this should become a <tag>sect1</tag>
      element you have to rename it. </para>
    </formalpara>
  </section>
  <section role="seealso">
    <title>See Also</title>
    <para><link xlink:href="http://www.docbook.org/tdg51/en/html/ch05.html#ex.limitsdepth"/></para>
  </section>
</section>
  <!--
    License CC BY-NC-SA 3.0
  
   This work is licensed under the 
   "Namensnennung – Keine kommerzielle Nutzung – Weitergabe unter
    gleichen Bedingungen 3.0 Deutschland (CC BY-NC-SA 3.0)" 
   http://creativecommons.org/licenses/by-nc-sa/3.0/de/deed.de
   
   Read the English translation here:
   
   "Attribution-NonCommercial-ShareAlike 3.0 Unported (CC BY-NC-SA 3.0)" 
   http://creativecommons.org/licenses/by-nc-sa/3.0/
   
--><!--<?xml-model href="file:../5.1/dbref.rnc" type="application/relax-ng-compact-syntax"?>--><section xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="dbc.markup.lists" remap="topic" userlevel="easy" xml:base="db/topic.lists.xml">
  <title>Using Lists</title>
  <info>
    <definitions definitionfile="defs.xml"/>
    <keywordset>
      <keyword>lists</keyword>
      <keyword>itemizedlist</keyword>
      <keyword>orderedlist</keyword>
      <keyword>variablelist</keyword>
      <keyword>bibliolist</keyword>
      <keyword>calloutlist</keyword>
      <keyword>glosslist</keyword>
      <keyword>segmentedlist</keyword>
      <keyword>simplelist</keyword>
      <keyword>numeration</keyword>
    </keywordset>
  </info>
  
  <section role="problem">
    <title>Problem</title>
    <para>You want to know what list types are available in DocBook.</para>
  </section>
  <section role="solution">
    <title>Solution</title>
    <para>DocBook provides three basic lists which are used most often:</para>
    
    <itemizedlist>
      <listitem>
        <para><tag>itemizedlist</tag>, for unordered lists (like
          <tag>ul</tag> in HTML)</para>
      </listitem>
      <listitem>
        <para><tag>orderedlist</tag> for numbered lists (like
            <tag>ol</tag> in HTML)</para>
      </listitem>
      <listitem>
        <para><tag>variablelist</tag>, for lists containing terms and their
          definition (like <tag>dl</tag> in HTML)</para>
      </listitem>
    </itemizedlist>
    
    <para>Additionally, for specific purposes, DocBook provides special
      lists (not explained in this topic):</para>
    
    <itemizedlist>
      <listitem>
        <para><tag>bibliolist</tag> is a wrapper for bibliographic
          content. A <tag>bibliolist</tag> is usually inserted in
          section-like elements where a <tag>bibliography</tag> is not
          allowed.</para>
      </listitem>
      <listitem>
        <para><tag>calloutlist</tag>, a usually numbered list which
          points to a line in a listing</para>
      </listitem>
      <listitem>
        <para><tag>glosslist</tag> is a wrapper for glossary content.
          A <tag>glosslist</tag> is usually inserted in section-like
          elements where a <tag>glossary</tag> is not allowed.</para>
      </listitem>
      <listitem>
        <para><tag>segmentedlist</tag> is a list which can be used which
          have a one-to-one dependence with its title. A
          <tag>segmentedlist</tag> can be formatted in a number of ways
          (tabular or as a list block).
        </para>
      </listitem>
      <listitem>
        <para><tag>simplelist</tag> is an unordered list for single
          words or small phrases.</para>
      </listitem>
    </itemizedlist>
    
    <para>The previous lists are used to maintain semantic
      distinction.</para>    
  </section>
  <section role="discussion">
    <title>Discussion</title>
    <para>The list types <tag>orderedlist</tag> and <tag>itemizedlist</tag>
    are structural identical (except for its initial element) as you will
    see in the following subsections.</para>    
    <para>The <tag>variablelist</tag> is slightly different and contains
      the <tag>term</tag> element for its term.</para>
   
    <section xml:id="markup.lists.itemizedlist">
      <title>Features of <tag>itemizedlist</tag></title>
      <para>An <tag>itemizedlist</tag> is a unordered list and can be
        written as shown in the following example:</para>
      <example>
        <title>Unordered List with Three Entries</title>
        <programlisting language="xml">&lt;itemizedlist&gt;
  &lt;listitem&gt;
    &lt;para&gt;The first entry&lt;/para&gt;
  &lt;/listitem&gt;
  &lt;listitem&gt;
    &lt;para&gt;The second entry&lt;/para&gt;
  &lt;/listitem&gt;
  &lt;listitem&gt;
    &lt;para&gt;The third entry&lt;/para&gt;
  &lt;/listitem&gt;
&lt;/itemizedlist&gt;</programlisting>
      </example>
      <para>The <tag>itemizedlist</tag> list in DocBook uses by default
        a disc symbol (• solid circle). If you nest an
        <tag>itemizedlist</tag>, it will first start the disc (• solid
        circle) and uses a circle (○ open circle) and finally a square
        (■ solid square). If you nest your list deeper, the sequence is
        repeated. The hierarchy looks like this:</para>
      <informaltable>
        <tgroup cols="2">
          <colspec colnum="1" align="right"/>
          <thead>
            <row>
              <entry>Level</entry>
              <entry>Shows as</entry>
            </row>
          </thead>
          <tbody>
            <row>
              <entry>1.</entry>
              <entry>• • •</entry>
            </row>
            <row>
              <entry>2.</entry>
              <entry>○ ○ ○</entry>
            </row>
            <row>
              <entry>3.</entry>
              <entry>■ ■ ■</entry>
            </row>
          </tbody>
        </tgroup>
      </informaltable>
      <!--<screen>• • •         1. level
  ○ ○ ○       2. level
    ■ ■ ■     3. level</screen>-->
      <para>The default bullet symbol can be overwritten with the <tag class="attribute">mark</tag> attribute:</para>
      <programlisting language="xml">&lt;itemizedlist mark="circle"&gt;</programlisting>
      <para>It is even possible to deviate from its default symbol in a
        <tag>listitem</tag> by using the <tag>overwrite</tag> attribute:</para>
      <programlisting language="xml">&lt;itemizedlist&gt;
  &lt;listitem&gt;
    &lt;para&gt;The first entry&lt;/para&gt;
  &lt;/listitem&gt;
  &lt;listitem overwrite="square"&gt;
    &lt;para&gt;The second entry&lt;/para&gt;
  &lt;/listitem&gt;
  &lt;listitem&gt;
    &lt;para&gt;The third entry&lt;/para&gt;
  &lt;/listitem&gt;
&lt;/itemizedlist&gt;</programlisting>
    </section>
    <section xml:id="markup.lists.orderedlist">
      <title>Features of <tag>orderedlist</tag></title>
      <para>An <tag>orderedlist</tag> can be written as shown in the
      following example:</para>
      <example>
        <title>Numbered List with Three Entries</title>
        <programlisting language="xml">&lt;orderedlist&gt;
  &lt;listitem&gt;
    &lt;para&gt;The first entry&lt;/para&gt;
  &lt;/listitem&gt;
  &lt;listitem&gt;
    &lt;para&gt;The second entry&lt;/para&gt;
  &lt;/listitem&gt;
  &lt;listitem&gt;
    &lt;para&gt;The third entry&lt;/para&gt;
  &lt;/listitem&gt;
&lt;/orderedlist&gt;</programlisting>
      </example>
      <para>The <tag>orderedlist</tag> in DocBook numbers as arabic
        numbers by default. If you nest an <tag>orderedlist</tag>, it
        will be automatically numbered as shown in the following
        sequence:</para>
      <informaltable>
        <tgroup cols="2">
          <colspec colnum="1" align="right"/>
          <thead>
            <row>
              <entry>Level</entry>
              <entry>Shows as</entry>
            </row>
          </thead>
          <tbody>
            <row>
              <entry>1.</entry>
              <entry>1, 2, 3</entry>
            </row>
            <row>
              <entry>2.</entry>
              <entry>a, b, c</entry>
            </row>
            <row>
              <entry>3.</entry>
              <entry>i, ii, iii</entry>
            </row>
            <row>
              <entry>4.</entry>
              <entry>A, B, C</entry>
            </row>
            <row>
              <entry>5.</entry>
              <entry>I, II, III</entry>
            </row>
          </tbody>
        </tgroup>
      </informaltable>
      <!--<screen>1, 2, 3              1. level
  a, b, c            2. level
    i, ii, iii       3. level
      A, B, C        4. level
        I, II, III   5. level</screen>-->
      <para>The numbering style in an <tag>orderedlist</tag> can be
        changed with the <tag class="attribute">numberation</tag>
        attribute. Allowed values are <simplelist type="inline">
          <?dbchoice choice="or"?>
          <member>arabic</member>
          <member>loweralpha</member>
          <member>lowerroman</member>
          <member>upperalpha</member>
          <member>upperroman</member>
          <member>arabicindic</member>
        </simplelist>.</para>
    </section>
    <section xml:id="markup.lists.variablelist">
      <title>Features of <tag>variablelist</tag></title>
      <para>An <tag>variablelist</tag>, despite its confusing name,
        holds all sort of terms and their definition. It is not limited
        to variables only. The following example shows how to use a
        <tag>variablelist</tag>.</para>
      <example>
        <title>Definition List with Two Entries</title>
        <programlisting language="xml">&lt;variablelist&gt;
  &lt;varlistentry&gt;
    &lt;term&gt;Hamburg&lt;/term&gt;
    &lt;listitem&gt;
       &lt;para&gt;Town in the northern part of Germany&lt;/para&gt;
    &lt;/listitem&gt;
  &lt;/varlistentry&gt;
  &lt;varlistentry&gt;
    &lt;term&gt;Nueremberg&lt;/term&gt;
    &lt;listitem&gt;
       &lt;para&gt;Town in the south-eastern part of Germany&lt;/para&gt;
    &lt;/listitem&gt;
  &lt;/varlistentry&gt;
&lt;/variablelist&gt;</programlisting>
      </example>
      <para>A <tag>varlistentry</tag> can contain more than one term.
        How the terms are displayed depends usually on the output
        formats. Each <tag>term</tag> can be printed on a
        separate line or on the same line separated by commas.</para>
    </section>
  </section>
  <section role="seealso">
    <title>See Also</title>
    
    <itemizedlist>
      <title>External Links</title>
      <listitem>
        <para><link xlink:href="http://www.docbook.org/tdg5/en/html/bibliolist.html"/></para>
      </listitem>
      <listitem>
        <para><link xlink:href="http://www.docbook.org/tdg5/en/html/calloutlist.html"/></para>
      </listitem>
      <listitem>
        <para><link xlink:href="http://www.docbook.org/tdg5/en/html/glosslist.html"/></para>
      </listitem>
      <listitem>
        <para><link xlink:href="http://www.docbook.org/tdg5/en/html/itemizedlist.html"/></para>
      </listitem>
      <listitem>
        <para><link xlink:href="http://www.docbook.org/tdg5/en/html/orderedlist.html"/></para>
      </listitem>
      <listitem>
        <para><link xlink:href="http://www.docbook.org/tdg5/en/html/segmentedlist.html"/></para>
      </listitem>
      <listitem>
        <para><link xlink:href="http://www.docbook.org/tdg5/en/html/simplelist.html"/></para>
      </listitem>
      <listitem>
        <para><link xlink:href="http://www.sagehill.net/docbookxsl/Lists.html"/></para>
      </listitem>
    </itemizedlist>
  </section>
</section>
  <!--
    License CC BY-NC-SA 3.0
  
   This work is licensed under the 
   "Namensnennung – Keine kommerzielle Nutzung – Weitergabe unter
    gleichen Bedingungen 3.0 Deutschland (CC BY-NC-SA 3.0)" 
   http://creativecommons.org/licenses/by-nc-sa/3.0/de/deed.de
   
   Read the English translation here:
   
   "Attribution-NonCommercial-ShareAlike 3.0 Unported (CC BY-NC-SA 3.0)" 
   http://creativecommons.org/licenses/by-nc-sa/3.0/
   
--><!--<?xml-model href="file:../5.1/dbref.rnc" type="application/relax-ng-compact-syntax"?>--><section xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="dbc.markup.programlistings" remap="topic" userlevel="medium" xml:base="db/topic.programlistings.xml">
  <title>Incorporating Code Listings</title>
  <info>
    <definitions definitionfile="defs.xml"/>
    <keywordset>
      <keyword>programlistings</keyword>
      <keyword>code</keyword>
    </keywordset>
  </info>
  
  <section role="problem">
    <title>Problem</title>
    <para>You need to add an element which is used for code listings.</para>
  </section>
  <section role="solution">
    <title>Solution</title>
    <para>Use the <tag>programlisting</tag> element. For example, the following markup
      shows some Python code:</para>
    <programlisting language="python" linenumbering="unnumbered">&lt;programlisting&gt;#!/usr/bin/python

def sayhello(name):
  """Say hello to someone"""
  return "Hello %s" % name

sayhello("Tux")&lt;/programlisting&gt;</programlisting>
    <para>If you want to benefit from syntax highlighting later, use the
        <tag class="attribute">language</tag> attribute
      additionally:</para>
    <programlisting linenumbering="unnumbered">&lt;programlisting <emphasis role="strong">language="python"</emphasis>&gt;...&lt;/programlisting&gt;</programlisting>
  </section>
  <section role="discussion">
    <title>Discussion</title>
    <para>In most cases, <tag>programlisting</tag> is probably enough
      for all your needs. However, DocBook and the DocBook stylesheets
      supports some neat features you should know:</para>
    <itemizedlist>
      <listitem>
        <para>Annotated lines for short comments</para>
      </listitem>
      <listitem>
        <para>Callouts, for more exhaustive explanations</para>        
      </listitem>
      <listitem>
        <para>Line numbering, if refering to a number is enough</para>
      </listitem>
      <listitem>
        <para>External code files, if you want to incorporate files from
        outside your DocBook document</para>
      </listitem>
    </itemizedlist>
    
    <para>The above features are explained in the following
      subsections.</para>
    
    <section xml:id="dbc.markup.programlistings.lineannotation">
      <title>Using Line Annotatations</title>
      <para>Annotated lines are short comments created by
        <tag>lineannotation</tag>:</para>
      <programlisting language="xml" linenumbering="unnumbered">&lt;programlisting&gt;#!/usr/bin/python &lt;lineannotation&gt;She-bang line&lt;/lineannotation&gt;

def sayhello(name):
  """Say hello to someone""" &lt;lineannotation&gt;Python's doc comment&lt;/lineannotation&gt;
  return "Hello %s" % name

sayhello("Tux")
&lt;programlisting&gt;</programlisting>
      <para>Line annotations are printed in italic by default:</para>
      <programlisting language="python" linenumbering="unnumbered">#!/usr/bin/python <lineannotation>Shebang line</lineannotation>

def sayhello(name):
  """Say hello to someone""" <lineannotation>Python's doc comment</lineannotation>
  return "Hello %s" % name

sayhello("Tux")</programlisting>
      <para>They are only useful, if you have short comments. If you need 
        further explanations, callouts are better suited for this task.</para>
      <para>Problems can arise when a reader wants to copy and paste
        text containing line annotations. Such text usually creates
        syntax problems. In this case, use a comment symbol for the
        appropriate programming language. For Python, it is the hash
        sign which can be combined in a <tag>programlisting</tag>
        context as follows:</para>
      <programlisting language="python" linenumbering="unnumbered">&lt;programlisting&gt; ...
# &lt;lineannotation&gt;Function to output a warm welcome message&lt;/lineannotation&gt;
def sayhello(name):
  ...
&lt;/programlisting&gt;</programlisting>
      <para>With this method, an annotated line does not create any
        syntax errors.</para>
    </section>
    <section xml:id="dbc.markup.programlistings.callout">
      <title>Using Callouts</title>
      <remark>toms, 2012-09-02: Refer to its own topic</remark>
      <para>Callouts are little marks in your code which refers to a
        more exhaustive explanation, usually <emphasis>after</emphasis> the code.
        Such an explanation is marked up as a <tag>calloutlist</tag>:</para>
      
      <programlisting language="xml" linenumbering="unnumbered"><![CDATA[<programlisting language="python"
>#!/usr/bin/python <co xml:id="co.shebang"/>

def sayhello(name):
  """Say hello to someone""" <co xml:id="co.doccomment"/>
  return "Hello %s" % name

sayhello("Tux")</programlisting>
<calloutlist>
   <callout arearefs="co.shebang">
     <para>A Shebang line. Unix-like operating systems can parse
           this line, execute the corresponding interpreter and pass
           the script as first argument.</para>
   </callout>
   <callout arearefs="co.doccomment">
     <para>A Python doc comment. Usually, written as triple quotes
           or as triple apostrophs marks the doc comment for a function
           or class.</para>
   </callout>
</calloutlist>]]></programlisting>
      <para>The result will look like this:</para>
      <programlisting language="python" linenumbering="unnumbered">#!/usr/bin/python <co xml:id="co.shebang"/>

def sayhello(name):
  """Say hello to someone""" <co xml:id="co.doccomment"/>
  return "Hello %s" % name

sayhello("Tux")</programlisting>
      <calloutlist>
        <callout arearefs="co.shebang">
          <para>A Shebang line. Unix-like operating systems can parse
            this line, execute the corresponding interpreter and pass
            the script as first argument.</para>
        </callout>
        <callout arearefs="co.doccomment">
          <para>A Python doc comment. Usually, written as triple quotes
            or as triple apostrophs marks the doc comment for a function
            or class.</para>
        </callout>
      </calloutlist>
      <para>Callouts are a good way to give your reader more
        explanations. Find more information in <remark>TODO: Add xref</remark>.</para>
    </section>
    <section xml:id="dbc.markup.programlistings.numbering">
      <title>Setting Line Numbering</title>
      <para>Numbering program listings can be done with the attribute
        <tag class="attribute">linenumbering</tag>:</para>
      <programlisting>&lt;programlisting linenumbering="numbered"&gt;...</programlisting>
      <para>The result can look like this:</para>
      <programlisting linenumbering="unnumbered"> 1 | #!/usr/bin/python
 2 | 
 3 | def sayhello(name):
 4 | """Say hello to someone"""
 5 | return "Hello %s" % name
 6 |
 7 | sayhello("Tux")</programlisting>
      <para>To influence the numbering, DocBook and the DocBook
        stylesheets has several ways:</para>
      <variablelist>
        <varlistentry>
          <term><tag class="attribute">startinglinenumber</tag></term>
          <listitem>
            <para>This attribute in <tag class="starttag">programlisting</tag>
              specifies the initial line number.</para>
          </listitem>
        </varlistentry>
        <varlistentry>
          <term><tag class="attribute">continuation</tag></term>
          <listitem>
            <para>This attribute in <tag class="starttag">programlisting</tag> determines whether line numbering
              continues from the previous element or restarts. Possible
              values are <tag class="attvalue">continues</tag> or <tag class="attvalue">restarts</tag> (default).</para>
          </listitem>
        </varlistentry>
        <varlistentry>
          <term><tag class="xmlpi" xlink:href="http://docbook.sourceforge.net/release/xsl/current/doc/pi/dbhtml_linenumbering.everyNth.html">dbhtml linenumbering.everyNth="<replaceable>N</replaceable>"</tag></term>
          <term><tag class="xmlpi" xlink:href="http://docbook.sourceforge.net/release/xsl/current/doc/pi/dbfo_linenumbering.everyNth.html">dbfo linenumbering.everyNth="<replaceable>N</replaceable>"</tag></term>
          <listitem>
            <para>This processing instruction (PI) specifies interval
              for line numbers. By default, every 5th line displays its
              number.</para>
          </listitem>
        </varlistentry>
        <varlistentry>
          <term><tag class="xmlpi" xlink:href="http://docbook.sourceforge.net/release/xsl/current/doc/pi/dbhtml_linenumbering.separator.html">dbhtml linenumbering.separator="<replaceable>text</replaceable>"</tag></term>
          <term><tag class="xmlpi" xlink:href="http://docbook.sourceforge.net/release/xsl/current/doc/pi/dbfo_linenumbering.separator.html">dbfo linenumbering.separator="<replaceable>text</replaceable>"</tag></term>
          <listitem>
            <para>This PI specifies separator text for line numbers. By
              default it is a single space. This text is printed after
              the line number but before the line from the program
              listing.</para>
          </listitem>
        </varlistentry>
        <varlistentry>
          <term><tag class="xmlpi" xlink:href="http://docbook.sourceforge.net/release/xsl/current/doc/pi/dbhtml_linenumbering.width.html">dbhtml linenumbering.width="<replaceable>width</replaceable>"</tag></term>
          <term><tag class="xmlpi" xlink:href="http://docbook.sourceforge.net/release/xsl/current/doc/pi/dbfo_linenumbering.width.html">dbfo linenumbering.width="<replaceable>width</replaceable>"</tag></term>
          <listitem>
            <para>This PI specifies width for line numbers. By default,
              this value is set to three which gives you a reserved
              space of numbers up to 999. </para>
          </listitem>
        </varlistentry>
        <varlistentry>
          <term><parameter xlink:href="http://docbook.sourceforge.net/release/xsl/current/doc/html/linenumbering.extension.html">linenumbering.extension</parameter></term>
          <listitem>
            <para>Parameter which enables the line numbering extension</para>
          </listitem>
        </varlistentry>
      </variablelist>
      <para>To use the processing instructions, add them in
        <tag>programlisting</tag> without any whitespace:</para>
      <programlisting language="xml" linenumbering="unnumbered">&lt;programlisting&gt;&lt;?dbhtml 
   linenumbering.everyNth="2" 
   linenumbering.width="2" ?&gt;#!/usr/bin/python
...
&lt;/programlisting&gt;</programlisting>
      <para>This will create the following output:</para>
      <programlisting language="xml" linenumbering="numbered"><?dbhtml linenumbering.everyNth="2" 
        linenumbering.width="2" 
?>  | #!/usr/bin/python
 2| 
  | def sayhello(name):
 4| """Say hello to someone"""
  | return "Hello %s" % name
 6|
  | sayhello("Tux")</programlisting>
    </section>
    <section xml:id="dbc.markup.programlistings.externals">
      <title>Incorporating External Files</title>
      <para>To incorporate external files is explained in a separate
        topic. Refer to <xref linkend="dbc.markup.programlistings-external"/>.</para>
    </section>
    
  </section>
  <section role="seealso">
    <title>See Also</title>
    <itemizedlist>
      <listitem>
        <para><link xlink:href="http://www.sagehill.net/docbookxsl/ProgramListings.html"/></para>
      </listitem>
      <listitem>
        <para><xref linkend="dbc.markup.programlistings-external"/></para>
      </listitem>
    </itemizedlist>
  </section>
</section>
  <!--
    License CC BY-NC-SA 3.0
  
   This work is licensed under the 
   "Namensnennung – Keine kommerzielle Nutzung – Weitergabe unter
    gleichen Bedingungen 3.0 Deutschland (CC BY-NC-SA 3.0)" 
   http://creativecommons.org/licenses/by-nc-sa/3.0/de/deed.de
   
   Read the English translation here:
   
   "Attribution-NonCommercial-ShareAlike 3.0 Unported (CC BY-NC-SA 3.0)" 
   http://creativecommons.org/licenses/by-nc-sa/3.0/
   
--><!--<?xml-model href="file:../5.1/dbref.rnc" type="application/relax-ng-compact-syntax"?>--><section xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="dbc.markup.programlistings-external" remap="topic" userlevel="easy" xml:base="db/topic.programlistings-external.xml">
  <title>Incorporating External Files in Code Listings</title>
  <info>
    <definitions definitionfile="defs.xml"/>
    <keywordset>
      <keyword>programlistings</keyword>
      <keyword>code</keyword>
      <keyword>XInclude</keyword>
      <keyword>textdata</keyword>
      <keyword>DocBook extensions</keyword>
    </keywordset>
  </info>
  
  <section role="problem">
    <title>Problem</title>
    <para>You have external files (codes, example files, and others) that you 
      want to incorporate into a
      <tag>programlisting</tag> element, but you want to keep your files
      separate from your documentation files.</para>
  </section>
  
  <section role="solution">
    <title>Solution</title>
    <para>Use one of the following methods to incorporate external files
      into your <tag>programlisting</tag> element:</para>
    <itemizedlist>
      <listitem>
        <para><tag>textobject</tag>/<tag>textdata</tag></para>
      </listitem>
      <listitem>
        <para><tag>xi:include</tag> (XIncludes)</para>
      </listitem>
    </itemizedlist>
    
    <para>You can mix both, but for consistency reasons, it is better to
    stick to one method.</para>
    
    <section xml:id="sec.programlisting-external-textdata">
      <title>Incorporating External Files with <tag>textdata</tag></title>
      <para>Usually, <tag>textdata</tag> is included inside a
          <tag>textobject</tag> which is then included inside a
          <tag>programlisting</tag> element.</para>
      <para>To refer to a file <filename>foo.py</filename> with
        <tag>textdata</tag>, use the code in <xref linkend="ex.programlisting.textdata"/>.</para>
      <example xml:id="ex.programlisting.textdata">
        <title>External File Markuped up with <tag>textdata</tag></title>
        <programlisting>&lt;programlisting&gt;<emphasis role="strong">&lt;textobject&gt;
   &lt;textdata fileref="foo.py"/&gt;
&lt;/textobject&gt;</emphasis>&lt;/programlisting&gt;</programlisting>
      </example>
    </section>
    
    <section xml:id="sec.programlisting-external-xinclude">
      <title>Incorporating External Files with XIncludes</title>
      <para>The same code in <xref linkend="ex.programlisting.textdata"/> can be expressed with XInclude:</para>
      <example>
        <title>External File Markuped up with <tag>xi:include</tag></title>
        <programlisting>&lt;programlisting&gt;<emphasis role="strong">&lt;xi:include 
  href="foo.py" parse="text"
/&gt;</emphasis>&lt;programlisting&gt;</programlisting>
      </example>
      <para>Do not forget to declare the namespace URI <tag class="namespace">http://www.w3.org/2001/XInclude</tag>. This
        can be done either on the <tag>xi:include</tag> element itself,
        or in the root element of your documentation. Preferably, it is
        easier to declare it once inside the root element.</para>
    </section>
  </section>
  <section role="discussion">
    <title>Discussion</title>
    <para>Keeping your external files separate from your
      documentation can have several reasons. Probably you need to
      change the files very often or you do not have control over these
      files. In such cases, it is better to leave them as separate files
      and don't include them directly into your XML code. Otherwise it
      would be tedious to include them manually whenever your code
      changes. </para>
    <para>To avoid such tedious tasks, the <tag>textdata</tag> and
        <tag>xi:include</tag> elements were invented. The element
        <tag>textdata</tag> was introduced in DocBook 4.2, released
      in 2002. At that time the XInclude specification was not written
      yet, the first public release was published in 2006. Too late for
      DocBook to incorporate it into its schema.</para>
    <para>Nowadays, in the light of XInclude, the element <tag>textdata</tag> 
      can be considered as obsolete—especially for DocBook 5
      documents. Therefor, for new documents, prefer the XInclude element(s) 
      as this has more advantages (see <xref linkend="tab.comp.textdata-vs-xinclude"/>).</para>
    
    <table xml:id="tab.comp.textdata-vs-xinclude">
      <title>Comparision Between <tag>textdata</tag> and <tag>xi:include</tag></title>
      <tgroup cols="3">
        <thead>
          <row>
            <entry>Topic</entry>
            <entry><tag>textdata</tag></entry>
            <entry><tag>xi:include</tag></entry>
          </row>
        </thead>
        <tbody>
          <row>
            <entry>Needs DocBook extension?</entry>
            <entry>Yes</entry>
            <entry>No</entry>
          </row>
          <row>
            <entry>Can be used elsewhere in the document?</entry>
            <entry>No</entry>
            <entry>Yes</entry>
          </row>
          <row>
            <entry>Can include text?</entry>
            <entry>Yes</entry>
            <entry>Yes</entry>
          </row>
          <row>
            <entry>Can include XML markup?</entry>
            <entry>No</entry>
            <entry>Yes</entry>
          </row>
          <row>
            <entry>Can use fallback mechanism?</entry>
            <entry>No</entry>
            <entry>Yes</entry>
          </row>
          <row>
            <entry>Included in DocBook 4?</entry>
            <entry>Yes</entry>
            <entry>No<footnote>
              <para>Not included in the DTD, but can be used anyway.</para>
            </footnote></entry>
          </row>
          <row>
            <entry>Included in DocBook 5?</entry>
            <entry>Yes</entry>
            <entry>Yes<footnote>
              <para>Only available in the separate files
                <filename>docbookxi.rn{c,g}</filename></para>
            </footnote></entry>
          </row>
          
        </tbody>
      </tgroup>
    </table>
    
    <para>If you still want (or have) to use <tag>textdata</tag> you
      need to transform your DocBook documents with Saxon or Xalan.
      Currently, the extension functions are only available for these
      XSLT processor, not xsltproc.
      Make sure the DocBook extension JAR file(s) are 
      included into your <envar>CLASSPATH</envar> variable. Furthermore, 
      set the parameters <parameter>use.extensions</parameter> and
      <parameter>textinsert.extension</parameter> to the value of 
      <literal>1</literal> to enable this functionality.</para>
  </section>
  
  <section role="seealso">
    <title>See Also</title>
    <itemizedlist>
      <listitem>
        <para><link xlink:href="http://www.sagehill.net/docbookxsl/ProgramListings.html"/></para>
      </listitem>
      <listitem>
        <para><link xlink:href="http://www.docbook.org/tdg51/en/html/textdata.html"/></para>
      </listitem>
    </itemizedlist>
  </section>
</section>
  <!--
    License CC BY-NC-SA 3.0
  
   This work is licensed under the 
   "Namensnennung – Keine kommerzielle Nutzung – Weitergabe unter
    gleichen Bedingungen 3.0 Deutschland (CC BY-NC-SA 3.0)" 
   http://creativecommons.org/licenses/by-nc-sa/3.0/de/deed.de
   
   Read the English translation here:
   
   "Attribution-NonCommercial-ShareAlike 3.0 Unported (CC BY-NC-SA 3.0)" 
   http://creativecommons.org/licenses/by-nc-sa/3.0/
   
--><!--<?xml-model href="file:../5.1/dbref.rnc" type="application/relax-ng-compact-syntax"?>--><section xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="dbc.markup.remarks" remap="topic" userlevel="easy" version="5.1" xml:base="db/topic.remarks.xml">
  <title>Inserting Remarks</title>
  <info>
    <keywordset>
      <keyword>remarks</keyword>
      <keyword>show.comments</keyword>
    </keywordset>
    <subjectset>
      <subject>
        <subjectterm>remarks</subjectterm>
      </subject>
    </subjectset>
  </info>
  
  <section role="problem">
    <title>Problem</title>
    <para>You want to insert comments or remarks in your document to
      enable or disable them in the output format.</para>
  </section>
  <section role="solution">
    <title>Solution</title>
    <para>For this purpose, DocBook provides a <tag xlink:href="http://www.docbook.org/tdg51/en/html/tag.html">remark</tag> element. The following example shows
        how to use it:</para>
    <example xml:id="ex.db.inlineremark">
      <title>A Remark Inside a Paragraph</title>
      <programlisting language="xml">&lt;para&gt;
This is a small text.&lt;remark&gt;Add more content&lt;/remark&gt;
&lt;/para&gt;</programlisting>
    </example>    
  </section>
  <section role="discussion">
    <title>Discussion</title>
    <para>To add comments in your document, there are two
      methods:</para>
    <itemizedlist>
      <listitem>
        <para>Use XML comments</para>
      </listitem>
      <listitem>
        <para>Use DocBook’s <tag>remark</tag> element</para>
      </listitem>
    </itemizedlist>
    <para>XML comments can be placed almost everywhere in your XML
      document. It is a very common method to give yourself or others
      some hints. This can be done with XML comments 
      like in this example:</para>
    <programlisting language="xml" linenumbering="unnumbered">&lt;para&gt;
This is a text &lt;!-- Ohh, we should add more --&gt;
&lt;/para&gt;</programlisting>
    <para>However, XML comments has one drawback: They are suppressed
      during transformation. As such, they are unavailable in your
      output format and can not be displayed anymore. Usually, you <emphasis>do
      not</emphasis> want them to appear in your output. </para>
    <para>On the contrary, by using the <tag>remark</tag> element,
      comments can be shown or suppressed whenever you want them. For
      example, if you write your document and put some remarks, you can
      show them to your contributors for review. After the document is
      ready to be published, leave the remark as they are but suppress
      the remark transformation.
    </para>
    <para>To display or suppress your remarks, use the parameter
        <parameter>show.comments</parameter>. This parameter can appear
      either on the command line of your XSLT processor or in a
      customization layer. Any non-zero value shows your remarks whereas
      a value of zero suppress them.</para>
    <para>When should you use XML comments and when remarks? The
      following table gives you a quick overview.</para>
    
    <table xml:id="tab.db.xmlcomments-vs-remarks">
      <title>Comparison of XML Comments versus Remarks</title>
      <tgroup cols="3">
        <thead>
          <row>
            <entry>Topic</entry>
            <entry>XML Comments</entry>
            <entry>Remarks</entry>
          </row>
        </thead>
        <tbody>
          <row>
            <entry>When to use it?</entry>
            <entry>
              <para>Comments which are only read by you</para>
            </entry>
            <entry>
              <para>Comments which can and should be read by others</para>
            </entry>
          </row>
          <row>
            <entry>Where to place it?</entry>
            <entry>
              <para>Almost everywhere<footnote>
                <para>An example where you <emphasis>cannot</emphasis>
                  insert your XML comment is inside an attribute.</para>
              </footnote></para>
            </entry>
            <entry>
              <para>Restricted by the DocBook schema<footnote>
                <para>See <link xlink:href="http://www.docbook.org/tdg51/en/html/tag.html"/> 
                  for more details.</para>
              </footnote></para>
            </entry>
          </row>
          <row>
            <entry>Can be displayed and suppressed?</entry>
            <entry>No, always suppressed</entry>
            <entry>Yes, by using the parameter <parameter>show.comments</parameter></entry>
          </row>
        </tbody>
      </tgroup>
    </table>
  </section>
</section>
  <!--
    License CC BY-NC-SA 3.0
  
   This work is licensed under the 
   "Namensnennung – Keine kommerzielle Nutzung – Weitergabe unter
    gleichen Bedingungen 3.0 Deutschland (CC BY-NC-SA 3.0)" 
   http://creativecommons.org/licenses/by-nc-sa/3.0/de/deed.de
   
   Read the English translation here:
   
   "Attribution-NonCommercial-ShareAlike 3.0 Unported (CC BY-NC-SA 3.0)" 
   http://creativecommons.org/licenses/by-nc-sa/3.0/
   
--><!--<?xml-model href="file:../5.1/dbref.rnc" type="application/relax-ng-compact-syntax"?>--><section xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="dbc.markup.xref-vs-link" remap="topic" userlevel="easy" xml:base="db/topic.xref-vs-link.xml">
  <title>Knowing the Difference of Cross References and Links</title>
  <info>
    <definitions definitionfile="defs.xml"/>
    <keywordset>
      <keyword>crossreference</keyword>
      <keyword>xref</keyword>
      <keyword>links</keyword>
      <keyword>localization</keyword>
    </keywordset>
    <subjectset>
      <subject>
        <subjectterm>links</subjectterm>
        <subjectterm>xref</subjectterm>
        <subjectterm>l10n</subjectterm>
      </subject>
    </subjectset>
  </info>
  
  <section role="problem">
    <title>Problem</title>
    <para>You want to set a <quote>link</quote> but you do not know
      which DocBook element to use.</para>
  </section>
  <section role="solution">
    <title>Solution</title>
    <para>DocBook distinguishes between two link types:</para>
    <itemizedlist>
      <listitem>
        <formalpara>
          <title>Internal Links or Cross References</title>
          <para>used primarily with <tag>xref</tag></para>
        </formalpara>
      </listitem>
      <listitem>
        <formalpara>
          <title>External Links</title>
          <para>used primarily with <tag>link</tag></para>
        </formalpara>
      </listitem>
    </itemizedlist>    
  </section>
  <section role="discussion">
    <title>Discussion</title>
    <para>There are several difference between <tag>xref</tag> and
        <tag>link</tag>. An <tag>xref</tag> is used for cross
      referencing another part of the document. In its simplest form,
      you need only an ID value of the object where you want to link
      to:</para>
    <example xml:id="ex.xref-vs-link.xref">
      <title>A Cross Reference</title>
      <programlisting language="xml">&lt;chapter xml:id="tea"&gt;
  &lt;title&gt;All About Tea&lt;/title&gt;
  &lt;section <emphasis role="bold">xml:id="about-tea"</emphasis>&gt;
    &lt;title&gt;About Tea&lt;/title&gt;
    &lt;para&gt;This section gives you an introduction about tea.&lt;/para&gt;
  &lt;/section&gt;
  &lt;section xml:id="prepar"&gt;
    &lt;title&gt;Preparing Tea&lt;/title&gt;
    &lt;para&gt;Read an introduction in <emphasis role="bold">&lt;xref linkend="about-tea"/&gt;</emphasis>.&lt;/para&gt;
  &lt;/section&gt;      
&lt;/chapter&gt;</programlisting>
    </example>
    <para>The DocBook XSL stylesheets take care of resolving the
      <tag>xref</tag>. By default, it replaces the <tag>xref</tag>
      element with a number and the title of the reference. It could
      look like this:</para>
    <screen>Read an introduction in Section 1.1, “About Tea”.</screen>
    <para>The text <code>Section 1.1, “About Tea”</code> is a <quote>hot
    link</quote> and points to the respective section. Using
      <tag>xref</tag> for cross references has several advantages:</para>
    <itemizedlist>
      <title>Advantages of Cross References Using <tag>xref</tag></title>
      <listitem>
        <para>Whenever a text of a title changes, all <tag>xref</tag>s
          pointing to it will automatically change too</para>
      </listitem>
      <listitem>
        <para>During validation, the <tag class="attribute">linkend</tag> attribute is checked, if this ID
          exists</para>
      </listitem>
      <listitem>
        <para>During resolution, additonal words like
            <quote>Section</quote>, <quote>Chapter</quote>, or
            <quote>Figure</quote> are automatically inserted according
          to the used document language</para>
      </listitem>
      <listitem>
        <para>You do not have to care about numbering</para>
      </listitem>
      <listitem>
        <para>For further customization, use the <tag class="attribute">xrefstyle</tag> attribute</para>
      </listitem>
    </itemizedlist>
    
    <para>In contrast, an <tag>link</tag> is used in most cases for
      <emphasis>external</emphasis> links.</para>
    <example xml:id="ex.xref-vs-link.link">
      <title>A Hyperlink</title>
      <programlisting language="xml">&lt;section xml:id="about-tea"&gt;
  &lt;title&gt;About Tea&lt;/title&gt;
  &lt;para&gt;See &lt;link xlink:href="http://www.example.org/tea"/&gt; for further information.&lt;/para&gt;
&lt;/section&gt;</programlisting>
    </example>
    <para>Using an <tag>link</tag> has the following advantages:</para>
    <itemizedlist>
      <title>Advantages of External Links Using <tag>link</tag></title>
      <listitem>
        <para>Usually no automatic resolution performed (only if you use
            <tag class="attribute">xlink:href</tag>)</para>
      </listitem>
      <listitem>
        <para>No validation necessary between source and target</para>
      </listitem>
      <listitem>
        <para>Link content can be manually created</para>
      </listitem>
      <listitem>
        <para>Additional inline elements allowed</para>
      </listitem>
    </itemizedlist>
    
    <para>The differences between <tag>xref</tag> and <tag>link</tag>
      are collected in <xref linkend="tab.xref-vs-link"/>.      
    </para>
    
    <table xml:id="tab.xref-vs-link">
      <title>Differences Between <tag>xref</tag> and <tag>link</tag></title>
      <tgroup cols="3">
        <colspec colnum="1" colname="c1" colwidth="1*"/>
        <colspec colnum="2" colname="c2" colwidth="2*"/>
        <colspec colnum="3" colname="c3" colwidth="2*"/>
        <thead>
          <row>
            <entry>Topic</entry>
            <entry><tag xlink:href="http://www.docbook.org/tdg51/en/html/xref.html">xref</tag></entry>
            <entry><tag xlink:href="http://www.docbook.org/tdg51/en/html/link.html">link</tag></entry>
          </row>
        </thead>
        <tbody>
          <row>
            <entry>TDG<footnote>
              <para>The Definitive Guide, see <link xlink:href="http://www.docbook.org/tdg51/en/html/docbook.html"/></para>
            </footnote> Definition</entry>
            <entry>A cross reference to another part of the document</entry>
            <entry>A hypertext link</entry>
          </row>
          <row>
            <entry>Content Model</entry>
            <entry><link xlink:href="http://www.docbook.org/tdg51/en/html/xref.html">empty</link></entry>
            <entry><link xlink:href="http://www.docbook.org/tdg51/en/html/link.html">text and inline elements</link></entry>
          </row>
          <row>
            <entry>Resolution</entry>
            <entry>Yes, automatically during transformation</entry>
            <entry>No, link content must be definied manually</entry>
          </row>
          <row>
            <entry>ID/IDREF Checking</entry>
            <entry>Yes</entry>
            <entry>No<footnote>
                <para>Checking can be performed, when <tag class="attribute">linkend</tag> attribute is used.</para>
              </footnote></entry>
          </row>
          <row>
            <entry>Restrictions</entry>
            <entry>Only cross referencing to elements which contains a <tag>title</tag></entry>
            <entry>No restrictions</entry>
          </row>
        </tbody>
      </tgroup>
    </table>
  </section>
  <section role="seealso">
    <title>See Also</title>
    <itemizedlist>
      <listitem>
        <para><xref linkend="dbc.markup.xref"/></para>
      </listitem>
      <listitem>
        <para><xref linkend="dbc.markup.link"/></para>
      </listitem>
      <listitem>
        <para><link xlink:href="http://www.docbook.org/tdg51/en/html/link.html"/></para>
      </listitem>
      <listitem>
        <para><link xlink:href="http://www.docbook.org/tdg51/en/html/xref.html"/></para>
      </listitem>
    </itemizedlist>
  </section>
</section>
  <!--
    License CC BY-NC-SA 3.0
  
   This work is licensed under the 
   "Namensnennung – Keine kommerzielle Nutzung – Weitergabe unter
    gleichen Bedingungen 3.0 Deutschland (CC BY-NC-SA 3.0)" 
   http://creativecommons.org/licenses/by-nc-sa/3.0/de/deed.de
   
   Read the English translation here:
   
   "Attribution-NonCommercial-ShareAlike 3.0 Unported (CC BY-NC-SA 3.0)" 
   http://creativecommons.org/licenses/by-nc-sa/3.0/
   
--><?xml-model href="../5.1/dbref.rnc" type="application/relax-ng-compact-syntax"?><section xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="dbc.markup.xref" remap="topic" userlevel="easy" xml:base="db/topic.xref.xml">
  <title>Inserting Cross References</title>
  <info>
    <definitions definitionfile="defs.xml"/>
    <keywordset>
      <keyword>cross references</keyword>
      <keyword>internal link</keyword>
      <keyword>xref</keyword>
    </keywordset>
    <subjectset>
      <subject>
        <subjectterm>xref</subjectterm>
        <subjectterm>links</subjectterm>
      </subject>
    </subjectset>
  </info>
  
  <section role="problem">
    <title>Problem</title>
    <para>You want to create a cross reference from one part of your
      document into another.</para>
  </section>
  <section role="solution">
    <title>Solution</title>
    <para>Use the <tag>xref</tag> element for this purpose. A cross
      reference is a one-to-one relationship from your <tag>xref</tag>
      to your target. To create such a relationship you need two things:
    </para>
    <orderedlist>
      <listitem>
        <para>The ID of your target. This is the value of the <tag class="attribute">xml:id</tag> attribute. Make sure, it
          points to the structure itself, not the title.</para>
      </listitem>
      <listitem>
        <para>The empty <tag>xref</tag> element and a <tag class="attribute">linkend</tag> attribute which holds the ID
          of your target.</para>
      </listitem>
    </orderedlist>
    
    <para>For example, you want to reference to the introduction chapter in your book.
      The chapter looks like this:</para>
    <programlisting language="xml">&lt;chapter xml:id="intro"&gt;
  &lt;title&gt;Introduction&lt;/title&gt;
  ...      
&lt;/chapter&gt;</programlisting>
    
    <para>As you can see, the chapter contains a title but most
      importantly, it also has a <tag class="attribute">xml:id</tag>
      attribute. This is our <quote>anchor</quote> or ID.</para>
    <para>If you want to create a cross reference to your introduction
      chapter, use the <tag>xref</tag> element as follows:</para>
    
    <screen>&lt;para&gt;Get basic information in &lt;xref linkend="intro"/&gt;.&lt;/para&gt;</screen>
    <para>The previous <tag>xref</tag> is rendered as follows:</para>
    <screen>Get basic information in Chapter 1. “Introduction”.</screen>
  </section>
  <section role="discussion">
    <title>Discussion</title>
    <para>Cross referencing is important in your documents as it makes
      your text accessible for your reader. The previous section showed
      the simplest form of a cross reference. However, there is more to
      find out about <tag>xref</tag>. The following subsections gives 
      you some useful tips and tricks:</para>
    
    <itemizedlist>
      <listitem>
        <para><xref linkend="sec.markup.xref.titlesonly" xrefstyle="select:title"/></para>
      </listitem>
      <listitem>
        <para><xref linkend="sec.markup.xref.xrefstyle" xrefstyle="select:title"/></para>
      </listitem>
      <listitem>
        <para><xref linkend="sec.markup.xref.xreflabel" xrefstyle="select:title"/></para>
      </listitem>
      <listitem>
        <para><xref linkend="sec.markup.xref.langpitfalls" xrefstyle="select:title"/></para>
      </listitem>
    </itemizedlist>
    
    <section xml:id="sec.markup.xref.titlesonly">
      <title>Reference to Elements with Titles Only</title>
      <para>Basically, DocBook allows you to insert a <tag class="attribute">xml:id</tag> attribute on <emphasis>every</emphasis> element if
        you wish. However, that does not mean, you should insert one. 
        As you could see from the previous section, when the <tag>xref</tag> is resolved,
        the DocBook stylesheets uses the <tag>title</tag> element to
        create the reference to its target. 
        If you refer to a element where no title is allowed
        (for example, a <tag>para</tag>), the cross reference cannot 
        resolved correctly. Depending on the version of the DocBook
        stylesheets, you get either an error or the <tag>xref</tag> uses
        the title of its nearest ancestor (for example, the parent's section
        where the above child para is included).</para>
    </section>

    <section xml:id="sec.markup.xref.xrefstyle">
      <title>Fine-tuning Cross References</title>
      <para>In cases where it is not enough to just refer to a target,
        use the <tag class="attribute">xrefstyle</tag> attribute to fine-tune the
        appearance of the resolved cross reference. The <tag class="attribute">xrefstyle</tag> attribute expects one of the
      following values:</para>
      <variablelist>
        <varlistentry>
          <term><literal>template: <replaceable>TEMPLATE_KEYWORDS</replaceable></literal></term>
          <listitem>
            <para>After the <literal>template:</literal> text, use the
              <literal>%</literal> placeholders to define where title,
              number, etc. should appear.</para>
          </listitem>
        </varlistentry>
        <varlistentry>
          <term><literal>select: <replaceable>SELECT_KEYWORDS</replaceable></literal></term>
          <listitem>
            <para>After the <literal>select:</literal>, use specific
              keywords which maps to title, number, etc.</para>
          </listitem>
        </varlistentry>
        <varlistentry>
          <term><literal><replaceable>ANY_NAME</replaceable></literal></term>
          <listitem>
            <para>If the <tag class="attribute">xrefstyle</tag>
              attribute does not start with neither
                <literal>select</literal> nor
                <literal>template</literal>, it is interpreted as a name
              which can be found in a language file. This solution is
              not covered in this topic.</para>
          </listitem>
        </varlistentry>
      </variablelist>
    
      <section xml:id="sec.markup.xref.xrefstyle.template">
        <title>Using <literal>template</literal></title>
        <para>The <literal>template</literal> method contains an
          immutable string including placeholders. These
          placeholders are replaced with its real values during
          transformation. For example, if you want a different text to
          this section than the default, you could use the following
          code:</para>
        <screen>Section &lt;xref linkend="dbc.markup.xref"<!--
         --> xrefstyle="template:%t"/&gt; helps you with the xref element.</screen>
        <para>During transformation, the <varname>%t</varname>
          placeholder is replaced by the target's title:</para>
        <screen>Section <xref linkend="dbc.markup.xref" xrefstyle="template:%t"/> helps you with the xref element.</screen>
        <para>As you could see, any other string not starting with
          <literal>%</literal> is untouched and literally copied. 
          <xref linkend="tab.markup.xref.xrefstyle.template.placeholders"/> gives you an overview about all
          available placeholders.</para>
        
        <table xml:id="tab.markup.xref.xrefstyle.template.placeholders">
          <title>Available Placeholders for <literal>template</literal></title>
          <tgroup cols="2">
            <thead>
              <row>
                <entry>Placeholder</entry>
                <entry>Description</entry>
              </row>
            </thead>
            <tbody>
              <row>
                <entry><literal>%d</literal></entry>
                <entry>Direction (<quote>above</quote> or
                  <quote>below</quote>)</entry>
              </row>
              <row>
                <entry><literal>%n</literal></entry>
                <entry>Number</entry>
              </row>
              <row>
                <entry><literal>%o</literal></entry>
                <entry>Document name (only for <tag>olink</tag>s)</entry>
              </row>
              <row>
                <entry><literal>%p</literal></entry>
                <entry>Page number, if applicable</entry>
              </row>
              <row>
                <entry><literal>%s</literal></entry>
                <entry>Subtitle, if applicable</entry>
              </row>
              <row>
                <entry><literal>%t</literal></entry>
                <entry>Title</entry>
              </row>
            </tbody>
          </tgroup>
        </table>
      </section>
      <section xml:id="sec.markup.xref.xrefstyle.select">
        <title>Using <literal>select</literal></title>
        <para>The <literal>select</literal> method expects several
          self-explanatory keywords which are also replaced during
          transformation. The difference is, you cannot use free text as
          in <literal>template</literal> and as such gives you less
          freedom. For instance, the first example in <xref linkend="sec.markup.xref.xrefstyle.template" xrefstyle="select:title"/> can also be
          expressed by using <literal>select</literal>:</para>
        <screen>Section &lt;xref linkend="dbc.markup.xref"<!--
         --> xrefstyle="select:title"/&gt; helps you with the xref element.</screen>
        <para/>
        <table>
          <title>Available Keywords for <literal>select</literal></title>
          <tgroup cols="3">
            <colspec colname="c1"/>
            <colspec colname="c2"/>
            <colspec colname="c3"/>
            <thead>
              <row>
                <entry>Keyword</entry>
                <entry>Example</entry>
                <entry>Description</entry>
              </row>
            </thead>
            <tbody>
              <row>
                <entry namest="c1" nameend="c3">Labels</entry>
              </row>
              <row>
                <entry><literal>label</literal></entry>
                <entry><literal>Chapter 5</literal></entry>
                <entry>label and number</entry>
              </row>
              <row>
                <entry><literal>labelname</literal></entry>
                <entry><literal>Chapter</literal></entry>
                <entry>Name of the referencing element</entry>
              </row>
              <row>
                <entry><literal>labelnumber</literal></entry>
                <entry><literal>5</literal></entry>
                <entry>Only the number</entry>
              </row>
              <row>
                <entry namest="c1" nameend="c3">Titels</entry>
              </row>
              <row>
                <entry><literal>title</literal></entry>
                <entry><literal>Inserting Cross References</literal></entry>
                <entry>Title without quotes</entry>
              </row>
              <row>
                <entry><literal>quotedtitle</literal></entry>
                <entry><literal>“Inserting Cross References”</literal></entry>
                <entry>Title with quotes</entry>
              </row>
              <row>
                <entry namest="c1" nameend="c3">Pagenumber</entry>
              </row>
              <row>
                <entry><literal>page</literal></entry>
                <entry><literal>(page 100)</literal></entry>
                <entry>Page number in brackets</entry>
              </row>
              <row>
                <entry><literal>Page</literal></entry>
                <entry><literal>“Page 100”</literal></entry>
                <entry>Uppercase <quote>page</quote></entry>
              </row>
              <row>
                <entry><literal>pageabbrev</literal></entry>
                <entry><literal>(p. 100)</literal></entry>
                <entry>Abbreviated page</entry>
              </row>
              <row>
                <entry><literal>pagenumber</literal></entry>
                <entry><literal>100</literal></entry>
                <entry>Only the page number</entry>
              </row>
              <row>
                <entry><literal>nopage</literal></entry>
                <entry>n/a</entry>
                <entry>Suppressed page number</entry>
              </row>
            </tbody>
          </tgroup>
        </table>
        <para>The order of the keywords does not matter; a
          <literal>select:title nopage</literal> is the same than
          <literal>select:nopage title</literal>. The order is taken
          from the language files in <filename class="directory">common/</filename>. For example, the following
          English language file defines the order of a chapter title
          (number followed by the title):</para>
        <screen>&lt;l:context name="title-numbered"&gt;
  &lt;l:template name="article/appendix" text="%n. %t"/&gt;
&lt;/l:context&gt;</screen>
      </section>
    </section>
    
    <section xml:id="sec.markup.xref.xreflabel">
      <title>Using <tag class="attribute">xreflabel</tag> Only in Rare Cases</title>
      <para>In rare cases, you have to reference to an element which
        does not allow a title. For example, if you want to reference to
        a paragraph. In such a case, use the <tag class="attribute">xreflabel</tag>.</para>
      <para xml:id="_para1">For example, if you reference to this
        paragraph with an ID of <tag class="attvalue">_para1</tag>, your
          <tag>xref</tag> will be resolved as follows:</para>
      <screen>&lt;xref linkend="_para1"/&gt;: <xref linkend="_para1"/></screen>
      <para xml:id="_para2" xreflabel="A better test">As you can see, it prints the
        title of its ancestor element. However, if you add a
        <tag class="attribute">xreflabel</tag> to this paragraph, you
        will end up with this:</para>
      <screen>&lt;para xml:id="_para2" xreflabel="A better test"&gt; ... &lt;para
...
&lt;xref linkend="_para2"/&gt;: <xref linkend="_para2"/></screen>
      <para>Remember, this should not be your default markup when cross
        referencing. Always try to refer to a element which contains a title as
        noted in <xref linkend="sec.markup.xref.titlesonly"/>.</para>
    </section>

    <section xml:id="sec.markup.xref.langpitfalls">
      <title>Watch For Language Pitfalls</title>
      <para>When using <tag>xref</tag>s, it can be sometimes difficult
        to write a <quote>fluent</quote> sentence. For example, you
        could be inclined to start a sentence like this:</para>
      <screen>The following chapter &lt;xref linkend="dbc.markup"/&gt; explains...</screen>
      <para>However, the output is undesireable:</para>
      <screen>The following chapter <xref linkend="dbc.markup"/> explains...</screen>
      <para>Removing the word <quote>chapter</quote> makes it less ugly,
      but the problem still persists: how to create fluent, easy to read
      sentences where cross references are nicely resolved?</para>
      <para>One solution is to rewrite the sentence and start with the
        <tag>xref</tag>:</para>
      <screen>&lt;xref linkend="dbc.markup"/&gt; explains ...</screen>
      <para>If you do not like this style, you can switch to passive
        voice as another solution:</para>
      <screen>The topic ABC is explained in &lt;xref linkend="dbc.markup"/&gt;.</screen>
      <para>Sometimes passive voice is not appropriate. In cases where
        you do not want to change the tense or grammar, use the
        <literal>template</literal> or <literal>select</literal>
        methods. Applied to the first example, you can rewrite the
        <tag>xref</tag> with <tag class="attribute">xrefstyle</tag>:</para>
      <screen>The following &lt;xref linkend="dbc.markup" xrefstyle="chapter %t"/&gt;, explains...</screen>
    </section>
  </section>
  <section role="seealso">
    <title>See Also</title>    
    <itemizedlist role="category">
      <listitem>
        <para><link xlink:href="http://www.docbook.org/tdg5/en/html/xref.html"/></para>
      </listitem>
    </itemizedlist>
  </section>
</section>
  <!--
    License CC BY-NC-SA 3.0
  
   This work is licensed under the 
   "Namensnennung – Keine kommerzielle Nutzung – Weitergabe unter
    gleichen Bedingungen 3.0 Deutschland (CC BY-NC-SA 3.0)" 
   http://creativecommons.org/licenses/by-nc-sa/3.0/de/deed.de
   
   Read the English translation here:
   
   "Attribution-NonCommercial-ShareAlike 3.0 Unported (CC BY-NC-SA 3.0)" 
   http://creativecommons.org/licenses/by-nc-sa/3.0/
   
--><?xml-model href="file:../5.1/dbref.rnc" type="application/relax-ng-compact-syntax"?><section xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="dbc.markup.link" remap="topic" userlevel="easy" version="5.1" xml:base="db/topic.link.xml">
  <title>Choosing Between Link Methods</title>
  <info>
    <definitions definitionfile="defs.xml"/>
    <keywordset>
      <keyword>external links</keyword>
      <keyword>simple XLinks</keyword>
      <keyword>xlink:href</keyword>
      <keyword>ulink</keyword>
    </keywordset>
    <subjectset>
      <subject>
        <subjectterm>links</subjectterm>
        <subjectterm>xlinks</subjectterm>
        <subjectterm>xref</subjectterm>
      </subject>
    </subjectset>
  </info>
  
  <section role="problem">
    <title>Problem</title>
    <para>You need some ideas how to markup links.</para>
  </section>
  <section role="solution">
    <title>Solution</title>
    <para>Use the <tag>link</tag><footnote>
      <para>In DocBook 4 use the <tag>ulink</tag> element</para>
    </footnote> element. Usually, external links are used in two ways:</para>
    <itemizedlist>
      <listitem>
        <formalpara>
          <title>Without Text</title>
          <para>The link element is completely empty:</para>
        </formalpara>
        <programlisting language="xml">&lt;link xlink:href="https://doccookbook.sf.net"/&gt;</programlisting>
      </listitem>
      <listitem>
        <formalpara>
          <title>With Text</title>
          <para>The link element contains some text or even other
          elements:</para>
        </formalpara>
        <programlisting language="xml">&lt;link xlink:href="https://doccookbook.sf.net"&gt;The DoCookBook&lt;/link&gt;</programlisting>
      </listitem>
    </itemizedlist>
    <para>Don't forget to add the XLink namespace declaration into the
      root element of your document, for example:</para>
    <screen>&lt;book <emphasis role="bold">xmlns:xlink="http://www.w3.org/1999/xlink"</emphasis> ...&gt;</screen>
  </section>
  <section role="discussion">
    <title>Discussion</title>
    <para>The <tag>link</tag> element has several features for creating
      internal or external links. It is allowed to use text content or
      leave a <tag>link</tag> completely empty. Regardless of the text
      content, you have to choose between the attributes <tag class="attribute">xlink:href</tag> or <tag class="attribute">linkend</tag>. </para>
    
    <section xml:id="sec.db.link.attributes">
      <title>Knowing the Properties of the <tag class="attribute">xlink:href</tag> and
          <tag class="attribute">linkend</tag> Attributes</title>
      <para>Using <tag class="attribute">linkend</tag> leads always to
        an internal link and is semantically equivalent to
          <tag>xref</tag>. You cannot create external links with the
          <tag class="attribute">linkend</tag> attribute. </para>
      <para>On the other hand, the XLink attribute <tag class="attribute">xlink:href</tag> can be used for both types:
        internal or external links. An example is shown in <xref linkend="tab.db.link.internal-vs.external"/>.</para>

      <table xml:id="tab.db.link.internal-vs.external">
        <title>Internal and External Links Examples With <tag class="attribute">linkend</tag> vs. <tag class="attribute">xlink:href</tag></title>
        <titleabbrev>Internal and External Links Examples</titleabbrev>
        <tgroup cols="3">
          <thead>
            <row>
              <entry/>
              <entry><tag class="attribute">xlink:href</tag></entry>
              <entry><tag class="attribute">linkend</tag></entry>
            </row>
          </thead>
          <tbody>
            <row>
              <entry>Datatype</entry>
              <entry>xsd:anyURI</entry>
              <entry>xsd:IDREF</entry>
            </row>
            <row>
              <entry>Internal</entry>
              <entry><tag class="attvalue">#cha.intro</tag></entry>
              <entry><tag class="attvalue">cha.intro</tag></entry>
            </row>
            <row>
              <entry>External</entry>
              <entry><tag class="attvalue">http://www.docbook.org</tag></entry>
              <entry align="center">―</entry>
            </row>
          </tbody>
        </tgroup>
      </table>
    
      <para>Note, validation is only performed when using <tag class="attribute">linkend</tag>, not with <tag class="attribute">xlink:href</tag>! The reason for this is the
        different datatypes. The XML parser can only validate a
          <property>xsd:ID</property> and <property>xsd:IDREF</property>
        connection.</para>
    </section>
    
    <section xml:id="sec.db.link.matrix">
      <title>Choosing the Needed Combination</title>
      <para>With text content, you have several combinations which is
        shown in <xref linkend="tab.db.link"/>:</para>
      <table xml:id="tab.db.link">
        <title>Different Possibilities for Links</title>
        <tgroup cols="4">
          <colspec colname="c0" colwidth="1*"/>
          <colspec colname="c1" colwidth="1*"/>
          <colspec colname="c2" colwidth="4*"/>
          <colspec colname="c3" colwidth="4*"/>
          <thead>
            <row>
              <entry morerows="1" namest="c0" nameend="c1"/>
              <entry namest="c2" nameend="c3" align="center">Content</entry>
            </row>
            <row>
              <!--<entry/>-->
              <entry>With Content</entry>
              <entry>Empty</entry>
            </row>
          </thead>
          <tbody>
            <row>
              <entry morerows="1" valign="middle"><emphasis role="strong">Linking Attributes</emphasis></entry>
              <entry><tag>xlink:href</tag></entry>
              <entry>Content is a link to the specified URI</entry>
              <entry>The specified URI is used as the content</entry>
            </row>
            <row>
              <!-- <entry/> -->
              <entry><tag>linkend</tag></entry>
              <entry>Content is an internal link to the element identified</entry>
              <entry>Semantically equivalent to an <tag>xref</tag>
                (internal link)</entry>
            </row>
          </tbody>
        </tgroup>
      </table>
      
      <para>The following list shows some examples:</para>
      
      <variablelist>
        <varlistentry xml:id="vl.db.link.content-xlinkhref">
          <term>Links With Content Using <tag class="attribute">xlink:href</tag></term>
          <listitem>
            <para>Use this code to create an external link with a text
              different than the URL:</para>
            <programlisting language="xml">&lt;link xlink:href="https://doccookbook.sf.net"&gt;My Project&lt;/link&gt;</programlisting>     
          </listitem>
        </varlistentry>
        <varlistentry xml:id="vl.db.link.content-linkend">
          <term>Links With Content Using <tag class="attribute">linkend</tag></term>
          <listitem>
            <para>Use this code to create an internal link (cross
              reference). The <quote>hot text</quote>
              is created from the content of <tag>link</tag>:</para>
            <programlisting language="xml">&lt;link linkend="cha.intro"&gt;Introduction&lt;/link&gt;</programlisting>
          </listitem>
        </varlistentry>
        <varlistentry xml:id="vl.db.link.empty-xlinkhref">
          <term>Empty Links Using <tag class="attribute">xlink:href</tag></term>
          <listitem>
            <para>Use this code to create an external link where the <quote>hot text</quote>
              is taken from the URL:</para>
            <programlisting language="xml">&lt;link xlink:href="http://www.example.org/Intro"/&gt;</programlisting>
            <para>If you want to create an internal link without ID
              validation check, use this code:</para>
            <programlisting language="xml">&lt;link xlink:href="#cha.intro"/&gt;</programlisting>
            <para>This is equivalent to the following <tag>xref</tag>
              notation:</para>
            <screen>&lt;xref linkend="cha.intro"/&gt;</screen>
            <para>Note the absense of the <literal>#</literal>
              character. Regardless if it is an empty <tag>link</tag>
              with <tag class="attribute">xlink:href</tag> or a
                <tag>xref</tag> with <tag class="attribute">linkend</tag>, the ID has to exist somewhere in the
              document. Otherwise, the element cannot be resolved during
              processing and and the link will be broken.</para>
          </listitem>
        </varlistentry>
        <varlistentry>
          <term>Empty Links Using <tag class="attribute">linkend</tag></term>
          <listitem>
            <para>This notation is semantically equivalent to an
              <tag>xref</tag>. See also <xref linkend="dbc.markup.xref"/>:</para>
            <programlisting language="xml">&lt;link linkend="cha.intro"/&gt;</programlisting>
            <para>The only difference of the previous example is the ID
              <tag class="attvalue">cha.intro</tag> must be unique and
              is checked if it is available in your document. If not, it
            is an validation error.</para>
          </listitem>
        </varlistentry>
      </variablelist>
      
      <para>In most cases, it is enough to just use an empty link
        element. As such, avoid the following notation when the URL in
          <tag class="attribute">xlink:href</tag> is the same than the
        text:</para>
      <programlisting language="xml">&lt;link xlink:href="https://doccookbook.sf.net"&gt;https://doccookbook.sf.net&lt;/link&gt;</programlisting>
      <para>This is mostly unnecessary as it is overly verbose,
        difficult to read, and does not add any value. Correct such
        links and remove the text: </para>
      <programlisting language="xml">&lt;link xlink:href="https://doccookbook.sf.net"/&gt;</programlisting>     
    </section>
    
    <section xml:id="sec.db.link.xlinks">
      <title>Shortening Links</title>
      <para>DocBook 5 also adds new concepts. One of this new concept is
        that <emphasis>every</emphasis> element can become a link. In
        other words, you do <emphasis role="italic">not</emphasis> have
        to use a <tag>link</tag> element anymore. For example, if you
        want to insert a book title with an additional link, in
        DocBook 4 it has to be written like this:</para>
      <programlisting language="xml">&lt;citetitle&gt;&lt;ulink url="https://doccookbook.sf.net"&gt;The DoCookBook&lt;/ulink&gt;&lt;/citetitle&gt;</programlisting>
      <para>or this, depending on what you prefer:</para>
      <programlisting language="xml">&lt;ulink url="https://doccookbook.sf.net"&gt;&lt;citetitle&gt;The DoCookBook&lt;/citetitle&gt;&lt;/ulink&gt;</programlisting>
      <para>With DocBook 5 this can be shortend:</para>
      <programlisting language="xml">&lt;citetitle xlink:href="https://doccookbook.sf.net"&gt;The DoCookBook&lt;/citetitle&gt;</programlisting>
      <para>Apart from the previous described link concept,
        DocBook 5 allows to control the link behavior. For example,
        to open a new window when clicking a link, use the <tag class="attribute">xlink:show</tag> attribute: </para>
      <programlisting language="xml">&lt;link xlink:show="new" xlink:href="https://doccookbook.sf.net"/&gt;</programlisting>
      <para>The attribute value <tag class="attvalue">show</tag> opens a
        <quote>new window, frame, pane, or other relevant presentation
          context</quote> (see <link xlink:href="http://www.docbook.org/tdg51/en/html/ref-elements.html#common.linking.attributes">Common Linking Attributes</link>).
        Of course, this is only useful for online formats. </para>
    </section>
  </section>
  <section role="seealso">
    <title>See Also</title>
    <itemizedlist>
      <listitem>
        <para><xref linkend="dbc.markup.xref"/></para>
      </listitem>
      <listitem>
        <para><xref linkend="dbc.markup.xref-vs-link"/></para>
      </listitem>
      <!--<listitem>
        <para><xref linkend="dbc.db.ext-xlinks"/></para>
      </listitem>-->
      <listitem>
        <para><link xlink:href="http://www.docbook.org/tdg5/en/html/link.html"/></para>
      </listitem>
    </itemizedlist>
  </section>
</section>
  <!--<xi:include href="db/topic.extended-xlinks.xml"/>-->
  <!-- TODO: Needs to investigate alt in acronym more: -->
  <!--<xi:include href="db/topic.acronym.xml"/>-->
  <!--
    License CC BY-NC-SA 3.0
  
   This work is licensed under the 
   "Namensnennung – Keine kommerzielle Nutzung – Weitergabe unter
    gleichen Bedingungen 3.0 Deutschland (CC BY-NC-SA 3.0)" 
   http://creativecommons.org/licenses/by-nc-sa/3.0/de/deed.de
   
   Read the English translation here:
   
   "Attribution-NonCommercial-ShareAlike 3.0 Unported (CC BY-NC-SA 3.0)" 
   http://creativecommons.org/licenses/by-nc-sa/3.0/
   
--><!--<?xml-model href="file:../5.1/dbref.rnc" type="application/relax-ng-compact-syntax"?>--><section xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="dbc.markup.quotes" remap="topic" userlevel="easy" xml:base="db/topic.quotes.xml">
  <title>Inserting Inline Quotes</title>
  <info>
    <definitions definitionfile="defs.xml"/>
    <keywordset>
      <keyword>quotes</keyword>
      <keyword>typographic quotes</keyword>
    </keywordset>
  </info>
  
  <section role="problem">
    <title>Problem</title>
    <para>You want to use inline quotes in a consistent and language
      independant way.</para>
  </section>
  <section role="solution">
    <title>Solution</title>
    <para>Use the <tag>quote</tag> tag:</para>
    <programlisting language="xml">&lt;para&gt;This is an &lt;quote&gt;English quote&lt;/quote&gt;.&lt;/para&gt;</programlisting>
  </section>
  <section role="discussion">
    <title>Discussion</title>
    <para>When people need quotes, they usually write
      <phrase>"this"</phrase>. However, from a typographical point of
      view, this is wrong. There are special start and end quotation
      characters. The more elegant way is to use <quote>this</quote>.
    </para>
    <para>However, the open and close characters are language dependent.
      Each language has different quotation rules. German readers
      prefer <quote xml:lang="de">this</quote>, French <quote xml:lang="fr">this</quote>, and the Italians use <quote xml:lang="it">this</quote>. </para>
    <para>Using quote markers directly has one disadvantages: if your
      text contains different languages you need to know how quotes are
      displayed in the respective language. Also it is easier and more
      consistent to leave this typographic detail to the DocBook
      stylesheets.</para>
    <para>One nice thing with inserting <tag>quote</tag> is it can be
      adapted to a different language by using the <tag class="attribute">xml:lang</tag> attribute:</para>
    <programlisting language="xml">&lt;para&gt;This is a &lt;quote xml:lang="de"&gt;German quote&lt;/quote&gt;.&lt;/para&gt;</programlisting>
    <!--
       TODO: 
        Often in literary (fiction and sometimes nonfiction) text, quotation 
        marks are unbalanced - an open quote is not closed at the end of a
        paragraph, and is the quotation resumes with an open quote in the
        following paragraph.  
        For example:
          “I advise against this usage....
 	  “Because it makes things difficult for DocBook developers.”
        The writer Joseph Conrad did this all the time, for pages on
        end-when a character tells a long story to his shipmates.  So I call
        them "Conrad Quotes."
    -->
  </section>
</section>
  <!--
    License CC BY-NC-SA 3.0
  
   This work is licensed under the 
   "Namensnennung – Keine kommerzielle Nutzung – Weitergabe unter
    gleichen Bedingungen 3.0 Deutschland (CC BY-NC-SA 3.0)" 
   http://creativecommons.org/licenses/by-nc-sa/3.0/de/deed.de
   
   Read the English translation here:
   
   "Attribution-NonCommercial-ShareAlike 3.0 Unported (CC BY-NC-SA 3.0)" 
   http://creativecommons.org/licenses/by-nc-sa/3.0/
   
--><!--<?xml-model href="file:../5.1/dbref.rnc" type="application/relax-ng-compact-syntax"?>--><section xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="dbc.markup.citerefentry" remap="topic" userlevel="easy" xml:base="db/topic.citerefentry4manpages.xml">
  <title>Markup References to Man Pages</title>
  <info>
    <definitions definitionfile="defs.xml"/>
    <keywordset>
      <keyword>citerefentry</keyword>
      <keyword>man pages</keyword>
    </keywordset>
  </info>
  
  <section role="problem">
    <title>Problem</title>
    <para>You search for an easy way to markup inline references to man
      pages.</para>
  </section>
  <section role="solution">
    <title>Solution</title>
    <para>Use <tag xlink:href="http://www.docbook.org/tdg51/en/html/citerefentry.html">citerefentry</tag>. </para>
    <example>
      <title>Markup Code for Referencing Man Pages</title>
      <programlisting language="xml">&lt;citerefentry&gt;
  &lt;refentrytitle&gt;xmllint&lt;/refentrytitle&gt;
  &lt;manvolnum&gt;1&lt;/manvolnum&gt;
&lt;/citerefentry&gt;</programlisting>
    </example>
    <para>It is rendered like this:</para>
    <example>
      <title>Rendered Result</title>
      <para><citerefentry>
        <refentrytitle>xmllint</refentrytitle>
        <manvolnum>1</manvolnum>
    </citerefentry></para>
    </example>
  </section>
  <section role="discussion">
    <title>Discussion</title>
    <para>Some discussion about the problem and solution.</para>
  </section>
  <section role="seealso">
    <title>See Also</title>
    <para>Include URL or bibliographic references.</para>
  </section>
</section>
</chapter>
  <!--
    License CC BY-NC-SA 3.0
  
   This work is licensed under the 
   "Namensnennung – Keine kommerzielle Nutzung – Weitergabe unter
    gleichen Bedingungen 3.0 Deutschland (CC BY-NC-SA 3.0)" 
   http://creativecommons.org/licenses/by-nc-sa/3.0/de/deed.de
   
   Read the English translation here:
   
   "Attribution-NonCommercial-ShareAlike 3.0 Unported (CC BY-NC-SA 3.0)" 
   http://creativecommons.org/licenses/by-nc-sa/3.0/
   
--><!--<?xml-model href="file:5.1/dbref.rnc" type="application/relax-ng-compact-syntax"?>--><chapter xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="dbc.common" version="5.1">
  <title>Common Customizations</title>
  <info>
    <definitions definitionfile="defs.xml"/>
    <biblioid class="other" otherclass="ticket">7</biblioid>
    <keywordset>
      <keyword>common customizations</keyword>
    </keywordset>
    
    <abstract>
      <para>Some typical problems are independant from their target
        formats. This chapter gives you some information what falls into
        this category.</para>
    </abstract>
  </info>
  
  <section xml:id="dbc.common.intro">
    <title>Introduction</title>
    <para>A lot of customizations can be shared between different output
      formats. As such, it is probably a good idea to think about how to
      structure and store your customizations before starting. The
      following directories are a good start, especially if you want to
      support different output formats:</para>
    <screen>mycustomizations/
  +-- common/
  +-- fo/
  +-- html/
  +-- futher formats...</screen>
    <para>The <filename class="directory">common</filename> directory
      contains all the stylesheets which are not specific to any
      formats. On the contrary, <filename class="directory">fo</filename>, <filename class="directory">html</filename>,
      etc. contain the respective customizations for their target
      formats. </para>
    <para>Furthermore, it is recommended to use the same file name than
      the original from the DocBook XSL stylesheets. This makes it
      easier to see, what changes can be expected within your files.</para>
  </section>
  
  <!-- 
   * Finding Professional Fonts
   * Getting to Know Available DocBook XSL Stylesheets 
   * Generating localized text (e.g. gentext.nav.next, gentext.nav.prev,)
   * Extending Language Files with your Own Text
   * Getting an Overview -> maybe _before_ any of the topics?
   * DocBook customization (through parameters or customization layers)
   * Changing and Extending Language Entries
   * Outputing Time and Dates
   * Taking Advantage of Common Bibliography
   * Taking Advantage of Common Glossary
   * Colorising Profiled Text
     http://lists.oasis-open.org/archives/docbook-apps/201108/msg00100.html
   * Printing XPath from Stylesheet
   * Creating Unit Test with XSpec
  -->
  <!--
    License CC BY-NC-SA 3.0
  
   This work is licensed under the 
   "Namensnennung – Keine kommerzielle Nutzung – Weitergabe unter
    gleichen Bedingungen 3.0 Deutschland (CC BY-NC-SA 3.0)" 
   http://creativecommons.org/licenses/by-nc-sa/3.0/de/deed.de
   
   Read the English translation here:
   
   "Attribution-NonCommercial-ShareAlike 3.0 Unported (CC BY-NC-SA 3.0)" 
   http://creativecommons.org/licenses/by-nc-sa/3.0/
   
--><!--<?xml-model href="file:../5.1/dbref.rnc" type="application/relax-ng-compact-syntax"?>--><section xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="dbc.common.fonts" remap="topic" userlevel="easy" xml:base="common/topic.fonts.xml">
  <title>Finding Professional Fonts</title>
  <info>
    <definitions definitionfile="defs.xml"/>
    <keywordset>
      <keyword>fonts</keyword>
      <keyword>SIL</keyword>
      <keyword>Google Web Fonts</keyword>
      <keyword>CTAN</keyword>
      <keyword>Linux Libertine fonts</keyword>
      <keyword>DejaVu fonts</keyword>
      <keyword>Stix fonts</keyword>
    </keywordset>
    <subjectset>
      <subject>
        <subjectterm>fonts</subjectterm>
      </subject>
    </subjectset>
  </info>
  
  <section role="problem">
    <title>Problem</title>
    <para>You need to find professional fonts, preferably released under
      an open source license which can be used for print or Web formats.</para>
  </section>
  <section role="solution">
    <title>Solution</title>
    <para>There are some very good fonts which can be used freely. Most
      fonts are even released under the <link xlink:href="http://scripts.sil.org/OFL">Open Font License</link>
      or other free or open licenses. The following list is a small
      overview which is by no means complete (use also your favorite
      search engine):</para>
    <variablelist>
      <varlistentry>
        <term><link xlink:href="http://scripts.sil.org"/></term>
        <listitem>
          <para><acronym>SIL<alt>Summer Institute of
            Linguistics</alt></acronym> is a nonprofit organization for
            sustainable language development. One part is to <quote>support 
            the use of non-Roman and complex scripts in language development.</quote>
            <acronym>SIL</acronym> creates the Charis SIL, Doulos SIL,
            Gentium, Andika, and other typefaces. All fonts are released
            under the Open Font License (OFL). This license was specially
            created for fonts and was initiated by SIL
            <remark>FIXME: Check!</remark>
            </para>
        </listitem>
      </varlistentry>
      <varlistentry>
        <term><link xlink:href="http://www.google.com/webfonts"/></term>
        <listitem>
          <para>Google Web Fonts is a huge collection of open source
            fonts. They can be freely incorporated into your Web sites
            using CSS or can be downloaded and embedded in PDF.</para>
        </listitem>
      </varlistentry>
      <varlistentry>
        <term><link xlink:href="http://www.tug.org/tetex/"/></term>
        <listitem>
          <para>The TeTeX distribution and <acronym>CTAN<alt>Comprehensive 
            TeX Archive Network</alt></acronym> contains also some high quality
            fonts, however, more aimed at the print business and not for
          the Web.</para>
        </listitem>
      </varlistentry>
      <varlistentry>
        <term><link xlink:href="http://www.linuxlibertine.org"/></term>
        <listitem>
          <para>The Linux Libertine fonts are designed to be an
            alternative to the serif Times fonts.  
            The Linux Libertine and the Linux Biolinum fonts are a
            collection of serif and sans serif fonts with the usual
            Latin, Greek, Cyrillic, and Hebrew glyphs. Additionally, the fonts
            contain ligatures, true small caps, old style numbers,
            proportional or monospaced numbers, true superscript and
            subscript, and much more. A monospace variant is currently
            designed.</para>
        </listitem>
      </varlistentry>
      <varlistentry>
        <term><link xlink:href="http://dejavu-fonts.org"/></term>
        <listitem>
          <para>
          The DejaVu font family are derived from the Bitstream Vera fonts.
          Due to license issues, the font has to be renamed. The fonts
          contain now lots of glyphs and supports Latin, Greek, Cyrillic, 
          Armenian, Georgian, and other languages.
          </para>
        </listitem>
      </varlistentry>
      <varlistentry>
        <term><link xlink:href="http://www.stixfonts.org"/></term>
        <listitem>
          <para>The STIX fonts (Scientific and Technical Information Exchange)
          is a set of comprehensive fonts for scientific and engineering 
          manuscripts. They can be used both for print and online publishing. </para>
        </listitem>
      </varlistentry>
    </variablelist>
    
  </section>
  <section role="discussion">
    <title>Discussion</title>
    <para>Before you use a font, answer the following questions:</para>
    <itemizedlist>
      <listitem>
        <formalpara>
          <title>Supported Languages and Amount of Glyphs</title>
          <para>Does your font support your language? Although modern
            fonts use Unicode thesedays, nevertheless your language
            might not be supported. Especially if you need
              <quote>uncommon</quote> languages or rarely used glyphs.
          </para>
        </formalpara>
      </listitem>
      <listitem>
        <formalpara>
          <title>Missing Styles</title>
          <para>Some fonts are published in only one style, usually
            <emphasis>regular</emphasis>. Such fonts makes it more difficult
            to universally adopt them in different scenarios where more
            styles (bold, italic, or a combination) are needed.
          </para>
        </formalpara>
      </listitem>
      <listitem>
        <formalpara>
          <title>Font Formats</title>
          <para>Modern fonts are usually Unicode fonts published as <acronym>OTF<alt>OpenType Font</alt></acronym> or <acronym>TTF<alt>TrueType</alt></acronym>
            format. Older fonts are mostly PostScript Type 1 fonts which 
            have a limited amount of glphys (theoretically 256). 
            PostScript fonts cannot be used on the Web.</para>
        </formalpara>
      </listitem>
      <listitem>
        <formalpara>
          <title>Font Combinations</title>
          <para>For a non-designer, it is generally easier to use a
            complete font family conisting of sans serif, serif and
            monospaced typefaces. The reason for this is these typefaces
            are made to fit together. It is much more difficult to
            select fonts which work aesthetically as it needs
            experiences.</para>
        </formalpara>
      </listitem>
      <listitem>
        <formalpara>
          <title>Quality</title>
          <para>This is a broad topic and it depends heavily where you want to
            use the font. Is it primarily used for Web content or only
            for print? Or both? Some fonts looks only good on a Web
            page, other work only for printed documents. Sometimes the
            <emphasis>hinting</emphasis> (adjustment of a font to a
            certain resolution) may or may not be implemented.
          </para>
        </formalpara>
      </listitem>
    </itemizedlist>   
  </section>
</section>
  <!--
    License CC BY-NC-SA 3.0
  
   This work is licensed under the 
   "Namensnennung – Keine kommerzielle Nutzung – Weitergabe unter
    gleichen Bedingungen 3.0 Deutschland (CC BY-NC-SA 3.0)" 
   http://creativecommons.org/licenses/by-nc-sa/3.0/de/deed.de
   
   Read the English translation here:
   
   "Attribution-NonCommercial-ShareAlike 3.0 Unported (CC BY-NC-SA 3.0)" 
   http://creativecommons.org/licenses/by-nc-sa/3.0/
   
--><!--<?xml-model href="file:../5.1/dbref.rnc" type="application/relax-ng-compact-syntax"?>--><section xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="dbc.common.dbcustomize" remap="topic" userlevel="medium" version="5.1" xml:base="common/topic.dbxsl-customization.xml">
  <title>Writing Customization Layers</title>
  <info>
    <definitions definitionfile="defs.xml"/>
    <keywordset>
      <keyword>customization layer</keyword>
    </keywordset>
    <subjectset>
      <subject>
        <subjectterm>customizationlayer</subjectterm>
      </subject>
    </subjectset>
  </info>
  
  <section role="problem">
    <title>Problem</title>
    <para>You want to write a customization layer for the DocBook XSL
      stylesheets, but you do not know how to do it.</para>
  </section>
  <section role="solution">
    <title>Solution</title>
    <para>A DocBook XSL customization layer comprise the following
    components:</para>
    
    <itemizedlist>
      <listitem>
        <para>A XSLT stylesheet skeletton with the start tag <tag class="starttag">xsl:stylesheet</tag> and the end tag
          <tag class="endtag">xsl:stylesheet</tag></para>
      </listitem>
      <listitem>
        <para>At least the namespaces for XSLT, DocBook 5, and your
          output format (for example, FO or XHTML).</para>
      </listitem>
      <listitem>
        <para>A <tag class="emptytag">xsl:import</tag> element to 
          incoporate the base DocBook XSLT stylesheet.</para>
      </listitem>
      <listitem>
        <para>Your customizations (parameters, variables, templates, or
          other imports).</para>
      </listitem>
    </itemizedlist>
    <para>How this can look is shown in the following listing.</para>
    <example xml:id="ex.common.dbcustomize.general-cust-layer">
      <title>General Customization Layer</title>
      <info>
        <output xmlns="urn:x-toms:docbook-ext">
          <filename>dbcustomize/docbook-customization.xsl</filename>
        </output>
      </info>
      <programlisting linenumbering="numbered" language="xml">&lt;xsl:stylesheet version="1.0"
  xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
  xmlns:d="http://docbook.org/ns/docbook"&gt;
  
  &lt;xsl:import href="http://docbook.sourceforge.net/release/xsl-ns/current/<replaceable>FORMAT</replaceable>/docbook.xsl"/&gt;
  
  &lt;!-- Your customizations go here --&gt;
  
&lt;/xsl:stylesheet&gt;</programlisting>
    </example>
  </section>
  <section role="discussion">
    <title>Discussion</title>
    <para>Why not modify the original stylesheets? There are some
      profound reasons which speaks against such modifications:      
    </para>
    <itemizedlist>
      <listitem>
        <para>Whenever you update your stylesheet, all your
          modifications are lost.</para>
      </listitem>
      <listitem>
        <para>You cannot separate between different customizations, for example,
        in one book you need an index but in the other it is unwanted.</para>
      </listitem>
      <listitem>
        <para>If you modify the original stylesheets directly you can
          not go back to the former output. </para>
      </listitem>
      <listitem>
        <para>It is hard to distinguish between your customizations and
          the original one.</para>
      </listitem>
    </itemizedlist>
    
    <para>Refrain from editing the original stylesheets! Always write a
      customization layer.</para>
    
    <para>Apart from the above, obvious reasons, the following list
      gives you some recommendations:</para>
    
    <itemizedlist>
      <listitem>
        <para>Insert common parameters or templates into a stylesheet
          which is included in your different customizations.</para>
      </listitem>
      <listitem>
        <para>Structure your output formats in different directories as
          shown in <xref linkend="dbc.common.intro"/>.</para>
      </listitem>
      <listitem>
        <para>Name your main stylesheet <filename>docbook.xsl</filename>
          or <filename>chunk.xsl</filename> (HTML only).</para>
      </listitem>
      <listitem>
        <para>If your customization grows, outsource your customization
          into several stylesheets and include them into your
          <quote>main</quote> stylesheet.</para>
      </listitem>
      <listitem>
        <para>Name your files like the DocBook XSL stylesheets. For
          example, if you customize <tag>filename</tag> (an inline
          element) put it into the file
          <filename>inline.xsl</filename>.</para>
      </listitem>
    </itemizedlist>
    
    <para>An example how this can look like, is shown in <xref linkend="ex.dbxsl.customizations"/>:</para>
    <example xml:id="ex.dbxsl.customizations">
      <title>Structure </title>
      <screen>mycustomizations/
  +-- common/
      +-- common.xsl <co xml:id="co.dbxsl.custlayer.common"/>
  +-- fo/
      +-- docbook.xsl <co xml:id="co.dbxsl.custlayer.fo.docbook"/>
      +-- inline.xsl  <co xml:id="co.dbxsl.custlayer.fo.inline"/>
  +-- html/
      +-- docbook.xsl <co xml:id="co.dbxsl.custlayer.html.docbook"/>
      +-- chunk.xsl   <co xml:id="co.dbxsl.custlayer.html.chunk"/>
      +-- inline.xsl  <co xml:id="co.dbxsl.custlayer.html.inline"/></screen>
    </example>
    <calloutlist>
      <callout arearefs="co.dbxsl.custlayer.common">
        <para>Common customizations across different formats</para>
      </callout>
      <callout arearefs="co.dbxsl.custlayer.fo.docbook">
        <para>Main stylesheet for FO output; includes <filename>inline.xsl</filename></para>
      </callout>
      <callout arearefs="co.dbxsl.custlayer.fo.inline">
        <para>Contains all modifications for inline elements regarding
          the FO output.</para>
      </callout>
      <callout arearefs="co.dbxsl.custlayer.html.docbook">
        <para>Main stylesheet for single HTML output; includes <filename>inline.xsl</filename></para>
      </callout>
      <callout arearefs="co.dbxsl.custlayer.html.chunk">
        <para>Main stylesheet for chunked HTML output; imports <filename>docbook.xsl</filename></para>
      </callout>
      <callout arearefs="co.dbxsl.custlayer.html.inline">
        <para>Contains all modifications for inline elements regarding
          the HTML output.</para>
      </callout>
    </calloutlist>
    
    <para>To use one of the customization layer with, for example,
      <command>xsltproc</command>, use:</para>
    <screen><command>xsltproc</command> mycustomizations/html/docbook.xsl mydocbook.xml</screen>
  </section>
  <section role="seealso">
    <title>See Also</title>
    <para><link xlink:href="http://www.sagehill.net/docbookxsl/CustomMethods.html#CustomizationLayer"/></para>
  </section>
</section>
  <!--
    License CC BY-NC-SA 3.0
  
   This work is licensed under the 
   "Namensnennung – Keine kommerzielle Nutzung – Weitergabe unter
    gleichen Bedingungen 3.0 Deutschland (CC BY-NC-SA 3.0)" 
   http://creativecommons.org/licenses/by-nc-sa/3.0/de/deed.de
   
   Read the English translation here:
   
   "Attribution-NonCommercial-ShareAlike 3.0 Unported (CC BY-NC-SA 3.0)" 
   http://creativecommons.org/licenses/by-nc-sa/3.0/
   
--><!--<?xml-model href="file:../5.1/dbref.rnc" type="application/relax-ng-compact-syntax"?>--><section xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="dbc.common.dbtimestamp" remap="topic" userlevel="easy" xml:base="common/topic.dbtimestamp.xml">
  <title>Inserting Date and Time</title>
  <info>
    <keywordset>
      <keyword>date and time</keyword>
      <keyword>datetime</keyword>
      <keyword>dbtimestamp</keyword>
      <keyword>processing-instruction</keyword>
      <keyword>context</keyword>
    </keywordset>
    <subjectset>
      <subject>
        <subjectterm>dbpi</subjectterm>
        <subjectterm>datetime</subjectterm>
      </subject>
    </subjectset>
  </info>
    
  <section role="problem">
    <title>Problem</title>
    <para>You want to insert the current date, time, or both in your
      output format (for example, to show the date of creation).</para>
  </section>
  <section role="solution">
    <title>Solution</title>
    <para>Use the <tag class="xmlpi">dbtimestamp</tag> processing
      instruction (PI). For example, integrate it into the
        <tag>pubdate</tag> to show the current publication date on the
      titlepage: </para>
    <programlisting language="xml">&lt;info&gt;
  &lt;!-- ... --&gt;
  &lt;pubdate&gt;<emphasis role="strong">&lt;?dbtimestamp?&gt;</emphasis>&lt;/pubdate&gt;
&lt;/info&gt;</programlisting>
  </section>
  <section role="discussion">
    <title>Discussion</title>
    <para>The above PI includes the date in its
        <emphasis>localized</emphasis> form, or in other words: the
      output depends on the current language. If you do not have set any
      language, the default is English (<code>en_US</code>) which is 
      <code>month/day/year</code>. If you want to
      change the default format, use one of the two options: </para>
    <itemizedlist>
      <listitem>
        <para>Change the default format</para>
      </listitem>
      <listitem>
        <para>Add pseudo-attributes</para>
      </listitem>
    </itemizedlist>
    
    <section xml:id="dbc.common.dbtimestamp.default-format">
      <title>Changing the Default Format</title>
      <para>Each language contains in its language files<remark>add
          xref</remark> the context <code>datetime</code>. The following
        code shows it for the English language file:</para>
      <programlisting language="xml">&lt;l:context name="datetime"&gt;
  &lt;l:template name="format" text="m/d/Y"/&gt;
&lt;/l:context&gt;</programlisting>
      <para>This is only useful, if you want to completely change the appearance of
        a date in your document. </para>
      <!-- Add procedure to explain how to change? -->
    </section>
    <section xml:id="dbc.common.dbtimestamp.pseudo-attrib">
      <title>Adding Pseudo-Attributes</title>
      <para>The simpler method is to change the PI directly. Especially
        if you do not want to customize the date for the complete
        document or you want it change individually. Basically, add a
          <emphasis>pseudo-attribute</emphasis><footnote>
          <para>A <emphasis>pseudo-attribute</emphasis> looks like an
            XML attribute due to its similar syntax. However, it is not.
            A processing instruction can only contain text and no
            attributes. For more information about PIs, refer to the XML
            specification at <link xlink:href="http://www.w3.org/TR/REC-xml/#sec-pi"/>.</para>
        </footnote> into the <tag class="xmlpi">dbtimestamp</tag> PI.
        For example, if you want to insert only the year, add the <tag class="attribute">format</tag> pseudo-attribute: </para>
      <screen language="xml">&lt;?dbtimestamp format="Y"?&gt;</screen>
      <para>More format-letters can be found in the reference page (see
        link at the <citetitle>See Also</citetitle> section).</para>
    </section>
  </section>
  <section role="seealso">
    <title>See Also</title>
    <itemizedlist>
      <listitem>
        <para><link xlink:show="new" xlink:href="http://www.sagehill.net/docbookxsl/Datetime.html"/></para>
      </listitem>
      <listitem>
        <para><link xlink:show="new" xlink:href="http://docbook.sourceforge.net/release/xsl/current/doc/pi/dbtimestamp.html"/>,
        the reference page for the PI</para>
      </listitem>
    </itemizedlist>
  </section>
</section>
  <!--
    License CC BY-NC-SA 3.0
  
   This work is licensed under the 
   "Namensnennung – Keine kommerzielle Nutzung – Weitergabe unter
    gleichen Bedingungen 3.0 Deutschland (CC BY-NC-SA 3.0)" 
   http://creativecommons.org/licenses/by-nc-sa/3.0/de/deed.de
   
   Read the English translation here:
   
   "Attribution-NonCommercial-ShareAlike 3.0 Unported (CC BY-NC-SA 3.0)" 
   http://creativecommons.org/licenses/by-nc-sa/3.0/
   
--><!--<?xml-model href="file:../5.1/dbref.rnc" type="application/relax-ng-compact-syntax"?>--><section xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="dbc.common.titles" remap="topic" xml:base="common/topic.titles.xml">
  <title>Accessing Title Contents</title>
  <info>
    <definitions definitionfile="defs.xml"/>
    <keywordset>
      <keyword>titles</keyword>
      <keyword>title.markup</keyword>
      <keyword>subtitle.markup</keyword>
      <keyword>titleabbrev.markup</keyword>
    </keywordset>
    <subjectset>
      <subject>
        <subjectterm>titles</subjectterm>
      </subject>
    </subjectset>
  </info>
  
  <section role="problem">
    <title>Problem</title>
    <para>You need to retrieve a title (or subtitle), but your current
      node is not a <tag>title</tag>.</para>
  </section>
  <section role="solution">
    <title>Solution</title>
    <para>The DocBook XSL stylesheets offers the
      <literal>title.markup</literal> mode for this purpose. Usually,
      insert the following code in the appropriate place:</para>
    <programlisting language="xml">&lt;xsl:apply-templates select="." mode="title.markup"/&gt;</programlisting>
    <para>The <tag>xsl:apply-templates</tag> recursively finds the
      correct <tag>title</tag> node, regardless where you are. It also looks
      into an <tag>info</tag> element, if necessary.</para>
  </section>
  <section role="discussion">
    <title>Discussion</title>
    <para>DocBook contains three elements which are used for title
      markup:</para>
    <variablelist>
      <varlistentry>
        <term><tag xlink:href="http://www.docbook.org/tdg51/en/html/title.html">title</tag></term>
        <listitem>
          <para>The main title. According to the <acronym>TDG</acronym> 
            <quote>it identifies the titles of documents and parts of
              documents, and is the required caption on formal
              objects.</quote>
          </para>
        </listitem>
      </varlistentry>
      <varlistentry>
        <term><tag xlink:href="http://www.docbook.org/tdg51/en/html/subtitle.html">subtitle</tag></term>
        <listitem>
          <para>A optional subtitle is an alternative or explanatory title in
            addition to its main title. Usually a subtitle is printed below the
            main title on the same page.
          </para>
        </listitem>
      </varlistentry>
      <varlistentry>
        <term><tag xlink:href="http://www.docbook.org/tdg51/en/html/titleabbrev.html">titleabbrev</tag></term>
        <listitem>
          <para>The optional, abbreviated title is used in case the main
            title is overly verbose. Usually this element is not printed
            with the main title on the same page. However, it is used in
            the table of content, for example.</para>
        </listitem>
      </varlistentry>
    </variablelist>
    
    <para>All of the above title elements contains a special mode to get
      the content of this node:</para>
    
    <table xml:id="tab.common.titles.modes">
      <title>Modes for Title Elements</title>
      <tgroup cols="2">
        <thead>
          <row>
            <entry>Element</entry>
            <entry>Mode</entry>
          </row>
        </thead>
        <tbody>
          <row>
            <entry><tag>title</tag></entry>
            <entry><code>title.markup</code></entry>
          </row>
          <row>
            <entry><tag>subtitle</tag></entry>
            <entry><code>subtitle.markup</code></entry>
          </row>
          <row>
            <entry><tag>titleabbrev</tag></entry>
            <entry><code>titleabbrev.markup</code></entry>
          </row>
        </tbody>
      </tgroup>
    </table>
    
    <para>To further elaborate why you should use one of the previous
      modes, let's assume you have this chapter title:</para>
    <programlisting language="xml">&lt;chapter&gt;
   &lt;title&gt;Programming in Python&lt;/title&gt;
   &lt;!-- further substructure pruned --&gt;
&lt;/chapter&gt;</programlisting>
    <para>Let's further assume, you have a template where you need the
      title from the above chapter. One simple, yet unfavorable, solution
      could be coded like this:</para>
    <programlisting language="xml">&lt;xsl:template name="..."&gt;
   &lt;xsl:value-of select="ancestor::d:title"/&gt;
&lt;/xsl:template&gt;</programlisting>
    <para>This has several disadvantages:</para>
    <itemizedlist>
      <listitem>
        <para>The XPath does not consider a title inside an
          <tag>info</tag> element.</para>
      </listitem>
      <listitem>
        <para>The <tag>xsl:value-of</tag> returns the <emphasis>string
          value</emphasis>. In most cases this is correct. However, if
          you have a <tag>quote</tag> inside <tag>title</tag>, the
          <tag>quote</tag> is not processed and you will not get any
          quotation marks.</para>
      </listitem>
    </itemizedlist>
    <para>Replacing <tag>xsl:value-of</tag> through the
        <tag>xsl:apply-templates</tag> as shown in the solution section,
      ensures correct processing of child elements inside
      <tag>title</tag>.</para>
    
    <para>The same is true for <tag>subtitle</tag> and
      <tag>titleabbrev</tag>. Using the <code>subtitle.markup</code> or
      <code>titleabbrev.markup</code> mode ensure you get always the
      correct content. </para>
    <para>To see what combination results in what string, find an
      overview in <xref linkend="tab.common.titles.results"/>.</para>  
    
    
    <table xml:id="tab.common.titles.results">
      <title>Different Combinations and Their Results on
        <code>*.markup</code> Modes</title>
      <tgroup cols="2">
        <thead>
          <row>
            <entry>Code</entry>
            <entry>Results</entry>
          </row>
        </thead>
        <tbody>
          <row>
            <entry><screen language="xml">&lt;title&gt;Programming in Python&lt;/title&gt;</screen></entry>
            <entry>
              <itemizedlist>
                <listitem>
                  <para><code>title.markup</code>: <quote>Programming in Python</quote></para>
                </listitem>
                <listitem>
                  <para><code>subtitle.markup</code>: <quote/> (empty
                    string)</para>
                </listitem>
                <listitem>
                  <para><code>titleabbrev.markup</code>: <quote>Programming in Python</quote></para>
                </listitem>
              </itemizedlist>
            </entry>
          </row>
          <row>
            <entry><screen language="xml">&lt;title&gt;Programming in Python&lt;/title&gt;
&lt;subtitle&gt;With an IDE&lt;/subtitle&gt;</screen></entry>
            <entry>
              <itemizedlist>
                <listitem>
                  <para><code>title.markup</code>: <quote>Programming in Python</quote></para>
                </listitem>
                <listitem>
                  <para><code>subtitle.markup</code>: <quote>With an IDE</quote></para>
                </listitem>
                <listitem>
                  <para><code>titleabbrev.markup</code>: <quote>Programming in Python</quote></para>
                </listitem>
              </itemizedlist>
            </entry>
          </row>
          <row>
            <entry><screen language="xml">&lt;title&gt;Programming in Python&lt;/title&gt;
&lt;titleabbrev&gt;Python&lt;/titleabbrev&gt;</screen></entry>
            <entry>
              <itemizedlist>
                <listitem>
                  <para><code>title.markup</code>: <quote>Programming in Python</quote></para>
                </listitem>
                <listitem>
                  <para><code>subtitle.markup</code>: <quote/> (empty
                    string)</para>
                </listitem>
                <listitem>
                  <para><code>titleabbrev.markup</code>: <quote>Python</quote></para>
                </listitem>
              </itemizedlist>
            </entry>
          </row>
          <row>
            <entry><screen language="xml">&lt;title&gt;Programming in Python&lt;/title&gt;
&lt;subtitle&gt;With an IDE&lt;/subtitle&gt;
&lt;titleabbrev&gt;Python&lt;/titleabbrev&gt;</screen></entry>
            <entry>
              <itemizedlist>
                <listitem>
                  <para><code>title.markup</code>: <quote>Programming in Python</quote></para>
                </listitem>
                <listitem>
                  <para><code>subtitle.markup</code>: <quote>With an IDE</quote></para>
                </listitem>
                <listitem>
                  <para><code>titleabbrev.markup</code>: <quote>Python</quote></para>
                </listitem>
              </itemizedlist>
            </entry>
          </row>
        </tbody>
      </tgroup>
    </table>
    
  </section>
  <section role="seealso">
    <title>See Also</title>
    <itemizedlist>
      <listitem>
        <para><link xlink:href="http://www.sagehill.net/docbookxsl/ReplaceTemplate.html#UtilityTemplates"/></para>
      </listitem>
    </itemizedlist>
  </section>
</section>
  <!--
    License CC BY-NC-SA 3.0
  
   This work is licensed under the 
   "Namensnennung – Keine kommerzielle Nutzung – Weitergabe unter
    gleichen Bedingungen 3.0 Deutschland (CC BY-NC-SA 3.0)" 
   http://creativecommons.org/licenses/by-nc-sa/3.0/de/deed.de
   
   Read the English translation here:
   
   "Attribution-NonCommercial-ShareAlike 3.0 Unported (CC BY-NC-SA 3.0)" 
   http://creativecommons.org/licenses/by-nc-sa/3.0/
   
--><?xml-model href="../5.1/dbref.rnc" type="application/relax-ng-compact-syntax"?><section xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="dbc.common.getdoctitle" remap="topic" userlevel="easy" xml:base="common/topic.doctitle.xml">
  <title>Getting the Documentation Title</title>
  <info>
    <definitions definitionfile="defs.xml"/>
    <keywordset>
      <keyword>documentation title</keyword>
      <keyword>get.doc.title</keyword>
    </keywordset>
    <subjectset>
      <subject>
        <subjectterm>titles</subjectterm>
      </subject>
    </subjectset>
  </info>
  
  <section role="problem">
    <title>Problem</title>
    <para>You need to get the documentation title as a string.</para>
  </section>
  <section role="solution">
    <title>Solution</title>
    <para>Use the named template <function>get.doc.title</function>
      (from <filename>common/utilities.xsl</filename>):</para>
    <programlisting language="xml">&lt;xsl:template match="..."&gt;
   &lt;xsl:variable name="doctitle"&gt;
     &lt;xsl:call-template name="get.doc.title"/&gt;
   &lt;/xsl:variable&gt;
   &lt;!-- ... use the varialbe $doctitle ...--&gt;
&lt;/xsl:template&gt;</programlisting>
  </section>
  <section role="discussion">
    <title>Discussion</title>
    <para>The documentation title is the outmost title of your text.
      This can be a title from a book, glossary, set, article, or other,
      depending on what is your root element.</para>
    <para>The <function>get.doc.title</function> template returns a
      string. In most cases this is probably enough, for example, if you
      want to place them as an attribute value where markup is not
      allowed.</para>
    <para>If you need the full markup, use the methods described in
      <xref linkend="dbc.common.titles"/>.</para>
  </section>
  <section role="seealso">
    <title>See Also</title>
    <itemizedlist role="category"/>
  </section>
</section>
  <!--
    License CC BY-NC-SA 3.0
  
   This work is licensed under the 
   "Namensnennung – Keine kommerzielle Nutzung – Weitergabe unter
    gleichen Bedingungen 3.0 Deutschland (CC BY-NC-SA 3.0)" 
   http://creativecommons.org/licenses/by-nc-sa/3.0/de/deed.de
   
   Read the English translation here:
   
   "Attribution-NonCommercial-ShareAlike 3.0 Unported (CC BY-NC-SA 3.0)" 
   http://creativecommons.org/licenses/by-nc-sa/3.0/
   
--><!--<?xml-model href="file:../5.1/dbref.rnc" type="application/relax-ng-compact-syntax"?>--><section xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="dbc.common.pi" remap="topic" userlevel="easy" xml:base="common/topic.pi.xml">
  <title>Extracting Information from Your Own Processing Instructions</title>
  <info>
    <definitions definitionfile="defs.xml"/>
    <keywordset>
      <keyword>PI</keyword>
      <keyword>processing instructions</keyword>
      <keyword>pseudo-attributes</keyword>
    </keywordset>
    <subjectset>
      <subject>
        <subjectterm>pi</subjectterm>
      </subject>
    </subjectset>
  </info>
  
  <section role="problem">
    <title>Problem</title>
    <para>You need an own processing instruction (not one from the
      DocBook XSL stylesheets) to fine-tune your transformation.</para>
  </section>
  <section role="solution">
    <title>Solution</title>
    <para>The DocBook XSL stylesheet offers the
      <function>pi-attribute</function> template for this purpose. It
      expects a processing instruction node and a
      <quote>pseudo-attribute</quote> name. For example, the following
      processing instruction is given:</para>
    <programlisting>&lt;?toms-html background-color="blue"?&gt;</programlisting>
    <para>Call <function>pi-attribute</function> to extract the content
      of the pseudo-attribute <tag class="attribute">name</tag>:</para>
    <programlisting language="xml">&lt;xsl:call-template name="pi-attribute"&gt;
  &lt;xsl:with-param name="pis" select="processing-instruction('toms-html')"/&gt;
  &lt;xsl:with-param name="attribute" select="'background-color'"/&gt;
&lt;/xsl:call-template&gt;</programlisting>
    <para>This gives you the result <literal>blue</literal>.</para>    
  </section>
  <section role="discussion">
    <title>Discussion</title>
    <para>Processing instructions (PIs) are usually needed for fine-tune your
      output formats. For example, to add page break information,
      background color, or other stylistic hints. PIs should
        <emphasis>not</emphasis> be used to insert data which should
      normally reside inside a DocBook element! As a general rule of
      thumb: Use PIs if you want provide layout specific information for
      your output format if there is no other method.
    </para>
    <para>The following example use the PI <tag class="xmlpi">toms-html</tag> which is included inside an
      <tag>para</tag> element to insert background color in HTML:<footnote>
        <para>Usually, such a need would be solved through CSS and not
          PIs. However, this example shows just the principle so it is a
          perfect use case.</para>
      </footnote></para>
    <procedure>
      <step>
        <para>Invent a target name for your processing instruction. This
          name should be unique and must not conflict with existing PIs (like
            <tag class="xmlpi">dbhtml</tag>, <tag class="xmlpi">dbfo</tag>, etc.) For
          example, you could use your abbreviated name and the output format to
          distinguish it from other processing instructions.</para>
      </step>
      <step>
        <para>Insert your PI into a para which indicates a different
          background color:</para>
        <programlisting>&lt;para&gt;&lt;?toms-html background-color="blue"?&gt;
  ...
&lt;/para&gt;</programlisting>
      </step>
      <step>
        <para>Create a customization layer as shown in <xref linkend="dbc.common.dbcustomize"/>.</para>
      </step>
      <step>
        <para>Customize the <tag>para</tag> template and add the
          following code to your customization layer. The customized
          template call <function>pi-attribute</function> with the
          relevant parameters. If no PI was set, apply the original
          template:</para>
        <programlistingco>
          <areaspec>
            <area xml:id="ar.pi.variable" coords="2 32" units="linecolumn"/>
            <area xml:id="ar.pi.when" coords="9 32" units="linecolumn"/>
            <area xml:id="ar.pi.div" coords="10 45" units="linecolumn"/>
            <areaset xml:id="ar.pi.apply-imports">
              <area coords="11 32" units="linecolumn" xml:id="ar.pi.apply-imports.1"/>
              <area coords="15 32" units="linecolumn" xml:id="ar.pi.apply-imports.2"/>
            </areaset>
          </areaspec>
          <programlisting linenumbering="numbered" language="xml">&lt;xsl:template match="d:para"&gt;
  &lt;xsl:variable name="bg"&gt;
    &lt;xsl:call-template name="pi-attribute"&gt;
      &lt;xsl:with-param name="pis" select="processing-instruction('toms-html')"/&gt;
      &lt;xsl:with-param name="attribute" select="'background-color'"/&gt;
    &lt;/xsl:call-template&gt;
  &lt;/xsl:variable&gt;
  &lt;xsl:choose&gt;
    &lt;xsl:when test="$bg != ''"&gt;   
      &lt;div style="background-color:{$bg}"&gt;
        &lt;xsl:apply-imports/&gt;
      &lt;/div&gt;
    &lt;/xsl:when&gt;
    &lt;xsl:otherwise&gt;
      &lt;xsl:apply-imports/&gt;
    &lt;/xsl:otherwise&gt;
  &lt;/xsl:choose&gt;
&lt;/xsl:template&gt;</programlisting>
          <calloutlist>
            <callout arearefs="ar.pi.variable">
              <para>Fill the variable <varname>bg</varname> with the
                result of <function>pi-attribute</function>. Note, the <tag class="attribute">select</tag> only matches for PIs
                <emphasis>inside</emphasis> a <tag>para</tag>.</para>
            </callout>
            <callout arearefs="ar.pi.when">
              <para>Decide what to do when background color is found.</para>
            </callout>
            <callout arearefs="ar.pi.div">
              <para>Wrap our paragraph around <tag>div</tag> with the
                corresponding <tag class="attribute">background-color</tag> inside a <tag class="attribute">style</tag> attribute. </para>
            </callout>
            <callout arearefs="ar.pi.apply-imports">
              <para>Delegate the default handling to the original
                  <tag>para</tag> template.</para>
            </callout>
          </calloutlist>
        </programlistingco>
      </step>
      <step>
        <para>Build your document with your customization layer.</para>
      </step>
    </procedure>
    
    <para>The previous example recognizes a PI
        <emphasis>inside</emphasis> a <tag>para</tag> only. If you want
      to recognize also PIs <emphasis>before</emphasis>, use the
      following XPath in the <tag class="attribute">select</tag>
      attribute of <function>pi-attribute</function>:</para>
    <screen>( processing-instruction('toms-html') | 
  preceding-sibling::processing-instruction('toms-html')[1] 
)[last()]</screen>
    <para>If two PIs are available (one inside, another outside), the
      one which is located inside takes precedence.</para>
  </section>
  <section role="seealso">
    <title>See Also</title>
    <itemizedlist>
      <listitem>
        <para><link xlink:href="http://docbook.sourceforge.net/release/xsl/current/doc/lib/pi-attribute.html"/></para>
      </listitem>
    </itemizedlist>
  </section>
</section>
  <!--
    License CC BY-NC-SA 3.0
  
   This work is licensed under the 
   "Namensnennung – Keine kommerzielle Nutzung – Weitergabe unter
    gleichen Bedingungen 3.0 Deutschland (CC BY-NC-SA 3.0)" 
   http://creativecommons.org/licenses/by-nc-sa/3.0/de/deed.de
   
   Read the English translation here:
   
   "Attribution-NonCommercial-ShareAlike 3.0 Unported (CC BY-NC-SA 3.0)" 
   http://creativecommons.org/licenses/by-nc-sa/3.0/
   
--><!--<?xml-model href="file:../5.1/dbref.rnc" type="application/relax-ng-compact-syntax"?>--><section xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="dbc.common.xpath.location" remap="topic" userlevel="easy" xml:base="common/topic.xpath.location.xml">
  <title>Retrieving XPath</title>
  <info>
    <definitions definitionfile="defs.xml"/>
    <keywordset>
      <keyword>XPath</keyword>
      <keyword>debugging</keyword>
    </keywordset>
    <subjectset>
      <subject>
        <subjectterm>xpath</subjectterm>
      </subject>
    </subjectset>
  </info>
  
  <section role="problem">
    <title>Problem</title>
    <para>You need the path to your current node—the XPath—to output it
      as debugging information.</para>
  </section>
  <section role="solution">
    <title>Solution</title>
    <para>The DocBook XSL stylesheet offers the
        <function>xpath.location</function> template for this purpose.
      To output the current XPath, use the following procedure:</para>
    
    <procedure>
      <step>
        <para>Import the <function>xpath.location</function> template
          from the DocBook XSL stylesheets in your customization layer:</para>
        <programlisting language="xml">&lt;xsl:import href="http://docbook.sourceforge.net/release/xsl/current/lib/lib.xsl"/&gt;</programlisting>
      </step>
      <step>
        <para>Add the following code in your template:</para>
        <programlisting language="xml">&lt;xsl:message&gt;
  &lt;xsl:text&gt;Current XPath: &lt;/xsl:text&gt;
  &lt;xsl:call-template name="xpath.location"/&gt;
&lt;/xsl:message&gt;</programlisting>
      </step>
    </procedure>
    
    <para>If you need the XPath for a different node, extend the
      previous code:</para>
    <programlisting language="xml">&lt;xsl:message&gt;
  &lt;xsl:text&gt;Current XPath: &lt;/xsl:text&gt;
  &lt;xsl:call-template name="xpath.location"&gt;
    &lt;xsl:with-param name="node" select="<replaceable>YOUR_XPath_Expression</replaceable>"/&gt;
  &lt;/xsl:call-template&gt;
&lt;/xsl:message&gt;</programlisting>
  </section>
  <section role="discussion">
    <title>Discussion</title>
    <para>Currently, the template in <filename>lib/lib.xsl</filename> is
      limited: it walks from the current node up to the root node and
      outputs just the element name. No namespace prefixes, no
      predicates. If you have a DocBook document with different
      namespaces, the original version does not help.</para>
    <para>In <xref linkend="ex.xpathns.location"/>, the revised template
    recognizes namespaces and counts elements on the sibling axis.</para>
    <example xml:id="ex.xpathns.location">
      <title>Namespace-aware Output of an XPath</title>
      <info>
        <output xmlns="urn:x-toms:docbook-ext">
          <filename>xpath.location/xpath.location.v2.xsl</filename>
        </output>
      </info>
      <programlistingco>
        <areaspec>
          <area xml:id="co.xpathns.ns" coords="5 50" units="linecolumn"/>
          <area xml:id="co.xpathns.nsnodes" coords="13 75" units="linecolumn"/>
          <area xml:id="co.xpathns.method" coords="18" units="linecolumn"/>
          <area xml:id="co.xpathns.choose" coords="21" units="linecolumn"/>
          <area xml:id="co.xpathns.predicate" coords="32 80" units="linecolumn"/>
        </areaspec>
        <programlisting linenumbering="numbered" language="xml">&lt;xsl:stylesheet version="1.0"
  xmlns:n="urn:x-toms:ns:namespaces"
  xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
  exclude-result-prefixes="n"&gt;
  &lt;namespaces xmlns="urn:x-toms:ns:namespaces"&gt;
    &lt;ns prefix="d"&gt;http://docbook.org/ns/docbook&lt;/ns&gt;
    &lt;ns prefix="xi"&gt;http://www.w3.org/2001/XInclude&lt;/ns&gt;
    &lt;ns prefix="rdf"&gt;http://www.w3.org/1999/02/22-rdf-syntax-ns#&lt;/ns&gt;
    &lt;ns prefix="cc"&gt;http://creativecommons.org/ns#&lt;/ns&gt;
    &lt;ns prefix="svg"&gt;http://www.w3.org/2000/svg&lt;/ns&gt;
  &lt;/namespaces&gt;
  
  &lt;xsl:variable name="nsnodes" select="document('')//n:namespaces/n:ns"/&gt;
  
  &lt;xsl:template name="xpath.location"&gt;
    &lt;xsl:param name="node" select="."/&gt;
    &lt;xsl:param name="path" select="''"/&gt;
    &lt;xsl:param name="method"&gt;prefix&lt;/xsl:param&gt;
  
    &lt;xsl:variable name="next.path"&gt;
      &lt;xsl:choose&gt;
        &lt;xsl:when test="$method = 'prefix' and $nsnodes[namespace-uri($node)]"&gt;
          &lt;xsl:value-of select="concat($nsnodes[namespace-uri($node) = .]/@prefix, ':')"/&gt;
        &lt;/xsl:when&gt;
        &lt;xsl:when test="$method = 'clark' and namespace-uri($node) != ''"&gt;
          &lt;xsl:value-of select="concat('{', namespace-uri($node), '}')"/&gt;
        &lt;/xsl:when&gt;
      &lt;/xsl:choose&gt;  
      &lt;xsl:value-of select="local-name($node)"/&gt;      
      &lt;xsl:if test="generate-id($node) != generate-id(/*) and
                    count(../*[local-name()=local-name(current()) and
                             namespace-uri()=namespace-uri(current())]) &gt; 1"&gt;
        &lt;xsl:text&gt;[&lt;/xsl:text&gt;
        &lt;xsl:value-of select="count(preceding-sibling::*
                          [local-name()=local-name(current()) and
                           namespace-uri()=namespace-uri(current())]) + 1"/&gt;
      &lt;xsl:text&gt;]&lt;/xsl:text&gt;
    &lt;/xsl:if&gt;
      &lt;xsl:if test="$path != ''"&gt;
        &lt;xsl:text&gt;/&lt;/xsl:text&gt;
      &lt;/xsl:if&gt;
      &lt;xsl:value-of select="$path"/&gt;
    &lt;/xsl:variable&gt;
    
    &lt;xsl:choose&gt;
      &lt;xsl:when test="$node/parent::*"&gt;
        &lt;xsl:call-template name="xpath.location"&gt;
          &lt;xsl:with-param name="node" select="$node/parent::*"/&gt;
          &lt;xsl:with-param name="path" select="$next.path"/&gt;
        &lt;/xsl:call-template&gt;
      &lt;/xsl:when&gt;
      &lt;xsl:otherwise&gt;
        &lt;xsl:value-of select="concat('/', $next.path)"/&gt;
      &lt;/xsl:otherwise&gt;
    &lt;/xsl:choose&gt;
  &lt;/xsl:template&gt;
  
&lt;/xsl:stylesheet&gt;</programlisting>
      </programlistingco>
      <calloutlist>
        <callout arearefs="co.xpathns.ns">
          <para>Contains the list of namespaces and their prefixes</para>
        </callout>
        <callout arearefs="co.xpathns.nsnodes">
          <para>Create a node set of all namespace to prefix mappings</para>
        </callout>
        <callout arearefs="co.xpathns.method">
          <para>Defines the method how prefixes are displayed. You can
            choose between <quote>prefix</quote> and the Clark notation.
            The latter adds the namespace in curly brackets before the
            element name, but makes the whole XPath very verbose.
            </para>
        </callout>
        <callout arearefs="co.xpathns.choose">
          <para>Choose between the prefixed or Clark notation</para>
        </callout>
        <callout arearefs="co.xpathns.predicate">
          <para>Checks, if we are not at the root node and there is more
          than one element with the same name and the same namespace. If
          this is true, we output a predicate where the current number
          is enclosed in squared brackets.</para>
        </callout>
      </calloutlist>
    </example>
 
    <para>The template can output the XPath in two different notations:</para>
    <variablelist>
      <varlistentry>
        <term>Prefix (<literal>method="prefix"</literal>, default)</term>
        <listitem>
          <para>Namespace nodes are abbreviated with a prefix. The
            prefix is definied in the <tag>namespaces</tag> element. A
            XPath to the first chapter inside a book looks like this:</para>
          <screen>/d:book/d:chapter[1]</screen>
        </listitem>
      </varlistentry>
      <varlistentry>
        <term>Clark (<literal>method="clark"</literal>)</term>
        <listitem>
          <para>Namespace nodes are printed with the full namespace
            URL. The namespace URL is definied in the
              <tag>namespaces</tag> element. A XPath to the first
            chapter inside a book looks like this:</para>
          <screen>/{http://docbook.org/ns/docbook}book/{http://docbook.org/ns/docbook}chapter[1]</screen>
          <note>
            <title>Use Clark Notation For Debugging Purposes Only</title>
            <para>The above notation is called the <emphasis>Clark
            notation</emphasis>, after <personname>
              <firstname>James</firstname>
              <surname>Clark</surname>
            </personname>, the editor of the XSLT 1.0 and XPath 1.0
            specifications.
            However, this notation cannot be used in XSLT as it is not
            officially supported. Only use the prefixed version in this
            case. The Clark notation is just useful for debugging
            purposes when you want or need the full namespace URLs.</para>
          </note>
        </listitem>
      </varlistentry>
    </variablelist>
    <para>Be aware, the previous template is slower than the original
      version (it has to count a little bit more). For debugging purpose
      it is probably fine.
    </para>
  </section>
  <section role="seealso">
    <title>See Also</title>
    <itemizedlist>
      <listitem>
        <para><link xlink:href="http://docbook.sourceforge.net/release/xsl/current/doc/lib/xpath.location.html"/></para>
      </listitem>
      <listitem>
        <para>A recursive solution, considering also attribute, text,
          and processing instruction nodes: <link xlink:href="http://www.dpawson.co.uk/xsl/sect2/xpath.html#d11572e154"/></para>
      </listitem>
    </itemizedlist>
  </section>
</section>
  <!--
    License CC BY-NC-SA 3.0
  
   This work is licensed under the 
   "Namensnennung – Keine kommerzielle Nutzung – Weitergabe unter
    gleichen Bedingungen 3.0 Deutschland (CC BY-NC-SA 3.0)" 
   http://creativecommons.org/licenses/by-nc-sa/3.0/de/deed.de
   
   Read the English translation here:
   
   "Attribution-NonCommercial-ShareAlike 3.0 Unported (CC BY-NC-SA 3.0)" 
   http://creativecommons.org/licenses/by-nc-sa/3.0/
   
--><!--<?xml-model href="file:../5.1/dbref.rnc" type="application/relax-ng-compact-syntax"?>--><section xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="dbc.common.l10n" remap="topic" userlevel="easy" xml:base="common/topic.l10n.xml">
  <title>Extending Language Files with Your Own Text</title>
  <info>
    <definitions definitionfile="defs.xml"/>
    <keywordset>
      <keyword>l10n</keyword>
      <keyword>translation</keyword>
      <keyword>language files</keyword>
      <keyword>local.l10n.xml</keyword>
      <keyword>context</keyword>
      <keyword>gentext</keyword>
      <keyword>http://docbook.sourceforge.net/xmlns/l10n/1.0</keyword>
    </keywordset>
    <subjectset>
      <subject>
        <subjectterm>l10n</subjectterm>
        <subjectterm>languages</subjectterm>
      </subject>
    </subjectset>
  </info>
  
  <section role="problem">
    <title>Problem</title>
    <para>You need a general solution to add localized text without
      hard-coding it into your stylesheet. Depending on the language, it
      should display the correct, translated text.</para>
  </section>
  <section role="solution">
    <title>Solution</title>
    <para>Use <emphasis>language files</emphasis> to add your text.
      Language files are the DocBook way to support several languages,
      all located under the <filename class="directory">common</filename> directory. Each file is in XML format and
      contains all your translated text as a key/value pair. For more
      complex settings and to group things, there are
        <emphasis>contexts</emphasis>. The key is never translated, it
      a constant and is only needed to find and retrieve the translated text. </para>
    <para>To use a language file, proceed as follows:</para>
    <procedure>
      <title>Adding Your Own Localized Text</title>
      <step>
        <para>Create a customization layer first as shown in <xref linkend="dbc.common.dbcustomize"/>.</para>
      </step>
      <step>
        <para>Add the parameter <parameter>local.l10n.xml</parameter> in
          your customization layer and point it to your language
          file (in this case, it is named
          <filename>myl10n.xml</filename>, but you can use any name you
          like):</para>        
        <screen>&lt;xsl:param name="local.l10n.xml" select="document('myl10n.xml')"/&gt;</screen>
      </step>
      <step>
        <para>Open the <filename>myl10n.xml</filename> file and insert
        the following XML code as an example:</para>
        <informalexample>
          <info>
            <output xmlns="urn:x-toms:docbook-ext">
              <filename>l10n.xml</filename>
            </output>
          </info>
        <programlisting linenumbering="numbered" language="xml">&lt;l:i18n xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0"&gt; 
  &lt;l:l10n language="en" english-language-name="English"&gt;
    &lt;l:gentext key="Authors" text="Authors"/&gt;
    &lt;l:gentext key="lastbuilt" text="Last built: "/&gt;
  &lt;/l:l10n&gt;
  &lt;l:l10n language="de" english-language-name="German"&gt;
    &lt;l:gentext key="Authors" text="Authoren"/&gt;
    &lt;l:gentext key="lastbuilt" text="Zuletzt gebaut: "/&gt;
  &lt;/l:l10n&gt;
&lt;/l:i18n&gt;</programlisting>
        </informalexample>
        <para>The above code shows two language, English and German
          (marked in the <tag class="attribute">language</tag>
          attribute).
          Furthermore, it contains two text entries for each language
            (<quote>Authors</quote> and <quote>lastbuilt</quote>).</para>    
      </step>
      <step>
        <para>Call <function>gentext</function> in your template to retrieve
        the translated text:</para>
        <programlisting language="xml">&lt;xsl:call-template name="gentext"&gt;
  &lt;xsl:with-param name="key" select="'Authors'"/&gt;
&lt;/xsl:call-template&gt;</programlisting>
      </step>
    </procedure>
  </section>
  <section role="discussion">
    <title>Discussion</title>
    <para>The <quote>gentext</quote> method to insert language specific
      text is quite powerful, but not almighty. It helps you to keep
      translateable text in one place and avoids hard-coded locations in
      your stylesheets. If you need the translated text not for the
      default language (usually marked in the root element), but for a
      different language, use the <tag>xsl:with-param</tag> as
      shown:</para>
    <programlisting language="xml">&lt;xsl:call-template name="gentext"&gt;
  &lt;xsl:with-param name="key" select="'Authors'"/&gt;
  &lt;xsl:with-param name="lang"&gt;de&lt;/xsl:with-param&gt;
&lt;/xsl:call-template&gt;</programlisting>
  </section>
  <section role="seealso">
    <title>See Also</title>
    <para><link xlink:href="http://www.sagehill.net/docbookxsl/Localizations.html"/></para>
  </section>
</section>
  <!--
    License CC BY-NC-SA 3.0
  
   This work is licensed under the 
   "Namensnennung – Keine kommerzielle Nutzung – Weitergabe unter
    gleichen Bedingungen 3.0 Deutschland (CC BY-NC-SA 3.0)" 
   http://creativecommons.org/licenses/by-nc-sa/3.0/de/deed.de
   
   Read the English translation here:
   
   "Attribution-NonCommercial-ShareAlike 3.0 Unported (CC BY-NC-SA 3.0)" 
   http://creativecommons.org/licenses/by-nc-sa/3.0/
   
--><!--<?xml-model href="file:../5.1/dbref.rnc" type="application/relax-ng-compact-syntax"?>--><section xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="dbc.common.get-lang" remap="topic" userlevel="easy" version="5.1" xml:base="common/topic.get-lang.xml">
  <title>Extracting Language Information</title>
  <info>
    <definitions definitionfile="defs.xml"/>
    <keywordset>
      <keyword>language</keyword>
      <keyword>l10n.language</keyword>
    </keywordset>
    <subjectset>
      <subject>
        <subjectterm>languages</subjectterm>
        <subjectterm>l10n</subjectterm>
      </subject>
    </subjectset>
  </info>
  
  <section role="problem">
    <title>Problem</title>
    <para>You need the language of the current element or of your DocBook document.</para>
  </section>
  <section role="solution">
    <title>Solution</title>
    <para>Use the <function>l10n.language</function> template from
      <filename>common/l10n.xsl</filename>. It extracts the language attribute 
      from the current context node or its ancestors:</para>
    <programlisting language="xml">&lt;xsl:variable name="language"&gt;
   &lt;xsl:call-template name="l10n.language"/&gt;
&lt;/xsl:variable&gt;</programlisting>
    <para>It returns a <quote>normalized</quote> string which is
      RFC1766 compliant.
    </para>
    <para>If you need to change the current node, use the
      <parameter>target</parameter> parameter. For example, the
      following code extracts the language from the root element:</para>
    <programlisting language="xml">&lt;xsl:variable name="lang"&gt;
   &lt;xsl:call-template name="l10n.language"&gt;
      &lt;xsl:with-param name="target" select="/*"/&gt;
   &lt;/xsl:call-template&gt;
&lt;/xsl:variable&gt;</programlisting>
  </section>
  <section role="discussion">
    <title>Discussion</title>
    <para>Language information is stored in DocBook either in the <tag class="attribute">lang</tag> (4.x) or <tag class="attribute">xml:lang</tag> (&gt;5.x) attributes. These attributes can be set on every
      DocBook element.</para>
    <para>For example, if you have a chapter inside a book and want to
      extract the contents of the language attribute from this chapter,
      the following XPath expression gives you this information:</para>
    <screen><!--
-->/book/chapter/@lang             <lineannotation>DocBook 4.x</lineannotation>
/db:book/db:chapter/@xml:lang   <lineannotation>DocBook 5.x</lineannotation></screen>
    <para>Although the XPath expressions are simple, they have some drawbacks:</para>
    <itemizedlist>
      <listitem>
        <para>If no language attribute is set, no content can be
          retrieved. The used language is undefined.</para>
      </listitem>
      <listitem>
        <para>There is no default language when a language is not set.</para>
      </listitem>
      <listitem>
        <para>Language information can be written inconsistently, for
          example, <literal>en</literal> or <literal>EN</literal>.</para>
      </listitem>
      <listitem>
        <para>The above expressions do not take into account the current
          context node. For example, the language in a <tag>foreignphrase</tag>
          element is usually different than a chapter or other parts of the
          document. </para>
      </listitem>
      <listitem>
        <para>There are no checks for RFC compliance.</para>
      </listitem>
    </itemizedlist>
    <para>All the previous problems are considered by the
        <function>l10n.language</function> template. It searches for the
      nearest anchestor who contains a language attribute and returns
      its content. For example, consider the following structure:</para>
    <screen>book xml:lang="en"
  chapter
    section
      para
        foreignphrase xml:lang="de"</screen>
    <para>If your current context is on the <tag>foreignphrase</tag>
      element, <function>l10n.language</function> will return
        <literal>de</literal> as language. However, if your context is
      on the <tag>para</tag> element, you will get
      <literal>en</literal>. The <tag>para</tag>, <tag>section</tag>,
      and <tag>chapter</tag> elements are children of <tag>book</tag>
      and therefore in the scope of the language attribute which gives
      you <literal>en</literal>.
      In the case no language is given, the template returns a
      default language from the
      <parameter>l10n.gentext.default.language</parameter> parameter (usually
      English).</para>    
    <para>Sometimes, returning only the language is not enough. The
      following table gives you some additional functions from <filename>common/l10n.xsl</filename>
      which can be useful for your code (Question marks(?) denote an
      optional parameter):</para>
    <table xml:id="tab.common.get-lang.overview">
      <title>Extracting Language Information</title>
      <tgroup cols="2">
        <colspec colname="c1"/>
        <colspec colname="c2"/>
        <thead>
          <row>
            <entry>Template</entry>
            <entry>Description</entry>
          </row>
        </thead>
        <tbody>
          <row>
            <entry><!--<funcsynopsis>
              <funcprototype>
                <funcdef>ATTRNODE <function>language.attribute</function></funcdef>
                <paramdef> <parameter>node</parameter></paramdef>
              </funcprototype>
            </funcsynopsis>-->
            <synopsis>attrnode = <function>language.attribute</function>(node="."?)</synopsis>
            </entry>
            <entry>Useful for HTML. Returns an attribute node <tag class="attribute">lang</tag> with the extracted language
              from the current node or one of its ancestors</entry>
          </row>
          <row>
            <entry><synopsis>attrnode = <function>xml.language.attribute</function>(node="."?)</synopsis>
            </entry>
            <entry>Useful for XHTML. Returns an attribute node <tag class="attribute">xml:lang</tag> with the extracted language
              from the current node or one of its ancestors</entry>
          </row>
          <row>
            <entry><synopsis>string = <function>l10n.language.name</function>(lang?)</synopsis></entry>
            <entry>Returns the English language name</entry>
          </row>
        </tbody>
      </tgroup>
    </table>
    <para/>
  </section>
  <section role="seealso">
    <title>See Also</title>
    <itemizedlist>
      <listitem>
        <para><link xlink:href="http://www.ietf.org/rfc/rfc1766.txt"/></para>
      </listitem>
      <listitem>
        <para><link xlink:href="http://docbook.sourceforge.net/release/xsl/current/doc/html/l10n.gentext.default.language.html"/></para>
      </listitem>
      <listitem>
        <para><link xlink:href="http://docbook.sourceforge.net/release/xsl/current/doc/html/l10n.lang.value.rfc.compliant.html"/></para>
      </listitem>
    </itemizedlist>
  </section>
</section>
  <!--
    License CC BY-NC-SA 3.0
  
   This work is licensed under the 
   "Namensnennung – Keine kommerzielle Nutzung – Weitergabe unter
    gleichen Bedingungen 3.0 Deutschland (CC BY-NC-SA 3.0)" 
   http://creativecommons.org/licenses/by-nc-sa/3.0/de/deed.de
   
   Read the English translation here:
   
   "Attribution-NonCommercial-ShareAlike 3.0 Unported (CC BY-NC-SA 3.0)" 
   http://creativecommons.org/licenses/by-nc-sa/3.0/
   
--><!--<?xml-model href="file:../5.1/dbref.rnc" type="application/relax-ng-compact-syntax"?>--><section xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="dbc.common.get-personname" remap="topic" userlevel="easy" xml:base="common/topic.get-personname.xml">
  <title>Extracting and Formatting Person and Author Information</title>
  <info>
    <definitions definitionfile="defs.xml"/>
    <keywordset>
      <keyword>author</keyword>
      <keyword>authorgroup</keyword>
      <keyword>personname</keyword>
      <keyword>person.name</keyword>
    </keywordset>
  </info>
  
  <section role="problem">
    <title>Problem</title>
    <para>You need to format an author, a group of authors, or any other
      name of persons.</para>
  </section>
  <section role="solution">
    <title>Solution</title>
    <para>The DocBook stylesheets provide the template
      <function>person.name</function> for a single name or
      <function>person.name.list</function> for a group of names. For example, 
      consider the following <tag>info</tag> element:</para>
    <programlisting language="xml">&lt;info&gt;
  &lt;author&gt;
    &lt;personname&gt;
      &lt;firstname&gt;Tux&lt;/firstname&gt;
      &lt;surname&gt;Penguin&lt;/surname&gt;
    &lt;/personname&gt;
  &lt;/author&gt;
&lt;/info&gt;</programlisting>
    <para>To retrieve the author name, use the following code in your
      template:</para>
    <programlisting language="xml">&lt;xsl:call-template name="person.name"&gt;
  &lt;xsl:with-param name="node" select="$theauthor"/&gt;
&lt;/xsl:call-template&gt;</programlisting>
    <para>whereas the variable <varname>theauthor</varname> points to
      the author node. The previous template returns the expected
      string:</para>
    <programlisting>Tux Penguin</programlisting>
    <para>For a group of names it is similar, just replace
        <function>person.name</function> with
        <function>person.name.list</function>. </para>
    
  </section>
  <section role="discussion">
    <title>Discussion</title>
    <para>At a first glance, names seems pretty easy to format.
      However, it is a little bit more complicated. For example, the title 
      of a person, its lineage, or middle names can makes
      it sometimes harder to extract all the information. The following 
      author contains a title and a lineage:</para>
    <programlisting language="xml">&lt;author&gt;
  &lt;personname&gt;
    &lt;honorific&gt;Dr.&lt;/honorific&gt;
    &lt;firstname&gt;Tux&lt;/firstname&gt;
    &lt;othername&gt;Tuxy&lt;/othername&gt;
    &lt;surname&gt;Penguin&lt;/surname&gt;
    &lt;lineage&gt;Jr.&lt;/lineage&gt;
  &lt;/personname&gt;
&lt;/author&gt;</programlisting>
    <para>Depending on what you need, the DocBook stylesheets can format
    the name with different </para>
    <table xml:id="tab.get-personname">
      <title>Overview of Available Templates</title>
      <tgroup cols="2">
        <thead>
          <row>
            <entry>Template</entry>
            <entry>Result</entry>
          </row>
        </thead>
        <tbody>
          <row>
            <entry><function>person.name</function></entry>
            <entry><screen>Dr. Tux Tuxy Penguin, Jr</screen></entry>
          </row>
          <row>
            <entry><function>person.name.last-first</function></entry>
            <entry><screen>Penguin, Tux</screen></entry>
          </row>
          <row>
            <entry><function>person.name.family-given</function></entry>
            <entry><screen>Penguin Tux [FAMILY Given]</screen></entry>
          </row>
        </tbody>
      </tgroup>
    </table>
    
    <para>Keep in mind, the current implementation only takes into
      account the first occurance of <tag>honorific</tag> or
      <tag>lineage</tag>.</para>
    
  </section>
</section>
  <!--
    License CC BY-NC-SA 3.0
  
   This work is licensed under the 
   "Namensnennung – Keine kommerzielle Nutzung – Weitergabe unter
    gleichen Bedingungen 3.0 Deutschland (CC BY-NC-SA 3.0)" 
   http://creativecommons.org/licenses/by-nc-sa/3.0/de/deed.de
   
   Read the English translation here:
   
   "Attribution-NonCommercial-ShareAlike 3.0 Unported (CC BY-NC-SA 3.0)" 
   http://creativecommons.org/licenses/by-nc-sa/3.0/
   
--><!--<?xml-model href="file:../5.1/dbref.rnc" type="application/relax-ng-compact-syntax"?>--><section xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="dbc.common.splitheader.modes" remap="topic" xml:base="common/topic.splitheader-into-numbers-and-titles.xml">
  <title>Splitting Header Into Label and Title With Modes</title>
  <info>
    <definitions definitionfile="defs.xml"/>
    <keywordset>
      <keyword>title</keyword>
      <keyword>label</keyword>
      <keyword>numbers</keyword>
    </keywordset>
    <subjectset>
      <subject>
        <subjectterm>title</subjectterm>
      </subject>
    </subjectset>
  </info>
  
  <section role="problem">
    <title>Problem</title>
    <para>Your header contains a consecutive number and a title. As you
      want to style them differently, you need to split them in this two
      pieces.</para>
  </section>
  <section role="solution">
    <title>Solution</title>
    <para>The DocBook stylesheets have two modes which are
      <quote>responsible</quote> for generating the labels and titles:
      the modes <varname>label.markup</varname> and
      <varname>title.markup</varname>.</para>
    
    <para>To <quote>split</quote> the header, you need to introduce an
      inline element for styling. For HTML this is <tag>span</tag> with
        <tag class="attribute">class</tag> attribute, for XSL-FO it is
        <tag>fo:inline</tag>. The principle is the same, but this topic
      shows only HTML for better readability. </para>
    <para>Customize the <varname>label.markup</varname> and
        <varname>title.markup</varname> templates for the specific
      DocBook element. To simplify the maintenance and customization,
      use the XSLT <tag class="emptytag">xsl:apply-imports</tag> tag.
      This allows you to call the original template without repeating it
      and to introduce your changes. Save the result from <tag class="emptytag">xsl:apply-imports</tag> in a variable and and
      output it only, if the variable is not empty. The following
      template shows this approach for a chapter label:</para>
    
    <programlisting language="xml"><![CDATA[<xsl:template match="d:chapter" mode="label.markup">
  <xsl:variable name="number">
    <xsl:apply-imports/>
  </xsl:variable>
   
  <xsl:if test="string($number) != ''">
    <span class="number"><xsl:value-of select="$number"/></span>
  </xsl:if>
</xsl:template>]]></programlisting>
    
    <para>For a chapter title the template is even simpler:</para>
    <programlisting language="xml"><![CDATA[<xsl:template match="d:chapter" mode="title.markup">
  <span class="title">
    <xsl:apply-imports/>
  </span>
</xsl:template>]]></programlisting>
    
    <para>Add the same changes for all elements that you need a
      different styling. After you have included this changes in your
      customization layer, a chapter title in HTML is shown as follows:</para>
    <programlisting language="html">&lt;h2 class="title"&gt;&lt;a id="id275730"&gt;&lt;/a&gt;Chapter
  &lt;span class="number"&gt;1&lt;/span&gt;. &lt;span class="title"&gt;...&lt;/span&gt;
&lt;/h2&gt;</programlisting>
    
    <para>To style the number in bold and the title in a normal weight,
      use the following CSS rule:</para>
    <programlisting language="css">h2.title &gt; .number {
  font-weight: bold;
}
h2.title &gt; .title {
  font-weight: normal;
}</programlisting>
    
    <para>Of course, you can apply all CSS rules you want.</para>
    
    <!-- ************** -->
    <!--
      <para>The DocBook stylesheets distinguish between a division,
      component, section, and formal titles. Each is styled by a
      different template (see <xref linkend="tab.common.splitheader"/>).</para>
     
    <table xml:id="tab.common.splitheader">
      <title>Division, Component, Section, and Formal Titles and Their
        Templates</title>
      <tgroup cols="3">
        <thead>
          <row>
            <entry>Elements</entry>
            <entry>Template</entry>
            <entry>XSLT File</entry>
          </row>
        </thead>
        <tbody>
          <row>
            <entry><tag>book</tag>, <tag>part</tag>,
              <tag>set</tag></entry>
            <entry><function>division.title</function></entry>
            <entry><filename>division.xsl</filename></entry>
          </row>
          <row>
            <entry><tag>appendix</tag>,
            <tag>article</tag>,
            <tag>bibliography</tag>,
            <tag>colophon</tag>,
            <tag>dedication</tag>, 
            <tag>glossary</tag>,   
            <tag>index</tag>, 
            and <tag>preface</tag></entry>
            <entry><function>component.title</function></entry>
            <entry><filename>component.xsl</filename></entry>
          </row>
          <row>
            <entry><tag>sect<replaceable>X</replaceable></tag>,
                <tag>section</tag>, <tag>simplesect</tag></entry>
            <entry><function>section.title</function>,
                <function>section.heading</function></entry>
            <entry><filename>sections.xsl</filename></entry>
          </row>
          <row>
            <entry><tag>equation</tag>, <tag>example</tag>,
                <tag>figure</tag>, <tag>procedure</tag>,
                <tag>table</tag></entry>
            <entry><function>formal.object.heading</function></entry>
            <entry><filename>formal.xsl</filename></entry>
          </row>
        </tbody>
      </tgroup>
    </table>
    -->
  </section>
  <section role="discussion">
    <title>Discussion</title>
    <para>Although the customization has some benefits (simple, easy to
      maintain, support the language files), you should be aware of some
      issues.</para>
    <para>The <varname>label.markup</varname> and
        <varname>title.markup</varname> modes are very basic modes; as
      such, they are used in other templates as well, not only for
      titles. This can lead to side effects, which you may or may not
      want. For example, the modes are used also for the table of
      content and for resolving cross references.</para>
    <para>To deal with this situation is two-fold:</para>
    <itemizedlist>
      <listitem>
        <para>Leave it as it is and customize it at the CSS level.</para>
      </listitem>
      <listitem>
        <para>Only </para>
      </listitem>
    </itemizedlist>
    
    <section xml:id="sec.common.splitheader.modes.xref">
      <title>Protecting Cross References</title>
      <para> To prevent the splitting in cross references, customize the
          <varname>insert.title.markup</varname> and
          <varname>insert.label.markup</varname>modes as follows:</para>
      <programlisting language="xml"><![CDATA[<xsl:template match="*" mode="insert.label.markup">
  <xsl:param name="purpose"/>
  <xsl:param name="xrefstyle"/>
  <xsl:param name="label"/>
    
  <xsl:value-of select="$label"/>
</xsl:template>
      
<xsl:template match="d:chapter" mode="insert.title.markup">
  <xsl:param name="purpose"/>
  <xsl:param name="xrefstyle"/>
  <xsl:param name="title"/>

  <xsl:choose>
    <xsl:when test="$purpose = 'xref'">
      <em><xsl:copy-of select="$title"/></em>
    </xsl:when>
    <xsl:otherwise>
      <xsl:value-of select="$title"/>
    </xsl:otherwise>
  </xsl:choose>
</xsl:template>]]></programlisting>
      <para>The difference between the original and the above
        customization is the <tag>xsl:copy-of</tag> tag. In the above
        customization it is replaced by <tag>xsl:value-of</tag>. This
        small change ensure only the string value is copied, not any
        elements.</para>
    </section>
    <section xml:id="sec.common.splitheader.modes.toc">
      <title>Protecting the Table of Contents</title>
      <para>To avoid the same structure in table of contents, customize
        the <function>toc.line</function> template as follows:</para>
      <programlistingco>
        <areaspec units="linecolumn">
          <area xml:id="co.splitheader.modes.toc.title" coords="5 32" linkends="ca.splitheader.modes.toc.title"/>          
          <areaset xml:id="co.splitheader.modes.toc.value-of.label" linkends="ca.splitheader.modes.toc.value-of.label">
            <area coords="14 40"/>
            <area coords="33"/>
          </areaset>
          <area xml:id="co.splitheader.modes.toc.value-of.title" coords="38" linkends="ca.splitheader.modes.toc.value-of.title"/>
        </areaspec>        
      <programlisting language="xml"><![CDATA[<xsl:template name="toc.line">
  <xsl:param name="toc-context" select="."/>
  <xsl:param name="depth" select="1"/>
  <xsl:param name="depth.from.context" select="8"/>
  <xsl:variable name="title"> 
    <xsl:apply-templates select="." mode="titleabbrev.markup"/>
  </xsl:variable>

  <span class="{local-name(.)}">
    <xsl:if test="$autotoc.label.in.hyperlink = 0">
      <xsl:variable name="label">
        <xsl:apply-templates select="." mode="label.markup"/>
      </xsl:variable>
      <xsl:value-of select="$label"/>
      <xsl:if test="$label != ''">
        <xsl:value-of select="$autotoc.label.separator"/>
      </xsl:if>
    </xsl:if>

    <a>
      <xsl:attribute name="href">
        <xsl:call-template name="href.target">
          <xsl:with-param name="context" select="$toc-context"/>
          <xsl:with-param name="toc-context" select="$toc-context"/>
        </xsl:call-template>
      </xsl:attribute>
      <!-- * if $autotoc.label.in.hyperlink is non-zero, then output the label -->
      <!-- * as part of the hyperlinked title -->
      <xsl:if test="not($autotoc.label.in.hyperlink = 0)">
        <xsl:variable name="label">
          <xsl:apply-templates select="." mode="label.markup"/>
        </xsl:variable>
        <xsl:value-of select="$label"/>
        <xsl:if test="$label != ''">
          <xsl:value-of select="$autotoc.label.separator"/>
        </xsl:if>
      </xsl:if>
      <xsl:value-of select="$title"/>
    </a>
  </span>
</xsl:template>]]></programlisting>
        <calloutlist>
          <callout arearefs="co.splitheader.modes.toc.title" xml:id="ca.splitheader.modes.toc.title">
            <para>Saves the output from <tag class="emptytag">xsl:apply-templates</tag>
              in the variable <varname>title</varname> to use it later</para>
          </callout>
          <callout arearefs="co.splitheader.modes.toc.value-of.label" xml:id="ca.splitheader.modes.toc.value-of.label">
            <para>Use <tag class="emptytag">xsl:value-of</tag> to get
              the string from the <varname>label</varname> variable</para>
          </callout>
          <callout arearefs="co.splitheader.modes.toc.value-of.title" xml:id="ca.splitheader.modes.toc.value-of.title">
            <para>Insert the string content of variable <varname>title</varname></para>
          </callout>
        </calloutlist>
      </programlistingco>
      
    </section>
  </section>
  <section role="seealso">
    <title>See Also</title>
    <para>.</para>
  </section>
</section>
  <!--
    License CC BY-NC-SA 3.0
  
   This work is licensed under the 
   "Namensnennung – Keine kommerzielle Nutzung – Weitergabe unter
    gleichen Bedingungen 3.0 Deutschland (CC BY-NC-SA 3.0)" 
   http://creativecommons.org/licenses/by-nc-sa/3.0/de/deed.de
   
   Read the English translation here:
   
   "Attribution-NonCommercial-ShareAlike 3.0 Unported (CC BY-NC-SA 3.0)" 
   http://creativecommons.org/licenses/by-nc-sa/3.0/
   
--><!--<?xml-model href="file:../5.1/dbref.rnc" type="application/relax-ng-compact-syntax"?>--><section xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="dbc.common.enum-figures" remap="topic" userlevel="easy" xml:base="common/topic.enumerate-figures.xml">
  <title>Numbering Figures and the Like Consistently Through your Document</title>
  <info>
    <keywordset>
      <keyword>numbering</keyword>
      <keyword>figures</keyword>
    </keywordset>
  </info>
  
  <section role="problem">
    <title>Problem</title>
    <para>You want to enumerate your figures, tables, programlisting or
      examples consistently through your document.</para>
  </section>
  <section role="solution">
    <title>Solution</title>
    <para>Use a customization layer and insert the following template in
      your customization layer:</para>
    <example xml:id="ex.common.enumerate">
      <title>Template to Number Figures Consistently</title>
      <programlisting language="xml">&lt;xsl:template match="d:figure" mode="label.markup"&gt; <co xml:id="co.common.enumerate.match"/>
    &lt;xsl:choose&gt;
      &lt;xsl:when test="@label"&gt; <co xml:id="co.common.enumerate.when"/>
        &lt;xsl:value-of select="@label"/&gt;
      &lt;/xsl:when&gt;
      &lt;xsl:otherwise&gt;
        &lt;xsl:number format="1" from="d:book|d:article" level="any"/&gt; <co xml:id="co.common.enumerate.number"/>
      &lt;/xsl:otherwise&gt;
    &lt;/xsl:choose&gt;
&lt;/xsl:template&gt;</programlisting>
      <calloutlist>
        <callout arearefs="co.common.enumerate.match">
          <para>Matches for <tag>figure</tag> elements in
            <literal>label.markup</literal> mode (a special mode for
            getting or calculating numbers).</para>
        </callout>
        <callout arearefs="co.common.enumerate.when">
          <para>If the figure contains a <tag class="attribute">label</tag> attribute, it will be used.
            This gives you the possibility to overwrite the displayed
            label.</para>
        </callout>
        <callout arearefs="co.common.enumerate.number">
          <para>Calculates the number of the current <tag>figure</tag>
            element, starting on a book or article level.</para>
        </callout>
      </calloutlist>
    </example>
  </section>
  <section role="discussion">
    <title>Discussion</title>
    <para>The template shown in <xref linkend="ex.common.enumerate" xrefstyle="select:label"/> matches only <tag>figure</tag>s. It
      can be extended to match also <tag>procedure</tag>s,
        <tag>tables</tag>, <tag>examples</tag> etc. If you do not need
      the support for the <tag class="attribute">label</tag> attribute,
      remove the <tag>xsl:choose</tag> and its children, but leave the
        <tag>xsl:number</tag> element.</para>
    <para>If you need a different numbering schema, modify the
      <tag class="attribute">format</tag> attribute in the
      <tag>xsl:number</tag> start-tag. For example, if you write
      <literal>[a]</literal> you will get consecutive numerals in
      brackets like  <literal>[a]</literal>, <literal>[b]</literal>,
      <literal>[c]</literal> etc.</para>
  </section>
  <!--<section role="seealso">
    <title>See Also</title>
    <para>Include URL or bibliographic references.</para>
  </section>-->
</section>
  <!--
    License CC BY-NC-SA 3.0
  
   This work is licensed under the 
   "Namensnennung – Keine kommerzielle Nutzung – Weitergabe unter
    gleichen Bedingungen 3.0 Deutschland (CC BY-NC-SA 3.0)" 
   http://creativecommons.org/licenses/by-nc-sa/3.0/de/deed.de
   
   Read the English translation here:
   
   "Attribution-NonCommercial-ShareAlike 3.0 Unported (CC BY-NC-SA 3.0)" 
   http://creativecommons.org/licenses/by-nc-sa/3.0/
   
--><!--<?xml-model href="file:../5.1/dbref.rnc" type="application/relax-ng-compact-syntax"?>--><section xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="dbc.common.case" remap="topic" userlevel="easy" xml:base="common/topic.case.xml">
  <title>Converting Lowercase to Uppercase or Vice Versa</title>
  <info>
    <definitions definitionfile="defs.xml"/>
    <keywordset>
      <keyword>lowercase</keyword>
      <keyword>uppercase</keyword>
    </keywordset>
  </info>
  
  <section role="problem">
    <title>Problem</title>
    <para>You need to convert a text string from lowercase or uppercase,
      respectively, taking care of the current locale.</para>
  </section>
  <section role="solution">
    <title>Solution</title>
    <para>Use the utility template <function>string.lower</function> or
        <function>string.upper</function> from the DocBook
      stylesheets:</para>
    <programlisting language="xml">&lt;xsl:call-template name="string.upper"&gt;
   &lt;xsl:with-param name="string"&gt;This is your string&lt;/xsl:with-param&gt;
&lt;/xsl:call-template&gt;</programlisting>
    <para>Or:</para>
    <programlisting language="xml">&lt;xsl:call-template name="string.lower"&gt;
   &lt;xsl:with-param name="string"&gt;This is your string&lt;/xsl:with-param&gt;
&lt;/xsl:call-template&gt;</programlisting>
  </section>
  <section role="discussion">
    <title>Discussion</title>
    <para>To transform a string into uppercase letters, XPath offers the
        <function>translate</function> function. The
        <function>translate</function> function expects three
      parameters: the string you want to change, a string of lowercase
      letters, and a string of uppercase letters. Your code looks like
      this: </para>
    <programlisting language="xml">&lt;xsl:value-of select="translate($string, 'abcdefghijklmnopqrstuvwxyz', 'ABCDEFGHIJKLMNOPQRSTUVWXYZ')"/&gt;</programlisting>
    <para>When called by the XSLT processor, the content of the
        <varname>string</varname> variable is transformed into
      uppercase. This works pretty well if your language is English or
      your string does not contain any accented characters. However, if
      your string contains, for example, the German lowercase letter
        <quote>ö</quote>, <function>translate</function> does not
      transform it into the uppercase letter <quote>Ö</quote>. </para>
    <para>This solves the above templates
        <function>string.lower</function> and
        <function>string.upper</function>. They use the language files
      of the DocBook stylesheets and get the lowercase and uppercase
      letters from a so called <quote>gentext templates</quote>. The
        <property>uppercase.alpha</property> and
        <property>lowercase.alpha</property> entries are used in the
      current locale.</para>
    <para>However, this transformation is not always perfect. For
      example, it is recommend to transform the German sharp
        <quote>ß</quote> (lowercase) into <quote>SS</quote> 
      (uppercase).<footnote>
        <para>Since 2008, Unicode contains the capital sharp ß (see
            <link xlink:href="http://en.wikipedia.org/wiki/Capital_%E1%BA%9E"/> which is located at position U+1E9E. Most fonts contain
          this glyphs now, but not all. You should carefully investigate
          your fonts before you change anything. For a German keyboard
          layout under X11, press <keycombo>
            <keycap>Caps Lock</keycap>
            <keycap>ß</keycap>
          </keycombo> to display the capital sharp ß which is printed as
            <quote>ẞ</quote>.</para>
      </footnote> This makes the <function>translate</function> function
      unusable for such corner cases. Only XPath 2.0 support
      local-sensitive mappings with <function xlink:href="http://www.w3.org/TR/xpath-functions/#func-upper-case">fn:upper-case</function>.</para>
  </section>
  <section role="seealso">
    <title>See Also</title>
    <itemizedlist>
      <listitem>
        <para><filename>common/common.xsl</filename></para>
      </listitem>
      <listitem>
        <para>XPath 1.0 <function xlink:href="http://www.w3.org/TR/xpath/#function-translate">translate(string, fromString, toString)</function> function</para>
      </listitem>
    </itemizedlist>
  </section>
</section>
  <!--
    License CC BY-NC-SA 3.0
  
   This work is licensed under the 
   "Namensnennung – Keine kommerzielle Nutzung – Weitergabe unter
    gleichen Bedingungen 3.0 Deutschland (CC BY-NC-SA 3.0)" 
   http://creativecommons.org/licenses/by-nc-sa/3.0/de/deed.de
   
   Read the English translation here:
   
   "Attribution-NonCommercial-ShareAlike 3.0 Unported (CC BY-NC-SA 3.0)" 
   http://creativecommons.org/licenses/by-nc-sa/3.0/
   
--><!--<?xml-model href="file:../5.1/dbref.rnc" type="application/relax-ng-compact-syntax"?>--><section xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="dbc.common.xref-suffix-or-prefix" remap="topic" xml:base="common/topic.xref-suffix-or-prefix.xml">
  <title>Append Text or Graphics in Cross-References</title>
  <info>
    <definitions definitionfile="defs.xml"/>
    <keywordset>
      <keyword>xref</keyword>
      <keyword>suffix</keyword>
      <keyword>prefix</keyword>
    </keywordset>
    <subjectset>
      <subject>
        <subjectterm>xref</subjectterm>
      </subject>
    </subjectset>
  </info>
  
  <section role="problem">
    <title>Problem</title>
    <para>You have a cross-reference (usually tagged with
      <tag>xref</tag>) and you want to append text or graphics after the
      reference is resolved.</para>
  </section>
  <section role="solution">
    <title>Solution</title>
    <para>Use the <literal>xref-to-prefix</literal> or
      <literal>xref-to-suffix</literal> mode. These modes are called before
      or after the <tag>xref</tag> is being resolved. As such it makes
      it pretty easy to add text or graphics.
    </para>
    <para>For example, the <link linkend="ex.common.all.xref-to-suffix.txt">following example</link> appends the text <quote>[x]</quote> to
      each <tag>xref</tag>, regardless where it points to:</para>
    
    <example xml:id="ex.common.all.xref-to-suffix.txt">
      <title>Appending Simple Text to Each Element</title>
      <screen><![CDATA[<xsl:template match="*" mode="xref-to-suffix">
   <xsl:text>[X]</xsl:text>
</xsl:template>]]></screen>
    </example>
    
    <para>If you need the text only for specific elements (for example,
      only for chapters) use the <tag class="attribute">match</tag>
      attribute:</para>
    
    <example xml:id="ex.common.chapter.xref-to-suffix.txt">
      <title>Appending Simple Text for Each Cross-Reference Pointing to
        a Chapter</title>
      <screen><![CDATA[<xsl:template match="d:chapter" mode="xref-to-suffix">
   <xsl:text>[X]</xsl:text>
</xsl:template>]]></screen>
    </example>
    
  </section>
  <section role="discussion">
    <title>Discussion</title>
    <para>If you have to insert text before or after your reference only,
      you can use one of the templates described above. However, if you
      need to display a graphic, you need to insert FO or HTML specific
      code. For HTML, this could look like this: </para>
    
    <example xml:id="ex.common.chapter.html.xref-to-chapter.img">
      <title>Adding Graphic for HTML</title>
      <screen><![CDATA[<xsl:template match="d:chapter" mode="xref-to-suffix">
   <img src="chapter.png" alt="Chapter"/>
</xsl:template>]]></screen>
    </example>
    
    <para>If you need to add a graphic for FO, use the following
      template:</para>
    <example xml:id="ex.common.chapter.fo.xref-to-chapter.img">
      <title>Adding Graphic for FO</title>
      <screen><![CDATA[<xsl:template match="d:chapter" mode="xref-to-suffix">
   <xsl:variable name="srcfile">
     <xsl:call-template name="fo-external-image">
       <xsl:with-param name="filename" select="'chapter.png'"/>
     </xsl:call-template>
   </xsl:variable>
   
   <fo:external-graphic src="{$srcfile}" height="1em"/>
</xsl:template>]]></screen>
    </example>
    
    <para>The same principle applies if you want to add something
      <emphasis>before</emphasis> your cross-reference. In this case,
      replace the <literal>xref-to-suffix</literal> mode with
      <literal>xref-to-prefix</literal>.</para>
    
    <!--<para>Since version 1.78.2, the DocBook stylesheets support the
      <parameter>referrer</parameter> parameter; this can be used to get
      the original <tag>xref</tag> element. </para>-->
  </section>
  <!--<section role="seealso">
    <title>See Also</title>
    <para>Include URL or bibliographic references.</para>
  </section>-->
</section>
</chapter>
  <!--
    License CC BY-NC-SA 3.0
  
   This work is licensed under the 
   "Namensnennung – Keine kommerzielle Nutzung – Weitergabe unter
    gleichen Bedingungen 3.0 Deutschland (CC BY-NC-SA 3.0)" 
   http://creativecommons.org/licenses/by-nc-sa/3.0/de/deed.de
   
   Read the English translation here:
   
   "Attribution-NonCommercial-ShareAlike 3.0 Unported (CC BY-NC-SA 3.0)" 
   http://creativecommons.org/licenses/by-nc-sa/3.0/
   
--><!--<?xml-model href="file:5.1/dbref.rnc" type="application/relax-ng-compact-syntax"?>--><chapter xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="dbc.structure" version="5.1">
  <title>Manipulating DocBook Document Structure</title>
  
  <info>
    <definitions definitionfile="defs.xml"/>
    <biblioid class="other" otherclass="ticket">8</biblioid>
    <keywordset>
      <keyword>docbook structure</keyword>
    </keywordset>
    <abstract>
      <para>DocBook files can be created manually or by tools.
        Sometimes tools create a structure which is inconvenient for
        some reasons or you have legacy documents which contain the
          <quote>wrong</quote> structure. This chapter shows how to
        restructure your DocBook document in the way you want.</para>
      <para>
      </para>
    </abstract>
  </info>
  
  
  <section xml:id="dbc.structure.intro">
    <title>Introduction</title>
    <para>The methods described in this chapter are mostly XSLT
      solutions where you can find more or less in any XSLT book.
      Actually, some ideas origin from
          <personname><firstname>Sal</firstname>
            <surname>Mangano</surname></personname>´s excellent
        <citetitle>XSLT Cookbook</citetitle>. However, the solutions in
      this chapter are targeted exclusively on DocBook.</para>
    <para>Most of these solutions are based on an <emphasis>identity
    transformation</emphasis> stylesheet which is shown in <xref linkend="ex.copy.xsl"/>.</para>
    
    <example xml:id="ex.copy.xsl">
      <title><filename>copy.xsl</filename></title>
      <info>
        <output xmlns="urn:x-toms:docbook-ext">
          <filename>common/copy.xsl</filename>
        </output>
      </info>
      <programlisting linenumbering="numbered" language="xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;xsl:stylesheet version="1.0"
  xmlns:xsl="http://www.w3.org/1999/XSL/Transform"&gt;
  &lt;xsl:template match="node() | @*"&gt;
    &lt;xsl:copy&gt;
      &lt;xsl:apply-templates select="@* | node()"/&gt;
    &lt;/xsl:copy&gt;
  &lt;/xsl:template&gt;  
&lt;/xsl:stylesheet&gt;</programlisting>
    </example>
    
    <para>This simple stylesheet copies everything from the input
      document to the output document without any modifications.
      Although it seems quite useless at a first glance, it reveals its
      full power when combining it with customizations. </para>
  </section>
  
  <!-- 
    * Combining two DocBook documents
    * Resolving XInclude Elements
    * Autogenerate indexterm ranges
    * Preserving Entities
    * Renaming Image Filenames
    * Checking Style Guide Issues with XSLT
    * Using the xmllint Shell to test XPath expressions
    * Using Placeholders (Entities, PIs, XIncludes, phrase, ref)
    * Creating a RevHistory from RSS and Atom
  -->
  <!--
    License CC BY-NC-SA 3.0
  
   This work is licensed under the 
   "Namensnennung – Keine kommerzielle Nutzung – Weitergabe unter
    gleichen Bedingungen 3.0 Deutschland (CC BY-NC-SA 3.0)" 
   http://creativecommons.org/licenses/by-nc-sa/3.0/de/deed.de
   
   Read the English translation here:
   
   "Attribution-NonCommercial-ShareAlike 3.0 Unported (CC BY-NC-SA 3.0)" 
   http://creativecommons.org/licenses/by-nc-sa/3.0/
   
--><!--<?xml-model href="file:../5.1/dbref.rnc" type="application/relax-ng-compact-syntax"?>--><section xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="dbc.structure.pretty-print" remap="topic" userlevel="easy" xml:base="structure/topic.pretty-print.xml">
  <title>Pretty-Printing DocBook Documents</title>
  <info>
    <definitions definitionfile="defs.xml"/>
    <keywordset>
      <keyword>pretty-print</keyword>
      <keyword>xmlformat</keyword>
    </keywordset>
  </info>
  
  <section role="problem">
    <title>Problem</title>
    <para>Your file, be it autogenerated or somehow
      <quote>mangled</quote> is poorly indented and you want to 
      get rid of this. </para>
  </section>
  <section role="solution">
    <title>Solution</title>
    <para>There are different solutions to this problem:</para>
    <itemizedlist>
      <listitem>
        <para>a <quote>pretty-print</quote> stylesheet</para>
      </listitem>
      <listitem>
        <para>the XML parser <command>xmllint</command></para>
      </listitem>
      <listitem>
        <para>the <command>xmlformat</command> command</para>
      </listitem>
    </itemizedlist>
    
    <section xml:id="sec.struct.pretty-print.xmllint">
      <title>XML Parser <command>xmllint</command></title>
      <para>The XML parser <command>xmllint</command> offers the
      <option>--format</option> option to turn on indentation for each element.</para>
      <screen><command>xmllint</command> --format <replaceable>XMLFILE</replaceable></screen>
    </section>
    <section xml:id="sec.struct.pretty-print.xslt">
      <title>The Pretty-Print Stylesheet</title>
      <para>The simplest stylesheet for indentation is shown in <xref linkend="ex.pretty.xsl"/>.
      It relies on the <filename>copy.xsl</filename> stylesheet.</para>
      <example xml:id="ex.pretty.xsl">
        <title><filename>pretty.xsl</filename></title>
        <info>
          <output xmlns="urn:x-toms:docbook-ext">
            <filename>pretty/pretty.xsl</filename>
          </output>
        </info>
        <programlisting linenumbering="numbered" language="xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;xsl:stylesheet version="1.0"
  xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
  xmlns="http://docbook.org/ns/docbook"&gt;
  
  &lt;xsl:import href="copy.xsl"/&gt;
  &lt;xsl:output indent="yes"/&gt;

  &lt;xsl:strip-space elements="*"/&gt;
  &lt;xsl:preserve-space elements="d:screen d:literallayout
    d:programlisting d:address"/&gt;
&lt;/xsl:stylesheet&gt;
</programlisting>
      </example>
    </section>
    <section xml:id="sec.struct.pretty-print.xmlformat">
      <title>Command <command>xmlformat</command></title>
      <para>The <command>xmlformat</command> tool is a Perl script which
      is available from the Web site <link xlink:href="http://www.kitebird.com/software/xmlformat/"/>. 
      </para>
      <para>The tool distinguishes between block elements, inline
        elements, and verbatim elements (similar to DocBook).
        The difference between the types is the whitespace
        normalization.</para>
      <para>Block elements typically begin with a new line and
        children are indented. Spacing before and after can be
        controlled too. </para>
      <para>Inline elements occur in block elements. Normalization and 
      line-wrapping occurs in regard to the enclosing block element.</para>
      <para>Verbatim elements are not formatted at all. That means, the
        content of the input element is the same as the content of the
        output element, including whitespaces.
      </para>
    </section>
  </section>
  <section role="discussion">
    <title>Discussion</title>
    <para>The <command>xmllint</command> command with its
        <option>--format</option> option is the easiest candidate but lacks
      customization. This is useful if you do not have any other tools
      at hand and you prefer a quick and rough reformatting.</para>
    <para>The <filename>pretty.xsl</filename> stylesheet is a pure XSLT
      solution. As such, it works on every platform which supports an
      XSLT processor. It is adaptable to your needs, but mixed content
      (like in <tag>para</tag>) is problematic.</para>
    <para>The most adaptable method is <command>xmlformat</command>.</para>
  </section>
  <!--<section role="seealso">
    <title>See Also</title>
    <para></para>
  </section>-->
</section>
  <!--
    License CC BY-NC-SA 3.0
  
   This work is licensed under the 
   "Namensnennung – Keine kommerzielle Nutzung – Weitergabe unter
    gleichen Bedingungen 3.0 Deutschland (CC BY-NC-SA 3.0)" 
   http://creativecommons.org/licenses/by-nc-sa/3.0/de/deed.de
   
   Read the English translation here:
   
   "Attribution-NonCommercial-ShareAlike 3.0 Unported (CC BY-NC-SA 3.0)" 
   http://creativecommons.org/licenses/by-nc-sa/3.0/
   
--><!--<?xml-model href="file:../5.1/dbref.rnc" type="application/relax-ng-compact-syntax"?>--><section xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="dbc.structure.db4-to-db5" remap="topic" userlevel="medium" xml:base="structure/topic.db4-to-db5.xml">
  <title>Converting DocBook from Version 4 to Version 5</title>
  <info>
    <definitions definitionfile="defs.xml"/>
    <keywordset>
      <keyword>converting</keyword>
      <keyword>DocBook 4</keyword>
      <keyword>DocBook 5</keyword>
    </keywordset>
  </info>
  
  <section role="problem">
    <title>Problem</title>
    <para>You have a DocBook document in version 4.x, but you need 5.x.</para>
  </section>
  <section role="solution">
    <title>Solution</title>
    <para>Generally, the difference between version 4 and version 5 is
      minimal. Refer to the <link xlink:href="http://www.docbook.org/tdg51/en/html/ch01.html#d6e550">The
        Definitive Guide</link> for detailed information what has been
      added, removed, or renamed.
    </para>
    <para>One major change is that all DocBook 5.x elements are in the
      namespace <uri>http://docbook.org/ns/docbook</uri>. All these
      changes are taken into account by the
        <filename>db4-upgrade.xsl</filename> stylesheet in the DocBook
      Subversion repository. The URL is <link xlink:href="https://docbook.svn.sourceforge.net/svnroot/docbook/trunk/docbook/relaxng/tools/db4-upgrade.xsl"/>. You just need to apply this stylesheet to your source DocBook
      document, for example:</para>
    <screen><command>xsltproc</command> db4-upgrade.xsl doc.xml</screen>
  </section>
  <section role="discussion">
    <title>Discussion</title>
    <para>One disadvantage is that entities are not preserved. This is
      not a stylesheet issue as the entities are already resolved when
      the XSLT processor gets its hand on the source tree. The
      stylesheet never sees the entities.
    </para>
    <para>The <citetitle xlink:href="http://docbook.org/docs/howto/#entities">DocBook
      Transition Guide</citetitle> recommends the following steps (cited
      from there):</para>
    <procedure xml:id="pr.structure.db4-to-db5.preserving-entities">
      <title>Preserving Entities between DocBook Conversion</title>
      <step>
        <para>Open your existing document using your favorite editing
          tool. You must use a tool that is <emphasis>not</emphasis>
          XML-aware, or one that allows you to edit markup <quote>in
            the raw</quote>.</para>
      </step>
      <step>
        <para>Replace all occurrences of the entity references that you
          want to preserve with some unique string. For example, if you
          want to preserve <tag class="genentity">Product</tag>
          references, you could replace them all with
            <literal>[[[Product]]]</literal> (assuming that the string
            <literal>[[[Product]]]</literal> doesn't occur anywhere else
          in your document).</para>
      </step>
      <step>
        <para>Copy the document type declaration of your document
          and save it some place. The document type declaration is
          everything from “&lt;!DOCTYPE” to the closing “]&gt;”. </para>
      </step>
      <step>
        <para>Perform the conversion with the
          <filename>db4-upgrade.xsl</filename> stylesheet.</para>
      </step>
      <step>
        <para>Open the new document using your favorite editing tool.
          Replace all occurrences of the unique string you used to save
          the entity references with the corresponding entity
          references.</para>
      </step>
      <step>
        <para>Paste the document type declaration that you saved onto
          the top of your new document.</para>
      </step>
      <step>
        <para>Remove the external identifier (the PUBLIC and/or SYSTEM
          keywords) from the document type declaration. A document that
          begins with:</para>
        <screen>&lt;!DOCTYPE book [
 &lt;!ENTITY someEntity "some replacement text"&gt;
]&gt;</screen>
        <para>is perfectly well-formed. If you don't remove the
          references to the DTD, then your parser will likely try to
          validate against DocBook V4.0 and that's not going to work.
          Alternatively, you could refer to the DocBook V5.0 DTD.</para>
      </step>
    </procedure>
  </section>
  <section role="seealso">
    <title>See Also</title>
    <para>Further information can be found in <link xlink:href="http://docbook.org/docs/howto/#convert4to5"/>.</para>
  </section>
</section>
  <!--
    License CC BY-NC-SA 3.0
  
   This work is licensed under the 
   "Namensnennung – Keine kommerzielle Nutzung – Weitergabe unter
    gleichen Bedingungen 3.0 Deutschland (CC BY-NC-SA 3.0)" 
   http://creativecommons.org/licenses/by-nc-sa/3.0/de/deed.de
   
   Read the English translation here:
   
   "Attribution-NonCommercial-ShareAlike 3.0 Unported (CC BY-NC-SA 3.0)" 
   http://creativecommons.org/licenses/by-nc-sa/3.0/
   
--><!--<?xml-model href="file:../5.1/dbref.rnc" type="application/relax-ng-compact-syntax"?>--><section xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="dbc.structure.db5-to-db4" remap="topic" userlevel="medium" xml:base="structure/topic.db5-to-db4.xml">
  <title>Converting DocBook from Version 5 to Version 4</title>
  <info>
    <definitions definitionfile="defs.xml"/>
    <keywordset>
      <keyword>converting</keyword>
      <keyword>DocBook 5</keyword>
      <keyword>DocBook 4</keyword>
    </keywordset>
  </info>
  
  <section role="problem">
    <title>Problem</title>
    <para>You have a DocBook document in version 5.x, but you need 4.x.</para>
  </section>
  <section role="solution">
    <title>Solution</title>
    <para>Generally, the difference between version 4 and version 5 are
      minimal. Refer to the <link xlink:href="http://www.docbook.org/tdg51/en/html/ch01.html#d6e550">The
        Definitive Guide</link> for detailed information what has been
        added, removed, or renamed.</para>
    <para>In case you have or get DocBook 5 and need the former
      version, the following stylesheet which supports the
      core transformation might help:</para>
    <example xml:id="ex.db5to4-core.xsl">
      <title><filename>db5to4-core.xsl</filename></title>
      <info>
        <output xmlns="urn:x-toms:docbook-ext">
          <filename>db5-to-db4/db5to4-core.xsl</filename>
        </output>
      </info>
      <programlisting language="xml" linenumbering="numbered">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;xsl:stylesheet version="1.0"
  xmlns:d="http://docbook.org/ns/docbook"
  xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
  xmlns:xi="http://www.w3.org/2001/XInclude"
  xmlns:xlink="http://www.w3.org/1999/xlink"
  xmlns:html="http://www.w3.org/1999/xhtml"
  xmlns:exsl="http://exslt.org/common"
  exclude-result-prefixes="d xi xlink exsl html"&gt;

  &lt;xsl:import href="copy.xsl"/&gt;
  
  &lt;xsl:output method="xml" indent="yes" 
    doctype-public="-//OASIS//DTD DocBook XML V4.5//EN"
    doctype-system="http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd"/&gt;
  &lt;xsl:strip-space elements="*"/&gt;
  &lt;xsl:preserve-space 
    elements="d:screen d:programlisting d:literallayout xi:*"/&gt;
  &lt;xsl:variable name="inlines"&gt;abbrev accel acronym alt anchor
    annotation application author biblioref citation citebiblioid
    citerefentry citetitle classname code command computeroutput
    constant coref database date editor email emphasis envar errorcode
    errorname errortext errortype exceptionname filename firstterm
    footnote footnoteref foreignphrase function glossterm guibutton
    guiicon guilabel guimenu guimenuitem guisubmenu hardware indexterm
    initializer inlineequation inlinemediaobject interfacename jobtitle
    keycap keycode keycombo keysym link literal markup menuchoice
    methodname modifier mousebutton nonterminal olink ooclass
    ooexception oointerface option optional org orgname package
    parameter person personname phrase productname productnumber prompt
    property quote remark replaceable returnvalue shortcut subscript
    superscript symbol systemitem tag termdef token trademark type uri
    userinput varname wordasword xref&lt;/xsl:variable&gt;
  
  &lt;!-- Overwrite standard template and create elements without 
       a namespace node
  --&gt;
  &lt;xsl:template match="d:*"&gt;
    &lt;xsl:element name="{local-name()}"&gt;
      &lt;xsl:apply-templates select="@*|node()"/&gt;
    &lt;/xsl:element&gt;
  &lt;/xsl:template&gt;
    
  &lt;xsl:template match="@xml:id|@xml:lang"&gt;
    &lt;xsl:attribute name="{local-name()}"&gt;
      &lt;xsl:apply-templates/&gt;
    &lt;/xsl:attribute&gt;
  &lt;/xsl:template&gt;
  
  &lt;!-- Suppress the following attributes: --&gt;
  &lt;xsl:template match="@annotations|@version"/&gt;
  &lt;xsl:template match="@xlink:*"/&gt;
  
  &lt;xsl:template match="@xlink:href"&gt;
    &lt;xsl:choose&gt;
      &lt;xsl:when test="contains($inlines, local-name(..))"&gt;
        &lt;ulink url="{.}" remap="{local-name(..)}"&gt;
          &lt;xsl:value-of select=".."/&gt;
        &lt;/ulink&gt;
      &lt;/xsl:when&gt;
      &lt;xsl:otherwise&gt;
        &lt;xsl:message&gt;@xlink:href could not be processed!
  parent element: &lt;xsl:value-of select="local-name(..)"/&gt;
        &lt;/xsl:message&gt;
      &lt;/xsl:otherwise&gt;
    &lt;/xsl:choose&gt;
  &lt;/xsl:template&gt;
  
  &lt;xsl:template match="d:*[@xlink:href]"&gt;
    &lt;xsl:choose&gt;
      &lt;xsl:when test="contains($inlines, local-name())"&gt;
        &lt;ulink url="{@xlink:href}" remap="{local-name(.)}"&gt;
          &lt;xsl:element name="{local-name()}"&gt;
            &lt;xsl:apply-templates 
              select="@*[local-name() != 'href' and
                         namespace-uri() != 'http://www.w3.org/1999/xlink']
                      |node()"/&gt;
          &lt;/xsl:element&gt;
        &lt;/ulink&gt;
      &lt;/xsl:when&gt;
      &lt;xsl:otherwise&gt;
        &lt;xsl:element name="{local-name()}"&gt;
          &lt;xsl:apply-templates 
            select="@*[local-name() != 'href' and
                       namespace-uri() != 'http://www.w3.org/1999/xlink']
                    |node()"/&gt;
        &lt;/xsl:element&gt;
      &lt;/xsl:otherwise&gt;
    &lt;/xsl:choose&gt;
  &lt;/xsl:template&gt;
  
  &lt;xsl:template match="d:link/@xlink:href"&gt;
    &lt;xsl:attribute name="url"&gt;
      &lt;xsl:value-of select="."/&gt;
    &lt;/xsl:attribute&gt;
  &lt;/xsl:template&gt;
  
  &lt;xsl:template match="d:link[@xlink:href]"&gt;
    &lt;ulink&gt;
      &lt;xsl:apply-templates select="@*|node()"/&gt;
    &lt;/ulink&gt;
  &lt;/xsl:template&gt;
  
  &lt;xsl:template match="d:link[@linkend]"&gt;
    &lt;link&gt;
      &lt;xsl:apply-templates select="@*|node()"/&gt;
    &lt;/link&gt;
  &lt;/xsl:template&gt;
  
  &lt;!-- Renamed DocBook elements --&gt;
  &lt;xsl:template match="d:personblurb"&gt;
    &lt;authorblurb&gt;
      &lt;xsl:apply-templates select="@*|node()"/&gt;
    &lt;/authorblurb&gt;
  &lt;/xsl:template&gt;
  &lt;xsl:template match="d:tag"&gt;
    &lt;sgmltag&gt;
      &lt;xsl:apply-templates select="@*|node()"/&gt;
    &lt;/sgmltag&gt;
  &lt;/xsl:template&gt;
  
  &lt;!-- New DocBook v5.1 and HTML elements, no mapping available --&gt;
  &lt;xsl:template match="d:acknowledgements|d:annotation|d:arc
                       |d:cover
                       |d:definitions
                       |d:extendedlink
                       |d:givenname
                       |d:locator
                       |d:org|d:tocdiv
                       |html:*"&gt;
    &lt;xsl:message&gt;Don't know how to transfer "&lt;xsl:value-of
      select="local-name()"/&gt;" element into DocBook 4&lt;/xsl:message&gt;
  &lt;/xsl:template&gt;
  
  &lt;xsl:template match="d:orgname"&gt;
     &lt;othername&gt;
       &lt;xsl:apply-templates select="@*|node()"/&gt;
     &lt;/othername&gt;
   &lt;/xsl:template&gt;

&lt;/xsl:stylesheet&gt;</programlisting>
    </example>
    <para>Use your favorite XSLT processor to transform your documents.</para>
  </section>
  <section role="discussion">
    <title>Discussion</title>
    <para>The stylesheet from <xref linkend="ex.db5to4-core.xsl"/> imports
      the templates from <filename>copy.xsl</filename> using an
      <emphasis>identity transformation</emphasis>. That means, whatever
      is <emphasis>not</emphasis> specified gets copied. In most cases
      that is what you want—a DocBook 5 <tag>section</tag> element
      will be transformed into an equally named DocBook 4 
      <tag>section</tag> element without the namespace.
    </para>
    <para>Where it gets difficult are the new elements which are
      introduced in DocBook 5. Whenever the stylesheet encounters
      those it will print a warning. These elements are not copied to
      the output stream. If you have one of those elements you need to
      customize the stylesheet yourself.</para>
    <para>Another issue is the almost ubiquitary <tag>info</tag>
      element which can appear in structual and block elements. The
      above stylesheet does it wrong and copies any <tag>info</tag>
      element straight into the output stream. However, DocBook 4
      has different element names for meta information in
      DocBook 5. If you have <tag>info</tag> elements in your 
      document they have to be renamed, depending on the parent element:</para>
    <itemizedlist>
      <listitem>
        <formalpara>
          <title>Meta Information Inside Structural Elements</title>
          <para>An <tag>info</tag> element inside a <tag>sect1</tag>
            appends the suffix <literal>info</literal> to the name of
            its parent element and is renamed therefore as
              <tag>sect1info</tag>. This rule is applied for structural
            elements like <tag>book</tag>, <tag>chapter</tag>, and
            others.</para>
        </formalpara>
      </listitem>
      <listitem>
        <formalpara>
          <title>Meta Information Inside Block Elements</title>
          <para>An <tag>info</tag> element inside an <tag>example</tag>
            is renamed as <tag>blockinfo</tag>. This rule is applied for
          block elements like <tag>equation</tag>, <tag>figure</tag>,
          and others.</para>
        </formalpara>
      </listitem>
    </itemizedlist>
    
    <para>Apart from the renaming, the order of the renamed <tag>info</tag>
      element is crucial. Consider the following DocBook 5
      structure:</para>
    <screen>section
  title
  info</screen>
    <para>This structure has to be renamed and reorganized as
      follows:</para>
    <screen>section
  sectioninfo
  title</screen>
    <para>As you can see, the <tag>title</tag> element appears now
        <emphasis>after</emphasis> the renamed <tag>info</tag>. All
      these issues are solved with the following additional
      stylesheet:</para>
    <example xml:id="ex.db5to4-info.xsl">
      <title><filename>db5to4-info.xsl</filename></title>
      <info>
        <output xmlns="urn:x-toms:docbook-ext">
          <filename>db5-to-db4/db5to4-info.xsl</filename>
        </output>
      </info>
      <programlisting language="xml" linenumbering="numbered">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;xsl:stylesheet version="1.0"
  xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
  xmlns:d="http://docbook.org/ns/docbook"
  xmlns:xlink="http://www.w3.org/1999/xlink"
  xmlns:exsl="http://exslt.org/common"
  exclude-result-prefixes="d xlink exsl"&gt;
  
  &lt;!-- Structural elements using info --&gt;
  &lt;xsl:template match="d:appendix[d:info]
                      |d:article[d:info]
                      |d:bibliography[d:info]
                      |d:book[d:info]
                      |d:chapter[d:info]
                      |d:colophon[d:info]
                      |d:equation[d:info]
                      |d:glossary[d:info]
                      |d:index[d:info]
                      |d:legalnotice[d:info]
                      |d:part[d:info]
                      |d:partintro[d:info]
                      |d:preface[d:info]
                      |d:reference[d:info]
                      |d:refsect1[d:info]
                      |d:refsect2[d:info]
                      |d:refsect3[d:info]
                      |d:refsection[d:info]
                      |d:refsynopsisdiv[d:info]
                      |d:sect1[d:info]
                      |d:sect2[d:info]
                      |d:sect3[d:info]
                      |d:sect4[d:info]
                      |d:sect5[d:info]
                      |d:section[d:info]
                      |d:set[d:info]
                      |d:setindex[d:info]"&gt;
    &lt;!-- Change order of info and title  --&gt;
    &lt;xsl:element name="{local-name()}"&gt;
      &lt;xsl:apply-templates select="@*"/&gt;
      &lt;xsl:apply-templates select="d:title/preceding-sibling::processing-instruction()
                                   |d:title/preceding-sibling::comment()"/&gt;
      &lt;xsl:apply-templates select="d:info"/&gt;
      &lt;xsl:apply-templates select="d:title"/&gt;
      &lt;!-- Process the rest --&gt;
      &lt;xsl:apply-templates select="d:info/following-sibling::node()"/&gt;
    &lt;/xsl:element&gt;
  &lt;/xsl:template&gt;
  
  &lt;!-- Block elements using info --&gt;
  &lt;xsl:template match="d:bibliolist[d:info]
                      |d:blockquote[d:info]
                      |d:equation[d:info]
                      |d:example[d:info]
                      |d:figure[d:info]
                      |d:glosslist[d:info]
                      |d:informalequation[d:info]
                      |d:informalexample[d:info]
                      |d:informalfigure[d:info]
                      |d:informaltable[d:info]
                      |d:itemizedlist[d:info]
                      |d:legalnotice[d:info]
                      |d:msgset[d:info]
                      |d:orderedlist[d:info]
                      |d:procedure[d:info]
                      |d:qandadiv[d:info]
                      |d:qandaentry[d:info]
                      |d:qandaset[d:info]
                      |d:table[d:info]
                      |d:task[d:info]
                      |d:taskprerequisites[d:info]
                      |d:taskrelated[d:info]
                      |d:tasksummary[d:info]
                      |d:variablelist[d:info]"&gt;
    &lt;xsl:element name="{local-name()}"&gt;
      &lt;xsl:apply-templates select="@*"/&gt;
      &lt;xsl:apply-templates select="d:title/preceding-sibling::processing-instruction()
                                   |d:title/preceding-sibling::comment()"/&gt;
      &lt;xsl:apply-templates select="d:info"&gt;
        &lt;xsl:with-param name="infoname"&gt;block&lt;/xsl:with-param&gt;
      &lt;/xsl:apply-templates&gt;
      &lt;xsl:apply-templates select="d:title|
                                   d:title/following-sibling::processing-instruction()[1]
                                   |d:title/following-sibling::comment()[1]"/&gt;
      
      &lt;!-- Process the rest --&gt;
      &lt;xsl:apply-templates select="d:info/following-sibling::node()"/&gt;
    &lt;/xsl:element&gt;
  &lt;/xsl:template&gt;

  &lt;!-- Suppress other info elements who has no direct mapping --&gt;
  &lt;xsl:template match="d:*[d:info]"/&gt;
  
  &lt;xsl:template match="d:info"&gt;
    &lt;xsl:param name="infoname" select="local-name(..)"/&gt;
    &lt;xsl:variable name="rtf-node"&gt;
      &lt;xsl:element name="{$infoname}info"&gt;
      &lt;xsl:apply-templates select="@*|node()"/&gt;
    &lt;/xsl:element&gt;
    &lt;/xsl:variable&gt;
    &lt;xsl:choose&gt;
      &lt;xsl:when test="count(exsl:node-set($rtf-node)/*/*) &gt; 0"&gt;
        &lt;xsl:copy-of select="$rtf-node"/&gt;
      &lt;/xsl:when&gt;
      &lt;xsl:otherwise&gt;&lt;!-- Don't copy, it's empty --&gt;&lt;/xsl:otherwise&gt;
    &lt;/xsl:choose&gt;
  &lt;/xsl:template&gt;
&lt;/xsl:stylesheet&gt;</programlisting>
    </example>
    <para>To combine both, use the following stylesheet:</para>
    <example xml:id="ex.db5to4-withinfo.xsl">
      <title><filename>db5to4-withinfo.xsl</filename></title>
      <info>
        <output xmlns="urn:x-toms:docbook-ext">
          <filename>db5-to-db4/db5to4-withinfo.xsl</filename>
        </output>
      </info>
      <programlisting language="xml" linenumbering="numbered">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;xsl:stylesheet version="1.0"
  xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
  xmlns:d="http://docbook.org/ns/docbook"&gt;

  &lt;xsl:import href="db5to4-core.xsl"/&gt;
  &lt;xsl:import href="db5to4-info.xsl"/&gt;
  
  &lt;xsl:output method="xml" indent="yes" 
    doctype-public="-//OASIS//DTD DocBook XML V4.5//EN"
    doctype-system="http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd"/&gt;
&lt;/xsl:stylesheet&gt;</programlisting>
    </example>
    <para>The above stylesheets were separated between a core
      functionality (<filename>db5to4-core.xsl</filename>) with
      additional <tag>info</tag> element handling
      (<filename>db5to4-info.xsl</filename>). In most cases you will use
      the stylesheet <filename>db5to4-withinfo.xsl</filename>, but if
      you want to implement a different <tag>info</tag> handling you
      can. In <xref linkend="ex.db5to4-withinfo.xsl"/> just replace the 
      line with importing <filename>db5to4-info.xsl</filename> with your
      own implementation.      
    </para>
  </section>
  <!--<section role="seealso">
    <title>See Also</title>
    <para></para>
  </section>-->
</section>
  <!--
    License CC BY-NC-SA 3.0
  
   This work is licensed under the 
   "Namensnennung – Keine kommerzielle Nutzung – Weitergabe unter
    gleichen Bedingungen 3.0 Deutschland (CC BY-NC-SA 3.0)" 
   http://creativecommons.org/licenses/by-nc-sa/3.0/de/deed.de
   
   Read the English translation here:
   
   "Attribution-NonCommercial-ShareAlike 3.0 Unported (CC BY-NC-SA 3.0)" 
   http://creativecommons.org/licenses/by-nc-sa/3.0/
   
--><section xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="dbc.structure.splitdb" version="5.1" remap="topic" userlevel="medium" xml:base="structure/topic.splitdb.xml">
  <title>Splitting DocBook Documents</title>
  <info>
    <!--<definitions definitionfile="defs.xml"/>-->
    <keywordset>
      <keyword>splitting</keyword>
      <keyword>exsl:document</keyword>
    </keywordset>
    <subjectset>
      <subject>
        <subjectterm>modules</subjectterm>
      </subject>
    </subjectset>
  </info>
  
  <section role="problem">
    <title>Problem</title>
    <para>You have a big DocBook document, like a book, and you want to
      split each <tag>chapter</tag>, <tag>appendix</tag> etc. into a
      separate file.</para>
  </section>
  <section role="solution">
    <title>Solution</title>
    <para>There are three solutions to this problems:</para>
    <itemizedlist>
      <listitem>
        <para>Apply a XSLT stylesheet which uses the extension element
          <function>exsl:document</function></para>
      </listitem>
      <listitem>
        <para>Run the <command>dbautosplit</command> Perl script</para>
      </listitem>
      <listitem>
        <para>Use the assembly stylesheet
          <filename>topic-maker-chunk.xsl</filename> (see <xref linkend="dbc.structure.splitting-into-topics"/> for
          more information).</para>
      </listitem>
    </itemizedlist>
    
    <para>The following subsections describe each method.</para>
    
    <section xml:id="sec.structure.splitdb.xsl">
      <title>Splitting with XSLT</title>
      <para>The stylesheet in <xref linkend="ex.dbsplit.xsl"/> uses 
        the extension element  to create separate documents from the main
        output. It uses code from
        <filename>html/chunk-code.xsl</filename>.</para>
      <example xml:id="ex.dbsplit.xsl">
        <title><filename>dbsplit.xsl</filename></title>
        <info>
          <output xmlns="urn:x-toms:docbook-ext">
            <filename>splitdb/dbsplit.xsl</filename>
          </output>
        </info>
        <programlisting linenumbering="numbered" language="xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;!DOCTYPE xsl:stylesheet 
[
 &lt;!ENTITY db "http://docbook.sourceforge.net/release/xsl-ns/current"&gt; 
]&gt;
&lt;xsl:stylesheet version="1.0"
  xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
  xmlns:d="http://docbook.org/ns/docbook"
  xmlns:exsl="http://exslt.org/common"
  xmlns:xi="http://www.w3.org/2001/XInclude"
  extension-element-prefixes="exsl"&gt;

  &lt;xsl:import href="chunker.xsl"/&gt;
  &lt;xsl:import href="copy.xsl"/&gt;
  &lt;xsl:output indent="yes"/&gt;


  &lt;xsl:param name="base.dir" select="'out/'"/&gt;
  &lt;xsl:param name="use.id.as.filename" select="0"/&gt;
  &lt;xsl:param name="rootid"/&gt;

  &lt;xsl:param name="dbsplit.root.filename"&gt;Index&lt;/xsl:param&gt;
  &lt;xsl:param name="dbsplit.ext"&gt;.xml&lt;/xsl:param&gt;
  &lt;xsl:param name="dbsplit.chunk.depth" select="2"/&gt;

  &lt;xsl:template name="object.id"&gt;
    &lt;xsl:param name="object" select="."/&gt;
    &lt;xsl:choose&gt;
      &lt;xsl:when test="$object/@id"&gt;
        &lt;xsl:value-of select="$object/@id"/&gt;
      &lt;/xsl:when&gt;
      &lt;xsl:when test="$object/@xml:id"&gt;
        &lt;xsl:value-of select="$object/@xml:id"/&gt;
      &lt;/xsl:when&gt;
      &lt;xsl:otherwise&gt;
        &lt;xsl:value-of select="generate-id($object)"/&gt;
      &lt;/xsl:otherwise&gt;
    &lt;/xsl:choose&gt;
  &lt;/xsl:template&gt;

  &lt;xsl:template match="*" mode="recursive-chunk-filename"&gt;
    &lt;xsl:param name="recursive" select="false()"/&gt;
    &lt;xsl:variable name="filename"&gt;
      &lt;xsl:choose&gt;
        &lt;!-- if this is the root element, use the dbsplit.root.filename --&gt;
        &lt;xsl:when test="not(parent::*) and $dbsplit.root.filename != ''"&gt;
          &lt;xsl:value-of select="$dbsplit.root.filename"/&gt;
          &lt;xsl:value-of select="$dbsplit.ext"/&gt;
        &lt;/xsl:when&gt;
        &lt;!-- Special case --&gt;
        &lt;xsl:when
          test="self::d:legalnotice and not($generate.legalnotice.link = 0)"&gt;
          &lt;xsl:choose&gt;
            &lt;xsl:when
              test="(@id or @xml:id) and not($use.id.as.filename = 0)"&gt;
              &lt;!-- * if this legalnotice has an ID, then go ahead and use --&gt;
              &lt;!-- * just the value of that ID as the basename for the file --&gt;
              &lt;!-- * (that is, without prepending an "ln-" too it) --&gt;
              &lt;xsl:value-of select="(@id|@xml:id)[1]"/&gt;
              &lt;xsl:value-of select="$dbsplit.ext"/&gt;
            &lt;/xsl:when&gt;
            &lt;xsl:otherwise&gt;
              &lt;!-- * otherwise, if this legalnotice does not have an ID, --&gt;
              &lt;!-- * then we generate an ID... --&gt;
              &lt;xsl:variable name="id"&gt;
                &lt;xsl:call-template name="object.id"/&gt;
              &lt;/xsl:variable&gt;
              &lt;!-- * ...and then we take that generated ID, prepend an --&gt;
              &lt;!-- * "ln-" to it, and use that as the basename for the file --&gt;
              &lt;xsl:value-of select="concat('ln-',$id,$dbsplit.ext)"/&gt;
            &lt;/xsl:otherwise&gt;
          &lt;/xsl:choose&gt;
        &lt;/xsl:when&gt;
        &lt;!-- if there's no dbhtml filename, and if we're to use IDs as --&gt;
        &lt;!-- filenames, then use the ID to generate the filename. --&gt;
        &lt;xsl:when test="(@id or @xml:id) and $use.id.as.filename != 0"&gt;
          &lt;xsl:value-of select="(@id|@xml:id)[1]"/&gt;
          &lt;xsl:value-of select="$dbsplit.ext"/&gt;
        &lt;/xsl:when&gt;
        &lt;xsl:otherwise/&gt;
      &lt;/xsl:choose&gt;
    &lt;/xsl:variable&gt;

    &lt;xsl:choose&gt;
      &lt;xsl:when test="not($recursive) and $filename != ''"&gt;
        &lt;!-- if this chunk has an explicit name, use it --&gt;
        &lt;xsl:value-of select="$filename"/&gt;
      &lt;/xsl:when&gt;

      &lt;xsl:when test="self::d:set"&gt;
        &lt;xsl:value-of select="$dbsplit.root.filename"/&gt;
        &lt;xsl:if test="not($recursive)"&gt;
          &lt;xsl:value-of select="$dbsplit.ext"/&gt;
        &lt;/xsl:if&gt;
      &lt;/xsl:when&gt;

      &lt;xsl:when test="self::d:book"&gt;
        &lt;xsl:text&gt;bk&lt;/xsl:text&gt;
        &lt;xsl:number level="any" format="01"/&gt;
        &lt;xsl:if test="not($recursive)"&gt;
          &lt;xsl:value-of select="$dbsplit.ext"/&gt;
        &lt;/xsl:if&gt;
      &lt;/xsl:when&gt;

      &lt;xsl:when test="self::d:article"&gt;
        &lt;xsl:if test="/d:set"&gt;
          &lt;!-- in a set, make sure we inherit the right book info... --&gt;
          &lt;xsl:apply-templates mode="recursive-chunk-filename"
            select="parent::*"&gt;
            &lt;xsl:with-param name="recursive" select="true()"/&gt;
          &lt;/xsl:apply-templates&gt;
        &lt;/xsl:if&gt;

        &lt;xsl:text&gt;ar&lt;/xsl:text&gt;
        &lt;xsl:number level="any" format="01" from="d:book"/&gt;
        &lt;xsl:if test="not($recursive)"&gt;
          &lt;xsl:value-of select="$dbsplit.ext"/&gt;
        &lt;/xsl:if&gt;
      &lt;/xsl:when&gt;

      &lt;xsl:when test="self::d:preface"&gt;
        &lt;xsl:if test="/d:set"&gt;
          &lt;!-- in a set, make sure we inherit the right book info... --&gt;
          &lt;xsl:apply-templates mode="recursive-chunk-filename"
            select="parent::*"&gt;
            &lt;xsl:with-param name="recursive" select="true()"/&gt;
          &lt;/xsl:apply-templates&gt;
        &lt;/xsl:if&gt;

        &lt;xsl:text&gt;pr&lt;/xsl:text&gt;
        &lt;xsl:number level="any" format="01" from="d:book"/&gt;
        &lt;xsl:if test="not($recursive)"&gt;
          &lt;xsl:value-of select="$dbsplit.ext"/&gt;
        &lt;/xsl:if&gt;
      &lt;/xsl:when&gt;

      &lt;xsl:when test="self::d:chapter"&gt;
        &lt;xsl:if test="/d:set"&gt;
          &lt;!-- in a set, make sure we inherit the right book info... --&gt;
          &lt;xsl:apply-templates mode="recursive-chunk-filename"
            select="parent::*"&gt;
            &lt;xsl:with-param name="recursive" select="true()"/&gt;
          &lt;/xsl:apply-templates&gt;
        &lt;/xsl:if&gt;

        &lt;xsl:text&gt;ch&lt;/xsl:text&gt;
        &lt;xsl:number level="any" format="01" from="d:book"/&gt;
        &lt;xsl:if test="not($recursive)"&gt;
          &lt;xsl:value-of select="$dbsplit.ext"/&gt;
        &lt;/xsl:if&gt;
      &lt;/xsl:when&gt;

      &lt;xsl:when test="self::d:appendix"&gt;
        &lt;xsl:if test="/d:set"&gt;
          &lt;!-- in a set, make sure we inherit the right book info... --&gt;
          &lt;xsl:apply-templates mode="recursive-chunk-filename"
            select="parent::*"&gt;
            &lt;xsl:with-param name="recursive" select="true()"/&gt;
          &lt;/xsl:apply-templates&gt;
        &lt;/xsl:if&gt;

        &lt;xsl:text&gt;ap&lt;/xsl:text&gt;
        &lt;xsl:number level="any" format="a" from="d:book"/&gt;
        &lt;xsl:if test="not($recursive)"&gt;
          &lt;xsl:value-of select="$dbsplit.ext"/&gt;
        &lt;/xsl:if&gt;
      &lt;/xsl:when&gt;

      &lt;xsl:when test="self::d:part"&gt;
        &lt;xsl:choose&gt;
          &lt;xsl:when test="/d:set"&gt;
            &lt;!-- in a set, make sure we inherit the right book info... --&gt;
            &lt;xsl:apply-templates mode="recursive-chunk-filename"
              select="parent::*"&gt;
              &lt;xsl:with-param name="recursive" select="true()"/&gt;
            &lt;/xsl:apply-templates&gt;
          &lt;/xsl:when&gt;
          &lt;xsl:otherwise&gt; &lt;/xsl:otherwise&gt;
        &lt;/xsl:choose&gt;

        &lt;xsl:text&gt;pt&lt;/xsl:text&gt;
        &lt;xsl:number level="any" format="01" from="d:book"/&gt;
        &lt;xsl:if test="not($recursive)"&gt;
          &lt;xsl:value-of select="$dbsplit.ext"/&gt;
        &lt;/xsl:if&gt;
      &lt;/xsl:when&gt;

      &lt;xsl:when test="self::d:reference"&gt;
        &lt;xsl:choose&gt;
          &lt;xsl:when test="/d:set"&gt;
            &lt;!-- in a set, make sure we inherit the right book info... --&gt;
            &lt;xsl:apply-templates mode="recursive-chunk-filename"
              select="parent::*"&gt;
              &lt;xsl:with-param name="recursive" select="true()"/&gt;
            &lt;/xsl:apply-templates&gt;
          &lt;/xsl:when&gt;
          &lt;xsl:otherwise&gt; &lt;/xsl:otherwise&gt;
        &lt;/xsl:choose&gt;

        &lt;xsl:text&gt;rn&lt;/xsl:text&gt;
        &lt;xsl:number level="any" format="01" from="d:book"/&gt;
        &lt;xsl:if test="not($recursive)"&gt;
          &lt;xsl:value-of select="$dbsplit.ext"/&gt;
        &lt;/xsl:if&gt;
      &lt;/xsl:when&gt;

      &lt;xsl:when test="self::d:refentry"&gt;
        &lt;xsl:choose&gt;
          &lt;xsl:when test="parent::d:reference"&gt;
            &lt;xsl:apply-templates mode="recursive-chunk-filename"
              select="parent::*"&gt;
              &lt;xsl:with-param name="recursive" select="true()"/&gt;
            &lt;/xsl:apply-templates&gt;
          &lt;/xsl:when&gt;
          &lt;xsl:otherwise&gt;
            &lt;xsl:if test="/d:set"&gt;
              &lt;!-- in a set, make sure we inherit the right book info... --&gt;
              &lt;xsl:apply-templates mode="recursive-chunk-filename"
                select="parent::*"&gt;
                &lt;xsl:with-param name="recursive" select="true()"/&gt;
              &lt;/xsl:apply-templates&gt;
            &lt;/xsl:if&gt;
          &lt;/xsl:otherwise&gt;
        &lt;/xsl:choose&gt;

        &lt;xsl:text&gt;re&lt;/xsl:text&gt;
        &lt;xsl:number level="any" format="01" from="d:book"/&gt;
        &lt;xsl:if test="not($recursive)"&gt;
          &lt;xsl:value-of select="$dbsplit.ext"/&gt;
        &lt;/xsl:if&gt;
      &lt;/xsl:when&gt;

      &lt;xsl:when test="self::d:colophon"&gt;
        &lt;xsl:choose&gt;
          &lt;xsl:when test="/d:set"&gt;
            &lt;!-- in a set, make sure we inherit the right book info... --&gt;
            &lt;xsl:apply-templates mode="recursive-chunk-filename"
              select="parent::*"&gt;
              &lt;xsl:with-param name="recursive" select="true()"/&gt;
            &lt;/xsl:apply-templates&gt;
          &lt;/xsl:when&gt;
          &lt;xsl:otherwise&gt; &lt;/xsl:otherwise&gt;
        &lt;/xsl:choose&gt;

        &lt;xsl:text&gt;co&lt;/xsl:text&gt;
        &lt;xsl:number level="any" format="01" from="d:book"/&gt;
        &lt;xsl:if test="not($recursive)"&gt;
          &lt;xsl:value-of select="$dbsplit.ext"/&gt;
        &lt;/xsl:if&gt;
      &lt;/xsl:when&gt;

      &lt;xsl:when test="self::d:sect1 or self::d:sect2 or self::d:sect3 or 
                      self::d:sect4 or self::d:sect5 or self::d:section"&gt;
        &lt;xsl:apply-templates mode="recursive-chunk-filename"
          select="parent::*"&gt;
          &lt;xsl:with-param name="recursive" select="true()"/&gt;
        &lt;/xsl:apply-templates&gt;
        &lt;xsl:text&gt;s&lt;/xsl:text&gt;
        &lt;xsl:number format="01"/&gt;
        &lt;xsl:if test="not($recursive)"&gt;
          &lt;xsl:value-of select="$dbsplit.ext"/&gt;
        &lt;/xsl:if&gt;
      &lt;/xsl:when&gt;

      &lt;xsl:when test="self::d:bibliography"&gt;
        &lt;xsl:choose&gt;
          &lt;xsl:when test="/d:set"&gt;
            &lt;!-- in a set, make sure we inherit the right book info... --&gt;
            &lt;xsl:apply-templates mode="recursive-chunk-filename"
              select="parent::*"&gt;
              &lt;xsl:with-param name="recursive" select="true()"/&gt;
            &lt;/xsl:apply-templates&gt;
          &lt;/xsl:when&gt;
          &lt;xsl:otherwise&gt; &lt;/xsl:otherwise&gt;
        &lt;/xsl:choose&gt;

        &lt;xsl:text&gt;bi&lt;/xsl:text&gt;
        &lt;xsl:number level="any" format="01" from="d:book"/&gt;
        &lt;xsl:if test="not($recursive)"&gt;
          &lt;xsl:value-of select="$dbsplit.ext"/&gt;
        &lt;/xsl:if&gt;
      &lt;/xsl:when&gt;

      &lt;xsl:when test="self::d:glossary"&gt;
        &lt;xsl:choose&gt;
          &lt;xsl:when test="/d:set"&gt;
            &lt;!-- in a set, make sure we inherit the right book info... --&gt;
            &lt;xsl:apply-templates mode="recursive-chunk-filename"
              select="parent::*"&gt;
              &lt;xsl:with-param name="recursive" select="true()"/&gt;
            &lt;/xsl:apply-templates&gt;
          &lt;/xsl:when&gt;
          &lt;xsl:otherwise&gt; &lt;/xsl:otherwise&gt;
        &lt;/xsl:choose&gt;

        &lt;xsl:text&gt;go&lt;/xsl:text&gt;
        &lt;xsl:number level="any" format="01" from="d:book"/&gt;
        &lt;xsl:if test="not($recursive)"&gt;
          &lt;xsl:value-of select="$dbsplit.ext"/&gt;
        &lt;/xsl:if&gt;
      &lt;/xsl:when&gt;

      &lt;xsl:when test="self::d:index"&gt;
        &lt;xsl:choose&gt;
          &lt;xsl:when test="/d:set"&gt;
            &lt;!-- in a set, make sure we inherit the right book info... --&gt;
            &lt;xsl:apply-templates mode="recursive-chunk-filename"
              select="parent::*"&gt;
              &lt;xsl:with-param name="recursive" select="true()"/&gt;
            &lt;/xsl:apply-templates&gt;
          &lt;/xsl:when&gt;
          &lt;xsl:otherwise&gt; &lt;/xsl:otherwise&gt;
        &lt;/xsl:choose&gt;

        &lt;xsl:text&gt;ix&lt;/xsl:text&gt;
        &lt;xsl:number level="any" format="01" from="d:book"/&gt;
        &lt;xsl:if test="not($recursive)"&gt;
          &lt;xsl:value-of select="$dbsplit.ext"/&gt;
        &lt;/xsl:if&gt;
      &lt;/xsl:when&gt;

      &lt;xsl:when test="self::d:setindex"&gt;
        &lt;xsl:text&gt;si&lt;/xsl:text&gt;
        &lt;xsl:number level="any" format="01" from="d:set"/&gt;
        &lt;xsl:if test="not($recursive)"&gt;
          &lt;xsl:value-of select="$dbsplit.ext"/&gt;
        &lt;/xsl:if&gt;
      &lt;/xsl:when&gt;

      &lt;xsl:otherwise&gt;
        &lt;xsl:text&gt;chunk-filename-error-&lt;/xsl:text&gt;
        &lt;xsl:value-of select="name(.)"/&gt;
        &lt;xsl:number level="any" format="01" from="d:set"/&gt;
        &lt;xsl:if test="not($recursive)"&gt;
          &lt;xsl:value-of select="$dbsplit.ext"/&gt;
        &lt;/xsl:if&gt;
      &lt;/xsl:otherwise&gt;
    &lt;/xsl:choose&gt;
  &lt;/xsl:template&gt;

  &lt;xsl:template name="generate-filename"&gt;
    &lt;xsl:apply-templates select="." mode="recursive-chunk-filename"/&gt;
  &lt;/xsl:template&gt;

  &lt;xsl:template name="generate-content"&gt;
    &lt;xsl:variable name="filename"&gt;
      &lt;xsl:call-template name="make-relative-filename"&gt;
        &lt;xsl:with-param name="base.dir" select="$base.dir"/&gt;
        &lt;xsl:with-param name="base.name"&gt;
           &lt;xsl:call-template name="generate-filename"/&gt;
        &lt;/xsl:with-param&gt;
      &lt;/xsl:call-template&gt;
    &lt;/xsl:variable&gt;
    &lt;xsl:variable name="depth" select="count(ancestor::*)"/&gt;
    
    &lt;!--&lt;xsl:message&gt;generate-content:
      name: &lt;xsl:value-of select="name()"/&gt;
      filename: &lt;xsl:value-of select="$filename"/&gt;
      depth: &lt;xsl:value-of select="$depth"/&gt;
      test: &lt;xsl:value-of select="$depth &gt;= $dbsplit.chunk.depth"/&gt;
    &lt;/xsl:message&gt;--&gt;
    
    &lt;xsl:choose&gt;
      &lt;xsl:when test="$depth &amp;lt;= $dbsplit.chunk.depth"&gt;
        &lt;xi:include href="{$filename}"/&gt;
        &lt;xsl:call-template name="write.xml.chunk"&gt;
          &lt;xsl:with-param name="filename" select="$filename"/&gt;
          &lt;xsl:with-param name="content"&gt;
            &lt;xsl:copy-of select="preceding-sibling::processing-instruction()|
                                 preceding-sibling::comment()"/&gt;
            &lt;xsl:copy&gt;
              &lt;xsl:apply-templates/&gt;
            &lt;/xsl:copy&gt;
          &lt;/xsl:with-param&gt;
        &lt;/xsl:call-template&gt;
      &lt;/xsl:when&gt;
      &lt;xsl:otherwise&gt;
        &lt;xsl:copy&gt;
          &lt;xsl:apply-templates/&gt;
        &lt;/xsl:copy&gt;
      &lt;/xsl:otherwise&gt;
    &lt;/xsl:choose&gt;
  &lt;/xsl:template&gt;

  &lt;xsl:template
    match="d:acknowledgements|d:appendix|d:article|
           d:bibliography|
           d:chapter|d:colophon|d:dedication|d:glossary|
           d:part|d:preface|d:reference|d:topic|
           d:sect1|d:section[not(parent::d:section)]"&gt;
    &lt;xsl:call-template name="generate-content"/&gt;
  &lt;/xsl:template&gt;

&lt;/xsl:stylesheet&gt;
</programlisting>
      </example>
      <para>The <filename>chunker.xsl</filename> file is more or
        less a stripped down version of the
          <filename>html/chunker.xsl</filename> file from the DocBook XSL
        stylesheets. It is used to create processor independent writing
        of our XML chunks. The file was integrated into
          <filename>dbsplit.xsl</filename> to make it more independent
        from the DocBook XSL stylesheets.</para>
      <example>
        <title><filename>chunker.xsl</filename></title>
        <info>
          <output xmlns="urn:x-toms:docbook-ext">
            <filename>splitdb/chunker.xsl</filename>
          </output>
        </info>
        <programlisting linenumbering="numbered" language="xml">&lt;xsl:stylesheet xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
  xmlns:saxon="http://icl.com/saxon"
  xmlns:lxslt="http://xml.apache.org/xslt"
  xmlns:redirect="http://xml.apache.org/xalan/redirect"
  xmlns:exsl="http://exslt.org/common"
  xmlns="http://www.w3.org/1999/xhtml" version="1.0"
  exclude-result-prefixes="saxon lxslt redirect exsl"
  extension-element-prefixes="saxon redirect lxslt exsl"&gt;

  &lt;xsl:param name="chunker.output.method" select="'xml'"/&gt;
  &lt;xsl:param name="chunker.output.encoding" select="'UTF-8'"/&gt;
  &lt;xsl:param name="chunker.output.indent" select="'no'"/&gt;
  &lt;xsl:param name="chunker.output.omit-xml-declaration" select="'no'"/&gt;
  &lt;xsl:param name="chunker.output.standalone" select="'no'"/&gt;
  &lt;xsl:param name="chunker.output.doctype-public" select="''"/&gt;
  &lt;xsl:param name="chunker.output.doctype-system" select="''"/&gt;
  &lt;xsl:param name="chunker.output.media-type" select="''"/&gt;
  &lt;xsl:param name="chunker.output.cdata-section-elements" select="''"/&gt;
  &lt;xsl:param name="chunker.output.quiet" select="0"/&gt;

  &lt;xsl:param name="saxon.character.representation"
    select="'entity;decimal'"/&gt;

  &lt;xsl:template name="make-relative-filename"&gt;
    &lt;xsl:param name="base.dir" select="'./'"/&gt;
    &lt;xsl:param name="base.name" select="''"/&gt;

    &lt;xsl:choose&gt;
      &lt;!-- put Saxon first to work around a bug in libxslt --&gt;
      &lt;xsl:when test="element-available('saxon:output')"&gt;
        &lt;!-- Saxon doesn't make the chunks relative --&gt;
        &lt;xsl:value-of select="concat($base.dir,$base.name)"/&gt;
      &lt;/xsl:when&gt;
      &lt;xsl:when test="element-available('exsl:document')"&gt;
        &lt;!-- EXSL document does make the chunks relative, I think --&gt;
        &lt;xsl:choose&gt;
          &lt;xsl:when test="count(parent::*) = 0"&gt;
            &lt;xsl:value-of select="concat($base.dir,$base.name)"/&gt;
          &lt;/xsl:when&gt;
          &lt;xsl:otherwise&gt;
            &lt;xsl:value-of select="$base.name"/&gt;
          &lt;/xsl:otherwise&gt;
        &lt;/xsl:choose&gt;
      &lt;/xsl:when&gt;
      &lt;xsl:when test="element-available('redirect:write')"&gt;
        &lt;!-- Xalan doesn't make the chunks relative --&gt;
        &lt;xsl:value-of select="concat($base.dir,$base.name)"/&gt;
      &lt;/xsl:when&gt;
      &lt;xsl:otherwise&gt;
        &lt;xsl:message terminate="yes"&gt;
          &lt;xsl:text&gt;Don't know how to chunk with &lt;/xsl:text&gt;
          &lt;xsl:value-of select="system-property('xsl:vendor')"/&gt;
        &lt;/xsl:message&gt;
      &lt;/xsl:otherwise&gt;
    &lt;/xsl:choose&gt;
  &lt;/xsl:template&gt;

  &lt;xsl:template name="write.chunk"&gt;
    &lt;xsl:param name="filename" select="''"/&gt;
    &lt;xsl:param name="quiet" select="$chunker.output.quiet"/&gt;
    &lt;xsl:param name="suppress-context-node-name" select="0"/&gt;
    &lt;xsl:param name="message-prolog"/&gt;
    &lt;xsl:param name="message-epilog"/&gt;

    &lt;xsl:param name="method" select="$chunker.output.method"/&gt;
    &lt;xsl:param name="encoding" select="$chunker.output.encoding"/&gt;
    &lt;xsl:param name="indent" select="$chunker.output.indent"/&gt;
    &lt;xsl:param name="omit-xml-declaration"
      select="$chunker.output.omit-xml-declaration"/&gt;
    &lt;xsl:param name="standalone" select="$chunker.output.standalone"/&gt;
    &lt;xsl:param name="doctype-public"
      select="$chunker.output.doctype-public"/&gt;
    &lt;xsl:param name="doctype-system"
      select="$chunker.output.doctype-system"/&gt;
    &lt;xsl:param name="media-type" select="$chunker.output.media-type"/&gt;
    &lt;xsl:param name="cdata-section-elements"
      select="$chunker.output.cdata-section-elements"/&gt;

    &lt;xsl:param name="content"/&gt;

    &lt;xsl:if test="$quiet = 0"&gt;
      &lt;xsl:message&gt;
        &lt;xsl:if test="not($message-prolog = '')"&gt;
          &lt;xsl:value-of select="$message-prolog"/&gt;
        &lt;/xsl:if&gt;
        &lt;xsl:text&gt;Writing &lt;/xsl:text&gt;
        &lt;xsl:value-of select="$filename"/&gt;
        &lt;xsl:if test="name(.) != '' and $suppress-context-node-name = 0"&gt;
          &lt;xsl:text&gt; for &lt;/xsl:text&gt;
          &lt;xsl:value-of select="name(.)"/&gt;
          &lt;xsl:if test="@id or @xml:id"&gt;
            &lt;xsl:text&gt;(&lt;/xsl:text&gt;
            &lt;xsl:value-of select="(@id|@xml:id)[1]"/&gt;
            &lt;xsl:text&gt;)&lt;/xsl:text&gt;
          &lt;/xsl:if&gt;
        &lt;/xsl:if&gt;
        &lt;xsl:if test="not($message-epilog = '')"&gt;
          &lt;xsl:value-of select="$message-epilog"/&gt;
        &lt;/xsl:if&gt;
      &lt;/xsl:message&gt;
    &lt;/xsl:if&gt;

    &lt;xsl:choose&gt;
      &lt;xsl:when test="element-available('exsl:document')"&gt;
        &lt;xsl:choose&gt;
          &lt;!-- Handle the permutations ... --&gt;
          &lt;xsl:when test="$media-type != ''"&gt;
            &lt;xsl:choose&gt;
              &lt;xsl:when
                test="$doctype-public != '' and $doctype-system != ''"&gt;
                &lt;exsl:document href="{$filename}" method="{$method}"
                  encoding="{$encoding}" indent="{$indent}"
                  omit-xml-declaration="{$omit-xml-declaration}"
                  cdata-section-elements="{$cdata-section-elements}"
                  media-type="{$media-type}"
                  doctype-public="{$doctype-public}"
                  doctype-system="{$doctype-system}"
                  standalone="{$standalone}"&gt;
                  &lt;xsl:copy-of select="$content"/&gt;
                &lt;/exsl:document&gt;
              &lt;/xsl:when&gt;
              &lt;xsl:when
                test="$doctype-public != '' and $doctype-system = ''"&gt;
                &lt;exsl:document href="{$filename}" method="{$method}"
                  encoding="{$encoding}" indent="{$indent}"
                  omit-xml-declaration="{$omit-xml-declaration}"
                  cdata-section-elements="{$cdata-section-elements}"
                  media-type="{$media-type}"
                  doctype-public="{$doctype-public}"
                  standalone="{$standalone}"&gt;
                  &lt;xsl:copy-of select="$content"/&gt;
                &lt;/exsl:document&gt;
              &lt;/xsl:when&gt;
              &lt;xsl:when
                test="$doctype-public = '' and $doctype-system != ''"&gt;
                &lt;exsl:document href="{$filename}" method="{$method}"
                  encoding="{$encoding}" indent="{$indent}"
                  omit-xml-declaration="{$omit-xml-declaration}"
                  cdata-section-elements="{$cdata-section-elements}"
                  media-type="{$media-type}"
                  doctype-system="{$doctype-system}"
                  standalone="{$standalone}"&gt;
                  &lt;xsl:copy-of select="$content"/&gt;
                &lt;/exsl:document&gt;
              &lt;/xsl:when&gt;
              &lt;xsl:otherwise&gt;
                &lt;!-- $doctype-public = '' and $doctype-system = ''"&gt; --&gt;
                &lt;exsl:document href="{$filename}" method="{$method}"
                  encoding="{$encoding}" indent="{$indent}"
                  omit-xml-declaration="{$omit-xml-declaration}"
                  cdata-section-elements="{$cdata-section-elements}"
                  media-type="{$media-type}" standalone="{$standalone}"&gt;
                  &lt;xsl:copy-of select="$content"/&gt;
                &lt;/exsl:document&gt;
              &lt;/xsl:otherwise&gt;
            &lt;/xsl:choose&gt;
          &lt;/xsl:when&gt;
          &lt;xsl:otherwise&gt;
            &lt;xsl:choose&gt;
              &lt;xsl:when
                test="$doctype-public != '' and $doctype-system != ''"&gt;
                &lt;exsl:document href="{$filename}" method="{$method}"
                  encoding="{$encoding}" indent="{$indent}"
                  omit-xml-declaration="{$omit-xml-declaration}"
                  cdata-section-elements="{$cdata-section-elements}"
                  doctype-public="{$doctype-public}"
                  doctype-system="{$doctype-system}"
                  standalone="{$standalone}"&gt;
                  &lt;xsl:copy-of select="$content"/&gt;
                &lt;/exsl:document&gt;
              &lt;/xsl:when&gt;
              &lt;xsl:when
                test="$doctype-public != '' and $doctype-system = ''"&gt;
                &lt;exsl:document href="{$filename}" method="{$method}"
                  encoding="{$encoding}" indent="{$indent}"
                  omit-xml-declaration="{$omit-xml-declaration}"
                  cdata-section-elements="{$cdata-section-elements}"
                  doctype-public="{$doctype-public}"
                  standalone="{$standalone}"&gt;
                  &lt;xsl:copy-of select="$content"/&gt;
                &lt;/exsl:document&gt;
              &lt;/xsl:when&gt;
              &lt;xsl:when
                test="$doctype-public = '' and $doctype-system != ''"&gt;
                &lt;exsl:document href="{$filename}" method="{$method}"
                  encoding="{$encoding}" indent="{$indent}"
                  omit-xml-declaration="{$omit-xml-declaration}"
                  cdata-section-elements="{$cdata-section-elements}"
                  doctype-system="{$doctype-system}"
                  standalone="{$standalone}"&gt;
                  &lt;xsl:copy-of select="$content"/&gt;
                &lt;/exsl:document&gt;
              &lt;/xsl:when&gt;
              &lt;xsl:otherwise&gt;
                &lt;!-- $doctype-public = '' and $doctype-system = ''"&gt; --&gt;
                &lt;exsl:document href="{$filename}" method="{$method}"
                  encoding="{$encoding}" indent="{$indent}"
                  omit-xml-declaration="{$omit-xml-declaration}"
                  cdata-section-elements="{$cdata-section-elements}"
                  standalone="{$standalone}"&gt;
                  &lt;xsl:copy-of select="$content"/&gt;
                &lt;/exsl:document&gt;
              &lt;/xsl:otherwise&gt;
            &lt;/xsl:choose&gt;
          &lt;/xsl:otherwise&gt;
        &lt;/xsl:choose&gt;
      &lt;/xsl:when&gt;

      &lt;xsl:when test="element-available('saxon:output')"&gt;
        &lt;xsl:choose&gt;
          &lt;!-- Handle the permutations ... --&gt;
          &lt;xsl:when test="$media-type != ''"&gt;
            &lt;xsl:choose&gt;
              &lt;xsl:when
                test="$doctype-public != '' and $doctype-system != ''"&gt;
                &lt;saxon:output
                  saxon:character-representation="{$saxon.character.representation}"
                  href="{$filename}" method="{$method}"
                  encoding="{$encoding}" indent="{$indent}"
                  omit-xml-declaration="{$omit-xml-declaration}"
                  cdata-section-elements="{$cdata-section-elements}"
                  media-type="{$media-type}"
                  doctype-public="{$doctype-public}"
                  doctype-system="{$doctype-system}"
                  standalone="{$standalone}"&gt;
                  &lt;xsl:copy-of select="$content"/&gt;
                &lt;/saxon:output&gt;
              &lt;/xsl:when&gt;
              &lt;xsl:when
                test="$doctype-public != '' and $doctype-system = ''"&gt;
                &lt;saxon:output
                  saxon:character-representation="{$saxon.character.representation}"
                  href="{$filename}" method="{$method}"
                  encoding="{$encoding}" indent="{$indent}"
                  omit-xml-declaration="{$omit-xml-declaration}"
                  cdata-section-elements="{$cdata-section-elements}"
                  media-type="{$media-type}"
                  doctype-public="{$doctype-public}"
                  standalone="{$standalone}"&gt;
                  &lt;xsl:copy-of select="$content"/&gt;
                &lt;/saxon:output&gt;
              &lt;/xsl:when&gt;
              &lt;xsl:when
                test="$doctype-public = '' and $doctype-system != ''"&gt;
                &lt;saxon:output
                  saxon:character-representation="{$saxon.character.representation}"
                  href="{$filename}" method="{$method}"
                  encoding="{$encoding}" indent="{$indent}"
                  omit-xml-declaration="{$omit-xml-declaration}"
                  cdata-section-elements="{$cdata-section-elements}"
                  media-type="{$media-type}"
                  doctype-system="{$doctype-system}"
                  standalone="{$standalone}"&gt;
                  &lt;xsl:copy-of select="$content"/&gt;
                &lt;/saxon:output&gt;
              &lt;/xsl:when&gt;
              &lt;xsl:otherwise&gt;
                &lt;!-- $doctype-public = '' and $doctype-system = ''"&gt; --&gt;
                &lt;saxon:output
                  saxon:character-representation="{$saxon.character.representation}"
                  href="{$filename}" method="{$method}"
                  encoding="{$encoding}" indent="{$indent}"
                  omit-xml-declaration="{$omit-xml-declaration}"
                  cdata-section-elements="{$cdata-section-elements}"
                  media-type="{$media-type}" standalone="{$standalone}"&gt;
                  &lt;xsl:copy-of select="$content"/&gt;
                &lt;/saxon:output&gt;
              &lt;/xsl:otherwise&gt;
            &lt;/xsl:choose&gt;
          &lt;/xsl:when&gt;
          &lt;xsl:otherwise&gt;
            &lt;xsl:choose&gt;
              &lt;xsl:when
                test="$doctype-public != '' and $doctype-system != ''"&gt;
                &lt;saxon:output
                  saxon:character-representation="{$saxon.character.representation}"
                  href="{$filename}" method="{$method}"
                  encoding="{$encoding}" indent="{$indent}"
                  omit-xml-declaration="{$omit-xml-declaration}"
                  cdata-section-elements="{$cdata-section-elements}"
                  doctype-public="{$doctype-public}"
                  doctype-system="{$doctype-system}"
                  standalone="{$standalone}"&gt;
                  &lt;xsl:copy-of select="$content"/&gt;
                &lt;/saxon:output&gt;
              &lt;/xsl:when&gt;
              &lt;xsl:when
                test="$doctype-public != '' and $doctype-system = ''"&gt;
                &lt;saxon:output
                  saxon:character-representation="{$saxon.character.representation}"
                  href="{$filename}" method="{$method}"
                  encoding="{$encoding}" indent="{$indent}"
                  omit-xml-declaration="{$omit-xml-declaration}"
                  cdata-section-elements="{$cdata-section-elements}"
                  doctype-public="{$doctype-public}"
                  standalone="{$standalone}"&gt;
                  &lt;xsl:copy-of select="$content"/&gt;
                &lt;/saxon:output&gt;
              &lt;/xsl:when&gt;
              &lt;xsl:when
                test="$doctype-public = '' and $doctype-system != ''"&gt;
                &lt;saxon:output
                  saxon:character-representation="{$saxon.character.representation}"
                  href="{$filename}" method="{$method}"
                  encoding="{$encoding}" indent="{$indent}"
                  omit-xml-declaration="{$omit-xml-declaration}"
                  cdata-section-elements="{$cdata-section-elements}"
                  doctype-system="{$doctype-system}"
                  standalone="{$standalone}"&gt;
                  &lt;xsl:copy-of select="$content"/&gt;
                &lt;/saxon:output&gt;
              &lt;/xsl:when&gt;
              &lt;xsl:otherwise&gt;
                &lt;!-- $doctype-public = '' and $doctype-system = ''"&gt; --&gt;
                &lt;saxon:output
                  saxon:character-representation="{$saxon.character.representation}"
                  href="{$filename}" method="{$method}"
                  encoding="{$encoding}" indent="{$indent}"
                  omit-xml-declaration="{$omit-xml-declaration}"
                  cdata-section-elements="{$cdata-section-elements}"
                  standalone="{$standalone}"&gt;
                  &lt;xsl:copy-of select="$content"/&gt;
                &lt;/saxon:output&gt;
              &lt;/xsl:otherwise&gt;
            &lt;/xsl:choose&gt;
          &lt;/xsl:otherwise&gt;
        &lt;/xsl:choose&gt;
      &lt;/xsl:when&gt;

      &lt;xsl:when test="element-available('redirect:write')"&gt;
        &lt;!-- Xalan uses redirect --&gt;
        &lt;redirect:write file="{$filename}"&gt;
          &lt;xsl:copy-of select="$content"/&gt;
        &lt;/redirect:write&gt;
      &lt;/xsl:when&gt;

      &lt;xsl:otherwise&gt;
        &lt;!-- it doesn't matter since we won't be making chunks... --&gt;
        &lt;xsl:message terminate="yes"&gt;
          &lt;xsl:text&gt;Can't make chunks with &lt;/xsl:text&gt;
          &lt;xsl:value-of select="system-property('xsl:vendor')"/&gt;
          &lt;xsl:text&gt;'s processor.&lt;/xsl:text&gt;
        &lt;/xsl:message&gt;
      &lt;/xsl:otherwise&gt;
    &lt;/xsl:choose&gt;
  &lt;/xsl:template&gt;

  &lt;xsl:template name="write.xml.chunk"&gt;
    &lt;xsl:param name="filename" select="''"/&gt;
    &lt;xsl:param name="quiet" select="$chunker.output.quiet"/&gt;
    &lt;xsl:param name="suppress-context-node-name" select="0"/&gt;
    &lt;xsl:param name="message-prolog"/&gt;
    &lt;xsl:param name="message-epilog"/&gt;
    &lt;xsl:param name="method" select="'xml'"/&gt;
    &lt;xsl:param name="encoding" select="$chunker.output.encoding"/&gt;
    &lt;xsl:param name="media-type" select="$chunker.output.media-type"/&gt;
    &lt;xsl:param name="content"/&gt;
    &lt;xsl:call-template name="write.chunk"&gt;
      &lt;xsl:with-param name="filename" select="$filename"/&gt;
      &lt;xsl:with-param name="quiet" select="$quiet"/&gt;
      &lt;xsl:with-param name="suppress-context-node-name"
        select="$suppress-context-node-name"/&gt;
      &lt;xsl:with-param name="message-prolog" select="$message-prolog"/&gt;
      &lt;xsl:with-param name="message-epilog" select="$message-epilog"/&gt;
      &lt;xsl:with-param name="method" select="$method"/&gt;
      &lt;xsl:with-param name="encoding" select="$encoding"/&gt;
      &lt;xsl:with-param name="indent" select="'yes'"/&gt;
      &lt;xsl:with-param name="omit-xml-declaration" select="'no'"/&gt;
      &lt;xsl:with-param name="standalone" select="'no'"/&gt;
      &lt;xsl:with-param name="doctype-public"/&gt;
      &lt;xsl:with-param name="doctype-system"/&gt;
      &lt;xsl:with-param name="media-type" select="$media-type"/&gt;
      &lt;xsl:with-param name="cdata-section-elements"/&gt;
      &lt;xsl:with-param name="content" select="$content"/&gt;
    &lt;/xsl:call-template&gt;
  &lt;/xsl:template&gt;
&lt;/xsl:stylesheet&gt;
</programlisting>
      </example>
      <para>It can be customized with several parameters:</para>
      <variablelist>
        <varlistentry>
          <term><parameter>base.dir</parameter></term>
          <listitem>
            <para>Determines the output directory</para>
          </listitem>
        </varlistentry>
        <varlistentry>
          <term><parameter>dbsplit.chunk.depth</parameter></term>
          <listitem>
            <para>Controls the depth where to split </para>
          </listitem>
        </varlistentry>
        <varlistentry>
          <term><parameter>dbsplit.ext</parameter></term>
          <listitem>
            <para>Defines the file extension for each filename written.</para>
          </listitem>
        </varlistentry>
        <varlistentry>
          <term><parameter>dbsplit.root.filename</parameter></term>
          <listitem>
            <para>Identifies the name of the root filename when splitted 
            </para>
          </listitem>
        </varlistentry>
        <varlistentry>
          <term><parameter>use.id.as.filename</parameter></term>
          <listitem>
            <para>Uses ID values as filenames</para>
          </listitem>
        </varlistentry>
        <varlistentry>
          <term><parameter>rootid</parameter></term>
          <listitem>
            <para>Specify the root element to split</para>
          </listitem>
        </varlistentry>
      </variablelist>
    </section>
    <section xml:id="sec.structure.splitdb.dbsplit">
      <title>Splitting with the <command>dbautosplit</command></title>
      <para>The <command>dbautosplit</command> command is a <link xlink:href="http://www.perl.org">Perl</link> script which
        is only be available in <link xlink:href="http://www.opensuse.org">openSUSE Linux</link>
        distribution. As such, you can <link xlink:href="http://software.opensuse.org/package/dbsplit-tools?search_term=dbsplit-tools">search
          for the command <command>dbautosplit</command></link> or
        download it from <link xlink:href="http://rpmfind.net/linux/rpm2html/search.php?query=dbautosplit"/>.        
        Additionaly it needs the <package>XML-DOM</package> and
          <package>XML-RegExp</package> packages. Download and install
        these package from <link xlink:href="http://www.cpan.org">CPAN</link>, the Comprehensive Perl Archive Network, before
        you proceed.</para>
      <para>For example, if you have a book with a preface and five
        chapters, use the following command to split it:</para>
      <screen><command>dbautosplit</command> --level 1 MyBook.xml</screen>
      <para>It will generate this output:</para>
      <screen>Creating file : out/preface-01/index.xml
Creating file : out/chapter-01/index.xml
Creating file : out/chapter-02/index.xml
Creating file : out/chapter-03/index.xml
Creating file : out/chapter-04/index.xml
Creating file : out/chapter-05/index.xml
Creating file : out/index.xml</screen>
      <para>By default, <command>dbautosplit</command> creates an
        <filename class="directory">out/</filename> directory. Each
        preface and chapter is stored in a separate subdirectory, named
        <filename class="directory">preface</filename> or
        <filename class="directory">chapter</filename> and with a
        consecutive number. The book itself is saved with
        <tag>xi:include</tag> elements in
        <filename>out/index.xml</filename>.</para>
      <para>You can change the output behavior by using a template system
        similar to <function>printf</function> function (see manpage).
        If you want to name the chapters by their <tag class="attribute">xml:id</tag> attribute, use the following
        commandline:</para>
      <screen><command>dbautosplit</command> -l 1 -o "%attr(xml:id)%txt(.xml)"<!--
      --> MyBook.xml</screen>
      <para>A possible output could look like this:</para>
      <screen>Creating file : out/preface.xml
Creating file : out/markup.xml
Creating file : out/common.xml
Creating file : out/structure.xml
Creating file : out/fo.xml
Creating file : out/html.xml
Creating file : out/index.xml</screen>
      <para/>
    </section>
    
  </section>
  <section role="discussion">
    <title>Discussion</title>
    <para> The shown methods have both advantages and drawbacks.</para>
    <table>
      <title>Comparison of Splitting Method</title>
      <tgroup cols="4">
        <thead>
          <row>
            <entry/>
            <entry><filename>splitdb/chunker.xsl</filename></entry>
            <entry><command>dbautosplit</command></entry>
            <entry><filename>topic-maker-chunk.xsl</filename></entry>
          </row>
        </thead>
        <tbody>
          <row>
            <entry>Change Splitting Level?</entry>
            <entry>yes</entry>
            <entry>yes</entry>
            <entry>yes</entry>
          </row>
          <row>
            <entry>Special Support for Assemblies?</entry>
            <entry>no</entry>
            <entry>no</entry>
            <entry>yes</entry>
          </row>
          <row>
            <entry/>
          </row>
        </tbody>
      </tgroup>
    </table>
  </section>
  <section role="seealso">
    <title>See Also</title>
    <itemizedlist role="category">
      <!--<listitem>
        <para></para>
      </listitem>-->
    </itemizedlist>
  </section>
</section>
  <!--
    License CC BY-NC-SA 3.0
  
   This work is licensed under the 
   "Namensnennung – Keine kommerzielle Nutzung – Weitergabe unter
    gleichen Bedingungen 3.0 Deutschland (CC BY-NC-SA 3.0)" 
   http://creativecommons.org/licenses/by-nc-sa/3.0/de/deed.de
   
   Read the English translation here:
   
   "Attribution-NonCommercial-ShareAlike 3.0 Unported (CC BY-NC-SA 3.0)" 
   http://creativecommons.org/licenses/by-nc-sa/3.0/
   
--><!--<?xml-model href="file:../5.1/dbref.rnc" type="application/relax-ng-compact-syntax"?>--><section xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="dbc.structure.extract" remap="topic" userlevel="easy" xml:base="structure/topic.extract-element.xml">
  <title>Extracting One Element from DocBook Document</title>
  <info>
    <definitions definitionfile="defs.xml"/>
    <keywordset>
      <keyword>extracting one element</keyword>
      <keyword>rootid</keyword>
      <keyword>xref</keyword>
      <keyword>cross-references</keyword>
    </keywordset>
    <subjectset>
      <subject>
        <subjectterm>rootid</subjectterm>
      </subject>
    </subjectset>
  </info>
  
  <section role="problem">
    <title>Problem</title>
    <para>You have a big DocBook document and you need to extract one
      structural element like a <tag>chapter</tag>, <tag>appendix</tag>
      etc. to edit or process it separately from the main document.</para>
  </section>
  <section role="solution">
    <title>Solution</title>
    <para>To make the solution work, the structural element needs an ID
    attribute. If this is available, use the following stylesheet:</para>
    <example xml:id="ex.rootid.xsl">
      <title>Extracting Stylesheet <filename>rootid.xsl</filename></title>
      <info>
        <output xmlns="urn:x-toms:docbook-ext">
          <filename>extract/rootid.xsl</filename>
        </output>
      </info>
      <programlisting linenumbering="numbered" language="xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;xsl:stylesheet version="1.0"
  xmlns:xsl="http://www.w3.org/1999/XSL/Transform"&gt;

  &lt;xsl:key name="id" match="*" use="@id|@xml:id"/&gt;
  &lt;!-- Contains the ID attribute of the extracted element: --&gt;
  &lt;xsl:param name="rootid"/&gt;
  &lt;!-- Controls some log messages: 0=off, 1=on --&gt;
  &lt;xsl:param name="rootid.debug" select="0"/&gt;

  &lt;xsl:template match="/"&gt;
    &lt;xsl:choose&gt;
      &lt;xsl:when test="$rootid !=''"&gt;
        &lt;xsl:if test="count(key('id',$rootid)) = 0"&gt;
          &lt;xsl:message terminate="yes"&gt;
            &lt;xsl:text&gt;ID '&lt;/xsl:text&gt;
            &lt;xsl:value-of select="$rootid"/&gt;
            &lt;xsl:text&gt;' not found in document.&lt;/xsl:text&gt;
          &lt;/xsl:message&gt;
        &lt;/xsl:if&gt;
        &lt;xsl:call-template name="rootid.debug.message"/&gt;
        &lt;xsl:call-template name="rootid.process"/&gt;
      &lt;/xsl:when&gt;
      &lt;xsl:otherwise&gt;
        &lt;xsl:call-template name="normal.process"/&gt;
      &lt;/xsl:otherwise&gt;
    &lt;/xsl:choose&gt;
  &lt;/xsl:template&gt;

  &lt;xsl:template name="rootid.debug.message"&gt;
    &lt;xsl:if test="$rootid.debug != 0"&gt;
      &lt;xsl:message&gt;
        &lt;xsl:text&gt;Using ID &lt;/xsl:text&gt;
        &lt;xsl:value-of select="concat('&amp;quot;', $rootid, '&amp;quot;')"/&gt;
      &lt;/xsl:message&gt;
    &lt;/xsl:if&gt;
  &lt;/xsl:template&gt;
  
  &lt;xsl:template name="rootid.process"&gt;
    &lt;xsl:apply-templates select="key('id',$rootid)" mode="process.root"/&gt;
  &lt;/xsl:template&gt;

  &lt;xsl:template name="normal.process"&gt;
    &lt;xsl:apply-templates/&gt;
  &lt;/xsl:template&gt;
  
  &lt;xsl:template match="node() | @*" mode="process.root"&gt;
    &lt;xsl:copy&gt;
      &lt;xsl:apply-templates select="@* | node()" mode="process.root"/&gt;
    &lt;/xsl:copy&gt;
  &lt;/xsl:template&gt;
&lt;/xsl:stylesheet&gt;</programlisting>
    </example>
    <para>Pass the <parameter>rootid</parameter> parameter to your XSLT
    processor with the corresponding ID, for example:</para>
    <screen><command>xsltproc</command> --stringparam rootid intro rootid.xsl <replaceable>XML_FILE</replaceable></screen>
    <para>The result contains only the element with the corresponding ID
      value and everything inside it.</para>
  </section>
  <section role="discussion">
    <title>Discussion</title>
    <para>This solution cuts off the element with the corresponding ID
      and copies the element itself and its children to the output
      stream. The copying is done in the <literal>process.root</literal>
      mode. The stylesheet does not apply any further processing. This can be a
      disadvantage, for example, a <tag>xref</tag> pointing outside of
      the respective element. If the resulting file contains such a
      cross reference, it will not be valid anymore.</para>
    <para>It is possible to convert such cross references into a
      <quote>resolved form</quote> by using the following code:</para>
    <example xml:id="ex.rootid-resolve-xrefs.xsl">
      <title><filename>rootid-resolve-xrefs.xsl</filename></title>
      <info>
        <output xmlns="urn:x-toms:docbook-ext">
          <filename>extract/rootid-resolve-xrefs.xsl</filename>
        </output>
      </info>
      <programlisting language="xml" linenumbering="numbered">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;xsl:stylesheet version="1.0"
  xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
  xmlns:xlink="http://www.w3.org/1999/xlink"
  xmlns:d="http://docbook.org/ns/docbook"&gt;
  
  &lt;xsl:import href="rootid.xsl"/&gt;
  
  &lt;xsl:template match="d:xref" mode="process.root"&gt;
    &lt;xsl:variable name="xhref" select="@xlink:href"/&gt;
    &lt;!-- is the @xlink:href a local idref link? --&gt;
    &lt;xsl:variable name="xlink.idref"&gt;
      &lt;xsl:choose&gt;
        &lt;xsl:when test="starts-with($xhref,'#')"&gt;
          &lt;xsl:value-of select="substring($xhref, 2)"/&gt;
        &lt;/xsl:when&gt;
        &lt;xsl:when test="contains($xhref, '://')"&gt;
         &lt;xsl:message&gt;
            &lt;xsl:text&gt;ERROR: Don't know what do do with @xlink:href: &lt;/xsl:text&gt;
            &lt;xsl:value-of select="$xhref"/&gt;&lt;/xsl:message&gt; 
        &lt;/xsl:when&gt;
        &lt;xsl:otherwise/&gt;
      &lt;/xsl:choose&gt;
    &lt;/xsl:variable&gt;
    &lt;xsl:variable name="xlink.targets" select="key('id',$xlink.idref)"/&gt;
    &lt;xsl:variable name="linkend.targets" select="key('id',@linkend)"/&gt;
    &lt;xsl:variable name="target" select="($xlink.targets | $linkend.targets)[1]"/&gt;
    &lt;xsl:variable name="refelem" select="local-name($target)"/&gt;
    
    &lt;xsl:variable name="this.div" 
      select="ancestor-or-self::d:*[@xml:id = $rootid][1]"/&gt;
    &lt;xsl:variable name="target.div"
      select="$target/ancestor-or-self::d:*[@xml:id = $rootid][1]"/&gt;

    &lt;xsl:choose&gt;
      &lt;xsl:when test="generate-id($this.div) = generate-id($target.div)"&gt;
        &lt;xsl:copy-of select="."/&gt;
      &lt;/xsl:when&gt;
      &lt;xsl:otherwise&gt;
        &lt;phrase xmlns="http://docbook.org/ns/docbook" remap="xref"&gt;
          &lt;xsl:choose&gt;
            &lt;xsl:when test="@linkend"&gt;
              &lt;xsl:attribute name="role"&gt;
                &lt;xsl:value-of select="@linkend"/&gt;
              &lt;/xsl:attribute&gt;
            &lt;/xsl:when&gt;
            &lt;xsl:when test="$xlink.idref != ''"&gt;
              &lt;xsl:attribute name="role"&gt;
                &lt;xsl:value-of select="$xlink.idref"/&gt;
              &lt;/xsl:attribute&gt;
            &lt;/xsl:when&gt;
            &lt;xsl:otherwise&gt;
              &lt;xsl:attribute name="role"&gt;
                &lt;xsl:value-of select="$xhref"/&gt;
              &lt;/xsl:attribute&gt;
            &lt;/xsl:otherwise&gt;
          &lt;/xsl:choose&gt;
          &lt;xsl:apply-templates
            select="@*[local-name() != 'linkend' and
                       local-name() != 'href']"
            mode="process.root"/&gt;
          &lt;xsl:apply-templates
            select="($target/ancestor-or-self::d:*[d:title])[last()]/d:title/node()"
            mode="process.root"/&gt;
        &lt;/phrase&gt;
      &lt;/xsl:otherwise&gt;
    &lt;/xsl:choose&gt;
  &lt;/xsl:template&gt;
&lt;/xsl:stylesheet&gt;
</programlisting>
    </example>
    <para>The stylesheet in <xref linkend="ex.rootid-resolve-xrefs.xsl"/> imports the
      <filename>rootid.xsl</filename> and inherits all templates. To
      implement a different behaviour we need to add a new template
      matching for the <tag>xref</tag> element in mode
      <literal>process.root</literal>.</para>
    <para>The template contains mostly code from the DocBook XSL
      stylesheets with some minor changes. The general behaviour is
      described in the following sequence:</para>
    <orderedlist>
      <listitem>
        <para>Make sure, everything is in place and a <tag class="attribute">xlink:href</tag> attribute does not contain
          a <literal>://</literal> string. If this is the case emit an
          error message.</para>
      </listitem>
      <listitem>
        <para>Populate the variables <varname>xlink.targets</varname>
          and <varname>linkend.targets</varname> with the target node.
          For <varname>xlink.targets</varname> use the XLink attribute <tag class="attribute">xlink:href</tag>, for the variable
          <varname>linkend.targets</varname> use the <tag class="attribute">linkend</tag>
          attribute. As only one of these attributes can be available,
          but not both, the variables are filled with zero nodes or
          more.</para>
      </listitem>
      <listitem>
        <para>Create the set union of the variables
            <varname>xlink.targets</varname> and
            <varname>linkend.targets</varname> and select only one node.
        </para>
      </listitem>
      <listitem>
        <para>Now it gets interesting: our context node is in
            <tag>xref</tag>. We need to know the node where  the value
          of the <tag class="attribute">xml:id</tag> attribute equals
          our <parameter>rootid</parameter> parameter. We climb up tree
          with the <function>ancestor-or-self</function> axis specifier
          and select every DocBook element. With the predicate
            <markup>[@xml:id = $rootid]</markup> the node set is
          filtered and only those element(s) are preserved where this
          expression is true. Only one node from the node set is
          selected.</para>
        <para>This is done also for the target node and the result is
          saved in the variable <varname>target.div</varname></para>
      </listitem>
      <listitem>
        <para>The two node from the previous operation are compared
          through the <function>generate-id</function> function. That
          leaves two options:</para>
        <itemizedlist>
          <listitem>
            <formalpara>
              <title>Both nodes are equal</title>
              <para>The <tag>xref</tag> points somewhere inside the tree
                under the <parameter>rootid</parameter> element. That
                means, we can copy the <tag>xref</tag> element.</para>
            </formalpara>
          </listitem>
          <listitem>
            <formalpara>
              <title>Both nodes are not equal</title>
              <para>The <tag>xref</tag> points outside of the
                  <parameter>rootid</parameter> element. That means, you
                need to <quote>resolve</quote> the <tag>xref</tag>
                element to prevent validation errors.</para>
            </formalpara>
          </listitem>
        </itemizedlist>
      </listitem>
      <listitem>
        <para>If the <tag>xref</tag> needs to be revamped, we use the
            <tag>phrase</tag> element, copy all attributes (except <tag class="attribute">linkend</tag> and <tag class="attribute">xlink:href</tag>), and copy anything inside the title of
          the target node. As the target node could not be a title
          itself, we use again the <function>ancestor-or-self</function>
          axis to climb up the tree and select the first emerging
          title.</para>
      </listitem>
    </orderedlist>
    
    <remark>TODO: Add graphic to illustrate the method</remark>
    
<!--    <programlisting language="xml" linenumbering="numbered"
>&lt;&#x21;&#x2d;&#x2d; From lib/lib.xsl &#x2d;&#x2d;>
&lt;xsl:template name="xpointer.idref">
  &lt;xsl:param name="xpointer">http://...&lt;/xsl:param>
  &lt;xsl:choose>
    &lt;xsl:when test="starts-with($xpointer, '#xpointer(id(')">
      &lt;xsl:variable name="rest"
         select="substring-after($xpointer, '#xpointer(id(')"/>
      &lt;xsl:variable name="quote" select="substring($rest, 1, 1)"/>
      &lt;xsl:value-of
         select="substring-before(substring-after($xpointer, $quote), $quote)"
        />
    &lt;/xsl:when>
    &lt;xsl:when test="starts-with($xpointer, '#')">
      &lt;xsl:value-of select="substring-after($xpointer, '#')"/>
    &lt;/xsl:when>
    &lt;&#x21;&#x2d;&#x2d; otherwise it's a pointer to some other document &#x2d;&#x2d;>
  &lt;/xsl:choose>
&lt;/xsl:template></programlisting>
-->
  </section>
  <section role="seealso">
    <title>See Also</title>
    <para><xref linkend="dbc.structure.splitdb"/> uses a different
      approach without needing an ID attribute.</para>
  </section>
</section>
  <!--
    License CC BY-NC-SA 3.0
  
   This work is licensed under the 
   "Namensnennung – Keine kommerzielle Nutzung – Weitergabe unter
    gleichen Bedingungen 3.0 Deutschland (CC BY-NC-SA 3.0)" 
   http://creativecommons.org/licenses/by-nc-sa/3.0/de/deed.de
   
   Read the English translation here:
   
   "Attribution-NonCommercial-ShareAlike 3.0 Unported (CC BY-NC-SA 3.0)" 
   http://creativecommons.org/licenses/by-nc-sa/3.0/
   
--><!--<?xml-model href="file:../5.1/dbref.rnc" type="application/relax-ng-compact-syntax"?>--><section xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="dbc.structure.sectX-to-section" remap="topic" userlevel="easy" xml:base="structure/topic.sectX-to-section.xml">
  <title>Transforming <tag>sectX</tag> Elements into <tag>section</tag> Elements</title>
  <info>
    <definitions definitionfile="defs.xml"/>
    <keywordset>
      <keyword>sectX</keyword>
      <keyword>section</keyword>
      <keyword>sectX to section</keyword>
    </keywordset>
  </info>
  
  <section>
    <title>Problem</title>
    <para>You need to transform every <tag>sectX</tag> element into a
        <tag>section</tag> element.</para>
  </section>
  <section>
    <title>Solution</title>
    <para>This problem is solved through the following XSLT stylesheet:</para>
    <example xml:id="ex.structure.sectX-to-section">
      <title>Transforms every <tag>sectX</tag> Element into a
          <tag>section</tag> Element</title>
      <info>
        <output xmlns="urn:x-toms:docbook-ext">
          <filename>sectX-to-section/db-sectX-to-section.xsl</filename>
        </output>
      </info>
      <programlisting linenumbering="numbered" language="xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;xsl:stylesheet version="1.0"
  xmlns:d="http://docbook.org/ns/docbook"
  xmlns:xsl="http://www.w3.org/1999/XSL/Transform"&gt;

  &lt;xsl:import href="copy.xsl"/&gt;
  
  &lt;xsl:template match="d:sect1|d:sect2|d:sect3|d:sect4|d:sect5"&gt;
    &lt;xsl:element name="section" namespace="http://docbook.org/ns/docbook"&gt;
      &lt;xsl:apply-templates select="node()"/&gt;
    &lt;/xsl:element&gt;
  &lt;/xsl:template&gt;
&lt;/xsl:stylesheet&gt;
</programlisting>
    </example>
  </section>
  <section>
    <title>Discussion</title>
    <para>The stylesheet from <xref linkend="ex.structure.sectX-to-section"/> is very easy: it
      imports the standard rules to copy every node from
        <filename>copy.xsl</filename> and create special rules for all
        <tag>sectX</tag> elements. As every <tag>sectX</tag> element
      creates the same structure, we can collect it in one template
      rule. </para>
  </section>
</section>
  <!--
    License CC BY-NC-SA 3.0
  
   This work is licensed under the 
   "Namensnennung – Keine kommerzielle Nutzung – Weitergabe unter
    gleichen Bedingungen 3.0 Deutschland (CC BY-NC-SA 3.0)" 
   http://creativecommons.org/licenses/by-nc-sa/3.0/de/deed.de
   
   Read the English translation here:
   
   "Attribution-NonCommercial-ShareAlike 3.0 Unported (CC BY-NC-SA 3.0)" 
   http://creativecommons.org/licenses/by-nc-sa/3.0/
   
--><!--<?xml-model href="file:../5.1/dbref.rnc" type="application/relax-ng-compact-syntax"?>--><section xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="dbc.structure.section-to-sectX" remap="topic" userlevel="easy" xml:base="structure/topic.section-to-sectX.xml">
  <title>Transforming <tag>section</tag> Elements into <tag>sectX</tag> Elements</title>
  <info>
    <definitions definitionfile="defs.xml"/>
    <keywordset>
      <keyword>sectX</keyword>
      <keyword>section</keyword>
      <keyword>section to sectX</keyword>
    </keywordset>
  </info>
  
  <section>
    <title>Problem</title>
    <para>You need to transform every <tag>sectX</tag> element into a
        <tag>section</tag> element.</para>
  </section>
  <section>
    <title>Solution</title>
    <para>This problem is solved through the following XSLT stylesheet:</para>
    <example xml:id="ex.structure.section-to-sectX">
      <title>Transforms every <tag>sectX</tag> Element into a
          <tag>section</tag> Element</title>
      <info>
        <output xmlns="urn:x-toms:docbook-ext">
          <filename>section-to-sectX/db-section-to-sectX.xsl</filename>
        </output>
      </info>
      <programlisting linenumbering="numbered" language="xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;xsl:stylesheet
  xmlns:d="http://docbook.org/ns/docbook"
  xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
  version="1.0"&gt;
  
  &lt;xsl:import href="copy.xsl"/&gt;
  
  &lt;xsl:template match="d:section"&gt;
    &lt;xsl:variable name="level" select="count(ancestor::*)"/&gt;
    &lt;xsl:element name="sect{$level}" namespace="http://docbook.org/ns/docbook"&gt;
      &lt;xsl:copy-of select="@*"/&gt;
      &lt;xsl:apply-templates/&gt;
    &lt;/xsl:element&gt;
  &lt;/xsl:template&gt;
  
&lt;/xsl:stylesheet&gt;</programlisting>
    </example>
  </section>
  <section>
    <title>Discussion</title>
    <para>The above stylesheet calculates the section level with the
        <function>ancestor</function> axis, because the amount of
      elements is directly correlated with the level of the
      corresponding section. With an <emphasis xlink:href="http://www.w3.org/TR/xslt#attribute-value-templates">attribute value template</emphasis> it is
      inserted in the <tag class="attribute">name</tag>
      attribute.</para>
    <para>There is one caveat: The stylesheet does not check if the
      limit is reached. Currently (with version 5.1), DocBook supports
      levels up to 5. If you nest your <tag>section</tag> elements too
      deep, you can end up with, let's say, <tag>sect8</tag> which
      is not allowed in DocBook. To avoid making 
      mistakes, it is better to check the level:</para>
    <example xml:id="ex.structure.sectX-to-section.check">
      <title>Error Checking of Section Levels</title>
      <programlisting linenumbering="numbered" language="xml">&lt;xsl:template match="d:section"&gt;
  &lt;xsl:variable name="level" select="count(ancestor::*)"/&gt;
  &lt;xsl:choose&gt;
    &lt;xsl:when test="$level &amp;lt;= 5"&gt;
      &lt;xsl:element name="sect{$level}"
          namespace="http://docbook.org/ns/docbook"&gt;
        &lt;xsl:copy-of select="@*"/&gt;
        &lt;xsl:apply-templates/&gt;
      &lt;/xsl:element&gt;
    &lt;/xsl:when&gt;
    &lt;xsl:otherwise&gt;
      &lt;xsl:message&gt;ERROR: section &lt;xsl:value-of
          select="normalize-space(d:title)"/&gt; to deep&lt;/xsl:message&gt;
      &lt;!-- What to do if the section is too deeply nested? --&gt;
    &lt;/xsl:otherwise&gt;
  &lt;/xsl:choose&gt;    
&lt;/xsl:template&gt;</programlisting>
    </example>
    <para>Amend the stylesheet when the section is too
      deeply nested (see above comment). You could avoid the section
      level (which is a bad idea) but it's better to rework the source
      document.</para>
    <para>If you want, you can stop the transformation if the section
      level is too high. Change the <tag>xsl:message</tag> as
      follows:</para>
    <programlisting language="xslt">&lt;xsl:message <emphasis role="strong">terminate="yes"</emphasis>&gt;...</programlisting>
  </section>
</section>
  <!--
    License CC BY-NC-SA 3.0
  
   This work is licensed under the 
   "Namensnennung – Keine kommerzielle Nutzung – Weitergabe unter
    gleichen Bedingungen 3.0 Deutschland (CC BY-NC-SA 3.0)" 
   http://creativecommons.org/licenses/by-nc-sa/3.0/de/deed.de
   
   Read the English translation here:
   
   "Attribution-NonCommercial-ShareAlike 3.0 Unported (CC BY-NC-SA 3.0)" 
   http://creativecommons.org/licenses/by-nc-sa/3.0/
   
--><!--<?xml-model href="file:../5.1/dbref.rnc" type="application/relax-ng-compact-syntax"?>--><section xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="dbc.structure.bridgehead-to-section" remap="topic" userlevel="hard" xml:base="structure/topic.bridgehead-to-section.xml">
  <title>Transforming <tag>bridgehead</tag> Elements into <tag>section</tag> Elements</title>
  <info>
    <definitions definitionfile="defs.xml"/>
    <keywordset>
      <keyword>bridgehead</keyword>
      <keyword>section</keyword>
    </keywordset>
  </info>
  
  <section role="problem">
    <title>Problem</title>
    <para>You have a DocBook document which contains several
      <tag>bridgehead</tag> elements. The <tag>bridgehead</tag> has to
      be transformed into the correct <tag>section</tag> structure.</para>
  </section>
  <section role="solution">
    <title>Solution</title>
    <para>A <tag>bridgehead</tag> element is a <quote>free-floating
        heading</quote>. In most cases it is a bad idea as it is
      difficult to handle in XSLT. To create the correct section
      hierarchy, a stylesheet need to collect all nodes between a
        <tag>bridgehead</tag> element and the next one. The following
      stylesheet uses a set difference method:</para>
    <example xml:id="ex.structure.bridgehead-to-section">
      <title>Transforms every <tag>bridgehead</tag> Element into
         a <tag>section</tag> Element</title>
      <info>
        <output xmlns="urn:x-toms:docbook-ext">
          <filename>bridgehead-to-section/db-bridgehead-to-section.xsl</filename>
        </output>
      </info>
      <programlisting linenumbering="numbered" language="xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;xsl:stylesheet version="1.0"  
  xmlns:d="http://docbook.org/ns/docbook"
  xmlns="http://docbook.org/ns/docbook"
  xmlns:xsl="http://www.w3.org/1999/XSL/Transform"&gt;
  
  &lt;xsl:import href="copy.xsl"/&gt;
  
  &lt;xsl:output indent="yes"/&gt;
  &lt;xsl:strip-space elements="*"/&gt;
  &lt;xsl:preserve-space elements="d:screen d:programlisting d:literallayout"/&gt;
  
  &lt;xsl:template match="d:section[d:bridgehead]"&gt;
    &lt;!-- All nodes inside our section: --&gt;
    &lt;xsl:variable name="node1" select="node()"/&gt;
    &lt;!-- All nodes --&gt;
    &lt;xsl:variable name="node2" 
      select="d:bridgehead[1]|
              d:bridgehead[1]/following-sibling::node()"/&gt;
    
    &lt;!-- Copy our section with all attributes, apply the set difference
      and investigate the first bridgehead 
    --&gt;
    &lt;xsl:copy&gt;
      &lt;xsl:copy-of select="@*"/&gt;
      &lt;xsl:apply-templates select="$node1[count(.|$node2) != count($node2)]"/&gt;
      &lt;xsl:apply-templates select="d:bridgehead[1]"/&gt;
    &lt;/xsl:copy&gt;
    &lt;xsl:text&gt;&amp;#10;&lt;/xsl:text&gt;
  &lt;/xsl:template&gt;
  
  &lt;xsl:template match="d:bridgehead"&gt;
    &lt;!-- All nodes who follow bridgeheads: --&gt;
    &lt;xsl:variable name="node1" 
      select="following-sibling::node()"/&gt;
    &lt;!-- All nodes who follow the next bridgehead including the next
         bridgehead.
         The next bridgehead element is included as we don't want it
         in the set difference:
    --&gt;
    &lt;xsl:variable name="node2"
      select="following-sibling::d:bridgehead[1]|
              following-sibling::d:bridgehead[1]/following-sibling::node()"/&gt;   

    &lt;!-- Create the section element with all attributes and apply
      standard rules for the diff set --&gt;
    &lt;xsl:element name="section"&gt;
      &lt;xsl:copy-of select="@*"/&gt;
      &lt;xsl:text&gt;&amp;#10;  &lt;/xsl:text&gt;
      &lt;xsl:element name="title"&gt;
        &lt;xsl:apply-templates select="node()"/&gt;
      &lt;/xsl:element&gt;
      &lt;xsl:apply-templates select="$node1[count(.|$node2) != count($node2)]"/&gt;
    &lt;/xsl:element&gt;
    
    &lt;!-- Process the next bridgehead --&gt;
    &lt;xsl:apply-templates select="following-sibling::d:bridgehead[1]"/&gt;
  &lt;/xsl:template&gt;
  
&lt;/xsl:stylesheet&gt;</programlisting>
    </example>
  </section>
  <section role="discussion">
    <title>Discussion</title>
    <para>The solution is unfortunately not very trivial in XSLT 1.0.
      The template rule <code>d:section[d:bridgehead]</code> matches
      only <tag>section</tag>s which contain one or more
        <tag>bridgehead</tag> elements.
      <!--This might speed up the stylesheet a little bit.--> The
      template rule performs the following steps:</para>
    <orderedlist>
      <listitem>
        <para>Collect all nodes inside a <tag>section</tag> and save it
          in variable <varname>node1</varname>.</para>
      </listitem>
      <listitem>
        <para>Collect all nodes who follows the next
            <tag>bridgehead</tag> including the next
            <tag>bridgehead</tag> itself and save it in variable
            <varname>node2</varname>.</para>
      </listitem>
      <listitem>
        <para>Creates a <tag>section</tag> element and copy all
          attributes from the <tag>bridgehead</tag> element.</para>
      </listitem>
      <listitem>
        <para>Creates a <tag>title</tag> element and apply the content
          from the <tag>bridgehead</tag> element. This copies the
          content from <tag>bridgehead</tag>.</para>
      </listitem>
      <listitem>
        <para>Calculates the set difference between
            <varname>node1</varname> and <varname>node2</varname>. This
          weird expression is needed in XSLT 1.0 to create a node set
          which contains only those nodes up to the first
            <tag>bridgehead</tag>.</para>
      </listitem>
      <listitem>
        <para>Handle the first <tag>bridgehead</tag> element which is
          covered by our <tag>bridgehead</tag> template rule.</para>
      </listitem>
    </orderedlist>
    <para>The <tag>bridgehead</tag> template rule is responsible for
      transforming the current <tag>bridgehead</tag> element into a
        <tag>section</tag>. It is also responsible for the next
        <tag>bridgehead</tag>s. The rule performs the following
      steps:</para>
    <orderedlist>
      <listitem>
        <para>Collect all nodes following of the current
            <tag>bridgehead</tag> element and save it in variable
            <varname>node1</varname>.</para>
      </listitem>
      <listitem>
        <para>Collect all nodes following of the next
            <tag>bridgehead</tag> element including the next
            <tag>bridgehead</tag> element itself. Save the node set in
          variable <varname>node2</varname>.</para>
      </listitem>
      <listitem>
        <para>Creates a <tag>section</tag> element and copy all
          attributes from the <tag>bridgehead</tag> element.</para>
      </listitem>
      <listitem>
        <para>Creates a <tag>title</tag> element and apply the content
          from the <tag>bridgehead</tag> element. This copies the
          content from <tag>bridgehead</tag>.</para>
      </listitem>
      <listitem>
        <para>Calculate the set difference between
            <varname>node1</varname> and <varname>node2</varname> and
          apply the correct template rule (usually they are just
          copied).</para>
      </listitem>
      <listitem>
        <para>Close the <tag>section</tag> element and handle the next
            <tag>bridgehead</tag> element.</para>
      </listitem>
    </orderedlist>
  </section>
  <!--<section role="seealso">
    <title>See Also</title>
    <para></para>
  </section>-->
</section>
  <!--
    License CC BY-NC-SA 3.0
  
   This work is licensed under the 
   "Namensnennung – Keine kommerzielle Nutzung – Weitergabe unter
    gleichen Bedingungen 3.0 Deutschland (CC BY-NC-SA 3.0)" 
   http://creativecommons.org/licenses/by-nc-sa/3.0/de/deed.de
   
   Read the English translation here:
   
   "Attribution-NonCommercial-ShareAlike 3.0 Unported (CC BY-NC-SA 3.0)" 
   http://creativecommons.org/licenses/by-nc-sa/3.0/
   
--><!--<?xml-model href="file:../5.1/dbref.rnc" type="application/relax-ng-compact-syntax"?>--><section xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="dbc.structure.move-blocks-in-para" remap="topic" userlevel="hard" xml:base="structure/topic.move-blocks-in-para.xml">
  <title>Moving Block Elements Outside of Paragraphs</title>
  <info>
    <keywordset>
      <keyword>block elements</keyword>
      <keyword>inline elements</keyword>
    </keywordset>
    <authorgroup>
      <othercredit>
        <personname>
          <firstname>Jeni</firstname>
          <surname>Tennison</surname>
        </personname>
      </othercredit>
      <othercredit>
        <personname>
          <firstname>Dave</firstname>
          <surname>Pawson</surname>
        </personname>
        <uri>http://www.dpawson.co.uk/xsl/sect2/N4486.html#d5509e529</uri>
      </othercredit>
    </authorgroup>    
    <definitions definitionfile="defs.xml"/>
  </info>
  
  <section role="problem">
    <title>Problem</title>
    <para>DocBook allows to insert block elements like
      <tag>example</tag>, <tag>figure</tag>, etc. to be inserted in
      <tag>para</tag>s. This is sometimes hard to process with XSLT and
      you want to move those block elements outside of your paragraph.
      After this modification, the paragraph contains only text and
      inline elements (like <tag>simpara</tag>).</para>
  </section>
  <section role="solution">
    <title>Solution</title>
    <para>The solution explained</para>
    <example xml:id="ex.structure.move-blocks-in-para">
      <title><filename>move-blocks-outof-para.xsl</filename></title>
      <info>
        <output xmlns="urn:x-toms:docbook-ext">
          <filename>remove-blocks-in-para/move-blocks-outof-para.xsl</filename>
        </output>
      </info>
      <programlisting language="xml" linenumbering="numbered">&lt;!DOCTYPE xsl:stylesheet
[
 &lt;!ENTITY dbblocks "d:address|d:bibliolist|d:blockquote|d:bridgehead|d:calloutlist|d:caution|d:classsynopsis|d:cmdsynopsis|d:constraintdef|d:constructorsynopsis|d:destructorsynopsis|d:epigraph|d:equation|d:example|d:fieldsynopsis|d:figure|d:funcsynopsis|d:glosslist|d:important|d:informalexample|d:informalfigure|d:informaltable|d:itemizedlist|d:literallayout|d:mediaobject|d:methodsynopsis|d:msgset|d:note|d:orderedlist|d:procedure|d:procedure|d:productionset|d:programlisting|d:programlistingco|d:qandaset|d:revhistory|d:screen|d:screenco|d:screenshot|d:segmentedlist|d:sidebar|d:simplelist|d:synopsis|d:table|d:task|d:tip|d:variablelist|d:warning"&gt;
 &lt;!ENTITY dbselfblocks "self::d:address|self::d:bibliolist|self::d:blockquote|self::d:bridgehead|self::d:calloutlist|self::d:caution|self::d:classsynopsis|self::d:cmdsynopsis|self::d:constraintdef|self::d:constructorsynopsis|self::d:destructorsynopsis|self::d:epigraph|self::d:equation|self::d:example|self::d:fieldsynopsis|self::d:figure|self::d:funcsynopsis|self::d:glosslist|self::d:important|self::d:informalexample|self::d:informalfigure|self::d:informaltable|self::d:itemizedlist|self::d:literallayout|self::d:mediaobject|self::d:methodsynopsis|self::d:msgset|self::d:note|self::d:orderedlist|self::d:procedure|self::d:procedure|self::d:productionset|self::d:programlisting|self::d:programlistingco|self::d:qandaset|self::d:revhistory|self::d:screen|self::d:screenco|self::d:screenshot|self::d:segmentedlist|self::d:sidebar|self::d:simplelist|self::d:synopsis|self::d:table|self::d:task|self::d:tip|self::d:variablelist|self::d:warning"&gt;
 &lt;!ENTITY dbblocksinpara "d:para/d:address|d:para/d:bibliolist|d:para/d:blockquote|d:para/d:bridgehead|d:para/d:calloutlist|d:para/d:caution|d:para/d:classsynopsis|d:para/d:cmdsynopsis|d:para/d:constraintdef|d:para/d:constructorsynopsis|d:para/d:destructorsynopsis|d:para/d:epigraph|d:para/d:equation|d:para/d:example|d:para/d:fieldsynopsis|d:para/d:figure|d:para/d:funcsynopsis|d:para/d:glosslist|d:para/d:important|d:para/d:informalexample|d:para/d:informalfigure|d:para/d:informaltable|d:para/d:itemizedlist|d:para/d:literallayout|d:para/d:mediaobject|d:para/d:methodsynopsis|d:para/d:msgset|d:para/d:note|d:para/d:orderedlist|d:para/d:procedure|d:para/d:procedure|d:para/d:productionset|d:para/d:programlisting|d:para/d:programlistingco|d:para/d:qandaset|d:para/d:revhistory|d:para/d:screen|d:para/d:screenco|d:para/d:screenshot|d:para/d:segmentedlist|d:para/d:sidebar|d:para/d:simplelist|d:para/d:synopsis|d:para/d:table|d:para/d:task|d:para/d:tip|d:para/d:variablelist|d:para/d:warning"&gt;
]&gt;
&lt;xsl:stylesheet xmlns:d="http://docbook.org/ns/docbook"
  xmlns="http://docbook.org/ns/docbook"
  xmlns:xsl="http://www.w3.org/1999/XSL/Transform" version="1.0"&gt;

  &lt;xsl:import href="copy.xsl"/&gt;

  &lt;xsl:strip-space elements="d:para"/&gt;
  &lt;xsl:preserve-space elements="d:screen d:programlisting d:literallayout"/&gt;
  &lt;xsl:output indent="yes"/&gt;

  &lt;xsl:template match="d:para"&gt;
    &lt;xsl:apply-templates select="node()[1]"/&gt;
  &lt;/xsl:template&gt;

  &lt;xsl:template match="&amp;dbblocksinpara;"&gt;
    &lt;xsl:copy-of select="."/&gt;
    &lt;xsl:text&gt;&amp;#10;&lt;/xsl:text&gt;
    &lt;xsl:apply-templates select="following-sibling::node()[1]"/&gt;
  &lt;/xsl:template&gt;

  &lt;xsl:template match="d:para/*|d:para/text()"&gt;
    &lt;xsl:element name="{local-name(..)}"&gt;
      &lt;xsl:apply-templates select="." mode="copy"/&gt;
    &lt;/xsl:element&gt;
    &lt;xsl:text&gt;&amp;#10;&lt;/xsl:text&gt;
    &lt;xsl:apply-templates
      select="following-sibling::*[&amp;dbselfblocks;][1]"/&gt;
  &lt;/xsl:template&gt;

  &lt;xsl:template match="d:para/node()" mode="copy"&gt;
    &lt;xsl:copy-of select="."/&gt;
    &lt;xsl:if test="not(following-sibling::node()[1][&amp;dbselfblocks;])"&gt;
      &lt;xsl:apply-templates select="following-sibling::node()[1]"
        mode="copy"/&gt;
    &lt;/xsl:if&gt;
  &lt;/xsl:template&gt;

&lt;/xsl:stylesheet&gt;</programlisting>
    </example>
  </section>
  <section role="discussion">
    <title>Discussion</title>
    <para><remark>TBD</remark></para>
  </section>
  <!--<section role="seealso">
    <title>See Also</title>
    <para></para>
  </section>-->
</section>
  <!--
    License CC BY-NC-SA 3.0
  
   This work is licensed under the 
   "Namensnennung – Keine kommerzielle Nutzung – Weitergabe unter
    gleichen Bedingungen 3.0 Deutschland (CC BY-NC-SA 3.0)" 
   http://creativecommons.org/licenses/by-nc-sa/3.0/de/deed.de
   
   Read the English translation here:
   
   "Attribution-NonCommercial-ShareAlike 3.0 Unported (CC BY-NC-SA 3.0)" 
   http://creativecommons.org/licenses/by-nc-sa/3.0/
   
--><!--<?xml-model href="file:../5.1/dbref.rnc" type="application/relax-ng-compact-syntax"?>--><section xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="dbc.structure.adding-indexterms" remap="topic" userlevel="medium" xml:base="structure/topic.adding-indexterms.xml">
  <title>Adding Index Entries (Semi-)Automatically</title>
  <info>
    <definitions definitionfile="defs.xml"/>
    <keywordset>
      <keyword>index</keyword>
      <keyword>automatically insert indices</keyword>
      <keyword>consistency</keyword>
    </keywordset>
    <subjectset>
      <subject>
        <subjectterm>profiling</subjectterm>
        <subjectterm>index</subjectterm>
      </subject>
    </subjectset>
  </info>
  
  <section role="problem">
    <title>Problem</title>
    <para>You want to add index entries (using the
        <tag>indexterm</tag> element) automatically and consistently into your document. </para>
  </section>
  <section role="solution">
    <title>Solution</title>
    <para>To see how the automatic addition works, the following
      procedure demonstrate this for the element
      <tag>envar</tag>.</para>
    
    <procedure xml:id="pro.structure.adding-indexterms">
      <title>Adding <tag>indexterm</tag> Elements to <tag>envar</tag></title>
      <step>
        <para>Use the element <tag>envar</tag> in your document as
          usual. By default all <tag>envar</tag> elements get an
            <tag>indexterm</tag>. In cases you do not want this, add the
          attribute <tag class="attribute">condition</tag> with its
          value <tag class="attvalue">noindex</tag> to suppress
          indexterm generation. This is done in the second
            <tag>para</tag> element:</para>
        <example xml:id="ex.structure.profile-envar.xml">
          <title><filename>profile-envar.xml</filename></title>
          <info>
            <output xmlns="urn:x-toms:docbook-ext">
              <filename>adding-indexterms/profile-envar.xml</filename>
            </output>
          </info>
          <programlisting language="xml" linenumbering="numbered">&lt;article  version="5.0"
  xmlns="http://docbook.org/ns/docbook"&gt;
  &lt;title&gt;Profiling Test&lt;/title&gt;
  &lt;para&gt;Environment variable &lt;envar&gt;XML_CATALOG_FILES&lt;/envar&gt;&lt;/para&gt;
  &lt;para&gt;Environment variable &lt;envar condition="noindex"&gt;FOO&lt;/envar&gt;&lt;/para&gt;
  &lt;para&gt;Environment variable &lt;envar os="windows"&gt;Path&lt;/envar&gt;&lt;envar 
    os="linux"&gt;PATH&lt;/envar&gt;&lt;/para&gt;
&lt;/article&gt;</programlisting>
        </example>
      </step>
      <step>
        <para>Create a stylesheet <filename>profile-tags.xsl</filename>
        with the following content:</para>
        <example xml:id="ex.structure.profile-tag.xsl">
          <title><filename>profile-tag.xsl</filename></title>
          <info>
            <output xmlns="urn:x-toms:docbook-ext">
              <filename>adding-indexterms/profile-tags.xsl</filename>
            </output>
          </info>
          <programlisting language="xml" linenumbering="numbered">&lt;xsl:stylesheet version="1.0"
  xmlns:d="http://docbook.org/ns/docbook"
  xmlns="http://docbook.org/ns/docbook"
  xmlns:xsl="http://www.w3.org/1999/XSL/Transform"&gt;
  
&lt;xsl:param name="preferred"&gt;pref&lt;/xsl:param&gt;

&lt;xsl:template name="check.index"&gt;
  &lt;xsl:param name="node" select="."/&gt;
  &lt;xsl:param name="default" select="1"/&gt;
    
    &lt;xsl:choose&gt;
      &lt;xsl:when test="$node/@condition = 'noindex'"&gt;0&lt;/xsl:when&gt;
      &lt;xsl:when test="$node/@condition = 'index'"&gt;1&lt;/xsl:when&gt;    
      &lt;xsl:otherwise&gt;&lt;xsl:value-of select="$default"/&gt;&lt;/xsl:otherwise&gt;
    &lt;/xsl:choose&gt;  
&lt;/xsl:template&gt;

&lt;xsl:template match="d:footnote|d:title|d:indexterm" mode="profile"&gt;
  &lt;!-- Indexterms doesn't/shouldn't occur in the descendants of
       these elements so just copy it --&gt;
  &lt;xsl:copy-of select="."/&gt;
&lt;/xsl:template&gt;

&lt;xsl:template match="d:envar" mode="profile"&gt;
    &lt;xsl:variable name="do.index"&gt;
      &lt;xsl:call-template name="check.index"/&gt;
    &lt;/xsl:variable&gt;

    &lt;!-- Copy original element --&gt;
    &lt;xsl:copy-of select="."/&gt;
  
    &lt;xsl:if test="$do.index != 0"&gt;
      &lt;indexterm&gt;
        &lt;primary&gt;&lt;xsl:value-of select="."/&gt;&lt;/primary&gt;
      &lt;/indexterm&gt;
      &lt;indexterm&gt;
        &lt;xsl:if test="contains(@conformance, $preferred)"&gt;
           &lt;xsl:attribute name="significance"&gt;preferred&lt;/xsl:attribute&gt;
        &lt;/xsl:if&gt;
        &lt;primary&gt;environment variables&lt;/primary&gt;
        &lt;secondary&gt;&lt;xsl:value-of select="."/&gt;&lt;/secondary&gt;
      &lt;/indexterm&gt;
    &lt;/xsl:if&gt;
&lt;/xsl:template&gt;
&lt;/xsl:stylesheet&gt;</programlisting>
        </example>
      </step>
      <step>
        <para>Create the stylesheet
            <filename>add-indexterms.xsl</filename>. This stylesheet is
          based on <filename>profile.xsl</filename> of the DocBook XSL
          stylesheets. It contains the special mode
            <literal>profile</literal> to process elements to observe
          profiling conditions.</para>
        <example xml:id="ex.structure.add-indexterms.xsl">
          <title><filename>add-indexterms.xsl</filename></title>
          <info>
            <output xmlns="urn:x-toms:docbook-ext">
              <filename>adding-indexterms/add-indexterms.xsl</filename>
            </output>
          </info>
          <programlisting language="xml" linenumbering="numbered">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;!DOCTYPE xsl:stylesheet
[
  &lt;!ENTITY db "http://docbook.sourceforge.net/release/xsl-ns/current"&gt; 
]&gt;
&lt;xsl:stylesheet version="1.0"
  xmlns:d="http://docbook.org/ns/docbook"
  xmlns="http://docbook.org/ns/docbook"
  xmlns:xsl="http://www.w3.org/1999/XSL/Transform" &gt;

&lt;xsl:import href="&amp;db;/profiling/profile.xsl"/&gt;
&lt;xsl:output indent="yes" method="xml"/&gt;
&lt;xsl:include href="profile-tags.xsl"/&gt;

&lt;/xsl:stylesheet&gt;</programlisting>
        </example>
      </step>
      <step>
        <para>Transform your document:</para>
        <screen><command>xsltproc</command> add-indexterms.xsl profile-envar.xml</screen>
      </step>
    </procedure>
    
    <para>After applying the stylesheet
        <filename>add-indexterms.xsl</filename> you will get the
      following output:</para>
    <example xml:id="ex.structure.profile-envar-result.xml">
      <title>Output of the Transformation</title>
      <programlisting language="xml">&lt;article xmlns="http://docbook.org/ns/docbook" version="5.0"&gt;
  &lt;title&gt;Profiling Test&lt;/title&gt;
  &lt;para&gt;Environment variable &lt;envar&gt;XML_CATALOG_FILES&lt;/envar&gt;&lt;indexterm&gt;
    &lt;primary&gt;XML_CATALOG_FILES&lt;/primary&gt;
  &lt;/indexterm&gt;&lt;indexterm&gt;
    &lt;primary&gt;environment variables&lt;/primary&gt;
    &lt;secondary&gt;XML_CATALOG_FILES&lt;/secondary&gt;
    &lt;/indexterm&gt;&lt;/para&gt;
  &lt;para&gt;Environment variable &lt;envar condition="noindex"&gt;FOO&lt;/envar&gt;&lt;/para&gt;
  &lt;para&gt;Environment variable &lt;envar os="windows"
        &gt;Path&lt;/envar&gt;&lt;indexterm&gt;&lt;primary&gt;Path&lt;/primary&gt;&lt;/indexterm&gt;&lt;indexterm&gt;&lt;primary&gt;environment
        variables&lt;/primary&gt;&lt;secondary&gt;Path&lt;/secondary&gt;&lt;/indexterm&gt;&lt;envar
      os="linux"
      &gt;PATH&lt;/envar&gt;&lt;indexterm&gt;
        &lt;primary&gt;PATH&lt;/primary&gt;
      &lt;/indexterm&gt;&lt;indexterm&gt;
        &lt;primary&gt;environment variables&lt;/primary&gt;
        &lt;secondary&gt;PATH&lt;/secondary&gt;
      &lt;/indexterm&gt;&lt;/para&gt;
&lt;/article&gt;</programlisting>
    </example>
  </section>
  <section role="discussion">
    <title>Discussion</title>
    <para>Let´s go back at the beginning first. Assume you want to show
      an environment variable in the index. Usually you would mark up
      the text with the <tag>envar</tag> element and add an
        <tag>indexterm</tag> right after the first one. As is is useful
      to find the index term also under the primary term
        <quote>environment variables</quote>, you add an additional
        <tag>indexterm</tag>. This could look like this:</para>
    <programlisting language="xml">&lt;para&gt;Use the &lt;envar&gt;PATH&lt;/envar&gt;&lt;indexterm&gt;
        &lt;primary&gt;PATH&lt;/primary&gt;
      &lt;/indexterm&gt;&lt;indexterm&gt;
        &lt;primary&gt;environment variables&lt;/primary&gt;
        &lt;secondary&gt;PATH&lt;/secondary&gt;
      &lt;/indexterm&gt;
      to do ...
&lt;/para&gt;</programlisting>
    <para>Although this is the usual method, it has some
      drawbacks:</para>
    <itemizedlist>
      <listitem>
        <formalpara>
          <title>It is hard to read</title>
          <para>If you are get used to read the bare XML code, it is
            hard to read as the text is broken into pieces. The text is
            cluttered with <tag>indexterm</tag> elements all
            along.</para>
        </formalpara>
      </listitem>
      <listitem>
        <formalpara>
          <title>It may be inconsistent</title>
          <para>If you forgot the <quote>s</quote> in the primary index
            term it will lead to double entries (one singular and one
            plural form). This lead to inconsistencies. It can be
            painful if you have to go through the complete document just
            to fix the singular form into the plural form (or vice
            versa).</para>
        </formalpara>
      </listitem>
      <listitem>
        <formalpara>
          <title>Whitespace could matter</title>
          <para>The <tag>indexterm</tag> element(s) start
              <emphasis>directly</emphasis> after your term. If you or
            your editor introduces one or more whitespaces after your
            dedicated index term, in the worst case it could lead to a
            wrong page number in the index. This mainly affects the PDF
            rather than any online formats but could confuse your
            readers.</para>
        </formalpara>
      </listitem>
    </itemizedlist>
    
    <para>All of the above problems can be solved with the stylesheet
      from <xref linkend="ex.structure.profile-tag.xsl"/>. It exploits the DocBook
      XSL stylesheet´s profiling mechanism. Normally, profiling is a
      method to <emphasis>remove</emphasis> certain structures from a
      document rather than <emphasis>add</emphasis> something. In our
      case we use the special <literal>profile</literal> mode to
      customize the automatic index term addition.</para>
    <para>With the above stylesheet, it is possible to influence how
      your index terms appear. This is done with the
      <tag class="attribute">condition</tag><footnote>
        <para>Theoretically you could use any of the several common
          attributes available on every DocBook element. The <tag class="attribute">condition</tag> was the one attribute 
          that has fitted the best in the authors mind.</para>
      </footnote> attribute, demonstrated on our <tag>envar</tag>
      example:</para>
    <variablelist>
      <varlistentry>
        <term><tag class="starttag">envar</tag>…<tag class="endtag">envar</tag></term>
        <listitem>
          <para>Adds the <tag>indexterm</tag>s directly after the
            <tag>envar</tag> element.</para>
        </listitem>
      </varlistentry>
      <varlistentry>
        <term><tag class="starttag">envar condition="index"</tag>…<tag class="endtag">envar</tag></term>
        <listitem>
          <para>Same as the previous entry.</para>
        </listitem>
      </varlistentry>
      <varlistentry>
        <term><tag class="starttag">envar condition="noindex"</tag>…<tag class="endtag">envar</tag></term>
        <listitem>
          <para>Suppresses any automatic generation of index entries.</para>
        </listitem>
      </varlistentry>
      <varlistentry>
        <term><tag class="starttag">envar condition="pref"</tag>…<tag class="endtag">envar</tag></term>
        <listitem>
          <para>Adds an <emphasis>preferred</emphasis> index entry. The
            keyword <quote>pref</quote> can be customized through the 
            <parameter>preferred</parameter> parameter. If the keyword
            is added in the <tag class="attribute">condition</tag>
            attribute, the following code is created:</para>
          <programlisting language="xml">&lt;indexterm significance="preferred"&gt;...&lt;/indexterm&gt;</programlisting>
        </listitem>
      </varlistentry>
    </variablelist>
        
    <para>This method can not solve all index problems. You should know
      some of its limits:</para>
    
    <itemizedlist>
      <listitem>
        <formalpara>
          <title>Document Type</title>
          <para>Technical documents are more applicable than novels as
            the former contains usually a set of elements which are
            consistently used. </para>
        </formalpara>
      </listitem>
      <listitem>
        <formalpara>
          <title>Consistent Elements</title>
          <para>The document needs not only consistently use the same
            elements for the same structure, it has to use a specific
            element in the first place. For example, if you want to show
            your configuration files in your index, you need to mark
            it up with <tag>filename</tag>, otherwise this method has no
            chance.</para>
        </formalpara>
      </listitem>
      <listitem>
        <formalpara>
          <title>Needed Elements</title>
          <para>Similar to the previous point, you have to know which
            elements you need to show up in the index. You have to
            select from all possible inline elements only a handful
            which you consider important enough.</para>
        </formalpara>
      </listitem>
      <listitem>
        <formalpara>
          <title>Only for Inline Elements</title>
          <para>This method works only for inline elements well.
            DocBook´s inline elements occur usually inside a paragraph
            but can also show up in a title.</para>
        </formalpara>
      </listitem>
      <listitem>
        <formalpara>
          <title>Hard-coded Primary Entry</title>
          <para>It can be critized to add hard-coded text into the
            stylesheet <filename>profile-tag.xsl</filename> (here:
            <quote>environment variables</quote>). If you maintain 
            different languages, you should replace it with a more
            general solution and move the language specific text into
            language files as described in <xref linkend="dbc.common.l10n"/>.</para>
        </formalpara>
      </listitem>
    </itemizedlist>
     
    <para>Although this method does not replace hand-written index
      entries, it can ease the pain. Especially for those entries which
      can be be inserted automatically it improves consistency. The
      method described above can also be implemented for other inline
      elements, like persons, functions, etc.</para>    
  </section>
  
  <section role="seealso">
    <title>See Also</title>
    <itemizedlist>
      <listitem>
        <para><xref linkend="dbc.markup.multiple-indices"/></para>
      </listitem>
    </itemizedlist>
  </section>
</section>
  <!--
    License CC BY-NC-SA 3.0
  
   This work is licensed under the 
   "Namensnennung – Keine kommerzielle Nutzung – Weitergabe unter
    gleichen Bedingungen 3.0 Deutschland (CC BY-NC-SA 3.0)" 
   http://creativecommons.org/licenses/by-nc-sa/3.0/de/deed.de
   
   Read the English translation here:
   
   "Attribution-NonCommercial-ShareAlike 3.0 Unported (CC BY-NC-SA 3.0)" 
   http://creativecommons.org/licenses/by-nc-sa/3.0/
   
--><!--<?xml-model href="file:../5.1/dbref.rnc" type="application/relax-ng-compact-syntax"?>--><section xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="dbc.structure.revision-list" remap="topic" userlevel="medium" xml:base="structure/topic.revision-list.xml">
  <title>Including Revision Information from Version Control Systems</title>
  <info>
    <definitions definitionfile="defs.xml"/>
    <keywordset>
      <keyword>version control system</keyword>
      <keyword>revhistory</keyword>
      <keyword>Bazaar</keyword>
      <keyword>Git</keyword>
      <keyword>Mercurial</keyword>
      <keyword>Subversion</keyword>
    </keywordset>
  </info>
  
  <section role="problem">
    <title>Problem</title>
    <para>You want to include revision information into your DocBook
      document from your version control systems, like Bazaar, Subversion,
      Mercurial, Git, and others.</para>
  </section>
  <section role="solution">
    <title>Solution</title>
    <para>Usually, the solution for each version control system is to
      output its log into its specific XML output and transform it with
      XSLT into a <tag>revhistory</tag> element. </para>
    
    <section xml:id="sec.structure.revision-list.bazaar">
      <title>Bazaar</title>
      <para><application xlink:href="http://bazaar.canonical.com">Bazaar</application>
        does not come with a predefined XML output. If you need this
        functionality, you have to install the
        <package>xmloutput</package> plugin first. This brings the
        <option>--xml</option> option to the <command>log</command>
        subcommand. Proceed as follows:</para>
      <procedure xml:id="pro.structure.revision-list.bazaar">
        <title>Installing the Bazaar Plugin xmloutput</title>
        <step>
          <para>Download the tar archive from <link xlink:href="http://wiki.bazaar.canonical.com/XMLOutput"/>.</para>
        </step>
        <step>
          <para>Unpack the archive.</para>
        </step>
        <step>
          <para>Change to the extension directory (usually something
            like
            <filename>bzr-xmloutput-<replaceable>VERSION</replaceable></filename>)
            and run:</para>
          <screen><command>python</command> setup build_ext</screen>
        </step>
        <step>
          <para>Copy the result directory <filename class="directory">build/lib/bzrlib/plugins/xmloutput/</filename> to your
            plugin directory. For Linux it is something like <filename class="directory">$HOME/.bazaar/plugins/</filename>, for
            Windows copy it to <filename class="directory">$APPDATA/bazaar/<replaceable>VERSION</replaceable>/plugins</filename></para>
        </step>
        <step>
          <para>Check if the plugin is correctly detected:</para>
          <screen><command>bzr</command> plugins</screen>
          <para>You should see the following line:</para>
          <screen>xmloutput <replaceable>VERSION</replaceable>
    This plugin adds an option (--xml) to log and provides an xml version of 
    some built-in commands.</screen>
        </step>
      </procedure>
      <para>After you have successully installed the plugin, create the 
        log output in XML with the following command:</para>
      <screen><command>bzr</command> log --xml <replaceable>REPO</replaceable> &gt; bzr-log.xml</screen>
      <para>To convert the previous log file into DocBook's
        <tag>revhistory</tag>, use the following stylesheet:</para>
      <example xml:id="ex.structure.convert-bazaar-logfile">
        <title>Stylesheet to Convert Bazaar's Log File</title>
        <programlisting>TBD</programlisting>
      </example>
    </section>
    <section xml:id="sec.structure.revision-list.git">
      <title>Git</title>
      <para><application xlink:href="http://git-scm.com">Git</application> does not have any options to turn the log
        into XML. However, with the <option>--pretty</option> option you
        can collect the information and wrap it into any XML elements
        you wish. The following command uses this option and
          <command>sed</command> to insert the <tag class="starttag">logs</tag> start tag in the first line and <tag class="endtag">logs</tag> end tag in the last line:</para>
      <screen><command>git</command> log --date=iso<!--
       --> --pretty=format:"&lt;logentry revision='%h'&gt;%n<!--
        --> &lt;author email='%ae'&gt;%an&lt;/author&gt;%n<!--
        --> &lt;date&gt;%ad&lt;/date&gt;%n<!-- 
        --> &lt;msg xml:space='preserve'&gt;%s&lt;/msg&gt;%n<!-- 
        -->&lt;/logentry&gt;" \
  | sed -e '1i&lt;logs&gt;' -e '$a&lt;/logs&gt;' &gt; git-log.xml</screen>
      <para>As the element names can be freely chosen, we use the same
        names as in <xref linkend="ex.mercurial-logfile"/>. This allows
        us to use the stylesheet from <xref linkend="ex.hg2revhistory.xsl"/>. </para>
    </section>
    <section xml:id="sec.structure.revision-list.mercurial">
      <title>Mercurial</title>
      <para><application xlink:href="http://mercurial.selenic.com">Mercurial</application>
        has the <option>--style</option> option to output its log into
        XML:</para>
      <screen><command>hg</command> log --style xml &gt; hg-log.xml</screen>
      <para>The XML file of the Mercurial log looks like this:</para>
      <example xml:id="ex.mercurial-logfile">
        <title>Mercurial Log File in XML</title>
        <programlisting linenumbering="numbered" language="xml">&lt;log&gt;
  &lt;logentry revision="69"
    node="dfadd024594c4083362fe6919264362803dcd285"&gt;
    &lt;tag&gt;tip&lt;/tag&gt;
    &lt;author email="tux@example.de"&gt;Tux Penguin&lt;/author&gt;
    &lt;date&gt;2011-05-22T01:56:21+02:00&lt;/date&gt;
    &lt;msg xml:space="preserve"&gt;Corrected xml:id attribute&lt;/msg&gt;
    &lt;paths&gt;
      &lt;path action="M"&gt;xml/structure/topic.extract-element.xml&lt;/path&gt;
    &lt;/paths&gt;
  &lt;/logentry&gt;
  &lt;logentry revision="68"
    node="833287df8943d0bab5ec65ec8aafe5bc42002289"&gt;
    &lt;author email="wilber@example.de"&gt;Wilber Gimp&lt;/author&gt;
    &lt;date&gt;2011-05-22T01:56:03+02:00&lt;/date&gt;
    &lt;msg xml:space="preserve"&gt;Changed chapter title&lt;/msg&gt;
    &lt;paths&gt;
      &lt;path action="M"&gt;xml/structure/topic.revision-list.xml&lt;/path&gt;
    &lt;/paths&gt;
  &lt;/logentry&gt;
  &lt;!-- Many more entries ... --&gt;
&lt;/log</programlisting>
      </example>
      <para>The following stylesheet converts the log file from <xref linkend="ex.mercurial-logfile"/> into DocBook's
        <tag>revhistory</tag>:</para>
      <example xml:id="ex.hg2revhistory.xsl">
        <title>Stylesheet <filename>hg2revhistory.xsl</filename> to Convert
          Mercurial XML Log Files into  DocBook's <tag>revhistory</tag></title>
        <info>
          <output xmlns="urn:x-toms:docbook-ext">
            <filename>revision-list/hg2revhistory.xsl</filename>
          </output>
        </info>
        <programlisting linenumbering="numbered" language="xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;!DOCTYPE xsl:stylesheet
[
  &lt;!ENTITY dbns "http://docbook.org/ns/docbook"&gt;
]&gt;
&lt;xsl:stylesheet version="1.0"
  xmlns:xsl="http://www.w3.org/1999/XSL/Transform"&gt;
  
  &lt;xsl:output method="xml" indent="yes"/&gt;
  
  &lt;xsl:param name="include.paths" select="1"/&gt;
  &lt;xsl:param name="include.copies" select="1"/&gt;
  
  &lt;xsl:template match="log"&gt;
    &lt;revhistory xmlns="&amp;dbns;"&gt;
      &lt;xsl:apply-templates/&gt;
    &lt;/revhistory&gt;
  &lt;/xsl:template&gt;
  
  &lt;xsl:template match="logentry"&gt;
    &lt;revhistory xmlns="&amp;dbns;"&gt;
      &lt;xsl:apply-templates select="@revision|*"/&gt;
    &lt;/revhistory&gt;
  &lt;/xsl:template&gt;
  
  &lt;xsl:template match="logentry/@revision"&gt;
    &lt;revnumber xmlns="&amp;dbns;"&gt;
      &lt;xsl:apply-templates/&gt;
    &lt;/revnumber&gt;
  &lt;/xsl:template&gt;
  
  &lt;xsl:template match="tag"&gt;
    &lt;revremark xmlns="&amp;dbns;"&gt;
      &lt;xsl:apply-templates/&gt;
    &lt;/revremark&gt;
  &lt;/xsl:template&gt;
  
  &lt;xsl:template match="date"&gt;
    &lt;date xmlns="&amp;dbns;"&gt;
      &lt;xsl:apply-templates/&gt;
    &lt;/date&gt;
  &lt;/xsl:template&gt;
  
  &lt;xsl:template match="author"&gt;
    &lt;xsl:variable name="firstname" select="substring-before(., ' ')"/&gt;
    &lt;xsl:variable name="surname" select="substring-after(., ' ')"/&gt;
    &lt;author xmlns="&amp;dbns;"&gt;
      &lt;personname&gt;
        &lt;firstname&gt;&lt;xsl:value-of select="$firstname"/&gt;&lt;/firstname&gt;
        &lt;!--&lt;othername&gt;&lt;/othername&gt;--&gt;
        &lt;surname&gt;&lt;xsl:value-of select="$surname"/&gt;&lt;/surname&gt;
      &lt;/personname&gt;
      &lt;email&gt;&lt;xsl:value-of select="@email"/&gt;&lt;/email&gt;
    &lt;/author&gt;
  &lt;/xsl:template&gt;
  
  &lt;xsl:template match="msg"&gt;
    &lt;revdescription xmlns="&amp;dbns;"&gt;
      &lt;para&gt;
        &lt;xsl:apply-templates/&gt;
      &lt;/para&gt;
    &lt;/revdescription&gt;
  &lt;/xsl:template&gt;
  
  &lt;xsl:template match="paths"&gt;
    &lt;xsl:if test="$include.paths != 0"&gt;
      &lt;itemizedlist xmlns="&amp;dbns;"&gt;
        &lt;title&gt;Paths&lt;/title&gt;
        &lt;xsl:apply-templates/&gt;
      &lt;/itemizedlist&gt;
    &lt;/xsl:if&gt;
  &lt;/xsl:template&gt;
  
  &lt;xsl:template match="path"&gt;
    &lt;listitem xmlns="&amp;dbns;"&gt;
      &lt;para&gt;
        &lt;xsl:apply-templates select="@action|text()"/&gt;
      &lt;/para&gt;
    &lt;/listitem&gt;    
  &lt;/xsl:template&gt;
  
  &lt;xsl:template match="path/@action"&gt;
    &lt;xsl:text&gt;[&lt;/xsl:text&gt;
    &lt;xsl:value-of select="."/&gt;
    &lt;xsl:text&gt;] &lt;/xsl:text&gt;
  &lt;/xsl:template&gt;
  &lt;xsl:template match="path/text()"&gt;
    &lt;filename xmlns="&amp;dbns;"&gt;
      &lt;xsl:value-of select="."/&gt;
    &lt;/filename&gt;
  &lt;/xsl:template&gt;

  &lt;xsl:template match="copyies"&gt;
    &lt;xsl:if test="$include.paths != 0"&gt;
      &lt;listitem xmlns="&amp;dbns;"&gt;
        &lt;title&gt;Copies&lt;/title&gt;
        &lt;para&gt;
          &lt;xsl:apply-templates select="@*|text()"/&gt;
        &lt;/para&gt;
      &lt;/listitem&gt;
    &lt;/xsl:if&gt;
  &lt;/xsl:template&gt;
  &lt;xsl:template match="copy"&gt;
    &lt;listitem xmlns="&amp;dbns;"&gt;
      &lt;para&gt;
        &lt;xsl:apply-templates select="@*|text()"/&gt;
      &lt;/para&gt;
    &lt;/listitem&gt;    
  &lt;/xsl:template&gt;
  
  &lt;xsl:template match="copy/@source"&gt;
    &lt;filename xmlns="&amp;dbns;"&gt;
      &lt;xsl:value-of select="."/&gt;
    &lt;/filename&gt;
  &lt;/xsl:template&gt;
  &lt;xsl:template match="copy/text()"&gt;
    &lt;xsl:text&gt; -&gt; &lt;/xsl:text&gt;
    &lt;filename xmlns="&amp;dbns;"&gt;
      &lt;xsl:value-of select="."/&gt;
    &lt;/filename&gt;
  &lt;/xsl:template&gt;
  
&lt;/xsl:stylesheet&gt;</programlisting>
      </example>
    </section>
    <section xml:id="sec.structure.revision-list.svn">
      <title>Subversion</title>
      <para><application xlink:href="http://subversion.tigris.org">Subversion</application>
        is similar to Mercurial: It has an
        <option>--xml</option> option to turn the log output into XML:</para>
      <screen><command>svn</command> log --xml &gt; svn-log.xml</screen>
      <para>With the <option>-v</option> option (verbose) you get
        additional path information. As the output is very similar to
        Mercurial, you can apply the stylesheet shown in <xref linkend="ex.hg2revhistory.xsl"/>
        also for Subversion's log file.
      </para>
      <para>As an alternative, the DocBook Subversion repository (see
          <link xlink:href="https://docbook.svn.sourceforge.net/svnroot/docbook/trunk"/>) contains the XSLT stylesheet
          <filename>releasetools/svnlog2docbook.xsl</filename> with
        additional features.</para>
    </section>    
  </section>
  <section role="discussion">
    <title>Discussion</title>
    <para><remark>TBD</remark></para>
  </section>
  <!--<section role="seealso">
    <title>See Also</title>
    <para></para>
  </section>-->
</section>
  <!--
    License CC BY-NC-SA 3.0
  
   This work is licensed under the 
   "Namensnennung – Keine kommerzielle Nutzung – Weitergabe unter
    gleichen Bedingungen 3.0 Deutschland (CC BY-NC-SA 3.0)" 
   http://creativecommons.org/licenses/by-nc-sa/3.0/de/deed.de
   
   Read the English translation here:
   
   "Attribution-NonCommercial-ShareAlike 3.0 Unported (CC BY-NC-SA 3.0)" 
   http://creativecommons.org/licenses/by-nc-sa/3.0/
   
--><!--<?xml-model href="file:../5.1/dbref.rnc" type="application/relax-ng-compact-syntax"?>--><section xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="dbc.structure.acronym-list" remap="topic" xml:base="structure/topic.acronym-list.xml">
  <title>Creating an Acronym List</title>
  <info>
    <definitions definitionfile="defs.xml"/>
    <keywordset>
      <keyword>acronym</keyword>
      <keyword>generated list</keyword>
    </keywordset>
    <othercredit>
      <personname>
          <firstname>Peter</firstname>
          <surname>Lavin</surname>
        </personname>
      <email>lavin.peter@gmail.com</email>
      <contrib>Contributed idea and stylesheet</contrib>
    </othercredit>
  </info>
  
  <section role="problem">
    <title>Problem</title>
    <para>You have a glossary with acronyms and you want to generate a sorted list of
      these acronyms automatically.</para>
  </section>
  <section role="solution">
    <title>Solution</title>
    <para>The following prerequisites are needed:</para>
    
    <orderedlist>
      <listitem>
        <para>The element <tag>glossary</tag> and for each
          <tag>glossterm</tag> your acronym as shown in the following
          structure:</para>
        <programlisting language="xml">&lt;glossary version="5.0" 
  xmlns="http://docbook.org/ns/docbook"&gt;
  &lt;title&gt;Acronym Test File&lt;/title&gt;
  &lt;info&gt;
    &lt;author&gt;
      &lt;personname&gt;
        &lt;firstname&gt;Thomas&lt;/firstname&gt;
        &lt;surname&gt;Schraitle&lt;/surname&gt;
      &lt;/personname&gt;
    &lt;/author&gt;
  &lt;/info&gt;
  
  &lt;glossentry xml:id="xml"&gt;
    &lt;acronym&gt;XML&lt;/acronym&gt;
    &lt;glossdef&gt;
      &lt;para&gt;Lore ipsum&lt;/para&gt;
    &lt;/glossdef&gt;
  &lt;/glossentry&gt;
  &lt;glossentry xml:id="pdf"&gt;
    &lt;acronym&gt;PDF&lt;/acronym&gt;
    &lt;glossdef&gt;
      &lt;para&gt;Lore ipsum&lt;/para&gt;
    &lt;/glossdef&gt;
  &lt;/glossentry&gt;
  &lt;glossentry xml:id="oasis"&gt;
    &lt;acronym&gt;OASIS&lt;/acronym&gt;
    &lt;glossdef&gt;
      &lt;para&gt;Lore ipsum&lt;/para&gt;
    &lt;/glossdef&gt;
  &lt;/glossentry&gt;
  &lt;glossentry xml:id="dtd"&gt;
    &lt;acronym role="foo" xml:id="dtd-acronym"&gt;DTD&lt;/acronym&gt;
    &lt;glossdef&gt;
      &lt;para&gt;Lore ipsum&lt;/para&gt;
    &lt;/glossdef&gt;
  &lt;/glossentry&gt;
&lt;/glossary&gt;</programlisting>
      </listitem>
      <listitem>
        <para>The following stylesheet to apply it to your XML
          structure:</para>
        <example xml:id="ex.structure.make_acronyms.xsl">
          <title><filename>make_acronyms.xsl</filename></title>
          <info>
            <output xmlns="urn:x-toms:docbook-ext">
              <filename>acronym-sorted/make_acronyms.xsl</filename>
            </output>
          </info>
        <programlisting language="xslt">&lt;xsl:stylesheet version="1.0" &#13;
  xmlns:xsl="http://www.w3.org/1999/XSL/Transform" &#13;
  xmlns:d="http://docbook.org/ns/docbook"&#13;
  xmlns="http://docbook.org/ns/docbook"&#13;
  exclude-result-prefixes="d"&gt;&#13;
  &#13;
  &lt;xsl:output encoding="UTF-8" indent="yes" method="xml" omit-xml-declaration="yes"/&gt;&#13;
  &#13;
  &lt;xsl:param name="appendixid"&gt;acronyms&lt;/xsl:param&gt;&#13;
  &lt;xsl:param name="docbookversion"&gt;5.0&lt;/xsl:param&gt;&#13;
  &#13;
  &lt;xsl:template match="/"&gt;&#13;
    &lt;!-- The comment below appears in the output file--&gt;&#13;
&lt;xsl:comment&gt;&#13;
 This file is dynamically generated at build time from a glossary file. &#13;
 To change this file, make changes to the appropriate glossary.xml file. &#13;
 In order to generate the acronyms file, any glossary entries with an &#13;
 acronym tag must have an xml:id. &#13;
&lt;/xsl:comment&gt;&#13;
    &lt;appendix version="{$docbookversion}"&gt;&#13;
      &lt;xsl:if test="$appendixid != ''"&gt;&#13;
        &lt;xsl:attribute name="xml:id"&gt;&#13;
          &lt;xsl:value-of select="$appendixid"/&gt;&#13;
        &lt;/xsl:attribute&gt;&#13;
      &lt;/xsl:if&gt;&#13;
      &lt;title&gt;Acronyms&lt;/title&gt;&#13;
      &lt;para&gt; This appendix displays acronyms sorted alphabetically and &#13;
        linked to their definition in the glossary. &lt;/para&gt;&#13;
      &lt;xsl:apply-templates select=".//d:glossary[1]"/&gt;&#13;
    &lt;/appendix&gt;&#13;
  &lt;/xsl:template&gt;&#13;
  &#13;
  &lt;xsl:template match="d:glossary"&gt;&#13;
    &lt;itemizedlist remap="glossary"&gt;&#13;
      &lt;xsl:apply-templates select="d:glossentry[d:acronym]"&gt;&#13;
        &lt;xsl:sort select="d:acronym"/&gt;&#13;
      &lt;/xsl:apply-templates&gt;&#13;
    &lt;/itemizedlist&gt;&#13;
  &lt;/xsl:template&gt;&#13;
  &#13;
  &lt;xsl:template match="d:glossentry[d:acronym]"&gt;&#13;
    &lt;listitem&gt;&#13;
      &lt;xsl:apply-templates select="d:acronym"/&gt;&#13;
    &lt;/listitem&gt;&#13;
  &lt;/xsl:template&gt;&#13;
  &#13;
  &lt;xsl:template match="d:acronym"&gt;&#13;
    &lt;xsl:variable name="id"&gt;&#13;
      &lt;xsl:choose&gt;&#13;
        &lt;xsl:when test="(ancestor-or-self::d:*/@xml:id)[last()]"&gt;&#13;
          &lt;xsl:value-of select="(ancestor-or-self::d:*/@xml:id)[last()]"/&gt;&#13;
        &lt;/xsl:when&gt;&#13;
        &lt;xsl:otherwise&gt;&#13;
          &lt;xsl:message&gt;No ID found!&lt;/xsl:message&gt;&#13;
        &lt;/xsl:otherwise&gt;&#13;
      &lt;/xsl:choose&gt;&#13;
    &lt;/xsl:variable&gt;&#13;
      &lt;para&gt;&#13;
        &lt;xsl:copy&gt;&#13;
          &lt;xsl:if test="$id != ''"&gt;&#13;
            &lt;xsl:attribute name="linkend"&gt;&#13;
              &lt;xsl:value-of select="$id"/&gt;&#13;
            &lt;/xsl:attribute&gt;&#13;
          &lt;/xsl:if&gt;&#13;
          &lt;xsl:attribute name="remap"&gt;acronym&lt;/xsl:attribute&gt;&#13;
          &lt;xsl:copy-of select="node()"/&gt;&#13;
        &lt;/xsl:copy&gt;&#13;
      &lt;/para&gt;&#13;
  &lt;/xsl:template&gt;&#13;
    &#13;
&lt;/xsl:stylesheet&gt;</programlisting>
        </example>
      </listitem>
    </orderedlist>
    
    <para>The result will look like this:</para>
    
    <programlisting>&lt;!--
 This file is dynamically generated at build time from a glossary file. 
 To change this file, make changes to the appropriate glossary.xml file. 
 In order to generate the acronyms file, any glossary entries with an 
 acronym tag must have an xml:id. 
--&gt;
&lt;appendix xmlns="http://docbook.org/ns/docbook" version="5.0" xml:id="acronyms"&gt;
  &lt;title&gt;Acronyms&lt;/title&gt;
  &lt;para&gt; This appendix displays acronyms sorted alphabetically and 
        linked to their definition in the glossary. &lt;/para&gt;
  &lt;itemizedlist remap="glossary"&gt;
    &lt;listitem&gt;
      &lt;para&gt;
        &lt;acronym linkend="dtd-acronym" remap="acronym"&gt;DTD&lt;/acronym&gt;
      &lt;/para&gt;
    &lt;/listitem&gt;
    &lt;listitem&gt;
      &lt;para&gt;
        &lt;acronym linkend="oasis" remap="acronym"&gt;OASIS&lt;/acronym&gt;
      &lt;/para&gt;
    &lt;/listitem&gt;
    &lt;listitem&gt;
      &lt;para&gt;
        &lt;acronym linkend="pdf" remap="acronym"&gt;PDF&lt;/acronym&gt;
      &lt;/para&gt;
    &lt;/listitem&gt;
    &lt;listitem&gt;
      &lt;para&gt;
        &lt;acronym linkend="xml" remap="acronym"&gt;XML&lt;/acronym&gt;
      &lt;/para&gt;
    &lt;/listitem&gt;
  &lt;/itemizedlist&gt;
&lt;/appendix&gt;</programlisting>
    
  </section>
  <section role="discussion">
    <title>Discussion</title>
    <para>TBD</para>
  </section>
  
</section>
  <!--
    License CC BY-NC-SA 3.0
  
   This work is licensed under the 
   "Namensnennung – Keine kommerzielle Nutzung – Weitergabe unter
    gleichen Bedingungen 3.0 Deutschland (CC BY-NC-SA 3.0)" 
   http://creativecommons.org/licenses/by-nc-sa/3.0/de/deed.de
   
   Read the English translation here:
   
   "Attribution-NonCommercial-ShareAlike 3.0 Unported (CC BY-NC-SA 3.0)" 
   http://creativecommons.org/licenses/by-nc-sa/3.0/
   
--><!--<?xml-model href="file:../5.1/dbref.rnc" type="application/relax-ng-compact-syntax"?>--><section xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="dbc.structure.splitting-into-topics" remap="topic" userlevel="easy" xml:base="structure/topic.splitting-into-topics.xml">
  <title>Splitting DocBook 5 Documents Into Topics</title>
  <info>
    <definitions definitionfile="defs.xml"/>
    <keywordset>
      <keyword>splitting</keyword>
      <keyword>topic</keyword>
      <keyword>assembly</keyword>
    </keywordset>
    <subjectset>
      <subject>
        <subjectterm>assemblies</subjectterm>
        <subjectterm>modules</subjectterm>
      </subject>
    </subjectset>
  </info>
  
  <section role="problem">
    <title>Problem</title>
    <para>You need to create topics of your existing DocBook 5
      document to use it with the new <tag xlink:href="http://www.docbook.org/tdg51/en/html/assembly.html">assembly</tag> and <tag xlink:href="http://www.docbook.org/tdg51/en/html/topic.html">topic</tag> elements in DocBook 5.1.</para>
  </section>
  <section role="solution">
    <title>Solution</title>
    <para>Use the <filename>assembly/topic-maker-chunk.xsl</filename>
      stylesheet to create topics from your current DocBook 5 document. This
      breaks apart your existing document into modular files and creates
      an assembly file.</para>
    <para>To disassemble an existing <filename>book.xml</filename>
      document, use the <command>xsltproc</command> command like this
      (the variable <envar>DB</envar> contains the path of your DocBook
      XSL directory):</para>
    <screen><command>xsltproc</command> --xinclude \
    --stringparam assembly.filename  assembly.xml \ 
    --stringparam base.dir topics/ \
    $DB/assembly/topic-maker-chunk.xsl  \
    book.xml</screen>
    <para>The <command>xsltproc</command> command outputs the master
      assembly file <filename>assembly.xml</filename>. The document's content is
      break up into modular chunks, saved in the <filename class="directory">topics/</filename> directory. The master file
      contains a single <tag xlink:href="http://www.docbook.org/tdg51/en/html/structure.html">structure</tag>
      element.</para>
  </section>
  <section role="discussion">
    <title>Discussion</title>
    <para>The <filename>topic-maker-chunk.xsl</filename> contains
      several parameters to influence the chunking process:</para>
    <table xml:id="tab.structure.splitting-into-topics.params">
      <title>Parameters to Influence Chunking Process Into Topics</title>
      <tgroup cols="2">
        <thead>
          <row>
            <entry>Parameter</entry>
            <entry>Description</entry>
          </row>
        </thead>
        <tbody>
          <row>
            <entry><parameter>assembly.filename</parameter></entry>
            <entry>Name of the assembly file (default:
                <filename>myassembly.xml</filename>)</entry>
          </row>
          <row>
            <entry><parameter>base.dir</parameter></entry>
            <entry>Directory name where to store all generated topic
              files (default: <filename class="directory">topics/</filename>)</entry>
          </row>
          <row>
            <entry><parameter>chunk.first.sections</parameter></entry>
            <entry>Should the first top-level section be chunked?
              (default: <literal>1</literal> = yes, otherwise
              no)</entry>
          </row>
          <row>
            <entry><parameter>chunk.section.depth</parameter></entry>
            <entry>Depth to which sections should be chunked (default is
                <literal>3</literal>)</entry>
          </row>
          <row>
            <entry><parameter>manifest.in.base.dir</parameter></entry>
            <entry>Puts the assembly file into the directory set by
              <parameter>base.dir</parameter> instead of the current
              directory</entry>
          </row>
          <row>
            <entry><parameter>topic.elements</parameter></entry>
            <entry>Elements which are converted into topics (default is
                <tag>preface</tag>, <tag>chapter</tag>,
                <tag>article</tag>, and <tag>section</tag>)</entry>
          </row>
          <row>
            <entry><parameter>html.ext</parameter></entry>
            <entry>Extension of the topic files (default is <filename class="extension">.xml</filename>)</entry>
          </row>
          <row>
            <entry><parameter>root.id.suffix</parameter></entry>
            <entry>Suffix to add, when <parameter>root.as.resourceref</parameter>
             is set to <literal>0</literal> (default is
             <literal>-info</literal>)
             </entry>
          </row>
          <row>
            <entry><parameter>root.as.resourceref</parameter></entry>
            <entry>Should the root element also converted into a topic?
              (default is <literal>1</literal> = yes, otherwise no)</entry>
          </row>
          <row>
            <entry><parameter>use.id.as.filename</parameter></entry>
            <entry>Use <tag class="attribute">xml:id</tag> value of
              chunk elements to create filename? (default:
                <literal>1</literal> = yes, otherwise no)</entry>
          </row>
        </tbody>
      </tgroup>
    </table>
    
    <para>The <filename>topic-maker-chunk.xsl</filename> stylesheet
      reuses the same chunking algorithm than the XHTML stylesheets. That
      means, it breaks the document at the same boundaries and you can
      alter the chunking process with the same parameters than the XHTML
      stylesheets.</para>
    <para>The following subsections shows some specific examples to
      influence the chunking process.</para>
    <section xml:id="sec.structure.splitting-into-topics.assembly-file">
      <title>Influencing where to Store the Assembly File</title>
      <para>By default, the <filename>topic-maker-chunk.xsl</filename>
        puts the assembly file in the current directory instead of the
        directory set by <parameter>base.dir</parameter>. If you want to
        have the assembly file and its topics together in the same directory, set
        the parameter <parameter>manifest.in.base.dir</parameter> to
        <literal>1</literal>.</para>
      <para/>
    </section>
    <section xml:id="sec.structure.splitting-into-topics.depth">
      <title>Changing the Chunking Depth</title>
      <para>By default, the parameter
          <parameter>chunk.section.depth</parameter> is set to
          <literal>3</literal> which means, the stylesheet puts each
        element into a separate file down to <tag>sect2</tag>. The
        higher the value, the more file it creates (and
        vice-versa).</para>
      <para>If you need finer control of the chunking process, use the
          <tag>dbhtml stop-chunking</tag> processing-instruction as
        described in <link xlink:href="http://docbook.sourceforge.net/release/xsl/current/doc/pi/dbhtml_stop-chunking.html"/>.
      </para>
    </section>
  </section>
  
  <section role="seealso">
    <title>See Also</title>
    <itemizedlist>
      <listitem>
        <para><link xlink:href="http://docbook.sourceforge.net/release/xsl/current/doc/html/chunking.html"/></para>
      </listitem>
      <listitem>
        <para><link xlink:href="http://docbook.sourceforge.net/release/xsl/current/doc/pi/dbhtml_stop-chunking.html"/></para>
      </listitem>
    </itemizedlist>
  </section>
</section>
  <!--
    License CC BY-NC-SA 3.0
  
   This work is licensed under the 
   "Namensnennung – Keine kommerzielle Nutzung – Weitergabe unter
    gleichen Bedingungen 3.0 Deutschland (CC BY-NC-SA 3.0)" 
   http://creativecommons.org/licenses/by-nc-sa/3.0/de/deed.de
   
   Read the English translation here:
   
   "Attribution-NonCommercial-ShareAlike 3.0 Unported (CC BY-NC-SA 3.0)" 
   http://creativecommons.org/licenses/by-nc-sa/3.0/
   
--><!--<?xml-model href="file:../5.1/dbref.rnc" type="application/relax-ng-compact-syntax"?>--><section xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="dbc.structure.assemble-topics" remap="topic" userlevel="medium" xml:base="structure/topic.assemble-topics.xml">
  <title>Assembling Topics</title>
  <info>
    <definitions definitionfile="defs.xml"/>
    <keywordset>
      <keyword>assemblies</keyword>
      <keyword>topic</keyword>
    </keywordset>
    <subjectset>
      <subject>
        <subjectterm>assemblies</subjectterm>
        <subjectterm>modules</subjectterm>
        <subjectterm>topics</subjectterm>
      </subject>
    </subjectset>
  </info>
  
  <section role="problem">
    <title>Problem</title>
    <para>You want to convert an <tag>assembly</tag> structure and its associated
      modular files into a single DocBook 5 file.</para>
  </section>
  <section role="solution">
    <title>Solution</title>
    <para>You need the following prerequisites:</para>
    <orderedlist>
      <listitem>
        <para>An <emphasis>assembly file</emphasis>. This starts with
          the <tag xlink:href="http://www.docbook.org/tdg51/en/html/assembly.html">assembly</tag> root element from DocBook 5.1.
          The assembly file contains references to all of your modules
          which composes your realized DocBook document. Or in other
          words: the assembly file maps the modules to structure.
        </para>
      </listitem>
      <listitem>
        <para>The <filename>assembly/assemble.xsl</filename> stylesheet
          from the DocBook XSL distribution. Get the latest version as
          it is added in 2012.</para>
      </listitem>
      <listitem>
        <para>Your module files based on DocBook 5.</para>
      </listitem>
    </orderedlist>
    <para>Use <command>xsltproc</command> to create a single
      DocBook 5 (the variable <envar>DB</envar> contains the path
      of your DocBook XSL directory):</para>
    <screen><command>xsltproc</command> \
    $DB/assembly/assemble.xsl \
    assembly.xml</screen>
  </section>
  <section role="discussion">
    <title>Discussion</title>
    <para>The <filename>assemble.xsl</filename> stylesheet contains
      several parameters to influence the assembling process:</para>
    <table xml:id="tab.structure.assemble-topics.params">
      <title>Parameters to Influence the Assembling Process</title>
      <tgroup cols="2">
        <thead>
          <row>
            <entry>Parameter</entry>
            <entry>Description</entry>
          </row>
        </thead>
        <tbody>
          <row>
            <entry><parameter>root.default.renderas</parameter></entry>
            <entry>Sets the name of the root element of the assembled
              document, if not specified with <tag class="attribute">renderas</tag> attribute</entry>
          </row>
          <row>
            <entry><parameter>structure.id</parameter></entry>
            <entry>Selects one <tag>structure</tag> element from
              several; similar to the <parameter>rootid</parameter>
              parameter for the XHTML stylesheets</entry>
          </row>
          <row>
            <entry><parameter>topic.default.renderas</parameter></entry>
            <entry>Sets the name of the output element of any topic
              elements if not specified with <tag class="attribute">renderas</tag> attribute</entry>
          </row>
          <row>
            <entry><parameter>output.format</parameter></entry>
            <entry>Selects which of the possible output formats are
              being generated. The value of this parameter should match
              on a <tag class="attribute">format</tag> attribute on
              <tag>output</tag> elements.</entry>
          </row>
          <row>
            <entry><parameter>output.type</parameter></entry>
            <entry>Selects which structure element to process; the value
            should match with the <tag class="attribute">type</tag>
              attribute on a <tag>structure</tag> element</entry>
          </row>
        </tbody>
      </tgroup>
    </table>
    <para>The following subsections shows some specific examples to
      influence the assembling process.</para>
    <section xml:id="sec.structure.assemble-topics.structure.id">
      <title>Selecting a Structure by ID</title>
      <para>For example, your assembly file looks like this:</para>
      <programlisting language="xml">&lt;assembly version="5.1" xmlns="http://docbook.org/ns/docbook"&gt;
  &lt;resources&gt; ... &lt;/resources&gt;
  &lt;structure xml:id="quickstart"&gt; ... &lt;/structure&gt;
  &lt;structure xml:id="reference"&gt; ... &lt;/structure&gt;
&lt;/assembly&gt;</programlisting>
      <para>As you can see, you have two <tag>structure</tag> elements,
        one for a quick start, another for a reference. To process only
        the reference, set the parameter
          <parameter>structure.id</parameter> to the <tag class="attribute">xml:id</tag> of the reference as
        follows:</para>
      <screen><command>xsltproc</command> \
    --stringparam structure.id reference \
    $DB/assembly/assemble.xsl \
    assembly.xml</screen>
      <para>If you omit the <parameter>structure.id</parameter>
        parameter, the <filename>assemble.xsl</filename> stlyesheet
        selects always the first <tag>structure</tag> element.</para>
    </section>
    <section xml:id="sec.structure.assemble-topics.structure.">
      <title>Selecting a Structure by Type</title>
      <para>For example, your assembly file looks like this:</para>
      <programlisting language="xml">&lt;assembly version="5.1" xmlns="http://docbook.org/ns/docbook"&gt;
  &lt;resources&gt; ... &lt;/resources&gt;
  &lt;structure type="help.system"&gt; ... &lt;/structure&gt;
  &lt;structure type="startup"&gt; ... &lt;/structure&gt;
&lt;/assembly&gt;</programlisting>
      <para>As you can see, there are two <tag>structure</tag> elements,
        one for a help system, another for a startup. To process only
        the startup, set the parameter
          <parameter>output.type</parameter> as follows:</para>
      <screen><command>xsltproc</command> \
    --stringparam output.type startup \
    $DB/assembly/assemble.xsl \
    assembly.xml</screen>
    </section>
  </section>
  <section role="seealso">
    <title>See Also</title>
    <itemizedlist>
      <listitem>
        <para><xref linkend="dbc.structure.splitting-into-topics"/></para>
      </listitem>
      <listitem>
        <para><link xlink:href="http://www.docbook.org/tdg51/en/html/assembly.html"/></para>
      </listitem>      
    </itemizedlist>
  </section>
</section>
  <!--
    License CC BY-NC-SA 3.0
  
   This work is licensed under the 
   "Namensnennung – Keine kommerzielle Nutzung – Weitergabe unter
    gleichen Bedingungen 3.0 Deutschland (CC BY-NC-SA 3.0)" 
   http://creativecommons.org/licenses/by-nc-sa/3.0/de/deed.de
   
   Read the English translation here:
   
   "Attribution-NonCommercial-ShareAlike 3.0 Unported (CC BY-NC-SA 3.0)" 
   http://creativecommons.org/licenses/by-nc-sa/3.0/
   
--><!--<?xml-model href="file:../5.1/dbref.rnc" type="application/relax-ng-compact-syntax"?>--><section xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="dbc.structure.assembly-file" remap="topic" userlevel="easy" xml:base="structure/topic.create-assembly-file.xml">
  <title>Creating an Assembly File Manually</title>
  <info>
    <definitions definitionfile="defs.xml"/>
    <keywordset>
      <keyword>topic</keyword>
      <keyword>assemblies</keyword>
    </keywordset>
    <subjectset>
      <subject>
        <subjectterm>assemblies</subjectterm>
        <subjectterm>topics</subjectterm>
      </subject>
    </subjectset>
  </info>
  
  <section role="problem">
    <title>Problem</title>
    <para>You want create topic oriented documents with the
      <tag xlink:href="http://www.docbook.org/tdg51/en/html/assembly.html">assembly</tag> element manually.</para>
  </section>
  <section role="solution">
    <title>Solution</title>
    <para>In its simplest form, an assembly file contains the following elements:</para>
    <variablelist>
      <varlistentry>
        <term><tag>assembly</tag></term>
        <listitem>
          <para>The root element of an assembly file. It is bound to the
            DocBook 5 namespace
              <uri>http://docbook.org/ns/docbook</uri>.</para>
        </listitem>
      </varlistentry>
      <varlistentry>
        <term><tag>resources</tag></term>
        <listitem>
          <para>Wrapper element for a collection of topics. Each topic
            is identified by a <tag>resource</tag> element and its <tag class="attribute">xml:id</tag> or <tag class="attribute">fileref</tag> attributes:</para>
          <screen>&lt;resource xml:id="preface" fileref="preface.xml"/&gt;</screen>
          <para>An assembly file can contain more than one
            <tag>resource</tag> elements.</para>
        </listitem>
      </varlistentry>
      <varlistentry>
        <term><tag>structure</tag></term>
        <listitem>
          <para>Wrapper element for a document to be assembled.
            Primarily it contains of <tag>module</tag>s which refers to
            a <tag>resource</tag> elements.</para>
        </listitem>
      </varlistentry>
    </variablelist>
    <para>The following example assumes, the files are composed of
      <tag>topic</tag> root elements, except for the
      <filename>glossary.xml</filename> file (which is comprised by a
      <tag>glossary</tag> element). </para>
    <programlisting language="xml">&lt;assembly version="5.1" xmlns="http://docbook.org/ns/docbook"&gt;
  &lt;resources&gt;
    &lt;resource fileref="intro.xml" xml:id="intro"/&gt;
    &lt;resource fileref="kde.xml" xml:id="kde"/&gt;
    &lt;resource fileref="gnome.xml" xml:id="gnome"/&gt;
    &lt;resource fileref="glossary.xml" xml:id=""/&gt;
  &lt;/resources&gt;
  &lt;structure xml:id="user-guide"&gt;
    &lt;output renderas="book"/&gt;
    &lt;module resourceref="intro"/&gt;
    &lt;module resourceref="kde"/&gt;
    &lt;module resourceref="gnome"/&gt;
    &lt;module resourceref="glossary"/&gt;
  &lt;/structure&gt;
&lt;/assembly&gt;</programlisting>
    <para/>
  </section>
  <section role="discussion">
    <title>Discussion</title>
    <para>TDB
    </para>
  </section>
  <section role="seealso">
    <title>See Also</title>
    <itemizedlist role="category">
      <listitem>
        <para><link xlink:href="http://www.docbook.org/tdg51/en/html/ch06.html"/></para>
      </listitem>
      <!--<listitem>
        <para><xref linkend="dbc.structure.splitting-into-topics"/></para>
      </listitem>
      <listitem>
        <para><xref linkend="dbc.structure.assemble-topics"/></para>
      </listitem>-->
    </itemizedlist>
  </section>
</section>
  <!--<xi:include href="structure/topic.preserve-entities.xml"/>-->
  <!--<xi:include href="structure/topic.impl-style-checking.xml"/>-->
</chapter> 
  <!--
    License CC BY-NC-SA 3.0
  
   This work is licensed under the 
   "Namensnennung – Keine kommerzielle Nutzung – Weitergabe unter
    gleichen Bedingungen 3.0 Deutschland (CC BY-NC-SA 3.0)" 
   http://creativecommons.org/licenses/by-nc-sa/3.0/de/deed.de
   
   Read the English translation here:
   
   "Attribution-NonCommercial-ShareAlike 3.0 Unported (CC BY-NC-SA 3.0)" 
   http://creativecommons.org/licenses/by-nc-sa/3.0/
   
--><!--<?xml-model href="file:5.1/dbref.rnc" type="application/relax-ng-compact-syntax"?>--><chapter xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="dbc.fo" version="5.1">
  <title>Print Customizations</title>
  <info>
    <definitions definitionfile="defs.xml"/>
    <biblioid class="other" otherclass="ticket">9</biblioid>
    <keywordset>
      <keyword>fo customizations</keyword>
      <keyword>print</keyword>
      <keyword>XSL-FO</keyword>
    </keywordset>
    <abstract>
      <para>The DocBook XSL stylesheets has got more than 200 parameters
      which can customize some aspects of the layout very easily (like
      the page dimensions). This chapter shows customizations which go 
      beyond simple parameter change.</para>
    </abstract>
  </info>

  <section xml:id="dbc.fo.intro">
    <title>Introduction</title>
    <para>Currently, there is only one stylesheet available for creating
      FO output: <filename>fo/docbook.xsl</filename>. To be exact, this
      creates XSL-FO 1.1 output which is compatible with decent FO
      formatters.</para>
    <para>Furthermore, the DocBook FO stylesheets supports extensions
      which enables the formatter to implement specific features. These
      features go beyond the FO specifications like PDF bookmarks,
      indices, etc. Currently, the stylesheets support extensions from
      PTC's Arbortext, Antenna House's AXF, Apache's FOP, and RenderX's
      XEP.</para>
  </section>
  <!-- 
  Print Customizations
    - Designing Pages for Novels
    - Designing Pages for Lexicons, Referene Book and Catalogs
    - Designing Pages for Magazines and News Papers
    - Designing Pages for Technical Books
    - Adapting Chapter and Sections Titles
    - Make Font Sizes Consistent
    - Index
    - Hyphenating URLs
    - Designing TOCs
    - Colorizing Table Rows
    - Adding Logos in Title Page
    - Adding Logos in Header or Footer
    - Adding Current Time and Date Information
    - Separating Chapter Number from Titel
    - Footnotes
    - Marginalia
    - Endnotes
    - Adorning Paragraphs with Initials (Openings)
    - Formatting Titles
    - Numbering Titles
    - Choosing Open Source Fonts
    - Standardizing Font Sizes (Le Corbusier)
    - Adding Change Bars
    - Initials/Drop Caps
    - Influence Leading in Flow Text (=line-height in paras)
    - Hyphenating in Verbatim Environments (long lines in screen, programlisting)
    - Showing Cropmarks
      http://svn.apache.org/viewvc/xmlgraphics/fop/trunk/examples/fo/advanced/bleed-and-crop-marks.fo?view=markup&pathrev=800143
    - Barcode
    - Add Typographical Superiors and Inferiors
    - Adding Fonts to FO Formatter
    - Creating Page Definitions with Inkscape
    - Styling Labels Differently than Titles (Separating Labels and
      Titles) 
    - Using Text Figures http://en.wikipedia.org/wiki/Text_figures
    - Using MathML in Formulas
    - Influencing the TOC Bookmark Levels in PDF
  -->
  
  <!--
    License CC BY-NC-SA 3.0
  
   This work is licensed under the 
   "Namensnennung – Keine kommerzielle Nutzung – Weitergabe unter
    gleichen Bedingungen 3.0 Deutschland (CC BY-NC-SA 3.0)" 
   http://creativecommons.org/licenses/by-nc-sa/3.0/de/deed.de
   
   Read the English translation here:
   
   "Attribution-NonCommercial-ShareAlike 3.0 Unported (CC BY-NC-SA 3.0)" 
   http://creativecommons.org/licenses/by-nc-sa/3.0/
   
--><!--<?xml-model href="file:../5.1/dbref.rnc" type="application/relax-ng-compact-syntax"?>--><section xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="dbc.fo.design-titlepages" remap="topic" userlevel="medium" xml:base="fo/topic.design-titlepages.xml">
  <title>Designing a Title Page</title>
  <info>
    <definitions definitionfile="defs.xml"/>
    <keywordset>
      <keyword>title page</keyword>
      <keyword>cover</keyword>
      <keyword>recto page</keyword>
      <keyword>verso page</keyword>
      <keyword>title page template</keyword>
    </keywordset>
    <subjectset>
      <subject>
        <subjectterm>titlepage</subjectterm>
      </subject>
    </subjectset>
  </info>
  
  <section role="problem">
    <title>Problem</title>
    <para>You want to design a title page of your book or article.</para>
  </section>
  <section role="solution">
    <title>Solution</title>
    <para>To design your title page there are two ways to do it,
      regardless if it is a book or an article:</para>
    <orderedlist>
      <listitem>
        <formalpara>
          <title>Indirectly</title>
          <para>Write a title page template which contains the wanted
            elements in their respective order.</para>
        </formalpara>
      </listitem>
      <listitem>
        <formalpara>
          <title>Directly</title>
          <para>Customize the specific named templates.</para>
        </formalpara>
      </listitem>
    </orderedlist>
    <para>Both methods are shown below. Although the following
      descriptions focus on a book title page, the same procedure
      applies for an article title page as well.</para>
    <para>Before we customize the stylesheets, we need to define,
        <emphasis>what</emphasis> we want to display on our title
      page(s). Depending on if it is a left or a right page, different
      elements needs to be shown. For this example, we use the following
      requisites:</para>
    
    <itemizedlist xml:id="li.fo.design-titlepages.rectopage.defs">
      <title>Recto (Right) Page</title>
      <para>This is the <quote>main page</quote> and the content appears
      in the following order:</para>
      <listitem>
        <para>the book title, from <code>/book/title</code> or
            <code>/book/info/title</code></para>
      </listitem>
      <listitem>
        <para>the book subtitle, from <code>/book/subtitle</code> or
            <code>/book/info/subtitle</code></para>
      </listitem>
      <listitem>
        <para>the book's author, from
          <code>/book/info/author</code></para>
      </listitem>
      <listitem>
        <para>the edition, from <code>/book/info/edition</code></para>
      </listitem>
    </itemizedlist>
    <itemizedlist xml:id="li.fo.design-titlepages.versopage.defs">
      <title>Verso (Left) Page</title>
      <para>This usually holds the imprint and the content appears
      in the following order:</para>
      <listitem>
        <para>the book's title and subtitle in a smaller font
          size</para>
      </listitem>
      <listitem>
        <para>the author, from <code>/book/info/author</code></para>
      </listitem>
      <listitem>
        <para>the edition, from <code>/book/info/edition</code></para>
      </listitem>
      <listitem>
        <para>some legal text (copyright), from
            <code>/book/info/legalnotice</code></para>
      </listitem>
      <listitem>
        <para>the <acronym>ISBN<alt>International Standard Book Number</alt></acronym>, from
            <code>/book/info/biblioid</code> with <tag class="attribute">class</tag> and the value <tag class="attvalue">isbn</tag></para>
      </listitem>
    </itemizedlist>
    
    <section xml:id="dbc.fo.design-titlepages.titlepage.indirectly">
      <title>Using Title Page Templates</title>
      <para>To create a title page using a title page template proceed
        as follows:</para>
      <procedure xml:id="pro.fo.design-titlepages.titlepage.indirectly">
        <step>
          <para>Prepare the title page template:</para>
          <substeps>
            <step>
              <para>Copy the file
                <filename>fo/titlepage.templates.xml</filename> from the
                DocBook XSL stylesheet distribution to a directory where
                all your FO customization is stored. Use the filename
                <filename>booktitlepage.xml</filename> so we know, it
                contains only a title page for a book.</para>
            </step>
            <step>
              <para>Open the file <filename>booktitlepage.xml</filename>
                and remove anything except the
                root and <tag>t:titlepage</tag> elements with the
                attribute <tag class="attribute">t:element="book"</tag>.
                Your title page template should look like this:</para>
              <informalexample>
                <info>
                  <output xmlns="urn:x-toms:docbook-ext">
                    <filename>design-titlepages/booktitlepage.xml</filename>
                  </output>
                </info>
              <programlisting language="xml">&lt;!DOCTYPE t:templates [
&lt;!ENTITY hsize0 "10pt"&gt;
&lt;!ENTITY hsize1 "12pt"&gt;
&lt;!ENTITY hsize2 "14.4pt"&gt;
&lt;!ENTITY hsize3 "17.28pt"&gt;
&lt;!ENTITY hsize4 "20.736pt"&gt;
&lt;!ENTITY hsize5 "24.8832pt"&gt;
&lt;!ENTITY hsize0space "7.5pt"&gt; &lt;!-- 0.75 * hsize0 --&gt;
&lt;!ENTITY hsize1space "9pt"&gt; &lt;!-- 0.75 * hsize1 --&gt;
&lt;!ENTITY hsize2space "10.8pt"&gt; &lt;!-- 0.75 * hsize2 --&gt;
&lt;!ENTITY hsize3space "12.96pt"&gt; &lt;!-- 0.75 * hsize3 --&gt;
&lt;!ENTITY hsize4space "15.552pt"&gt; &lt;!-- 0.75 * hsize4 --&gt;
&lt;!ENTITY hsize5space "18.6624pt"&gt; &lt;!-- 0.75 * hsize5 --&gt;
]&gt;
&lt;t:templates xmlns:t="http://nwalsh.com/docbook/xsl/template/1.0"
             xmlns:param="http://nwalsh.com/docbook/xsl/template/1.0/param"
             xmlns:fo="http://www.w3.org/1999/XSL/Format"
             xmlns:xsl="http://www.w3.org/1999/XSL/Transform"&gt;
   &lt;t:titlepage t:element="book" t:wrapper="fo:block"&gt;
     &lt;!-- Content disabled for better legibility --&gt;
   &lt;/t:titlepage&gt;
&lt;/t:templates&gt;</programlisting>
              </informalexample>
            </step>
          </substeps>
        </step>
        <step>
          <para>Customize the content of your titlepage and save your
            changes into the <filename>booktitlepage.xml</filename>
            file.</para>
          <substeps>
            <step>
              <para>Change the recto page and locate the
                  <tag>t:titlepage-content</tag> element with its
                attribute <tag>t:side="recto"</tag>. As definied in
                  <xref linkend="li.fo.design-titlepages.rectopage.defs"/>, we
                remove everything what is not needed. Additionally we
                have to output edition, which we get from an empty <tag class="emptytag">edition</tag> tag. The content of the
                  <tag>t:titlepage-content</tag> should look like
                this:</para>
              <programlisting language="xml">&lt;t:titlepage-content t:side="recto"&gt;
  &lt;title     t:named-template="division.title"
             param:node="ancestor-or-self::book[1]"
             text-align="center"
             font-size="&amp;hsize5;"
             space-before="&amp;hsize5space;"
             font-weight="bold"
             font-family="{$title.fontset}"/&gt;
  &lt;subtitle  text-align="center"
             font-size="&amp;hsize4;"
             space-before="&amp;hsize4space;"
             font-family="{$title.fontset}"/&gt;
  &lt;author    font-size="&amp;hsize3;"
             space-before="&amp;hsize2space;"
             keep-with-next.within-column="always"/&gt;
  &lt;edition   font-size="&amp;hsize3;"/&gt;
&lt;/t:titlepage-content&gt;</programlisting>
            </step>
            <step>
              <para>Change the verso page and locate the
                  <tag>t:titlepage-content</tag> element with its
                attribute <tag>t:side="verso"</tag>. As definied in
                  <xref linkend="li.fo.design-titlepages.versopage.defs"/>, again,
                we remove everything what is not needed. The content of
                the <tag>t:titlepage-content</tag> should look like
                this: </para>
              <programlisting language="xml">&lt;t:titlepage-content t:side="verso"&gt;
  &lt;title     t:named-template="book.verso.title"
             font-size="&amp;hsize2;"
             font-weight="bold"
             font-family="{$title.fontset}"/&gt;
  &lt;subtitle  t:named-template="book.verso.title"
             font-size="&amp;hsize2;"
             font-weight="bold"
             font-family="{$title.fontset}"/&gt;
  &lt;author/&gt;
  &lt;edition/&gt;
  &lt;legalnotice/&gt;
  &lt;biblioid  t:predicate="[@class = 'isbn']"/&gt;
&lt;/t:titlepage-content&gt;</programlisting>
            </step>
            <step>
              <para>Leave the other elements
                  (<tag>t:titlepage-separator</tag> and
                  <tag>t:titlepage-before</tag>) as they are.</para>
            </step>
          </substeps>
        </step>
        <step>
          <para>Use the <filename>template/titlepage.xsl</filename>
            stylesheet from the DocBook XSL distribution to transform
            your <filename>booktitlepage.xml</filename> title page
            definition to create the
              <filename>booktitlepage.xsl</filename> output:</para>
          <screen><command>xsltproc</command> --output booktitlepage.xsl template/titlepage.xsl booktitlepage.xml</screen>
        </step>
        <step>
          <para>Insert the constructed
            <filename>booktitlepage.xsl</filename> into your
            customization layer <filename>mybooktitlepage.xsl</filename>:</para>
          <informalexample>
            <info>
              <output xmlns="urn:x-toms:docbook-ext">
                <filename>design-titlepages/mybooktitlepage.xsl</filename>
              </output>
            </info>
            <programlisting language="xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;xsl:stylesheet version="1.0"
  xmlns:fo="http://www.w3.org/1999/XSL/Format"
  xmlns:xsl="http://www.w3.org/1999/XSL/Transform"&gt;
  
  &lt;xsl:import href="http://docbook.sourceforge.net/release/xsl-ns/current/fo/docbook.xsl"/&gt;
  &lt;xsl:include href="booktitlepage.xsl"/&gt;
  &lt;!-- More customizations hidden --&gt;
&lt;/xsl:stylesheet&gt;</programlisting>
          </informalexample>
          
        </step>
        <step>
          <para>Build your book as usual with your customization layer.</para>
        </step>
      </procedure>
    </section>
    <section xml:id="dbc.fo.design-titlepages.titlepage.directly">
      <title>Customizing Title Pages Directly</title>  
      <para>To create a title page directly using named templates
        proceed as follows:</para>
      
      <procedure xml:id="pro.fo.design-titlepages.titlepage.directly">
        <step>
          <para>Open the file
            <filename>fo/titlepage.templates.xsl</filename> of your
            DocBook XSL stylesheet distribution.</para>
        </step>
        <step>
          <para>Search for the correct template name(s). A template name is
            composed of the following components, wheras <replaceable>ELEMENT</replaceable>
            and <replaceable>SIDE</replaceable> are placeholders:
          </para>
          <screen><replaceable>ELEMENT</replaceable>.titlepage.<replaceable>SIDE</replaceable></screen>
          <para>As we want to change the title page of a book for the
            left (verso) and right (recto) pages, the correct 
            template names are <function>book.titlepage.recto</function>
            and <function>book.titlepage.verso</function>.</para>
        </step>
        <step>
          <para>Create a new file, for example
              <filename>booktitlepage.xsl</filename>. This will contain all our
            customizations of our book's title page. </para>
        </step>
        <step>
          <para>Copy the <function>book.titlepage.recto</function> and
              <function>book.titlepage.verso</function> templates into
            your new file <filename>booktitlepage.xsl</filename>.</para>
        </step>
        <step>
          <para>Customize the template
              <function>book.titlepage.recto</function> according to the
            definitions in 
              <xref linkend="li.fo.design-titlepages.rectopage.defs"/>:</para>
          <substeps>
            <step>
              <para>Leave the two <tag>xsl:choose</tag> conditions intact to
                select the book's title and subtitle.</para>
            </step>
            <step>
              <para>Insert after the last <tag class="endtag">xsl:choose</tag> the following line to select the
                book's author from <code>d:info/d:author</code>:</para>
              <programlisting>&lt;xsl:apply-templates mode="book.titlepage.recto.auto.mode" select="d:info/d:author"/&gt;</programlisting>
            </step>
            <step>
              <para>Insert the following line to select the book's
                edition from <code>d:info/d:edition</code>:</para>
              <programlisting>&lt;xsl:apply-templates mode="book.titlepage.recto.auto.mode" select="d:info/d:edition"/&gt;</programlisting>
            </step>
            <step>
              <para>Remove the other <tag>xsl:apply-templates</tag>
                elements as we only want to display the title, subtitle,
                author, and the editor. The template should look like
                this:</para>
              <programlisting language="xml">&lt;xsl:template name="book.titlepage.recto"&gt;
  &lt;xsl:choose&gt;
    &lt;xsl:when test="d:bookinfo/d:title"&gt;
      &lt;xsl:apply-templates mode="book.titlepage.recto.auto.mode" select="d:bookinfo/d:title"/&gt;
    &lt;/xsl:when&gt;
    &lt;xsl:when test="d:info/d:title"&gt;
      &lt;xsl:apply-templates mode="book.titlepage.recto.auto.mode" select="d:info/d:title"/&gt;
    &lt;/xsl:when&gt;
    &lt;xsl:when test="d:title"&gt;
      &lt;xsl:apply-templates mode="book.titlepage.recto.auto.mode" select="d:title"/&gt;
    &lt;/xsl:when&gt;
  &lt;/xsl:choose&gt;
              
  &lt;xsl:choose&gt;
    &lt;xsl:when test="d:bookinfo/d:subtitle"&gt;
      &lt;xsl:apply-templates mode="book.titlepage.recto.auto.mode" select="d:bookinfo/d:subtitle"/&gt;
    &lt;/xsl:when&gt;
    &lt;xsl:when test="d:info/d:subtitle"&gt;
      &lt;xsl:apply-templates mode="book.titlepage.recto.auto.mode" select="d:info/subtitle"/&gt;
    &lt;/xsl:when&gt;
    &lt;xsl:when test="d:subtitle"&gt;
      &lt;xsl:apply-templates mode="book.titlepage.recto.auto.mode" select="d:subtitle"/&gt;
    &lt;/xsl:when&gt;
  &lt;/xsl:choose&gt;
  
  &lt;xsl:apply-templates mode="book.titlepage.recto.auto.mode" select="d:info/d:author"/&gt;
  &lt;xsl:apply-templates mode="book.titlepage.recto.auto.mode" select="d:info/d:edition"/&gt;
&lt;/xsl:template&gt;</programlisting>
            </step>
          </substeps>
        </step>
        <step>
          <para>Customize the template
              <function>book.titlepage.verso</function> according to the
            definitions in <xref linkend="li.fo.design-titlepages.versopage.defs"/>
            (note the different mode):</para>
          <substeps>
            <step>
              <para>Leave the two <tag>xsl:choose</tag> conditions intact to
                select the book's title and subtitle.</para>
            </step>            
            <step>
              <para>Insert after the last <tag class="endtag">xsl:choose</tag>
                the following line to select the book's author
                from <code>d:info/d:author</code>:</para>
              <programlisting>&lt;xsl:apply-templates mode="book.titlepage.verso.auto.mode" select="d:info/d:author"/&gt;</programlisting>
            </step>
            <step>
              <para>Insert the following line to select the book's
                edition from <code>d:info/d:edition</code>:</para>
              <programlisting>&lt;xsl:apply-templates mode="book.titlepage.verso.auto.mode" select="d:info/d:edition"/&gt;</programlisting>
            </step>
            <step>
              <para>Insert the following line to select some legal text
                from <code>d:info/d:legalnotice</code>:</para>
              <programlisting>&lt;xsl:apply-templates mode="book.titlepage.verso.auto.mode" select="d:info/d:legalnotice"/&gt;</programlisting>
            </step>            
            <step>
              <para>Insert the following line to select the book's ISBN
                number from <code>d:info/d:biblioid</code>:</para>
               <programlisting>&lt;xsl:apply-templates mode="book.titlepage.verso.auto.mode"
    select="d:info/d:biblioid[@class='isbn']"/&gt;</programlisting>
            </step>            
            <step>
              <para>Remove the other <tag>xsl:apply-templates</tag>
                elements as we only want display the title, subtitle,
                author, editor, legal text, and the ISBN number. The
                template should look like this:</para>
              <programlisting language="xml">&lt;xsl:template name="book.titlepage.verso"&gt;
  &lt;xsl:choose&gt;
    &lt;xsl:when test="d:bookinfo/d:title"&gt;
      &lt;xsl:apply-templates mode="book.titlepage.verso.auto.mode" select="d:bookinfo/d:title"/&gt;
    &lt;/xsl:when&gt;
    &lt;xsl:when test="d:info/d:title"&gt;
      &lt;xsl:apply-templates mode="book.titlepage.verso.auto.mode" select="d:info/d:title"/&gt;
    &lt;/xsl:when&gt;
    &lt;xsl:when test="d:title"&gt;
      &lt;xsl:apply-templates mode="book.titlepage.verso.auto.mode" select="d:title"/&gt;
    &lt;/xsl:when&gt;
  &lt;/xsl:choose&gt;
              
  &lt;xsl:choose&gt;
    &lt;xsl:when test="d:bookinfo/d:subtitle"&gt;
      &lt;xsl:apply-templates mode="book.titlepage.verso.auto.mode" select="d:bookinfo/d:subtitle"/&gt;
    &lt;/xsl:when&gt;
    &lt;xsl:when test="d:info/d:subtitle"&gt;
      &lt;xsl:apply-templates mode="book.titlepage.verso.auto.mode" select="d:info/d:subtitle"/&gt;
    &lt;/xsl:when&gt;
    &lt;xsl:when test="d:subtitle"&gt;
      &lt;xsl:apply-templates mode="book.titlepage.verso.auto.mode" select="d:subtitle"/&gt;
    &lt;/xsl:when&gt;
  &lt;/xsl:choose&gt;
  
  &lt;xsl:apply-templates mode="book.titlepage.verso.auto.mode" select="d:info/d:author"/&gt;
  &lt;xsl:apply-templates mode="book.titlepage.verso.auto.mode" select="d:info/d:editor"/&gt;
  &lt;xsl:apply-templates mode="book.titlepage.verso.auto.mode" select="d:info/d:legalnotice"/&gt;
  &lt;xsl:apply-templates mode="book.titlepage.verso.auto.mode" select="d:info/d:biblioid[@class='isbn']"/&gt; 
&lt;/xsl:template&gt;</programlisting>
            </step>
          </substeps>
        </step>
        <step>
          <para>Insert the constructed
            <filename>booktitlepage.xsl</filename> into your
            customization layer <filename>mybooktitlepage.xsl</filename>:</para>
          <programlisting language="xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;xsl:stylesheet version="1.0"
  xmlns:fo="http://www.w3.org/1999/XSL/Format"
  xmlns:xsl="http://www.w3.org/1999/XSL/Transform"&gt;
  
  &lt;xsl:import href="http://docbook.sourceforge.net/release/xsl-ns/current/fo/docbook.xsl"/&gt;
  &lt;xsl:include href="booktitlepage.xsl"/&gt;
  &lt;!-- More customizations hidden --&gt;
&lt;/xsl:stylesheet&gt;</programlisting>
        </step>
        <step>
          <para>Build your book as usual with your customization layer.</para>
        </step>
      </procedure>

    </section>
  </section>
  <section role="discussion">
    <title>Discussion</title>
    <para>There are several reasons to customize a title page:</para>
    <itemizedlist>
      <listitem>
        <para>You want a different order of the default elements</para>
      </listitem>
      <listitem>
        <para>You want to show or hide elements</para>
      </listitem>
      <listitem>
        <para>You want to insert corporate logos, links, or other
          graphical illustrations</para>
      </listitem>
      <listitem>
        <para>You want to distinguish between a document in draft or in
          final state.</para>
      </listitem>
    </itemizedlist>
    
    <para>All these requirements can be done, either with the direct or
      indirect method. Apart from your own preferences, use the direct
      method if you have more complicated conditions which can not be
      expressed by simple title page definitions. Sometimes it is faster to
      just add the respective named template instead of going through
      the indirect method. </para>
    <para>Regardless which method you prefer, it ends up with the same
      named templates. For a book title page, the named templates are
      called in the following order, starting with
        <function>book.titlepage</function>:</para>
    <screen linenumbering="unnumbered">book.titlepage
  book.titlepage.before.recto
  book.titlepage.recto
  book.titlepage.before.verso
  book.titlepage.verso
  book.titlepage.separator</screen>
    <para>Usually, the <function>book.titlepage</function> template is
      only customized in rare cases. For example, if you want to revamp
      the previous schema completely and add additional pages like
        <phrase xlink:href="http://en.wikipedia.org/wiki/Half_title">half titles</phrase>. Each of the templates in
        <function>book.titlepage</function> are responsible for a
      different setup of a title page. We discussed the <function>book.titlepage.recto</function>
      and <function>book.titlepage.verso</function> templates already.
      The templates <function>book.titlepage.separator</function> and
        <function>book.titlepage.before.verso</function> contain page
      breaks, whereas <function>book.titlepage.before.recto</function>
      is empty.</para>
    <para>Note, all of the above templates process title page elements
      in a special mode. As you have seen in <xref linkend="dbc.fo.design-titlepages.titlepage.directly"/>, elements for a
      recto page are processed in the
        <code>book.titlepage.recto.auto.mode</code> mode. The same
      principle applies for a verso page and its mode
        <code>book.titlepage.verso.auto.mode</code>. However, not all
      elements have a template with such modes as not all elements can
      (and should) appear on a title page. Look into the file
        <filename>fo/titlepage.templates.xsl</filename> to see which are
      definied. Assume title and subtitle have already templates for
      recto and verso pages as well as all the elements which are listed
      in the original <function>book.titlepage.verso</function> and
      <function>book.titlepage.recto</function>.</para>
    <para>For example, the <tag>edition</tag> element has certainly no
      templates for a recto and verso book title page. If you do not
      have definied one, a fallback mechanism takes place. For this
      reason, if you call a element in <function>book.titlepage.verso</function> and
      <function>book.titlepage.recto</function>, you need also to define
      the respective templates: </para>
    <programlisting language="xml">&lt;xsl:template match="d:edition" mode="book.titlepage.recto.auto.mode"&gt;
   &lt;!-- Add your code for a recto page --&gt;
&lt;/xsl:template&gt;
    
&lt;xsl:template match="d:edition" mode="book.titlepage.verso.auto.mode"&gt;
   &lt;!-- Add your code for a verso page --&gt;
&lt;/xsl:template&gt;</programlisting>
    <para>Usually, you want to display the edition on a recto page
    different than on a verso page.</para>
  </section>
  <section role="seealso">
    <title>See Also</title>
    <itemizedlist role="category">
      <listitem>
        <para><link xlink:href="http://www.sagehill.net/docbookxsl/HTMLTitlePage.html"/></para>
      </listitem>
    </itemizedlist>
  </section>
</section>
  <!--
    License CC BY-NC-SA 3.0
  
   This work is licensed under the 
   "Namensnennung – Keine kommerzielle Nutzung – Weitergabe unter
    gleichen Bedingungen 3.0 Deutschland (CC BY-NC-SA 3.0)" 
   http://creativecommons.org/licenses/by-nc-sa/3.0/de/deed.de
   
   Read the English translation here:
   
   "Attribution-NonCommercial-ShareAlike 3.0 Unported (CC BY-NC-SA 3.0)" 
   http://creativecommons.org/licenses/by-nc-sa/3.0/
   
--><!--<?xml-model href="file:../5.1/dbref.rnc" type="application/relax-ng-compact-syntax"?>--><section xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="dbc.fo.style-titlepages" remap="topic" userlevel="medium" xml:base="fo/topic.style-titlepages.xml">
  <title>Styling Title Pages</title>
  <info>
    <definitions definitionfile="defs.xml"/>
    <keywordset>
      <keyword>title page</keyword>
      <keyword>style title page</keyword>
    </keywordset>
    <subjectset>
      <subject>
        <subjectterm>titlepage</subjectterm>
      </subject>
    </subjectset>
  </info>
  
  <section role="problem">
    <title>Problem</title>
    <para>You do not want to overhaul the default title pages, but you
      want to change small things, like the font size, margins, or
      other stylistic parameters. </para>
  </section>
  <section role="solution">
    <title>Solution</title>
    <para>The difficulty is to find the correct template to customize.
      Here is a general procedure how to do this:</para>
    
    <procedure xml:id="pro.fo.style-titlepages">
      <title>Finding the Correct Template to Customize for a Title Page</title>
      <step>
        <para>Open the file
          <filename>fo/titlepage.templates.xsl</filename> from your
          DocBook XSL distribution.</para>
      </step>
      <step>
        <para>Determine the following parameters and write it down or
          memorize it:</para>
        <itemizedlist>
          <listitem>
            <para>The title page which you want to customize (usually 
              something like book, chapter, etc.), refered as
              <replaceable>DIVISION</replaceable></para>
          </listitem>
          <listitem>
            <para>The element on that title page, referred as
              <replaceable>ELEMENT</replaceable></para>
          </listitem>
          <listitem>
            <para>The side, be it recto (right) or verso (left), refered
            as <replaceable>SIDE</replaceable>.</para>
          </listitem>
        </itemizedlist>
      </step>
      <step xml:id="st.fo.style-titlepages.compose-template">
        <para>Compose a template in your mind from the previous parameters and
          replace the placeholders:</para>
        <programlisting language="xml">&lt;xsl:template match="<replaceable>ELEMENT</replaceable>" mode="<replaceable>DIVISION</replaceable>.titlepage.<replaceable>SIDE</replaceable>.auto.mode"&gt;</programlisting>
      </step>
      <step>
        <para>Try to find the template from <xref linkend="st.fo.style-titlepages.compose-template"/> in
          <filename>fo/titlepage.templates.xsl</filename>.</para>
      </step>
      <step>
        <para>If you have found the template depicted in <xref linkend="st.fo.style-titlepages.compose-template"/>, copy it
          to your customization layer. If there is no such template,
          create a new one with the same signature.</para>
      </step>
      <step>
        <para>Customize the template.</para>
      </step>
      <step>
        <para>Build your document with your customization layer.</para>
      </step>
    </procedure>
    
  </section>
  <section role="discussion">
    <title>Discussion</title>
    <para>To make the general explanations a bit more useful, here is a
      small example: you want to change the font size for the title of a book's recto
      title page. Applying <xref linkend="pro.fo.style-titlepages"/>
      leads to the following template:</para>
    <screen>&lt;xsl:template match="<emphasis role="strong" xlink:title="The ELEMENT placeholder">d:title</emphasis>" mode="<emphasis role="strong" xlink:title="The DIVISION placeholder">book</emphasis>.titlepage.<emphasis role="strong" xlink:title="The SIDE placeholder">recto</emphasis>.auto.mode"&gt;</screen>
    <para>After you have copied it to your customization layer, you can
      change the <tag class="attribute">font-size</tag> (marked bold):</para>
    <programlisting language="xml">&lt;xsl:template match="d:title" mode="book.titlepage.recto.auto.mode"&gt;
  &lt;fo:block xmlns:fo="http://www.w3.org/1999/XSL/Format" 
     xsl:use-attribute-sets="book.titlepage.recto.style" 
     text-align="center" 
     <emphasis role="strong">font-size="40pt"</emphasis>
     space-before="18.6624pt" 
     font-weight="bold" 
     font-family="{$title.fontset}"&gt;
    &lt;xsl:call-template name="division.title"&gt;
      &lt;xsl:with-param name="node" select="ancestor-or-self::d:book[1]"/&gt;
    &lt;/xsl:call-template&gt;
  &lt;/fo:block&gt;
&lt;/xsl:template&gt;</programlisting>
    <para>In the previous example, the font size was changed from
      the original value of <literal>24.8832pt</literal> to
      <literal>40pt</literal>. The other objects are unchanged. Other
      attributes can be changed as needed.</para>
    
  </section>
  <section role="seealso">
    <title>See Also</title>
    <para><xref linkend="dbc.fo.design-titlepages"/></para>
  </section>
</section>
  <!--
    License CC BY-NC-SA 3.0
  
   This work is licensed under the 
   "Namensnennung – Keine kommerzielle Nutzung – Weitergabe unter
    gleichen Bedingungen 3.0 Deutschland (CC BY-NC-SA 3.0)" 
   http://creativecommons.org/licenses/by-nc-sa/3.0/de/deed.de
   
   Read the English translation here:
   
   "Attribution-NonCommercial-ShareAlike 3.0 Unported (CC BY-NC-SA 3.0)" 
   http://creativecommons.org/licenses/by-nc-sa/3.0/
   
--><!--<?xml-model href="file:../5.1/dbref.rnc" type="application/relax-ng-compact-syntax"?>--><section xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="dbc.fo.line-height" remap="topic" userlevel="easy" xml:base="fo/topic.line-height.xml">
  <title>Influencing the Leading</title>
  <info>
    <definitions definitionfile="defs.xml"/>
    <keywordset>
      <keyword>line height</keyword>
      <keyword>leading</keyword>
      <keyword>half-leading</keyword>
      <keyword>font size</keyword>
    </keywordset>
    <othercredit>
      <personname>
        <firstname>Tony</firstname>
        <surname>Graham</surname>
      </personname>
    </othercredit>
    <subjectset>
      <subject>
        <subjectterm>fontsize</subjectterm>
      </subject>
    </subjectset>
  </info>
  
  <section role="problem">
    <title>Problem</title>
    <para>You want to change the leading between consecutive lines of text.</para>
  </section>
  <section role="solution">
    <title>Solution</title>
    <para>Leading is the distance from one baseline to the next, or in
      other words, the <quote>interlinear space.</quote> It is not the
      same as the line height. Unfortunately, the FO specification named
      the property for influencing the leading
        <property>line-height</property> which makes it confusing. </para>
    <para>The DocBook stylesheets introduce the parameter
        <parameter>line-height</parameter> with the same name and
      functionality. It acts as a placeholder for the above
        <property>line-height</property> property. The following
      examples do all the same (except for the value <tag class="attvalue">normal</tag>). It is assumed, you have a base
      font size of 10pt; negative values in
        <property>line-height</property> are not allowed:</para>
    <variablelist>
      <varlistentry>
        <term><tag class="attvalue">normal</tag></term>
        <listitem>
          <para>This is the default value. The real value is set by the
            formatter and depends on the font size, usually it is a
            value between 1.0 and 1.2. <remark>Say more about the real
              value</remark></para>
        </listitem>
      </varlistentry>
      <varlistentry>
        <term>Length</term>
        <listitem>
          <para>Sets the line height of the respective value:</para>
          <screen>&lt;xsl:param name="line-height"&gt;12pt&lt;/xsl:param&gt;</screen>
          <para>The leading is 2pt (12pt − 10pt).</para>
        </listitem>
      </varlistentry>
      <varlistentry>
        <term>Number</term>
        <listitem>
          <para>Sets the line height is the result of  the value
            multiplied by the font size:</para>
          <screen>&lt;xsl:param name="line-height"&gt;1.2&lt;/xsl:param&gt;</screen>
        </listitem>
      </varlistentry>
      <varlistentry>
        <term>Percentage</term>
        <listitem>
          <para>Sets the line height is the result of the percentage
            value multiplied by the font size:</para>
          <screen>&lt;xsl:param name="line-height"&gt;120%&lt;/xsl:param&gt;</screen>
        </listitem>
      </varlistentry>
    </variablelist>
    
  </section>
  <section role="discussion">
    <title>Discussion</title>
    <para>Unfortunately, the situation with line height in FO is a bit more
      complicated as it first seems. Usually, this is what most people
      expects:</para>
    <screen>First line
 [Gap]
Second Line
 [Gap]
Third Line
 [Gap]</screen>
    <para>However, the <property>line-height</property> property is a
      <quote>half-leading</quote> value which are added before and
      after a line. This leads to the more realistic picture:</para>
    <screen> [1/2 Gap]
First line
 [1/2 Gap]
 [1/2 Gap]
Second Line
 [1/2 Gap]
 [1/2 Gap]
Third Line
 [1/2 Gap]</screen>
    <para>If the line height is constant in each line, the effect is the
      same (except at the top or bottom of a reference area). According
      to the FO specification of <tag class="attribute">line-height</tag> the FO property is a <emphasis xlink:href="http://www.w3.org/TR/xsl11/#spacecond">compound
        datatype</emphasis> which has minimum, optimum, maximum, conditionally,
      and precedence. The minimum, optimum, and maximum constraints are
      length</para>
    
    <para>That said, leading has a direct influence on how easy a text
      is read. If the value is too small, consecutive lines gets
      overlapped. If the value is too big, the cohersion of text gets
      lost. Most text requires positive leading. Usually 9pt/11pt,
      10pt/12pt, 11pt/13pt, and 12pt/15pt are the most common (the two
      values depicting the font size and line height).</para>
    <para>According to <personname>
        <firstname>Robert</firstname>
        <surname>Bringhurst</surname></personname> in his book
        <citetitle>The Elements of Typographic Style</citetitle> he
      recommends more lead in the following situations (cited from his
      book from page 37):</para>
    <itemizedlist>
      <listitem>
        <para>Dark faces need more lead than light ones</para>
      </listitem>
      <listitem>
        <para>Large-bodied faces need more lead than smaller-bodied ones</para>
      </listitem>
      <listitem>
        <para>Unserifed faces often need more lead (or a shorter line)
          than their serifed counterparts</para>
      </listitem>
      <listitem>
        <para>Text with thickened by superscripts, subscripts,
          mathematical expressions, or the frequent use of full
          capitals</para>
      </listitem>
    </itemizedlist>
  </section>
  <section role="seealso">
    <title>See Also</title>
    <itemizedlist>
      <listitem>
        <para><link xlink:href="http://en.wikipedia.org/wiki/Leading"/>, the Wikipedia
        article about leading</para>
      </listitem>
      <listitem>
        <para><link xlink:href="http://www.w3.org/TR/xsl11/#line-height"/>, the
          definition of line-height in the XSL-FO specification</para>
      </listitem>
      <listitem>
        <para><link xlink:href="http://old.nabble.com/Line-height-vs.-line-spacing-td30185507.html"/>, the answer from <personname>
            <firstname>Tony</firstname>
            <surname>Graham</surname>
          </personname> about the question <quote>Line height vs. line
            spacing</quote> which influenced this topic</para>
      </listitem>
    </itemizedlist>

  </section>
</section>
  <!--
    License CC BY-NC-SA 3.0
  
   This work is licensed under the 
   "Namensnennung – Keine kommerzielle Nutzung – Weitergabe unter
    gleichen Bedingungen 3.0 Deutschland (CC BY-NC-SA 3.0)" 
   http://creativecommons.org/licenses/by-nc-sa/3.0/de/deed.de
   
   Read the English translation here:
   
   "Attribution-NonCommercial-ShareAlike 3.0 Unported (CC BY-NC-SA 3.0)" 
   http://creativecommons.org/licenses/by-nc-sa/3.0/
   
--><!--<?xml-model href="file:../5.1/dbref.rnc" type="application/relax-ng-compact-syntax"?>--><section xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="dbc.fo.hyphen-urls" remap="topic" userlevel="medium" xml:base="fo/topic.hyphenating-urls.xml">
  <title>Hyphenating URLs</title>
  <info>
    <keywordset>
      <keyword>hyphenation</keyword>
      <keyword>URLs</keyword>
      <keyword>zero width space</keyword>
      <keyword>soft hyphen</keyword>
    </keywordset>
    <subjectset>
      <subject>
        <subjectterm>hyphenation</subjectterm>
      </subject>
    </subjectset>
    <definitions definitionfile="defs.xml"/>
  </info>
  
  <section role="problem">
    <title>Problem</title>
    <para>You have URLs or paths which you want to hyphenate correctly.
      The URLs have to break on slashes or other characters only, but
      not between words.</para>
  </section>
  <section role="solution">
    <title>Solution</title>
    <para>The hyphenation of URLs in the DocBook stylesheets are
      controlled by two parameters: <parameter xlink:href="http://docbook.sourceforge.net/release/xsl/current/doc/fo/ulink.hyphenate.html" xlink:show="new">ulink.hyphenate</parameter> and <parameter xlink:href="http://docbook.sourceforge.net/release/xsl/current/doc/fo/ulink.hyphenate.chars.html" xlink:show="new">ulink.hyphenate.chars</parameter>. The first
      parameter, if not empty, turns on hyphenation. Specify a
      hyphenation character, usually either a Unicode soft hyphen
      (U+00AD) or a Unicode zero-width space (U+200B). </para>
    <para>The second parameter,
        <parameter>ulink.hyphenate.chars</parameter>, let you define
      your allowable hyphenation points. The default value is a slash
      (/), but URLs can contain more characters where it is desirable to
      hyphenate. For this reason, the DocBook parameter reference recommends the
      following value: </para>
    <screen>&lt;xsl:param name="ulink.hyphenate.chars"&gt;:/@&amp;?.#&lt;/xsl:param</screen>
  </section>
  <section role="discussion">
    <title>Discussion</title>
    <para>The easiest way is to set the parameters
        <parameter>ulink.hyphenate.chars</parameter> and
        <parameter>ulink.hyphenate</parameter> to the values showed in
      the last section and be happy. However, for professional needs,
      this is not enough. The parameters and embedded algorithm
      do not take into account protocols, for example <systemitem class="protocol">http</systemitem>. Protocols begin with
      the schema followed by <literal>://</literal> as in
      <literal>http://</literal>. In some situations (although
      rare), a hyphenation can occur between the double slashes or before
      the colon. Furthermore, according to the <citetitle>Chicago
        Manual of Style</citetitle>, it is desirable to distinguish
      characters <emphasis>before</emphasis> and
        <emphasis>after</emphasis> the hyphenation takes place.</para>
    <para>All these requirements are implemented in the stylesheet showed in
      <xref linkend="ex.hyphenate-url.xsl"/>. It cuts off the protocol
      with its <literal>://</literal> and iterates through each
      characters and checks, if a hyphenation point needs to be inserted
      before or after it.</para>
    <example xml:id="ex.hyphenate-url.xsl">
      <title><filename>hyphenate-url.xsl</filename></title>
      <info>
        <output xmlns="urn:x-toms:docbook-ext">
          <filename>hyphen-urls/hyphenate-url.xsl</filename>
        </output>
      </info>
      <programlisting language="xml" linenumbering="numbered">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;xsl:stylesheet version="1.0"
    xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
    xmlns:fo="http://www.w3.org/1999/XSL/Format"&gt;

&lt;xsl:template name="hyphenate-url"&gt;
  &lt;xsl:param name="url" select="''"/&gt;

  &lt;!-- Remove the "schema://" prefix, so it disturbs not the
       algorithm in "hyphenate-url-string" --&gt;
  &lt;xsl:choose&gt;
   &lt;xsl:when test="$ulink.hyphenate = ''"&gt;
      &lt;xsl:value-of select="$url"/&gt;
   &lt;/xsl:when&gt;
   &lt;xsl:when test="contains($url, '://')"&gt;
      &lt;xsl:value-of select="substring-before($url, '://')"/&gt;
      &lt;xsl:text&gt;://&lt;/xsl:text&gt;
      &lt;xsl:copy-of select="$ulink.hyphenate"/&gt;
      &lt;xsl:call-template name="hyphenate-url-string"&gt;
        &lt;xsl:with-param name="url" select="substring-after($url, '://')"/&gt;
      &lt;/xsl:call-template&gt;
   &lt;/xsl:when&gt;
   &lt;xsl:otherwise&gt;
      &lt;xsl:call-template name="hyphenate-url-string"&gt;
        &lt;xsl:with-param name="url" select="normalize-space($url)"/&gt;
      &lt;/xsl:call-template&gt;
   &lt;/xsl:otherwise&gt;
  &lt;/xsl:choose&gt;
&lt;/xsl:template&gt;


&lt;xsl:template name="hyphenate-url-string"&gt;
  &lt;xsl:param name="url" select="''"/&gt;
  &lt;xsl:variable name="char" select="substring($url, 1,1)"/&gt;

  &lt;xsl:choose&gt;
   &lt;xsl:when test="$url=''"/&gt;
   &lt;!-- Insert breakpoint _before_ the character --&gt;
   &lt;xsl:when test="contains($ulink.hyphenate.before.chars, $char)"&gt;
     &lt;xsl:value-of select="concat($ulink.hyphenate, $char)"/&gt;
     &lt;xsl:call-template name="hyphenate-url-string"&gt;
       &lt;xsl:with-param name="url" select="substring($url, 2)"/&gt;
     &lt;/xsl:call-template&gt;
   &lt;/xsl:when&gt;
   &lt;!-- Insert breakpoint _after_ the character --&gt;
   &lt;xsl:when test="contains($ulink.hyphenate.after.chars, $char)"&gt;
     &lt;xsl:value-of select="concat($char, $ulink.hyphenate)"/&gt;
     &lt;xsl:call-template name="hyphenate-url-string"&gt;
       &lt;xsl:with-param name="url" select="substring($url, 2)"/&gt;
     &lt;/xsl:call-template&gt;
   &lt;/xsl:when&gt;
   &lt;xsl:otherwise&gt;
     &lt;xsl:value-of select="$char"/&gt;
     &lt;xsl:call-template name="hyphenate-url-string"&gt;
       &lt;xsl:with-param name="url" select="substring($url, 2)"/&gt;
     &lt;/xsl:call-template&gt;
   &lt;/xsl:otherwise&gt;
  &lt;/xsl:choose&gt;
&lt;/xsl:template&gt;
&lt;/xsl:stylesheet&gt;</programlisting>
    </example>
    
    <para>Include the above stylesheet into your customization layer
      with additionally the following parameters:</para>
    <programlisting language="xml">&lt;!-- Insert breakpoint /before/ the following characters: --&gt;
&lt;xsl:param name="ulink.hyphenate.before.chars"
  &gt;.,%?&amp;amp;#\-+{_&lt;/xsl:param&gt;
&lt;!-- Insert breakpoint /after/ the following characters: --&gt;
&lt;xsl:param name="ulink.hyphenate.after.chars"
  &gt;/:@=};&lt;/xsl:param&gt;</programlisting>
    
  </section>
  <!--<section role="seealso">
    <title>See Also</title>
    <para></para>
  </section>-->
</section>
  <!--
    License CC BY-NC-SA 3.0
  
   This work is licensed under the 
   "Namensnennung – Keine kommerzielle Nutzung – Weitergabe unter
    gleichen Bedingungen 3.0 Deutschland (CC BY-NC-SA 3.0)" 
   http://creativecommons.org/licenses/by-nc-sa/3.0/de/deed.de
   
   Read the English translation here:
   
   "Attribution-NonCommercial-ShareAlike 3.0 Unported (CC BY-NC-SA 3.0)" 
   http://creativecommons.org/licenses/by-nc-sa/3.0/
   
--><!--<?xml-model href="file:../5.1/dbref.rnc" type="application/relax-ng-compact-syntax"?>--><section xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="dbc.fo.initials" remap="topic" userlevel="easy" xml:base="fo/topic.initials.xml">
  <title>Creating Initials and Drop Caps</title>
  <info>
    <definitions definitionfile="defs.xml"/>
    <keywordset>
      <keyword>initials</keyword>
      <keyword>drop caps</keyword>
      <keyword>floats</keyword>
    </keywordset>
  </info>
  
  <section role="problem">
    <title>Problem</title>
    <para>You need a <quote>drop cap</quote>, or <link xlink:href="http://en.wikipedia.org/wiki/Initial">Initial</link>,
      which is a <quote>a letter at the beginning of a work, a chapter,
        or a paragraph that is larger than the rest of the
      text.</quote></para>
  </section>
  <section role="solution">
    <title>Solution</title>
    <para>Typographically, you have different options to place initials:</para>
    <itemizedlist>
      <listitem>
        <para>on the same baseline as the first line of text,</para>
      </listitem>
      <listitem>
        <para>as floats, embedded between two or more lines,</para>
      </listitem>
      <listitem>
        <para>besides the left margin of the text block without
          indentation.</para>
      </listitem>
    </itemizedlist>
    <para>Additionally you can design your initials as graphics, but we
    will come to this later.</para>
    
    <section xml:id="sec.fo.initials.baseline">
      <title>Place Initials on the Same Baseline</title>
      <para>This is the easiest method to implement. The stylesheet
        normalizes the text node of the first paragraph, extract the first character
        and wrap it between an <tag>fo:inline</tag> element with font
        size, family, and weight:</para>
      <example xml:id="ex.initials-baseline.xsl">
        <title><filename>initials-baseline.xsl</filename></title>
        <info>
          <output xmlns="urn:x-toms:docbook-ext">
            <filename>initials/initials-baseline.xsl</filename>
          </output>
        </info>
        <programlisting language="xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;xsl:stylesheet version="1.0"
  xmlns:fo="http://www.w3.org/1999/XSL/Format"
  xmlns:xsl="http://www.w3.org/1999/XSL/Transform"&gt;
  
  &lt;xsl:param name="drop.caps.size"&gt;20pt&lt;/xsl:param&gt;
  &lt;xsl:param name="drop.caps.font-family" select="$body.font.family"/&gt;
  &lt;xsl:param name="drop.caps.font-weight"&gt;bold&lt;/xsl:param&gt;
  
  &lt;xsl:template name="create.initial"&gt;
    &lt;xsl:param name="initial" select="substring(normalize-space(.),1,1)"/&gt;
    &lt;fo:inline&gt;
      &lt;fo:inline font-size="{$drop.caps.size}"
        font-weight="{$drop.caps.font-weight}"
        font-family="{$drop.caps.font-family}"&gt;
        &lt;xsl:copy-of select="$initial"/&gt;
      &lt;/fo:inline&gt;
      &lt;xsl:value-of select="substring(normalize-space(.), 2)"/&gt;
    &lt;/fo:inline&gt;
  &lt;/xsl:template&gt;
&lt;/xsl:stylesheet&gt;</programlisting>
      </example>
      <para>To use it, include it into your customization layer. It is
        usually called in text nodes like the first paragraph from a
        section which parent is an article:</para>
      
      <informalexample>
        <info>
          <output xmlns="urn:x-toms:docbook-ext">
            <filename>initials/db-initials.xsl</filename>
          </output>
        </info>
        <programlisting language="xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;!DOCTYPE xsl:stylesheet 
[
 &lt;!ENTITY db "http://docbook.sourceforge.net/release/xsl-ns/current"&gt; 
]&gt;
&lt;xsl:stylesheet version="1.0"
  xmlns:d="http://docbook.org/ns/docbook"
  xmlns:xsl="http://www.w3.org/1999/XSL/Transform"&gt;
  
  &lt;xsl:import href="&amp;db;/fo/docbook.xsl"/&gt;
  &lt;xsl:include href="initials-baseline.xsl"/&gt;
  
  &lt;xsl:template match="d:article/d:section/d:para[1]/text()"&gt;
    &lt;xsl:call-template name="create.initial"/&gt;
  &lt;/xsl:template&gt;
&lt;/xsl:stylesheet&gt;</programlisting>
      </informalexample>
      
      <para>It is easy to extend it to chapters, you just have to copy
        the template and correct the content in the <tag class="attribute">match</tag> attribute to:</para>
      <programlisting>&lt;xsl:template<!--
       --> match="d:chapter/d:section/d:para[1]/text()"&gt;</programlisting>
    </section>
    <section xml:id="sec.fo.initials.floats">
      <title>Implement Initials as Floats</title>
      <para><remark>TBD</remark></para>
    </section>
    <section xml:id="sec.fo.initials.margin">
      <title>Place Initials in Left Margin</title>
      <para><remark>TBD</remark></para>
    </section>
  </section>
  <section role="discussion">
    <title>Discussion</title>
    <para>The solution described in <xref linkend="sec.fo.initials.baseline"/> is in most cases sufficient.
      However, if the first character is <emphasis>not</emphasis> a
      letter, any character is incorrectly made an initial.</para>
  </section>
  <section role="seealso">
    <title>See Also</title>
    <para>Find information about the property <tag class="attribute">line-height</tag> in <xref linkend="dbc.fo.line-height"/>.</para>
  </section>
</section>
  <!--
    License CC BY-NC-SA 3.0
  
   This work is licensed under the 
   "Namensnennung – Keine kommerzielle Nutzung – Weitergabe unter
    gleichen Bedingungen 3.0 Deutschland (CC BY-NC-SA 3.0)" 
   http://creativecommons.org/licenses/by-nc-sa/3.0/de/deed.de
   
   Read the English translation here:
   
   "Attribution-NonCommercial-ShareAlike 3.0 Unported (CC BY-NC-SA 3.0)" 
   http://creativecommons.org/licenses/by-nc-sa/3.0/
   
--><!--<?xml-model href="file:../5.1/dbref.rnc" type="application/relax-ng-compact-syntax"?>--><section xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="dbc.fo.number-titles" remap="topic" userlevel="easy" xml:base="fo/topic.number-titles.xml">
  <title>Numbering Part, Chapter, Appendix, and other Titles</title>
  <info>
    <definitions definitionfile="defs.xml"/>
    <keywordset>
      <keyword>titles</keyword>
      <keyword>numbering</keyword>
      <keyword>appendix.autolabel</keyword>
      <keyword>chapter.autolabel</keyword>
      <keyword>part.autolabel</keyword>
      <keyword>preface.autolabel</keyword>
      <keyword>qandadiv.autolabel</keyword>
      <keyword>reference.autolabel</keyword>
      <keyword>section.autolabel</keyword>
      <keyword>section.label.includes.component.label</keyword>
      <keyword>component.label.includes.part.label</keyword>
      <keyword>label.from.part</keyword>
      <keyword>section.autolabel.max.depth</keyword>
    </keywordset>
    <subjectset>
      <subject>
        <subjectterm>titles</subjectterm>
      </subject>
    </subjectset>
  </info>
  
  <section role="problem">
    <title>Problem</title>
    <para>You want a number in front of your structural elements like
        <tag>appendix</tag>, <tag>chapter</tag>, <tag>section</tag>,
      etc.</para>
  </section>
  <section role="solution" xml:id="sec.fo.number-titles.solution">
    <title>Solution</title>
    <para>The DocBook XSL stylesheets provide already a decent numbering
      scheme for high level divisions like parts, appendices, chapters,
      and references. The most common use is numbering section. If you
      want to automatically number section titles, set the
        <parameter>section.autolabel</parameter> parameter either
      manually or through a customization layer, for example: </para>
    <programlisting language="xml">&lt;xsl:param name="section.autolabel" select="1"/&gt;</programlisting>
  </section>
  <section role="discussion">
    <title>Discussion</title>
    <para>The DocBook XSL stylesheets contain autolabel parameters for
      the common elements <tag>appendix</tag>, <tag>chapter</tag>,
        <tag>part</tag>, <tag>preface</tag>, <tag>qandadiv</tag>,
        <tag>reference</tag>, and <tag>section</tag>. These can be set
      individually to change the numbering of for the same elements. The
      default values are shown in <xref linkend="tab.fo.number-titles.autolabel"/>. </para>
    <table xml:id="tab.fo.number-titles.autolabel">
      <title>Autolabel Parameters and their Default Values</title>
      <tgroup cols="3">
        <thead>
          <row>
            <entry>Parameter</entry>
            <entry>Default</entry>
            <entry>Example</entry>
          </row>
        </thead>
        <tbody>
          <row>
            <entry><parameter>appendix.autolabel</parameter></entry>
            <entry><literal>A</literal></entry>
            <entry>Appendix A. Python 3</entry>
          </row>
          <row>
            <entry><parameter>chapter.autolabel</parameter></entry>
            <entry><literal>1</literal></entry>
            <entry>Chapter 1. A Tutorial Introduction</entry>
          </row>
          <row>
            <entry><parameter>part.autolabel</parameter></entry>
            <entry><literal>I</literal></entry>
            <entry>Part I. The Python Language</entry>
          </row>
          <row>
            <entry><parameter>preface.autolabel</parameter></entry>
            <entry><literal>0</literal></entry>
            <entry>Prefaces are usually not numbered</entry>
          </row>
          <row>
            <entry><parameter>qandadiv.autolabel</parameter></entry>
            <entry><literal>1</literal></entry>
            <entry>3.1 Installation Questions</entry>
          </row>
          <row>
            <entry><parameter>reference.autolabel</parameter></entry>
            <entry><literal>I</literal></entry>
            <entry>I. Python Reference</entry>
          </row>
          <row>
            <entry><parameter>section.autolabel</parameter></entry>
            <entry><literal>0</literal></entry>
            <entry>Not numbered by default</entry>
          </row>
        </tbody>
      </tgroup>
    </table>
    
    <para>The autolabel parameters can contain the following
      values:</para>
    
    <variablelist>
      <varlistentry>
        <term>Value <literal>0</literal></term>
        <listitem>
          <para>A value of zero disables the automatic numbering. For
            example, if you want to disable automatic numbering for
            appendix elements, use this:</para>
          <programlisting language="xml">&lt;xsl:param name="appendix.autolabel" select="0"/&gt;</programlisting>
        </listitem>
      </varlistentry>
      <varlistentry>
        <term>Value <literal>1</literal></term>
        <listitem>
          <para>A value of one enables the automatic numbering and uses
            arabic numerals. For example, section numbering is disabled
            by default. Use the code in the <xref xrefstyle="select:title" linkend="sec.fo.number-titles.solution"/> section.</para>
        </listitem>
      </varlistentry>
      <varlistentry>
        <term>String</term>
        <listitem>
          <para>A string enables a different automatic numbering schema,
            for example roman numerals. See the following table to get
            an overview. </para>
          <table xml:id="tab.fo.">
            <title>Possible Formats for Autolabel Parameters</title>
            <tgroup cols="4">
              <thead>
                <row>
                  <entry>Value</entry>
                  <entry>Alternative Value</entry>
                  <entry>Style</entry>
                  <entry>Example</entry>
                </row>
              </thead>
              <tbody>
                <row>
                  <entry><literal>1</literal></entry>
                  <entry><literal>arabic</literal></entry>
                  <entry>Arabic numerals</entry>
                  <entry>1, 2, 3, 4, …</entry>
                </row>
                <row>
                  <entry><literal>I</literal></entry>
                  <entry><literal>upperroman</literal></entry>
                  <entry>Uppercase roman numerals</entry>
                  <entry>I, II, III, IV, …</entry>
                </row>
                <row>
                  <entry><literal>i</literal></entry>
                  <entry><literal>lowerroman</literal></entry>
                  <entry>Lowercase roman numerals</entry>
                  <entry>i, ii, iii, iv, …</entry>
                </row>
                <row>
                  <entry><literal>A</literal></entry>
                  <entry><literal>upperalpha</literal></entry>
                  <entry>Uppercase letters</entry>
                  <entry>A, B, C, D, …</entry>
                </row>
                <row>
                  <entry><literal>a</literal></entry>
                  <entry><literal>loweralpha</literal></entry>
                  <entry>Lowercase letters</entry>
                  <entry>a, b, c, d, …</entry>
                </row>
                <row>
                  <entry><tag class="numcharref">x661</tag></entry>
                  <entry><literal>arabicindic</literal></entry>
                  <entry>Arabic-Indic numerals</entry>
                  <entry>١, ٢, ٣, ٤, …</entry>
                </row>
              </tbody>
            </tgroup>
          </table>
        </listitem>
      </varlistentry>
    </variablelist>
    
    <para>Mostly you will probably want sections to be numbered
      including its parent numbering. If you do not touch
        <parameter>chapter.autolabel</parameter>, use the parameter
        <parameter>section.label.includes.component.label</parameter>
      and set it to <literal>1</literal>:</para>
    <programlisting language="xml">&lt;xsl:param name="section.autolabel" select="1"/&gt;
&lt;xsl:param name="section.label.includes.component.label" select="1"/&gt;</programlisting>
    
    <para>With the following parameters you can further customize your 
      numbering:</para>
    
    <variablelist>
      <varlistentry>
        <term><parameter>component.label.includes.part.label</parameter></term>
        <listitem>
          <para>Controls if appendix or chapter number labels are
          prefixed with their contained part label. </para>
        </listitem>
      </varlistentry>
      <varlistentry>
        <term><parameter>label.from.part</parameter></term>
        <listitem>
          <para>Defines if the components inside a part is renumbered or
          not. A value of non-zero restarts the chapter number and
          counts again from one. Use this numbering if you want
          unambiguous numerals.</para>
          <para>The value zero (the default) restarts the component
          number throughout each book.</para>
        </listitem>
      </varlistentry>
      <varlistentry>
        <term><parameter>section.autolabel.max.depth</parameter></term>
        <listitem>
          <para>Controls which sections get a number. By default, all
            sections are get numbered (default value is
              <literal>8</literal>.) If you want to number only sections
            at level 1, set the parameter to the value
              <literal>1</literal>.</para>
        </listitem>
      </varlistentry>
    </variablelist>
   
    <para>Let us assume the following structure in a book:</para>
    
    <screen>Part: The Python Language
  Chapter: A Tutorial Introduction
     Section: Running Python
     Section: Variables

  Chapter: Lexical Conventions and Syntax
     Section: Line Structure and Indentation
     Section: Identifiers and Reserved Words

Part: The Python Library
  Chapter: Build-In Functions
     Section: Build-In Functions and Types
     Section: Build-In Exceptions
  Chapter: Python Runtime Services
     Section: atext
     Section: copy</screen>
    
    <table>
      <title>Parameter Combinations</title>
      <tgroup cols="2">
        <thead>
          <row>
            <entry>Parameters</entry>
            <entry>Result</entry>
          </row>
        </thead>
        <tbody valign="top">
          <row>
            <entry>No parameters set, using the default settings</entry>
            <entry><screen linenumbering="unnumbered">I. The Python Language
  1. A Tutorial Introduction
      Running Python
      Variables
  2. Lexical Conventions and Syntax
      Line Structure and Indentation
      Identifiers and Reserved Words
II. The Python Library
  3. Build-In Functions
      Build-In Functions and Types
      Build-In Exceptions
  4. Python Runtime Services
      atext
      copy</screen></entry>
          </row>
          <row>
            <entry><simplelist type="vert">
              <member><literal>section.autolabel=1</literal></member>
            </simplelist></entry>
            <entry><screen linenumbering="unnumbered">I. The Python Language
  1. A Tutorial Introduction
      1. Running Python
      2. Variables
  2. Lexical Conventions and Syntax
      1. Line Structure and Indentation
      2. Identifiers and Reserved Words
II. The Python Library
  3. Build-In Functions
      1. Build-In Functions and Types
      2. Build-In Exceptions
  4. Python Runtime Services
      1. atexit
      2. copy</screen></entry>
          </row>
          <row>
            <entry><simplelist type="vert">
              <member><literal>section.autolabel=1</literal></member>
              <member><literal>section.label.includes.component.label=1</literal></member>
            </simplelist></entry>
            <entry><screen linenumbering="unnumbered">I. The Python Language
  1. A Tutorial Introduction
      1.1. Running Python
      1.2. Variables
  2. Lexical Conventions and Syntax
      2.1. Line Structure and Indentation
      2.2. Identifiers and Reserved Words
II. The Python Library
  3. Build-In Functions
      3.1. Build-In Functions and Types
      3.2. Build-In Exceptions
  4. Python Runtime Services
      4.1. atexit
      4.2. copy</screen></entry>
          </row>
          <row>
            <entry><simplelist type="vert">
              <member><literal>section.autolabel=1</literal></member>
              <member><literal>section.label.includes.component.label=1</literal></member>
              <member><literal>component.label.includes.part.label</literal></member>
            </simplelist></entry>
            <entry><screen linenumbering="unnumbered">I. The Python Language
  I.1. A Tutorial Introduction
      I.1.1. Running Python
      I.1.2. Variables
  I.2. Lexical Conventions and Syntax
      I.2.1. Line Structure and Indentation
      I.2.2. Identifiers and Reserved Words
II. The Python Library
  II.3. Build-In Functions
      II.3.1. Build-In Functions and Types
      II.3.2. Build-In Exceptions
  II.4. Python Runtime Services
      II.4.1. atexit
      II.4.2. copy</screen></entry>
          </row>
          <row>
            <entry><simplelist type="vert">
              <member><literal>section.autolabel=1</literal></member>
              <member><literal>section.label.includes.component.label=1</literal></member>
              <member><literal>component.label.includes.part.label</literal></member>
              <member><literal>label.from.part=1</literal></member>
            </simplelist></entry>
            <entry><screen linenumbering="unnumbered">I. The Python Language
  I.1. A Tutorial Introduction
      I.1.1. Running Python
      I.1.2. Variables
  I.2. Lexical Conventions and Syntax
      I.2.1. Line Structure and Indentation
      I.2.2. Identifiers and Reserved Words
II. The Python Library
  II.1. Build-In Functions
      II.1.1. Build-In Functions and Types
      II.1.2. Build-In Exceptions
  II.2. Python Runtime Services
      II.2.1. atexit
      II.2.2. copy</screen></entry>
          </row>
        </tbody>
      </tgroup>
    </table>
   
    <para>However, when dealing with other numbering systems, the above
      parameters are not enough. To support, for example, Japanese numbering,
      you need to customize the named template
      <function>autolabel.format</function> from
      <filename>common/labels.xsl</filename>.</para>
    
    <example xml:id="ex.fo.extending-autolabel.format">
      <title>Extending <function>autolabel.format</function></title>
      <programlisting language="xml">&lt;xsl:template name="autolabel.format"&gt;
  &lt;xsl:param name="context" select="."/&gt;
  &lt;xsl:param name="format"/&gt;

  &lt;xsl:choose&gt;
    &lt;xsl:when test="string($format) != 0"&gt;
      &lt;xsl:choose&gt;
        &lt;xsl:when test="string($format)='001'"&gt;
          &lt;xsl:value-of select="$format"/&gt;
        &lt;/xsl:when&gt;
        &lt;xsl:when test="$format='loweralpha' or $format='a'"&gt;
          &lt;xsl:value-of select="'a'"/&gt;
        &lt;/xsl:when&gt;
        &lt;xsl:when test="$format='lowerroman' or $format='i'"&gt;
          &lt;xsl:value-of select="'i'"/&gt;
        &lt;/xsl:when&gt;
        &lt;xsl:when test="$format='upperalpha' or $format='A'"&gt;
          &lt;xsl:value-of select="'A'"/&gt;
        &lt;/xsl:when&gt;
        &lt;xsl:when test="$format='upperroman' or $format='I'"&gt;
          &lt;xsl:value-of select="'I'"/&gt;
        &lt;/xsl:when&gt;
        &lt;xsl:when test="$format='arabicindic' or $format='١'"&gt;
          &lt;xsl:value-of select="'١'"/&gt;
        &lt;/xsl:when&gt;
        <emphasis role="bold">&lt;xsl:when test="$format='japanese' or $format='&amp;#x4e00;'"&gt;
          &lt;xsl:value-of select="'&amp;#x4e00;'"/&gt;
        &lt;/xsl:when&gt;</emphasis>
        &lt;xsl:otherwise&gt;
          &lt;xsl:message&gt;
            &lt;xsl:text&gt;Unexpected &lt;/xsl:text&gt;
            &lt;xsl:value-of select="local-name(.)"/&gt;
            &lt;xsl:text&gt;.autolabel value: &lt;/xsl:text&gt;
            &lt;xsl:value-of select="$format"/&gt;
            &lt;xsl:text&gt;; using default.&lt;/xsl:text&gt;
          &lt;/xsl:message&gt;
          &lt;xsl:call-template name="default.autolabel.format"/&gt;
        &lt;/xsl:otherwise&gt;
      &lt;/xsl:choose&gt;
    &lt;/xsl:when&gt;
  &lt;/xsl:choose&gt;
&lt;/xsl:template&gt;</programlisting>
    </example>
    
    <para>Unfortunately, the <command>xsltproc</command> processor does
      not support this currently (as in version 1.1.24). Only Saxon does
      it correct.</para>
  </section>
  
  <section role="seealso">
    <title>See Also</title>
    <itemizedlist>
      <listitem>
        <para><link xlink:href="http://www.sagehill.net/docbookxsl/SectionNumbering.html"/></para>
      </listitem>
      <listitem>
        <para><link xlink:href="http://en.wikipedia.org/wiki/Category:Numerals"/></para>
      </listitem>
    </itemizedlist>
  </section>
</section>
  <!--<xi:include href="fo/topic.sep-label-and-titles.xml"/>-->
  <!--<xi:include href="fo/topic.pagedefs-with-inkscape.xml"/>-->
  <!--<xi:include href="fo/topic.empty-header-and-footer.xml"/>-->
  
</chapter>  
  <!--
    License CC BY-NC-SA 3.0
  
   This work is licensed under the 
   "Namensnennung – Keine kommerzielle Nutzung – Weitergabe unter
    gleichen Bedingungen 3.0 Deutschland (CC BY-NC-SA 3.0)" 
   http://creativecommons.org/licenses/by-nc-sa/3.0/de/deed.de
   
   Read the English translation here:
   
   "Attribution-NonCommercial-ShareAlike 3.0 Unported (CC BY-NC-SA 3.0)" 
   http://creativecommons.org/licenses/by-nc-sa/3.0/
   
--><!-- <?xml-model href="file:5.1/dbref.rnc" type="application/relax-ng-compact-syntax"?>--><chapter xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="dbc.html" version="5.1">
  <title>(X)HTML Customizations</title>
  <info>
    <definitions definitionfile="defs.xml"/>
    <biblioid class="other" otherclass="ticket">10</biblioid>
    <keywordset>
      <keyword>html customizations</keyword>
      <keyword>online</keyword>
      <keyword>XHTML</keyword>
      <keyword>HTML</keyword>
      <keyword>HTML5</keyword>
    </keywordset>
    <abstract>
      <para>HTML is a very important output format for the DocBook XSL
        stylesheets as it is not only displayed on Web sites, but also
        used <quote>inside</quote> ebooks (<acronym>EPUB<alt>Electronic
          PUBlication</alt></acronym>). It comes in several derivates.</para>
    </abstract>
  </info>
  
  <section xml:id="dbc.html.intro">
    <title>Introduction</title>
    <para>Currently, there are several HTML derivates available as
      target formats. As such, <quote>the</quote> HTML does not exist,
      only a variety of HTML dialects:</para>
    
    <table xml:id="tab.html.intro.overview">
      <title>Overview of Different HTML Stylesheets</title>
      <tgroup cols="2">
        <colspec colwidth="1.5*"/>
        <colspec colwidth="5*"/>
        <thead>
          <row>
            <entry>Main Stylesheets</entry>
            <entry>Explanation</entry>
          </row>
        </thead>
        <tbody>
          <row>
            <entry><simplelist>
                <member><filename>eclipse/eclipse.xsl</filename></member>
                <member><filename>eclipse/eclipse3.xsl</filename></member>
            </simplelist>
            </entry>
            <entry>Contains stylesheet to document for the <link xlink:href="http://www.ibm.com/developerworks/opensource/library/os-echelp/">Eclipse help system</link>. The main stylesheets use code
            from the HTML 4.x stylesheets</entry>
          </row>
          <row>
            <entry><simplelist>
                <member><filename>html/chunk.xsl</filename></member>
                <member><filename>html/docbook.xsl</filename></member>
              </simplelist>
            </entry>
            <entry>Contains stylesheets the <quote>classical</quote> 
            <acronym xlink:href="http://www.w3.org/TR/html4/">HTML 4</acronym>.</entry>
          </row>
          <row>
            <entry><filename>htmlhelp/htmlhelp.xsl</filename></entry>
            <entry>Contains stylesheets for <acronym xlink:href="http://en.wikipedia.org/wiki/Microsoft_Compiled_HTML_Help">HTMLHelp</acronym>, the standard help
            system from Windows 3.0 through Windows XP. The main
            stylesheet <filename>htmlhelp.xsl</filename> uses code from
            the HTML 4.x stylesheets</entry>
          </row>
          <row>
            <entry><filename>webhelp/xsl/webhelp.xsl</filename></entry>
            <entry>Contains the result of the <acronym>GSOC<alt>Google
                Summer of Code</alt></acronym> 2010 and creates a Web
              page with a sidebar, search form, and hierarchical
              navigation. The stylesheet incorporates the XHTML
              stylesheets.</entry>
          </row>
          <row>
            <entry><simplelist>
                <member><filename>website/chunk-website.xsl</filename></member>
                <member><filename>website/website.xsl</filename></member>
              </simplelist>
            </entry>
            <entry>Contains stylesheets to create a <quote>Web
            site</quote></entry>
          </row>
          <row>
            <entry><simplelist>
                <member><filename>xhtml/chunk.xsl</filename></member>
                <member><filename>xhtml/docbook.xsl</filename></member>
              </simplelist>
            </entry>
            <entry>Contains stylesheets for <acronym xlink:href="http://www.w3.org/TR/xhtml1/">XHTML 1.0</acronym>
              (<quote>transitional XHTML</quote>). These stylesheets are
            generated through a XSLT transformation from the HTML core
            stylesheets</entry>
          </row>
          <row>
            <entry><simplelist>
                <member><filename>xhtml-1_1/chunk.xsl</filename></member>
                <member><filename>xhtml-1_1/docbook.xsl</filename></member>
              </simplelist>
            </entry>
            <entry>Contains stylesheets for <acronym xlink:href="http://www.w3.org/TR/xhtml11/">XHTML 1.1</acronym>. Like the one
            for XHTML, they are generated through a XSLT transformation.
            In comparison, the XHTML 1.1 omits certain attributes which
            were allowed in XHTML or HTML. The missing part must be
            implemented by CSS.
            The XHTML 1.1 stylesheets are also used for EPUB creation.</entry>
          </row>
          <row>
            <entry><simplelist>
                <member><filename>xhtml5/chunk.xsl</filename></member>
                <member><filename>xhtml5/docbook.xsl</filename></member>
              </simplelist>
            </entry>
            <entry>Contains stylesheets for <acronym xlink:href="http://dev.w3.org/html5/spec/Overview.html">HTML 5</acronym>.
            These stylesheets customizes the XHTML stylesheets. As such
            it inherits all the features and parameters.
            The HTML 5 stylesheets are also used for EPUB3 creation.
            </entry>
          </row>
        </tbody>
      </tgroup>
    </table>
  </section>
  
  <!-- 
  (X)HTML Customizations
    * Control chunking 
    * Attaching CSS (to your HTML) (explain different methods)
    * Alt Text for Images
    * Syntax Highlighting
    * Adding Permalinks
    * Creating Breadcrumbs (simple, sophisticated)
    * Implementing Clickable TOCs
    * Deciding where to put Customizations (CSS or XSLT)
    * Integrating Google's Web Fonts
  -->
  <!--
    License CC BY-NC-SA 3.0
  
   This work is licensed under the 
   "Namensnennung – Keine kommerzielle Nutzung – Weitergabe unter
    gleichen Bedingungen 3.0 Deutschland (CC BY-NC-SA 3.0)" 
   http://creativecommons.org/licenses/by-nc-sa/3.0/de/deed.de
   
   Read the English translation here:
   
   "Attribution-NonCommercial-ShareAlike 3.0 Unported (CC BY-NC-SA 3.0)" 
   http://creativecommons.org/licenses/by-nc-sa/3.0/
   
--><!--<?xml-model href="file:../5.1/dbref.rnc" type="application/relax-ng-compact-syntax"?>--><section xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="dbc.html.authors-in-toc" remap="topic" userlevel="medium" xml:base="html/topic.authors-in-toc.xml">
  <title>Adding Authors to Table of Contents</title>
  <info>
    <definitions definitionfile="defs.xml"/>
    <keywordset>
      <keyword>table of contents</keyword>
      <keyword>TOC</keyword>
      <keyword>authors</keyword>
      <keyword>proceedings</keyword>
    </keywordset>
    <subjectset>
      <subject>
        <subjectterm>tocs</subjectterm>
      </subject>
    </subjectset>
  </info>
  
  <section role="problem">
    <title>Problem</title>
    <para>You have a document which is written by different authors
      (like in proceedings) and want to include the author names in the
      table of contents.</para>
  </section>
  <section role="solution">
    <title>Solution</title>
    <para>You need to customize the <function>toc.line</function>
      template. Proceed as follows:</para>
    
    <procedure xml:id="pro.html.authors-in-toc">
      <step>
        <para>Make sure your chapters, appendices, sections, etc.
          contain at least one author, like in the following example:</para>
        <programlisting language="xml"><![CDATA[<sect1>
  <title>How to Become a Linux Mascott</title>
  <info>
    <author>
      <personname>
        <firstname>Tux</firstname>
        <surname>Penguin</surname>
      </personname>
    </author>
  </info>
  <!-- ... -->
</sect1>]]></programlisting>
      </step>
      <step>
        <para>Create a customization layer first as shown in <xref linkend="dbc.common.dbcustomize"/>.</para>
      </step>
      <step>
        <para>Add the following line to your customization layer:</para>
        <programlisting language="xml"><![CDATA[<xsl:include href="autotoc.xsl"/>]]></programlisting>
      </step>
      <step>
        <para>Create a new file <filename>autotoc.xsl</filename> in the
          same directory, with the following contents:</para>
        <informalexample xml:id="ex.html.authors-in-toc">
          <!--<title><filename>autotoc.xsl</filename></title>-->
          <info>
            <output xmlns="urn:x-toms:docbook-ext">
              <filename>author-in-toc/autotoc.xsl</filename>
            </output>
          </info>          
          <programlistingco>
            <areaspec>
              <area xml:id="ar.html.authors-in-toc.author" coords="10 74" units="linecolumn"/>
              <area xml:id="ar.html.authors-in-toc.if" coords="12" units="linecolumn"/>
              <area xml:id="ar.html.authors-in-toc.call" coords="14" units="linecolumn"/>
              <area xml:id="ar.html.authors-in-toc.span" coords="20" units="linecolumn"/>
            </areaspec>
            <programlisting language="xml" linenumbering="numbered">&lt;xsl:stylesheet version="1.0"
  xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
  xmlns="http://www.w3.org/1999/xhtml"&gt;
  
  &lt;xsl:template name="toc.line"&gt;
    &lt;xsl:param name="toc-context" select="."/&gt;
    &lt;xsl:param name="depth" select="1"/&gt;
    &lt;xsl:param name="depth.from.context" select="8"/&gt;

    &lt;xsl:variable name="author" select="*/author|*/authorgroup/author"/&gt;

    &lt;xsl:if test="$author"&gt;
      &lt;span class="author"&gt;
        &lt;xsl:call-template name="person.name.list"&gt;
          &lt;xsl:with-param name="person.list" select="$author"/&gt;
        &lt;/xsl:call-template&gt;
        &lt;xsl:text&gt;: &lt;/xsl:text&gt;
      &lt;/span&gt;
    &lt;/xsl:if&gt;
    &lt;span class="{local-name(.)}"&gt;
      &lt;xsl:if test="$autotoc.label.in.hyperlink = 0"&gt;
        &lt;xsl:variable name="label"&gt;
          &lt;xsl:apply-templates select="." mode="label.markup"/&gt;
        &lt;/xsl:variable&gt;
        &lt;xsl:copy-of select="$label"/&gt;
        &lt;xsl:if test="$label != ''"&gt;
          &lt;xsl:value-of select="$autotoc.label.separator"/&gt;
        &lt;/xsl:if&gt;
      &lt;/xsl:if&gt;

      &lt;a&gt;
        &lt;xsl:attribute name="href"&gt;
          &lt;xsl:call-template name="href.target"&gt;
            &lt;xsl:with-param name="context" select="$toc-context"/&gt;
            &lt;xsl:with-param name="toc-context" select="$toc-context"/&gt;
          &lt;/xsl:call-template&gt;
        &lt;/xsl:attribute&gt;

        &lt;xsl:if test="not($autotoc.label.in.hyperlink = 0)"&gt;
          &lt;xsl:variable name="label"&gt;
            &lt;xsl:apply-templates select="." mode="label.markup"/&gt;
          &lt;/xsl:variable&gt;
          &lt;xsl:copy-of select="$label"/&gt;
          &lt;xsl:if test="$label != ''"&gt;
            &lt;xsl:value-of select="$autotoc.label.separator"/&gt;
          &lt;/xsl:if&gt;
        &lt;/xsl:if&gt;

        &lt;xsl:apply-templates select="." mode="titleabbrev.markup"/&gt;
      &lt;/a&gt;
    &lt;/span&gt;
  &lt;/xsl:template&gt;
&lt;/xsl:stylesheet&gt;</programlisting>
          </programlistingco>
          <calloutlist>
            <callout arearefs="ar.html.authors-in-toc.author">
              <para>Collects all author nodes regardless if they appear in
              <tag>info</tag> or <tag>authorgroup</tag></para>
            </callout>
            <callout arearefs="ar.html.authors-in-toc.if">
              <para>Checks, if <tag>author</tag> nodes were found</para>
            </callout>
            <callout arearefs="ar.html.authors-in-toc.call">
              <para>Calls  <function>person.name.list</function> and pass
              the nodes from <xref linkend="ar.html.authors-in-toc.author"/></para>
            </callout>
            <callout arearefs="ar.html.authors-in-toc.span">
              <para>Contains the original code from
                <filename>autotoc.xsl</filename> and creates the title
                entry for the table of contents</para>
            </callout>
          </calloutlist>
        </informalexample>        
      </step>
      <step>
        <para>Rebuild your document with your customization layer.</para>
      </step>
    </procedure>
    <para>When you process the above section with the customization
      layer, you will receive the following line:</para>
    <screen>Tux Penguin: How to Become a Linux Mascott</screen>
    <para>Or in HTML notation:</para>
    <programlisting language="xml">&lt;span class="author"&gt;Tux Penguin: &lt;/span&gt;
&lt;span class="section"&gt;
  &lt;a href="..."&gt;How to Become a Linux Mascott&lt;/a&gt; 
&lt;/span&gt;</programlisting>
    <para>Depending on the parameter
      <parameter>section.autolabel</parameter> the title can be prefixed
    with a number.</para>
  </section>
  <section role="discussion">
    <title>Discussion</title>
    <para>The previous stylesheet works also for one or more authors. It
    does not matter if the <tag>author</tag> elements appear as a direct
    child of <tag>info</tag> or <tag>authorgroup</tag>. The following
      code produces the same string:</para>
    
    <informaltable>
      <tgroup cols="2">
        <tbody valign="top">
          <row>
            <entry><programlisting language="xml"><![CDATA[<info>
  <author>
    <personname>
      <firstname>Tux</firstname>
      <surname>Penguin</surname>
    </personname>
  </author>
  <author>
    <personname>
      <firstname>Wilber</firstname>
      <surname>Gimp</surname>
    </personname>
  </author>
</info>]]>
</programlisting></entry>
            <entry>
<programlisting language="xml"><![CDATA[<info>
  <authorgroup>
    <author>
      <personname>
        <firstname>Tux</firstname>
        <surname>Penguin</surname>
      </personname>
    </author>
    <author>
      <personname>
        <firstname>Wilber</firstname>
        <surname>Gimp</surname>
      </personname>
    </author>
  </authorgroup>
</info>]]></programlisting></entry>
          </row>
        </tbody>
      </tgroup>
    </informaltable>
    
    <para>Even if you mix <tag>author</tag> and <tag>authorgroup</tag>
      you will get the correct string output.</para>
    <para>You can also use elements other than <tag>author</tag>. To
      detect <tag>editor</tag>, extend the variable
      <varname>author</varname> as follows:</para>
    
    <programlisting language="xml">&lt;xsl:variable name="author"
      select="*/author|*/editor|*/authorgroup/author|*/authorgroup/editor"/&gt;</programlisting>
  </section>
  <section role="seealso">
    <title>See Also</title>
    <itemizedlist>
      <listitem>
        <para><link xlink:href="http://www.sagehill.net/docbookxsl/TOCcontrol.html"/></para>
      </listitem>
    </itemizedlist>
  </section>
</section>
  <!--
    License CC BY-NC-SA 3.0
  
   This work is licensed under the 
   "Namensnennung – Keine kommerzielle Nutzung – Weitergabe unter
    gleichen Bedingungen 3.0 Deutschland (CC BY-NC-SA 3.0)" 
   http://creativecommons.org/licenses/by-nc-sa/3.0/de/deed.de
   
   Read the English translation here:
   
   "Attribution-NonCommercial-ShareAlike 3.0 Unported (CC BY-NC-SA 3.0)" 
   http://creativecommons.org/licenses/by-nc-sa/3.0/
   
--><!--<?xml-model href="file:../5.1/dbref.rnc" type="application/relax-ng-compact-syntax"?>--><section xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="dbc.html.permalinks" remap="topic" userlevel="easy" xml:base="html/topic.permalinks.xml">
  <title>Creating Permalinks</title>
  <info>
    <definitions definitionfile="defs.xml"/>
    <keywordset>
      <keyword>permalinks</keyword>
      <keyword>¶</keyword>
      <keyword>component.title</keyword>
    </keywordset>
    <subjectset>
      <subject>
        <subjectterm>links</subjectterm>
      </subject>
    </subjectset>
  </info>
  
  <section role="problem">
    <title>Problem</title>
    <para>Your need for every appendix, chapter, section, etc. a small
      hint (often depicted as <quote>¶</quote>) which points to the
      division itself. This <quote>permalink</quote> simplies the
      retrieval and indentification of such a division.</para>
  </section>
  <section role="solution">
    <title>Solution</title>
    <para>You need an ID attribute on your division (chapter, section,
      examples, etc.) to make it work. The
        <filename>permalinks.xsl</filename> stylesheet is a named
      template which expects an <parameter>id</parameter>
      parameter.</para>
    <example xml:id="ex.html.permalinks">
      <title>Permalink Stylesheet (<filename>permalinks.xsl</filename>)</title>
      <info>
        <output xmlns="urn:x-toms:docbook-ext">
          <filename>permalinks/permalinks.xsl</filename>
        </output>
      </info>
      <programlistingco>
        <areaspec>  
          <area xml:id="ar.html.permalinks.generate.permalink" coords="6" units="linecolumn"/>
          <area xml:id="ar.html.permalinks.permalink.text" coords="7" units="linecolumn"/>
          <area xml:id="ar.html.permalinks.span" coords="13" units="linecolumn"/>
          <area xml:id="ar.html.permalinks.a" coords="14" units="linecolumn"/>
          <area xml:id="ar.html.permalinks.href.target" coords="15" units="linecolumn"/>
        </areaspec>
        <programlisting language="xml" linenumbering="numbered">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;xsl:stylesheet version="1.0" 
  xmlns="http://www.w3.org/1999/xhtml"
  xmlns:xsl="http://www.w3.org/1999/XSL/Transform"&gt;

  &lt;xsl:param name="generate.permalink" select="1"/&gt;
  &lt;xsl:param name="permalink.text"&gt;¶&lt;/xsl:param&gt;

  &lt;xsl:template name="permalink"&gt;
    &lt;xsl:param name="node" select="."/&gt;

    &lt;xsl:if test="$generate.permalink != '0'"&gt;
      &lt;span class="permalink"&gt;
        &lt;a alt="Permalink" title="Permalink"&gt;
          &lt;xsl:attribute name="href"&gt;
            &lt;xsl:call-template name="href.target"&gt;
              &lt;xsl:with-param name="object"  select="$node"/&gt;
            &lt;/xsl:call-template&gt;
          &lt;/xsl:attribute&gt;
          &lt;xsl:copy-of select="$permalink.text"/&gt;
        &lt;/a&gt;
      &lt;/span&gt;
    &lt;/xsl:if&gt;
  &lt;/xsl:template&gt;
&lt;/xsl:stylesheet&gt;</programlisting>
      </programlistingco>
      <calloutlist>
        <callout arearefs="ar.html.permalinks.generate.permalink">
          <para>Contains parameter
            <parameter>generate.permalink</parameter> to switch on or
            off permalink creation.</para>
        </callout>
        <callout arearefs="ar.html.permalinks.permalink.text">
          <para>Contains parameter <parameter>permalink.text</parameter>
          which is inserted as the permalink text.</para>
        </callout>
        <callout arearefs="ar.html.permalinks.span">
          <para>Creates a <tag>span</tag> element as a wrapper element 
            which contains all information about the permalink.</para>
        </callout>
        <callout arearefs="ar.html.permalinks.a">
          <para>Creates a HTML <tag>a</tag> element. The pointer in the
            <tag class="attribute">href</tag> attribute is used from the
          <parameter>id</parameter> parameter.</para>
        </callout>
        <callout arearefs="ar.html.permalinks.href.target">
          <para>Creates a <tag>href</tag> attribute with the correct
            link, regardless if it points to a chunked file or not.</para>
        </callout>
      </calloutlist>
    </example>
    <para>This is of course not enough. Use the following steps to
    include it into your customization layers:</para>
    <procedure>
      <step>
        <para>Create a customization layer as shown in <xref linkend="dbc.common.dbcustomize"/>.</para>
      </step>
      <step>
        <para>Include the stylesheet from <xref linkend="ex.html.permalinks"/> into your customization
            layer:</para>
        <programlisting language="xml">&lt;xsl:stylesheet version="1.0"
  xmlns="http://www.w3.org/1999/xhtml"
  xmlns:xsl="http://www.w3.org/1999/XSL/Transform"&gt;
  &lt;!-- ... --&gt;
  <emphasis role="bold">&lt;xsl:include href="permalinks.xsl"/&gt;</emphasis>
  &lt;!-- Add here more xsl:include's of the following files --&gt;
&lt;/xsl:stylesheet&gt;</programlisting>
      </step>
      <step>
        <para>Add <tag>xsl:include</tag> tags to your customization
          layer with points to one or all of the following files to
          include permalinks in their respective elements.</para>
        <para/>
        <itemizedlist>
          <listitem>
            <para>For appendices, chapters, prefaces, etc. use the
              <function>component.title</function> template (originates from
              <filename>{xhtml,xhtml-1_1,html}/component.xsl</filename>):
            </para>            
            <informalexample>
              <info>
                <output xmlns="urn:x-toms:docbook-ext">
                  <filename>permalinks/component.title.xsl</filename>
                </output>
              </info>
              <programlisting language="xml">&lt;xsl:stylesheet version="1.0"
  xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
  xmlns:d="http://docbook.org/ns/docbook"
  xmlns="http://www.w3.org/1999/xhtml"
  exclude-result-prefixes="d"&gt;
  
  &lt;xsl:template name="component.title"&gt;
    &lt;xsl:param name="node" select="."/&gt;
    
    &lt;xsl:variable name="level"&gt;
      &lt;xsl:choose&gt;
        &lt;xsl:when test="ancestor::d:section"&gt;
          &lt;xsl:value-of select="count(ancestor::d:section)+1"/&gt;
        &lt;/xsl:when&gt;
        &lt;xsl:when test="ancestor::d:sect5"&gt;6&lt;/xsl:when&gt;
        &lt;xsl:when test="ancestor::d:sect4"&gt;5&lt;/xsl:when&gt;
        &lt;xsl:when test="ancestor::d:sect3"&gt;4&lt;/xsl:when&gt;
        &lt;xsl:when test="ancestor::d:sect2"&gt;3&lt;/xsl:when&gt;
        &lt;xsl:when test="ancestor::d:sect1"&gt;2&lt;/xsl:when&gt;
        &lt;xsl:otherwise&gt;1&lt;/xsl:otherwise&gt;
      &lt;/xsl:choose&gt;
    &lt;/xsl:variable&gt;
    &lt;xsl:element name="h{$level+1}" namespace="http://www.w3.org/1999/xhtml"&gt;
      &lt;xsl:attribute name="class"&gt;title&lt;/xsl:attribute&gt;
      &lt;xsl:if test="$generate.id.attributes = 0"&gt;
        &lt;xsl:call-template name="anchor"&gt;
          &lt;xsl:with-param name="node" select="$node"/&gt;
          &lt;xsl:with-param name="conditional" select="0"/&gt;
        &lt;/xsl:call-template&gt;
      &lt;/xsl:if&gt;
      &lt;xsl:apply-templates select="$node" mode="object.title.markup"&gt;
        &lt;xsl:with-param name="allow-anchors" select="1"/&gt;
      &lt;/xsl:apply-templates&gt;
      &lt;xsl:call-template name="permalink"&gt;
        &lt;xsl:with-param name="node" select="$node"/&gt;
      &lt;/xsl:call-template&gt;
    &lt;/xsl:element&gt;
  &lt;/xsl:template&gt;
&lt;/xsl:stylesheet&gt;</programlisting>
            </informalexample>
          </listitem>
          <listitem>
            <para>For figures, examples, procedures, tables, etc. use
              the <function>formal.object.heading</function>
              template (originates from
              <filename>{xhtml,xhtml-1_1,html}/formal.xsl</filename>):</para>
            <informalexample>
              <info>
                <output xmlns="urn:x-toms:docbook-ext">
                  <filename>permalinks/formal.object.heading.xsl</filename>
                </output>
              </info>
              <programlisting language="xml">&lt;xsl:stylesheet version="1.0"
  xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
  xmlns:d="http://docbook.org/ns/docbook"
  xmlns="http://www.w3.org/1999/xhtml"
  exclude-result-prefixes="d"&gt;
  
  &lt;xsl:template name="formal.object.heading"&gt;
    &lt;xsl:param name="object" select="."/&gt;
    &lt;xsl:param name="title"&gt;
      &lt;xsl:apply-templates select="$object" mode="object.title.markup"&gt;
        &lt;xsl:with-param name="allow-anchors" select="1"/&gt;
      &lt;/xsl:apply-templates&gt;
    &lt;/xsl:param&gt;
    &lt;p class="title"&gt;
      &lt;b&gt;&lt;xsl:copy-of select="$title"/&gt;&lt;/b&gt;
      &lt;xsl:call-template name="permalink"&gt;
        &lt;xsl:with-param name="node" select="$object"/&gt;
      &lt;/xsl:call-template&gt;
    &lt;/p&gt;
  &lt;/xsl:template&gt;
&lt;/xsl:stylesheet&gt;</programlisting>
            </informalexample>
          </listitem>
          <listitem>
            <para>For parts, use the
              <function>division.title</function> template (originates from
              <filename>{xhtml,xhtml-1_1,html}/division.xsl</filename>):</para>
            <informalexample>
              <info>
                <output xmlns="urn:x-toms:docbook-ext">
                  <filename>permalinks/division.title.xsl</filename>
                </output>
              </info>
              <programlisting language="xml">&lt;xsl:stylesheet version="1.0"
  xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
  xmlns:d="http://docbook.org/ns/docbook"
  xmlns="http://www.w3.org/1999/xhtml"
  exclude-result-prefixes="d"&gt;
  
  &lt;xsl:template name="division.title"&gt;
    &lt;xsl:param name="node" select="."/&gt;
    
    &lt;h1&gt;
      &lt;xsl:attribute name="class"&gt;title&lt;/xsl:attribute&gt;
      &lt;xsl:call-template name="anchor"&gt;
        &lt;xsl:with-param name="node" select="$node"/&gt;
        &lt;xsl:with-param name="conditional" select="0"/&gt;
      &lt;/xsl:call-template&gt;
      &lt;xsl:apply-templates select="$node" mode="object.title.markup"&gt;
        &lt;xsl:with-param name="allow-anchors" select="1"/&gt;
      &lt;/xsl:apply-templates&gt;
      &lt;xsl:call-template name="permalink"&gt;
        &lt;xsl:with-param name="node" select="$node"/&gt;
      &lt;/xsl:call-template&gt;
    &lt;/h1&gt;
  &lt;/xsl:template&gt;
&lt;/xsl:stylesheet&gt;</programlisting>
            </informalexample>
          </listitem>
          <listitem>
            <para>For glossary terms, use the following template</para>
            <informalexample>
              <info>
                <output xmlns="urn:x-toms:docbook-ext">
                  <filename>permalinks/glossterm.title.xsl</filename>
                </output>
              </info>
              <programlisting language="xml">&lt;xsl:stylesheet version="1.0"
  xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
  xmlns:d="http://docbook.org/ns/docbook"
  xmlns="http://www.w3.org/1999/xhtml"
  exclude-result-prefixes="d"&gt;
  
  &lt;xsl:template match="d:glossentry/d:glossterm"&gt;
    &lt;xsl:variable name="id" select="(@id|../@id)[last()]"/&gt;
    &lt;xsl:apply-imports/&gt;
    &lt;xsl:if test="$generate.permalink != 0"&gt;
      &lt;xsl:message&gt;Generating permalink for glossterm &lt;xsl:value-of
          select="concat('&amp;quot;', normalize-space(.), '&amp;quot;')"/&gt;&lt;/xsl:message&gt;
      &lt;xsl:call-template name="permalink"&gt;
        &lt;xsl:with-param name="node" select=".."/&gt;
      &lt;/xsl:call-template&gt;
    &lt;/xsl:if&gt;
  &lt;/xsl:template&gt;
&lt;/xsl:stylesheet&gt;</programlisting>
            </informalexample>
          </listitem>
          <listitem>
            <para>For sections, use <function>section.title</function>
              (originates from
              <filename>{xhtml,xhtml-1_1,html}/sections.xsl</filename>):</para>
            <informalexample>
              <info>
                <output xmlns="urn:x-toms:docbook-ext">
                  <filename>permalinks/section.title.xsl</filename>
                </output>
              </info>
              <programlisting language="xml">&lt;xsl:stylesheet version="1.0"
  xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
  xmlns:d="http://docbook.org/ns/docbook"
  xmlns="http://www.w3.org/1999/xhtml" exclude-result-prefixes="d"&gt;

  &lt;xsl:template name="section.title"&gt;
    &lt;xsl:variable name="section"
      select="(ancestor::d:section |
               ancestor::d:simplesect|
               ancestor::d:sect1|
               ancestor::d:sect2|
               ancestor::d:sect3| 
               ancestor::d:sect4| 
               ancestor::d:sect5)[last()]"/&gt;

    &lt;xsl:variable name="renderas"&gt;
      &lt;xsl:choose&gt;
        &lt;xsl:when test="$section/@renderas = 'sect1'"&gt;1&lt;/xsl:when&gt;
        &lt;xsl:when test="$section/@renderas = 'sect2'"&gt;2&lt;/xsl:when&gt;
        &lt;xsl:when test="$section/@renderas = 'sect3'"&gt;3&lt;/xsl:when&gt;
        &lt;xsl:when test="$section/@renderas = 'sect4'"&gt;4&lt;/xsl:when&gt;
        &lt;xsl:when test="$section/@renderas = 'sect5'"&gt;5&lt;/xsl:when&gt;
        &lt;xsl:otherwise&gt;&lt;xsl:value-of select="''"/&gt;&lt;/xsl:otherwise&gt;
      &lt;/xsl:choose&gt;
    &lt;/xsl:variable&gt;
    &lt;xsl:variable name="level"&gt;
      &lt;xsl:choose&gt;
        &lt;xsl:when test="$renderas != ''"&gt;
          &lt;xsl:value-of select="$renderas"/&gt;
        &lt;/xsl:when&gt;
        &lt;xsl:otherwise&gt;
          &lt;xsl:call-template name="section.level"&gt;
            &lt;xsl:with-param name="node" select="$section"/&gt;
          &lt;/xsl:call-template&gt;
        &lt;/xsl:otherwise&gt;
      &lt;/xsl:choose&gt;
    &lt;/xsl:variable&gt;

    &lt;xsl:call-template name="section.heading"&gt;
      &lt;xsl:with-param name="section" select="$section"/&gt;
      &lt;xsl:with-param name="level" select="$level"/&gt;
      &lt;xsl:with-param name="title"&gt;
        &lt;xsl:apply-templates select="$section" mode="object.title.markup"&gt;
          &lt;xsl:with-param name="allow-anchors" select="1"/&gt;
        &lt;/xsl:apply-templates&gt;
        &lt;xsl:if test="$level = 1"&gt;
          &lt;xsl:call-template name="permalink"&gt;
            &lt;xsl:with-param name="node" select="$section"/&gt;
          &lt;/xsl:call-template&gt;
        &lt;/xsl:if&gt;
      &lt;/xsl:with-param&gt;
    &lt;/xsl:call-template&gt;
  &lt;/xsl:template&gt;
&lt;/xsl:stylesheet&gt;
</programlisting>
            </informalexample>
          </listitem>
        </itemizedlist>
      </step>
     <step>
       <para>Use your customization layer to transform your DocBook
         document into (X)HTML.</para>
     </step>
    </procedure>
  </section>
  <section role="discussion">
    <title>Discussion</title>
    <para>Permalinks are useful as it allows it easily to copy its URL.
      The DocBook XSL stylesheets allows the addition of permalinks in
      different locations, but the above customizations make the permalink more
      <quote>attached</quote> to its title.</para>
    <para>All the above customization files create almost the same
      structure in regards to its permalink. For example, a chapter
      title looks like this in HTML:</para>
    <programlisting language="xml">&lt;h2 class="title"&gt;The Chapter Title&lt;span
      class="permalink"&gt;&lt;a href="..." title="Permalink"
      alt="Permalink"&gt;¶&lt;/a&gt;&lt;/span&gt;
&lt;/h1&gt;</programlisting>
    <para>With CSS rules, you can add style your permalink whatever you
      like.</para>
  </section>
  <!--<section role="seealso">
    <title>See Also</title>
    <para><remark>TBD</remark></para>
  </section>-->
</section>
  <!--
    License CC BY-NC-SA 3.0
  
   This work is licensed under the 
   "Namensnennung – Keine kommerzielle Nutzung – Weitergabe unter
    gleichen Bedingungen 3.0 Deutschland (CC BY-NC-SA 3.0)" 
   http://creativecommons.org/licenses/by-nc-sa/3.0/de/deed.de
   
   Read the English translation here:
   
   "Attribution-NonCommercial-ShareAlike 3.0 Unported (CC BY-NC-SA 3.0)" 
   http://creativecommons.org/licenses/by-nc-sa/3.0/
   
--><!--<?xml-model href="file:../5.1/dbref.rnc" type="application/relax-ng-compact-syntax"?>--><section xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="dbc.html.texinfo-navig" remap="topic" userlevel="medium" xml:base="html/topic.simplenavig.xml">
  <title>Creating Simple Navigation in Chapters</title>
  <info>
    <definitions definitionfile="defs.xml"/>
    <keywordset>
      <keyword>HTML</keyword>
      <keyword>simple navigation</keyword>
      <keyword>next</keyword>
      <keyword>previous</keyword>
      <keyword>sections</keyword>
      <keyword>generate.simple.navigation</keyword>
    </keywordset>
    <subjectset>
      <subject>
        <subjectterm>navigation</subjectterm>
      </subject>
    </subjectset>
  </info>
  <section role="problem">
    <title>Problem</title>
    <para>You need a simple navigation for your single HTML file. The
      navigation should contain for each chapter a link to
      the next and previous chapters including an up link pointing to
      the enclosing part or book. This is depicted in the following
      graphic:</para>
    <mediaobject>
      <imageobject>
        <imagedata fileref="png/simplenavig.png" align="center"/>
      </imageobject>
    </mediaobject>
  </section>
  <section role="solution">
    <title>Solution</title>
    <para>The following file defines the named template
        <function>generate.simple.navigation</function>:</para>
    <example xml:id="ex.simple-navigation.xsl">
      <title><filename>simple-navigation.xsl</filename></title>
      <info>
        <output xmlns="urn:x-toms:docbook-ext">
          <filename>simplenavig/simple-navigation.xsl</filename>
        </output>
      </info>
      <programlisting linenumbering="numbered" language="xml">&lt;xsl:stylesheet version="1.0"
  xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
  xmlns:d="http://docbook.org/ns/docbook"
  xmlns="http://www.w3.org/1999/xhtml"
  exclude-result-prefixes="d"&gt;
    
  &lt;xsl:template name="generate.simple.navigation"&gt;
    &lt;xsl:param name="node" select="."/&gt;
    &lt;xsl:variable name="prev" select="$node/preceding-sibling::d:chapter"/&gt;
    &lt;xsl:variable name="next" select="$node/following-sibling::d:chapter"/&gt;
    &lt;xsl:variable name="up"   select="$node/parent::d:*"/&gt;
   
    &lt;div class="chapter-navigation"&gt;
      &lt;ul&gt;
        &lt;xsl:if test="count($next) &gt;0"&gt;
          &lt;li class="next"&gt;
            &lt;xsl:call-template name="gentext.nav.next"/&gt;
            &lt;xsl:text&gt;: &lt;/xsl:text&gt;
            &lt;a&gt;
              &lt;xsl:attribute name="href"&gt;
                &lt;xsl:call-template name="href.target"&gt;
                  &lt;xsl:with-param name="object" select="$next"/&gt;
                &lt;/xsl:call-template&gt;
              &lt;/xsl:attribute&gt;
              &lt;xsl:value-of select="$next/d:title"/&gt;
            &lt;/a&gt;
          &lt;/li&gt;
        &lt;/xsl:if&gt;
        &lt;xsl:if test="count($prev) &gt;0"&gt;
          &lt;li class="prev"&gt;
            &lt;xsl:call-template name="gentext.nav.prev"/&gt;
            &lt;xsl:text&gt;: &lt;/xsl:text&gt;
            &lt;a&gt;
              &lt;xsl:attribute name="href"&gt;
                &lt;xsl:call-template name="href.target"&gt;
                  &lt;xsl:with-param name="object" select="$prev"/&gt;
                &lt;/xsl:call-template&gt;
              &lt;/xsl:attribute&gt;
              &lt;xsl:value-of select="$prev/d:title"/&gt;
            &lt;/a&gt;
          &lt;/li&gt;
        &lt;/xsl:if&gt;
        &lt;xsl:if test="count($up) &gt;0"&gt;
          &lt;li class="up"&gt;
            &lt;xsl:call-template name="gentext.nav.up"/&gt;
            &lt;xsl:text&gt;: &lt;/xsl:text&gt;
            &lt;a&gt;
              &lt;xsl:attribute name="href"&gt;
                &lt;xsl:call-template name="href.target"&gt;
                  &lt;xsl:with-param name="object" select="$up"/&gt;
                &lt;/xsl:call-template&gt;
              &lt;/xsl:attribute&gt;
              &lt;xsl:value-of select="$up/d:title"/&gt;
            &lt;/a&gt;
          &lt;/li&gt;
        &lt;/xsl:if&gt;
      &lt;/ul&gt;
    &lt;/div&gt;
  &lt;/xsl:template&gt;
&lt;/xsl:stylesheet&gt;</programlisting>
    </example>
    <para>This is not enough, of course. Use the following steps to
      include it into your customization layers:</para>
    <procedure>
      <step>
        <para>Create a customization layer as shown in <xref linkend="dbc.common.dbcustomize"/>.</para>
      </step>
      <step>
        <para>Include the stylesheet from <xref linkend="ex.simple-navigation.xsl"/> into your customization
            layer:</para>
        <example xml:id="ex.db-simple-navigation.xsl">
          <title><filename>db-simple-navigation.xsl</filename></title>
          <info>
        <output xmlns="urn:x-toms:docbook-ext">
          <filename>simplenavig/db-simple-navigation.xsl</filename>
        </output>
      </info>
          <programlisting linenumbering="numbered" language="xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;!DOCTYPE xsl:stylesheet [
  &lt;!ENTITY db "http://docbook.sourceforge.net/release/xsl-ns/current"&gt;
]&gt;
&lt;xsl:stylesheet version="1.0"
  xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
  xmlns:d="http://docbook.org/ns/docbook"
  xmlns="http://www.w3.org/1999/xhtml" 
  exclude-result-prefixes="d"&gt;
  
  &lt;xsl:import href="&amp;db;/xhtml/docbook.xsl"/&gt;
  &lt;xsl:import href="simple-navigation.xsl"/&gt;
  
  &lt;xsl:param name="generate.simple.navigation" select="1"/&gt;
  &lt;xsl:param name="html.stylesheet"&gt;book.css&lt;/xsl:param&gt;

  &lt;xsl:template name="chapter.titlepage.before.recto"&gt;
    &lt;xsl:if test="$generate.simple.navigation != 0"&gt;
      &lt;xsl:call-template name="generate.simple.navigation"/&gt;
    &lt;/xsl:if&gt;
  &lt;/xsl:template&gt;
&lt;/xsl:stylesheet&gt;</programlisting>      
        </example>        
      </step>
      <step>
        <para>Use the file <filename>db-simple-navigation.xsl</filename>
        to transform your documents.</para>
      </step>
    </procedure>
    
    <para>If you want to switch on or off the above behaviour, use the
      parameter <parameter>generate.simple.navigation</parameter><footnote>
        <para>It is not an error to have a parameter with the same name
          as a named template.</para>
      </footnote> and set it to <literal>0</literal>.</para>    
  </section>
  <section role="discussion">
    <title>Discussion</title>
    <para>The named template
        <function>generate.simple.navigation</function> works as
        follows:</para>
    
    <orderedlist>
      <listitem>
        <para>Three variables are definied for the previous, next, and
          up links. All depends on the <varname>node</varname> parameter
          which is by default the context node. This is useful as you
          can change the behaviour very easily by just changing the
          context node when calling the template with
            <function>xsl:call-template</function>.</para>
      </listitem>
      <listitem>
        <para>The <varname>prev</varname> and <varname>next</varname>
          variables are filled with the previous or next chapter
          elements along their sibling axis. In comparison, the
            <varname>up</varname> variable needs to find its enclosing
          element; it uses the <function>parent</function> axis
          for this purpose.</para>
        <para>If there are no previous or next chapters, the node set will
          be empty. For the <varname>up</varname> variable, this depends
          on where a chapter belongs; usually it is enclosed in a
            <tag>book</tag> or <tag>part</tag> element. As we need only
          the parent element As such this variable can not be empty
          (only if the chapter would be the root element.)</para>
      </listitem>
      <listitem>
        <para>The simple navigation is implemented as a unordered list
          inside a <tag>div</tag> element. The enclosing <tag>div</tag>
          element is used to make styling with CSS easier.</para>
      </listitem>
      <listitem>
        <para>With <tag>xsl:if</tag> we check the amount of nodes in our
            <varname>prev</varname> and <varname>next</varname>
          variables. Only if the variable contains more than zero nodes
          it will a listitem created.</para>
      </listitem>
      <listitem>
        <para>If we create a listitem, we want to insert a text to help
          our readers and to distinguish the different directions. The
          text has to be independent from the used language; so
          hard-coding the text would not be sufficient. For this reason,
          the DocBook stylesheets contains named templates to generate
          localized text. The next, previous, and up link texts are
          created through the named templates
            <function>generate.nav.next</function>,
            <function>generate.nav.prev</function>, and
            <function>generate.nav.up</function>.</para>
      </listitem>
      <listitem>
        <para>As the generated localized text contains only the text
          without interpunctations, we append <quote>: </quote>.</para>
      </listitem>
      <listitem>
        <para>We create the link with the <tag>a</tag> link. The needed
            <tag class="attribute">href</tag> attribute is created by
          calling <function>href.target</function> (origin
            <filename>html.xsl</filename>). This template is responsible
          for the correct linking value.</para>
      </listitem>
      <listitem>
        <para>The content of the <tag>a</tag> element is inserted from
          the <tag>title</tag> element of the corresponding node. As we
          are only interested in the string value, we can use
            <function>xsl:value-of</function>.</para>
      </listitem>
    </orderedlist>
    
    <para>The <function>generate.simple.navigation</function> template
      matches only chapters along the sibling axis. As such it can not
      find a glossary or appendix after a chapter. If you want to create
      links for <emphasis>any</emphasis> component elements, not only
      chapters, you need to change the variables <varname>prev</varname>
      and <varname>next</varname>. A first attempt would lead to
      this:</para>
    <programlisting>&lt;xsl:variable name="prev" select="$node/preceding-sibling::d:*[1]"/&gt;
&lt;xsl:variable name="next" select="$node/following-sibling::d:*[1]"/&gt;</programlisting>
    <para>This works for the <varname>next</varname> variables. However,
      our expression for the <varname>prev</varname> variable contains a
      bug. Consider the following structure:</para>
    <screen>book
  title
  info
  <emphasis role="bold">chapter</emphasis>
  ...</screen>
    <para>The <function>preceding-sibling</function> axis returns the
        <tag>info</tag> and <tag>title</tag> elements. This is not what
      you want as these are no component elements for our
        <varname>prev</varname> link. In that case we need an expression
      to filter out the unwanted elements. This is done with an
      predicate:</para>
    <programlisting>&lt;xsl:variable name="prev" select="$node/preceding-sibling::d:*[not(self::d:title|self::d:info)][1]"/&gt;</programlisting>
    <para>That expression first creates a node set with
        <emphasis>all</emphasis> preceding elements. In a second step
      they are check against the term
        <code>not(self::d:title|self::d:info)</code>; only those
      elements remain in the node set which are not <tag>title</tag> or
        <tag>info</tag> elements. In our above example, this leads to a
      node set with zero nodes and is exactly what we wanted to
      achieve.</para>
    <para>With the previous change, we allow <emphasis>any</emphasis>
      structural element to be included in a next or previous link.
      However, we show our navigation links only in chapter titlepages
      at the moment (the named template
        <function>chapter.titlepage.before.recto</function>.) We need to
      extend the stylesheet
        <filename>db-simple-navigation.xsl</filename> to allow elements
      like <tag>appendix</tag>, <tag>glossary</tag>, etc. Refer to the
      content modell of DocBook´s <tag xlink:href="http://www.docbook.org/tdg51/en/html/book.html">book</tag> element for details. For an <tag>appendix</tag> this
      looks like this:</para>
    <programlisting>&lt;xsl:template name="appendix.titlepage.before.recto"&gt;
  &lt;xsl:if test="$generate.simple.navigation != 0"&gt;
    &lt;xsl:call-template name="generate.simple.navigation"/&gt;
  &lt;/xsl:if&gt;
&lt;/xsl:template&gt;</programlisting>
    <para>For the other elements this is exactly the same except the
      name. Just use the element name and append
      <literal>.titlepage.before.recto</literal>.</para>
<!--
      <xsl:message>
      prev: <xsl:value-of select="concat(count($prev), ':',
      local-name($prev))"/>
      next: <xsl:value-of select="concat(count($next), ':',
      local-name($next))"/>
      up:   <xsl:value-of select="concat(count($up), ':',
      local-name($up))"/>
      </xsl:message>
-->
  </section>
  <section role="seealso">
    <title>See Also</title>
    <!--<itemizedlist role="category">
      <listitem>
        <para/>
      </listitem>
    </itemizedlist>-->
  </section>
</section>
  <!--
    License CC BY-NC-SA 3.0
  
   This work is licensed under the 
   "Namensnennung – Keine kommerzielle Nutzung – Weitergabe unter
    gleichen Bedingungen 3.0 Deutschland (CC BY-NC-SA 3.0)" 
   http://creativecommons.org/licenses/by-nc-sa/3.0/de/deed.de
   
   Read the English translation here:
   
   "Attribution-NonCommercial-ShareAlike 3.0 Unported (CC BY-NC-SA 3.0)" 
   http://creativecommons.org/licenses/by-nc-sa/3.0/
   
--><!--<?xml-model href="file:../5.1/dbref.rnc" type="application/relax-ng-compact-syntax"?>--><section xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="dbc.html.breadcrumbs" remap="topic" version="5.1" userlevel="medium" xml:base="html/topic.breadcrumbs.xml">
  <title>Implementing <quote>Breadcrumbs</quote></title>
  <info>
    <definitions definitionfile="defs.xml"/>
    <keywordset>
      <keyword>breadcrumbs</keyword>
      <keyword>navigation</keyword>
    </keywordset>
    <subjectset>
      <subject>
        <subjectterm>navigation</subjectterm>
      </subject>
    </subjectset>
  </info>
  
  <section role="problem">
    <title>Problem</title>
    <para>You want to display a <quote>path</quote> to your current
      chapter, section etc. to improve fast jumping to parent
      structures.</para>
  </section>
  <section role="solution">
    <title>Solution</title>
    <para>Use breadcrumbs<footnote>
      <para>Breadcrumbs are a navigation aid and show the titles from 
        the top page to the current page. The term origins from the 
        trail of breadcrumbs left by Hänsel and Gretel in the 
        popular fairytale written by the Brothers Grimm.</para>
    </footnote> to improve navigation. Use the following procedure to
      create breadcrumbs for your documents: </para>
    
    <procedure xml:id="pro.html.breadcrumbs">
      <step xml:id="st.html.breadcrumbs.custlayer">
        <para>Create a customization layer as shown in <xref linkend="dbc.common.dbcustomize"/>.</para>
      </step>
      <step>
        <para>Create a file <filename>breadcrumbs.xsl</filename> with
          the following content:</para>
        
        <informalexample>
         <info>
          <output xmlns="urn:x-toms:docbook-ext">
            <filename>breadcrumbs/breadcrumbs.xsl</filename>
          </output>
        </info>
        <programlistingco>
          <areaspec>
            <area xml:id="ar.breadcrumbs.param" coords="7" units="linecolumn"/>
            <area xml:id="ar.breadcrumbs.ancestor" coords="12" units="linecolumn"/>
            <area xml:id="ar.breadcrumbs.href" coords="15" units="linecolumn"/>
            <area xml:id="ar.breadcrumbs.title" coords="21 67" units="linecolumn"/>
            <area xml:id="ar.breadcrumbs.sep" coords="24" units="linecolumn"/>
            <area xml:id="ar.breadcrumbs.currentnode" coords="27" units="linecolumn"/>
          </areaspec>
          <programlisting linenumbering="numbered" language="xml">&lt;xsl:stylesheet version="1.0"
  xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
  xmlns:d="http://docbook.org/ns/docbook"
  xmlns="http://www.w3.org/1999/xhtml"
  exclude-result-prefixes="d"&gt;

  &lt;xsl:param name="breadcrumbs.separator" select="' &gt; '"/&gt;

  &lt;xsl:template name="generate.breadcrumbs"&gt;
    &lt;xsl:param name="current.node" select="."/&gt;
    &lt;div class="breadcrumbs"&gt;
      &lt;xsl:for-each select="$current.node/ancestor::*"&gt;
        &lt;span class="breadcrumb-link"&gt;
          &lt;a&gt;
            &lt;xsl:attribute name="href"&gt;
              &lt;xsl:call-template name="href.target"&gt;
                &lt;xsl:with-param name="object" select="."/&gt;
                &lt;xsl:with-param name="context" select="$current.node"/&gt;
              &lt;/xsl:call-template&gt;
            &lt;/xsl:attribute&gt;
            &lt;xsl:apply-templates select="." mode="title.markup"/&gt;
          &lt;/a&gt;
        &lt;/span&gt;
        &lt;xsl:copy-of select="$breadcrumbs.separator"/&gt;
      &lt;/xsl:for-each&gt;
      &lt;!-- Display the current node, but not as a link --&gt;
      &lt;span class="breadcrumb-node"&gt;
        &lt;xsl:apply-templates select="$current.node" mode="title.markup"/&gt;
      &lt;/span&gt;
    &lt;/div&gt;
  &lt;/xsl:template&gt;
&lt;/xsl:stylesheet&gt;
</programlisting>
          <calloutlist>
            <callout arearefs="ar.breadcrumbs.param">
              <para>Parameter to separate each component</para>
            </callout>
            <callout arearefs="ar.breadcrumbs.ancestor">
              <para>Iterates over the ancestor axis</para>
            </callout>
            <callout arearefs="ar.breadcrumbs.href">
              <para>Creates the <tag class="attribute">href</tag>
                attribute by calling <function>href.target</function>
                to create appropriate link references even for chunked
                output</para>
            </callout>
            <callout arearefs="ar.breadcrumbs.title">
              <para>Inserts the processed title</para>
            </callout>
            <callout arearefs="ar.breadcrumbs.sep">
              <para>Inserts the breadcrumbs separator</para>
            </callout>
            <callout arearefs="ar.breadcrumbs.currentnode">
              <para>Inserts the processed title of the current node but
                not as a link</para>
            </callout>
          </calloutlist>
        </programlistingco>
        </informalexample>               
      </step>
      <step>
        <para>Include <filename>breadcrumbs.xsl</filename> into your
          customization layer from <xref linkend="st.html.breadcrumbs.custlayer"/>:</para>
        <programlisting>&lt;xsl:include href="breadcrumbs.xsl"/&gt;</programlisting>
      </step>
      <step>
        <para>Add the following code into your customization layer:</para>
        <programlisting>&lt;xsl:template name="user.header.content"&gt;
  &lt;xsl:call-template name="generate.breadcrumb"/&gt;
&lt;/xsl:template&gt;</programlisting>
      </step>
      <step>
        <para>Build your document with your customization layer.</para>
      </step>
    </procedure>
    
    <para>For example, consider the the current topic. It is embedded
      into this nested structure:</para>
    <screen>book: The DoCookBook
  chapter: (X)HTML Customizations
     sect1: Implementing “Breadcrumbs”</screen>
    <para>The above <filename>breadcrumbs.xsl</filename> stylesheets
      creates this HTML code when the current node is this topic:</para>
    <programlisting>&lt;div class="breadcrumbs"&gt;
  &lt;span&gt;&lt;a href="...X..."&gt;The DoCookBook&lt;/a&gt;&lt;/span&gt;
  &gt;
  &lt;span&gt;&lt;a href="...Y..."&gt;(X)HTML Customizations&lt;/a&gt;&lt;/span&gt;
  &gt;
  &lt;span class="breadcrumb-node"&gt;Implementing “Breadcrumbs”&lt;/span&gt;  
&lt;/div&gt;</programlisting>
    <para>Leading to the following appearance:</para>
    <screen>The DoCookBook &gt; (X)HTML Customizations &gt; Implementing “Breadcrumbs”</screen>
    <para>Whereas all <tag>span</tag>s contains links to their
      respective components except the last one.</para>
  </section>
  <section role="discussion">
    <title>Discussion</title>
    <para><remark>TBD</remark></para>
  </section>
  <section role="seealso">
    <title>See Also</title>
    <itemizedlist role="category">
      <listitem>
        <para><link xlink:href="http://www.sagehill.net/docbookxsl/HTMLHeaders.html#BreadCrumbs"/></para>
      </listitem>
    </itemizedlist>
  </section>
</section>
  <!--
    License CC BY-NC-SA 3.0
  
   This work is licensed under the 
   "Namensnennung – Keine kommerzielle Nutzung – Weitergabe unter
    gleichen Bedingungen 3.0 Deutschland (CC BY-NC-SA 3.0)" 
   http://creativecommons.org/licenses/by-nc-sa/3.0/de/deed.de
   
   Read the English translation here:
   
   "Attribution-NonCommercial-ShareAlike 3.0 Unported (CC BY-NC-SA 3.0)" 
   http://creativecommons.org/licenses/by-nc-sa/3.0/
   
--><!--<?xml-model href="file:../5.1/dbref.rnc" type="application/relax-ng-compact-syntax"?>--><section xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="dbc.html.move-toc" remap="topic" version="5.1" userlevel="medium" xml:base="html/topic.movetoc.xml">
  <title>Moving the Table of Contents (TOC)</title>
  <info>
    <definitions definitionfile="defs.xml"/>
    <keywordset>
      <keyword>TOC</keyword>
      <keyword>table of contents</keyword>
    </keywordset>
    <subjectset>
      <subject>
        <subjectterm>tocs</subjectterm>
      </subject>
    </subjectset>
  </info>

  <section role="problem">
    <title>Problem</title>
    <para>You have a book and want the table of contents appear after
      the main content.</para>
  </section>
  <section role="solution">
    <title>Solution</title>
    <para>The processing of a book is handled in the
      <filename>xhtml/division.xsl</filename> file. The template needs
      to be copied and inserted in your customization layer. To move
      your table of contents, do the following:</para>
    <procedure>
      <step xml:id="st.html.novetoc.custlayer">
        <para>Create a customization layer as shown in <xref linkend="dbc.common.dbcustomize"/>.</para>
      </step>
      <step>
        <para>Create a file <filename>move-toc.xsl</filename> with the
          following content:</para>

        <informalexample>
          <info>
            <output xmlns="urn:x-toms:docbook-ext">
              <filename>move-toc/move-toc.xsl</filename>
            </output>
          </info>
          <programlistingco>
            <areaspec>
              <area xml:id="ar.movetoc.apply" coords="31" units="linecolumn"/>
              <area xml:id="ar.movetoc.call" coords="33" units="linecolumn"/>
            </areaspec>
            <programlisting language="xml" linenumbering="numbered">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;xsl:stylesheet  version="1.0"
  xmlns="http://www.w3.org/1999/xhtml"
  xmlns:d="http://docbook.org/ns/docbook"
  xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
  exclude-result-prefixes="d"&gt;
  
  &lt;xsl:template match="d:book"&gt;
    &lt;xsl:call-template name="id.warning"/&gt;
    &lt;div&gt;
      &lt;xsl:apply-templates select="." mode="common.html.attributes"/&gt;
      &lt;xsl:if test="$generate.id.attributes != 0"&gt;
        &lt;xsl:attribute name="id"&gt;
          &lt;xsl:call-template name="object.id"/&gt;
        &lt;/xsl:attribute&gt;
      &lt;/xsl:if&gt;
      &lt;xsl:call-template name="book.titlepage"/&gt;
      
      &lt;xsl:apply-templates select="d:dedication" 
        mode="dedication"/&gt;
      &lt;xsl:apply-templates select="d:acknowledgements"
        mode="acknowledgements"/&gt;
      
      &lt;xsl:variable name="toc.params"&gt;
        &lt;xsl:call-template name="find.path.params"&gt;
          &lt;xsl:with-param name="table" 
            select="normalize-space($generate.toc)"/&gt; 
        &lt;/xsl:call-template&gt;
      &lt;/xsl:variable&gt;
      
      &lt;xsl:apply-templates/&gt;

      &lt;xsl:call-template name="make.lots"&gt;
        &lt;xsl:with-param name="toc.params" select="$toc.params"/&gt;
        &lt;xsl:with-param name="toc"&gt;
          &lt;xsl:call-template name="division.toc"&gt;
            &lt;xsl:with-param name="toc.title.p"
              select="contains($toc.params, 'title')"/&gt;
          &lt;/xsl:call-template&gt;
        &lt;/xsl:with-param&gt;
      &lt;/xsl:call-template&gt;
    &lt;/div&gt;
  &lt;/xsl:template&gt;
  
&lt;/xsl:stylesheet&gt;</programlisting>
            <calloutlist>
              <callout arearefs="ar.movetoc.apply">
                <para>The <tag>xsl:apply-templates</tag> creates first
                  all the content</para>
              </callout>
              <callout arearefs="ar.movetoc.call">
                <para>Create the table of content</para>
              </callout>
            </calloutlist>
          </programlistingco>
        </informalexample>
      </step>
      <step>
        <para>Include <filename>move-toc.xsl</filename> into your
          customization layer from <xref linkend="st.html.novetoc.custlayer"/>:</para>
        <programlisting>&lt;xsl:include href="move-toc.xsl"/&gt;</programlisting>
      </step>
      <step>
        <para>Build your document with your customization layer.</para>
      </step>
    </procedure>
  </section>
  <section role="discussion">
    <title>Discussion</title>
    <para>The same principle applies to other structural elements,
      although the handling is a bit different.</para>
  </section>
  <!--<section role="seealso">
    <title>See Also</title>
    <para>Include URL or bibliographic references.</para>
  </section>-->
</section>
  <!--
    License CC BY-NC-SA 3.0
  
   This work is licensed under the 
   "Namensnennung – Keine kommerzielle Nutzung – Weitergabe unter
    gleichen Bedingungen 3.0 Deutschland (CC BY-NC-SA 3.0)" 
   http://creativecommons.org/licenses/by-nc-sa/3.0/de/deed.de
   
   Read the English translation here:
   
   "Attribution-NonCommercial-ShareAlike 3.0 Unported (CC BY-NC-SA 3.0)" 
   http://creativecommons.org/licenses/by-nc-sa/3.0/
   
--><!--<?xml-model href="file:../5.1/dbref.rnc" type="application/relax-ng-compact-syntax"?>--><section xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="dbc.html.sh.google-code-prettifiy" remap="topic" userlevel="easy" version="5.1" xml:base="html/topic.sh-google-code-prettify.xml">
  <title>Implementing Syntax Highlighting with Google Code
    Prettify</title>
  <info>
    <definitions definitionfile="defs.xml"/>
    <keywordset>
      <keyword>programlisting</keyword>
      <keyword>syntax highlighting</keyword>
    </keywordset>
    <subjectset>
      <subject>
        <subjectterm>syntax highlighting</subjectterm>
      </subject>
    </subjectset>
  </info>
  
  <section role="problem">
    <title>Problem</title>
    <para>You want to highlight your source codes in
        <tag>programlisting</tag> elements with <link xlink:href="http://code.google.com/p/google-code-prettify/">Google Code Prettifiy</link>.</para>
  </section>
  <section role="solution">
    <title>Solution</title>
    <para>Syntax highlighting makes source code easier to read as
      keywords, strings, etc. appear in different colors. Use the
      following procedure to implement syntax highlighting with Google
      Code Prettifiy:</para>
    <procedure>
      <step>
        <para>Download the source code bundle from the project's home
          page at <link xlink:href="http://code.google.com/p/google-code-prettify/"/>.</para>
      </step>
      <step>
        <para>Copy the <filename>src</filename> directory to your HTML
          output directory and rename it to <filename class="directory">highlighter</filename>.</para>
      </step>
      <step>
        <para>Create a customization layer as explained in <xref linkend="dbc.common.dbcustomize"/>.</para>
      </step>
      <step>
        <para>Set the <parameter>html.stylesheet</parameter> stylesheet
          parameter:</para>
        <programlisting language="xml">&lt;xsl:param name="html.stylesheet"&gt;highlighter/prettify.css&lt;/xsl:param&gt;</programlisting>
        <para>This value is needed to add the default style into the
          header of the HTML output.</para>
      </step>
      <step>
        <para>Add the named template
            <function>user.footer.content</function> with the following
          content:</para>
        <programlisting language="xsl">&lt;xsl:template name="user.footer.content"&gt;
   &lt;xsl:param name="node" select="."/&gt;
   &lt;script src="highlighter/prettify.js"&gt;&lt;/script&gt;
   &lt;script&gt;prettyPrint();&lt;/script&gt;
&lt;/xsl:template&gt;</programlisting>
        <para>This template is called before the end of <tag class="endtag">body</tag> tag. Inside the template, load the
            <filename>prettify.js</filename> and call the function
            <function>prettyPrint()</function></para>
      </step>
      <step xml:id="st.html.sh.google.class.value">
        <para>Add a template for <tag>programlisting</tag> which only
          matches, when you add a <tag class="attribute">language</tag>
          attribute. Use the <literal>class.value</literal> mode as
          follows:</para>
        <programlisting language="xsl">&lt;xsl:template match="d:programlisting[@language]" mode="class.value"&gt;
  &lt;xsl:param name="class" select="local-name(.)"/&gt;
  &lt;xsl:choose&gt;
    &lt;xsl:when test="@linenumbering = 'numbered'"&gt;
       &lt;xsl:value-of select="concat('prettyprint linenums ', $class)"/&gt;
    &lt;/xsl:when&gt;
    &lt;xsl:otherwise&gt;
       &lt;xsl:value-of select="concat('prettyprint ', $class)"/&gt;
    &lt;/xsl:otherwise&gt;
  &lt;/xsl:choose&gt;
&lt;/xsl:template&gt;</programlisting>
      </step>
      <step>
        <para>If you want to enable syntax highlighting, make sure you add
          a <tag class="attribute">language</tag> attribute in your 
          <tag>programlisting</tag> tag.</para>
        <para>If you want to enable line numbering, add the attribute
          <tag class="attribute">linenumbering</tag> with the value
          <tag class="attvalue">linenums</tag>.</para>
      </step>
      <step>
        <para>Rebuild your HTML with your customization layer.</para>
      </step>
    </procedure>
  </section>
  <section role="discussion">
    <title>Discussion</title>
    <para>The current implementation uses a JavaScript solution to
      render the result in your browser. This has the advantage that you
      do not need any extensions in your customization layer during
      transformation. You only need to add the above additions to your
      customization layer and your source code to enable syntax highlighting.</para>
    <para>However, if JavaScript is disabled it won't work anymore. If
      you rely on minimal HTML without any JavaScript code, this
      solution is not for you. Use the highlighting mechanism which uses
      a XSLT extension. <remark>Add link to highlighting extension topic
        with JAR</remark></para>
    
    <section>
      <title>Using the Language Attribute</title>
      <para>As you could see above, the code in <xref linkend="st.html.sh.google.class.value"/> uses the
          <tag>language</tag> attribute, but doesn't pass it to the HTML
        code. This is not needed as Google Code Prettify will guess.<footnote>
          <para><quote>You don't need to specify the language since
              prettyprint() will guess.</quote> cited from <link xlink:href="http://google-code-prettify.googlecode.com/svn/trunk/README.html"/>, July 10, 2012.</para>
        </footnote> If you do not want to rely on this algorithm, change
        the above code and insert the language explitly:</para>
      <programlisting language="xsl">&lt;xsl:template match="d:programlisting[@language]" mode="class.value"&gt;
  &lt;xsl:param name="class" select="local-name(.)"/&gt;
  &lt;xsl:variable name="lang" select="concat('lang-', @language, ' ')"/&gt;
  &lt;xsl:choose&gt;
    &lt;xsl:when test="@linenumbering = 'numbered'"&gt;
      &lt;xsl:value-of select="concat('prettyprint ', $lang, 'linenums ', $class)"/&gt;
    &lt;/xsl:when&gt;
    &lt;xsl:otherwise&gt;
      &lt;xsl:value-of select="concat('prettyprint ', $lang, $class)"/&gt;
    &lt;/xsl:otherwise&gt;
  &lt;/xsl:choose&gt;
&lt;/xsl:template&gt;</programlisting>
      <para>Be aware that the above code does not make any checks, it
        just copies the value. If your <tag class="attribute">language</tag> attribute contains an
        unsupported value, it may work not as expected.
      </para>
    </section>
    <section>
      <title>Using a Different Style</title>
      <para>If you do not like the default style from
        <filename>highlighter/prettify.css</filename>, use one of the
        CSS files from the <filename class="directory">styles</filename>
      directory. You can view an example in the <link xlink:href="http://google-code-prettify.googlecode.com/svn/trunk/styles/index.html">Gallery</link>.
      </para>
      <para>Copy your favorite style into the <filename class="directory">highlighter</filename> directory and change the
        <parameter>html.stylesheet</parameter> pointing to your CSS
        file.</para>
    </section>
  </section>
  <section role="seealso">
    <title>See Also</title>
    <para>Include URL or bibliographic references.</para>
  </section>
</section>
  <!-- <xi:include href="html/topic.google-webfonts.xml"/> -->
  <!--<xi:include href="html/topic.consistent-ids.xml"/>-->
</chapter>
  <!-- <xi:include href="dbc-epub.xml"/> -->
  
  <!--<xi:include href="dbc-tools.xml"/>-->
  
  <!--<?xml-model href="file:5.1/dbref.rnc" type="application/relax-ng-compact-syntax"?>--><appendix xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="cc-by-nc-sa-30-de" xml:lang="de">
  <title>Namensnennung – Keine kommerzielle Nutzung – Weitergabe unter
    gleichen Bedingungen 3.0 Deutschland</title>
  <para>Entnommen von <link xlink:href="http://creativecommons.org/licenses/by-nc-sa/3.0/de/"/>.</para>

  <blockquote>
    <para>CREATIVE COMMONS IST KEINE RECHTSANWALTSKANZLEI UND LEISTET
      KEINE RECHTSBERATUNG. DIE BEREITSTELLUNG DIESER LIZENZ FÜHRT ZU
      KEINEM MANDATSVERHÄLTNIS. CREATIVE COMMONS STELLT DIESE
      INFORMATIONEN OHNE GEWÄHR ZUR VERFÜGUNG. CREATIVE COMMONS
      ÜBERNIMMT KEINE GEWÄHRLEISTUNG FÜR DIE GELIEFERTEN INFORMATIONEN
      UND SCHLIEßT DIE HAFTUNG FÜR SCHÄDEN AUS, DIE SICH AUS DEREN
      GEBRAUCH ERGEBEN. </para>
  </blockquote>

  <blockquote>
    <title>Lizenz</title>
    <para>DER GEGENSTAND DIESER LIZENZ (WIE UNTER
        <quote>SCHUTZGEGENSTAND</quote> DEFINIERT) WIRD UNTER DEN
      BEDINGUNGEN DIESER CREATIVE COMMONS PUBLIC LICENSE
        (<quote>CCPL</quote>, <quote>LIZENZ</quote> ODER
        <quote>LIZENZVERTRAG</quote>) ZUR VERFÜGUNG GESTELLT. DER
      SCHUTZGEGENSTAND IST DURCH DAS URHEBERRECHT UND/ODER ANDERE
      GESETZE GESCHÜTZT. JEDE FORM DER NUTZUNG DES SCHUTZGEGENSTANDES,
      DIE NICHT AUFGRUND DIESER LIZENZ ODER DURCH GESETZE GESTATTET IST,
      IST UNZULÄSSIG.</para>
    <para>DURCH DIE AUSÜBUNG EINES DURCH DIESE LIZENZ GEWÄHRTEN RECHTS
      AN DEM SCHUTZGEGENSTAND ERKLÄREN SIE SICH MIT DEN
      LIZENZBEDINGUNGEN RECHTSVERBINDLICH EINVERSTANDEN. SOWEIT DIESE
      LIZENZ ALS LIZENZVERTRAG ANZUSEHEN IST, GEWÄHRT IHNEN DER
      LIZENZGEBER DIE IN DER LIZENZ GENANNTEN RECHTE UNENTGELTLICH UND
      IM AUSTAUSCH DAFÜR, DASS SIE DAS GEBUNDENSEIN AN DIE
      LIZENZBEDINGUNGEN AKZEPTIEREN.</para>
  </blockquote>

  <orderedlist>
    <listitem xml:id="cc-de.def">
      <para>Definitionen</para>
      <orderedlist numeration="loweralpha" inheritnum="inherit">
        <listitem xml:id="cc-de.def.adaption">
          <para>Der Begriff <quote><emphasis role="bold">Abwandlung</emphasis></quote> im Sinne dieser Lizenz
            bezeichnet das Ergebnis jeglicher Art von Veränderung des
            Schutzgegenstandes, solange die eigenpersönlichen Züge des
            Schutzgegenstandes darin nicht verblassen und daran eigene
            Schutzrechte entstehen. Das kann insbesondere eine
            Bearbeitung, Umgestaltung, Änderung, Anpassung, Übersetzung
            oder Heranziehung des Schutzgegenstandes zur Vertonung von
            Laufbildern sein. Nicht als Abwandlung des
            Schutzgegenstandes gelten seine Aufnahme in eine Sammlung
            oder ein Sammelwerk und die freie Benutzung des
            Schutzgegenstandes. </para>
        </listitem>
        <listitem xml:id="cc-de.def.collection">
          <para>Der Begriff <quote><emphasis role="bold">Sammelwerk</emphasis></quote> im Sinne dieser Lizenz
            meint eine Zusammenstellung von literarischen,
            künstlerischen oder wissenschaftlichen Inhalten, sofern
            diese Zusammenstellung aufgrund von Auswahl und Anordnung
            der darin enthaltenen selbständigen Elemente eine geistige
            Schöpfung darstellt, unabhängig davon, ob die Elemente
            systematisch oder methodisch angelegt und dadurch einzeln
            zugänglich sind oder nicht.</para>
        </listitem>
        <listitem xml:id="cc-de.def.distribute">
          <para><quote><emphasis role="bold">Verbreiten</emphasis></quote> im Sinne dieser Lizenz
            bedeutet, den Schutzgegenstand oder Abwandlungen im Original
            oder in Form von Vervielfältigungsstücken, mithin in
            körperlich fixierter Form der Öffentlichkeit anzubieten oder
            in Verkehr zu bringen.</para>
        </listitem>
        <listitem xml:id="cc-de.def.license-elements">
          <para>Unter <quote><emphasis role="bold">Lizenzelementen</emphasis></quote> werden im Sinne
            dieser Lizenz die folgenden übergeordneten
            Lizenzcharakteristika verstanden, die vom Lizenzgeber
            ausgewählt wurden und in der Bezeichnung der Lizenz zum
            Ausdruck kommen: <quote>Namensnennung</quote>, <quote>Keine
              kommerzielle Nutzung</quote>, <quote>Weitergabe unter
              gleichen Bedingungen</quote>.</para>
        </listitem>
        <listitem xml:id="cc-de.def.licensor">
          <para>Der <quote><emphasis role="bold">Lizenzgeber</emphasis></quote> im Sinne dieser Lizenz ist
            diejenige natürliche oder juristische Person oder Gruppe,
            die den Schutzgegenstand unter den Bedingungen dieser Lizenz
            anbietet und insoweit als Rechteinhaberin auftritt.</para>
        </listitem>
        <listitem xml:id="cc-de.def.original-author">
          <para><quote><emphasis role="bold">Rechteinhaber</emphasis></quote> im Sinne dieser Lizenz
            ist der Urheber des Schutzgegenstandes oder jede andere
            natürliche oder juristische Person oder Gruppe von Personen,
            die am Schutzgegenstand ein Immaterialgüterrecht erlangt
            hat, welches die in Abschnitt <!--3--><xref linkend="cc-de.license-grant"/> genannten Handlungen
            erfasst und bei dem eine Einräumung von Nutzungsrechten oder
            eine Weiterübertragung an Dritte möglich ist.</para>
        </listitem>
        <listitem xml:id="cc-de.def.work">
          <para>Der Begriff <quote><emphasis role="bold">Schutzgegenstand</emphasis></quote> bezeichnet in
            dieser Lizenz den literarischen, künstlerischen oder
            wissenschaftlichen Inhalt, der unter den Bedingungen dieser
            Lizenz angeboten wird. Das kann insbesondere eine
            persönliche geistige Schöpfung jeglicher Art, ein Werk der
            kleinen Münze, ein nachgelassenes Werk oder auch ein
            Lichtbild oder anderes Objekt eines verwandten Schutzrechts
            sein, unabhängig von der Art seiner Fixierung und unabhängig
            davon, auf welche Weise jeweils eine Wahrnehmung erfolgen
            kann, gleichviel ob in analoger oder digitaler Form. Soweit
            Datenbanken oder Zusammenstellungen von Daten einen
            immaterialgüterrechtlichen Schutz eigener Art genießen,
            unterfallen auch sie dem Begriff "Schutzgegenstand" im Sinne
            dieser Lizenz.</para>
        </listitem>
        <listitem xml:id="cc-de.def.you">
          <para>Mit <quote><emphasis role="bold">Sie</emphasis></quote>
            bzw. <quote><emphasis role="bold">Ihnen</emphasis></quote>
            ist die natürliche oder juristische Person gemeint, die in
            dieser Lizenz im Abschnitt <!--3--><xref linkend="cc-de.license-grant"/> genannte Nutzungen des
            Schutzgegenstandes vornimmt und zuvor in Hinblick auf den
            Schutzgegenstand nicht gegen Bedingungen dieser Lizenz
            verstoßen oder aber die ausdrückliche Erlaubnis des
            Lizenzgebers erhalten hat, die durch diese Lizenz gewährten
            Nutzungsrechte trotz eines vorherigen Verstoßes
            auszuüben.</para>
        </listitem>
        <listitem xml:id="cc-de.def.publicly-perform">
          <para>Unter <quote><emphasis role="bold">Öffentlich
                Zeigen</emphasis></quote> im Sinne dieser Lizenz sind
            Veröffentlichungen und Präsentationen des Schutzgegenstandes
            zu verstehen, die für eine Mehrzahl von Mitgliedern der
            Öffentlichkeit bestimmt sind und in unkörperlicher Form
            mittels öffentlicher Wiedergabe in Form von Vortrag,
            Aufführung, Vorführung, Darbietung, Sendung, Weitersendung,
            zeit- und ortsunabhängiger Zugänglichmachung oder in
            körperlicher Form mittels Ausstellung erfolgen, unabhängig
            von bestimmten Veranstaltungen und unabhängig von den zum
            Einsatz kommenden Techniken und Verfahren, einschließlich
            drahtgebundener oder drahtloser Mittel und Einstellen in das
            Internet.</para>
        </listitem>
        <listitem xml:id="cc-de.def.reproduce">
          <para><quote><emphasis role="bold">Vervielfältigen</emphasis></quote> im Sinne dieser Lizenz
            bedeutet, mittels beliebiger Verfahren
            Vervielfältigungsstücke des Schutzgegenstandes herzustellen,
            insbesondere durch Ton- oder Bildaufzeichnungen, und umfasst
            auch den Vorgang, erstmals körperliche Fixierungen des
            Schutzgegenstandes sowie Vervielfältigungsstücke dieser
            Fixierungen anzufertigen, sowie die Übertragung des
            Schutzgegenstandes auf einen Bild- oder Tonträger oder auf
            ein anderes elektronisches Medium, gleichviel ob in
            digitaler oder analoger Form.</para>
        </listitem>
      </orderedlist>
    </listitem>
    <listitem xml:id="cc-de.fair-dealing-rights">
      <formalpara>
        <title>Schranken des Immaterialgüterrechts</title>
        <para>Diese Lizenz ist in keiner Weise darauf gerichtet,
          Befugnisse zur Nutzung des Schutzgegenstandes zu vermindern,
          zu beschränken oder zu vereiteln, die Ihnen aufgrund der
          Schranken des Urheberrechts oder anderer Rechtsnormen bereits
          ohne Weiteres zustehen oder sich aus dem Fehlen eines
          immaterialgüterrechtlichen Schutzes ergeben.</para>
      </formalpara>
    </listitem>
    <listitem xml:id="cc-de.license-grant">
      <formalpara>
        <title>Einräumung von Nutzungsrechten</title>
        <para>Unter den Bedingungen dieser Lizenz räumt Ihnen der
          Lizenzgeber – unbeschadet unverzichtbarer Rechte und
          vorbehaltlich des Abschnitts <!--4.f)--><xref linkend="cc-de.restrictions.f"/> – das vergütungsfreie,
          räumlich und zeitlich (für die Dauer des Schutzrechts am
          Schutzgegenstand) unbeschränkte einfache Recht ein, den
          Schutzgegenstand auf die folgenden Arten und Weisen zu nutzen
            (<quote>unentgeltlich eingeräumtes einfaches Nutzungsrecht
            für jedermann</quote>):</para>
      </formalpara>
      <orderedlist numeration="loweralpha">
        <listitem xml:id="cc-de.license-grant.a">
          <para>Den Schutzgegenstand in beliebiger Form und Menge zu
            vervielfältigen, ihn in Sammelwerke zu integrieren und ihn
            als Teil solcher Sammelwerke zu vervielfältigen;</para>
        </listitem>
        <listitem xml:id="cc-de.license-grant.b">
          <para>Abwandlungen des Schutzgegenstandes anzufertigen,
            einschließlich Übersetzungen unter Nutzung jedweder Medien,
            sofern deutlich erkennbar gemacht wird, dass es sich um
            Abwandlungen handelt;</para>
        </listitem>
        <listitem xml:id="cc-de.license-grant.c">
          <para>den Schutzgegenstand, allein oder in Sammelwerke
            aufgenommen, öffentlich zu zeigen und zu verbreiten;</para>
        </listitem>
        <listitem xml:id="cc-de.license-grant.d">
          <para>Abwandlungen des Schutzgegenstandes zu veröffentlichen,
            öffentlich zu zeigen und zu verbreiten.</para>
        </listitem>
      </orderedlist>
      <para>Das vorgenannte Nutzungsrecht wird für alle bekannten sowie
        für alle noch nicht bekannten Nutzungsarten eingeräumt. Es
        beinhaltet auch das Recht, solche Änderungen am Schutzgegenstand
        vorzunehmen, die für bestimmte nach dieser Lizenz zulässige
        Nutzungen technisch erforderlich sind. Alle sonstigen Rechte,
        die über diesen Abschnitt hinaus nicht ausdrücklich durch den
        Lizenzgeber eingeräumt werden, bleiben diesem allein
        vorbehalten. Soweit Datenbanken oder Zusammenstellungen von
        Daten Schutzgegenstand dieser Lizenz oder Teil dessen sind und
        einen immaterialgüterrechtlichen Schutz eigener Art genießen,
        verzichtet der Lizenzgeber auf sämtliche aus diesem Schutz
        resultierenden Rechte.</para>
    </listitem>
    <listitem xml:id="cc-de.restrictions">
      <formalpara>
        <title>Bedingungen</title>
        <para>Die Einräumung des Nutzungsrechts gemäß Abschnitt <xref linkend="cc-de.license-grant"/> dieser Lizenz erfolgt
          ausdrücklich nur unter den folgenden Bedingungen:</para>
      </formalpara>
      <orderedlist numeration="loweralpha" inheritnum="inherit">
        <listitem xml:id="cc-de.restrictions.a">
          <para>Sie dürfen den Schutzgegenstand ausschließlich unter den
            Bedingungen dieser Lizenz verbreiten oder öffentlich zeigen.
            Sie müssen dabei stets eine Kopie dieser Lizenz oder deren
            vollständige Internetadresse in Form des
            Uniform-Resource-Identifier (URI) beifügen. Sie dürfen keine
            Vertrags- oder Nutzungsbedingungen anbieten oder fordern,
            die die Bedingungen dieser Lizenz oder die durch diese
            Lizenz gewährten Rechte beschränken. Sie dürfen den
            Schutzgegenstand nicht unterlizenzieren. Bei jeder Kopie des
            Schutzgegenstandes, die Sie verbreiten oder öffentlich
            zeigen, müssen Sie alle Hinweise unverändert lassen, die auf
            diese Lizenz und den Haftungsausschluss hinweisen. Wenn Sie
            den Schutzgegenstand verbreiten oder öffentlich zeigen,
            dürfen Sie (in Bezug auf den Schutzgegenstand) keine
            technischen Maßnahmen ergreifen, die den Nutzer des
            Schutzgegenstandes in der Ausübung der ihm durch diese
            Lizenz gewährten Rechte behindern können. Dieser Abschnitt
              <!--4.a)--><xref linkend="cc-de.restrictions.a"/> gilt auch für
            den Fall, dass der Schutzgegenstand einen Bestandteil eines
            Sammelwerkes bildet, was jedoch nicht bedeutet, dass das
            Sammelwerk insgesamt dieser Lizenz unterstellt werden muss.
            Sofern Sie ein Sammelwerk erstellen, müssen Sie auf die
            Mitteilung eines Lizenzgebers hin aus dem Sammelwerk die in
            Abschnitt <!--4.d)--><xref linkend="cc-de.restrictions.d"/>
            aufgezählten Hinweise entfernen. Wenn Sie eine Abwandlung
            vornehmen, müssen Sie auf die Mitteilung eines Lizenzgebers
            hin von der Abwandlung die in Abschnitt <!--4.d)--><xref linkend="cc-de.restrictions.d"/> aufgezählten Hinweise
            entfernen.</para>
        </listitem>
        <listitem xml:id="cc-de.restrictions.b">
          <para>Sie dürfen eine Abwandlung ausschließlich unter den
          Bedingungen:</para>
          <orderedlist numeration="lowerroman">
            <listitem>
              <para>dieser Lizenz,</para>
            </listitem>
            <listitem>
              <para>einer späteren Version dieser Lizenz mit denselben Lizenzelementen;</para>
            </listitem>
            <listitem>
              <para>einer rechtsordnungsspezifischen
                Creative-Commons-Lizenz mit denselben Lizenzelementen ab
                Version 3.0 aufwärts (z.B. Namensnennung – Keine
                kommerzielle Nutzung – Weitergabe unter gleichen
                Bedingungen 3.0 US) oder</para>
            </listitem>
            <listitem>
              <para>der Creative-Commons-Unported-Lizenz mit denselben
                Lizenzelementen ab Version 3.0 aufwärts</para>
            </listitem>
          </orderedlist>
          <para>verbreiten oder öffentlich zeigen (<quote>Verwendbare Lizenz</quote>).</para>
          <para>Sie müssen stets eine Kopie der verwendbaren Lizenz oder
            deren vollständige Internetadresse in Form des
            Uniform-Resource-Identifier (URI) beifügen, wenn Sie die
            Abwandlung verbreiten oder öffentlich zeigen. Sie dürfen
            keine Vertrags- oder Nutzungsbedingungen anbieten oder
            fordern, die die Bedingungen der verwendbaren Lizenz oder
            die durch sie gewährten Rechte beschränken. Bei jeder
            Abwandlung, die Sie verbreiten oder öffentlich zeigen,
            müssen Sie alle Hinweise auf die verwendbare Lizenz und den
            Haftungsausschluss unverändert lassen. Wenn Sie die
            Abwandlung verbreiten oder öffentlich zeigen, dürfen Sie (in
            Bezug auf die Abwandlung) keine technischen Maßnahmen
            ergreifen, die den Nutzer der Abwandlung in der Ausübung der
            ihm durch die verwendbare Lizenz gewährten Rechte behindern
            können. Dieser Abschnitt <!--4.b)--><xref linkend="cc-de.restrictions.b"/> gilt auch für den Fall, dass
            die Abwandlung einen Bestandteil eines Sammelwerkes bildet,
            was jedoch nicht bedeutet, dass das Sammelwerk insgesamt der
            verwendbaren Lizenz unterstellt werden muss.</para>
        </listitem>
        <listitem xml:id="cc-de.restrictions.c">
          <para>Die Rechteeinräumung gemäß Abschnitt <!--3--><xref linkend="cc.license-grant"/> gilt nur für
            Handlungen, die nicht vorrangig auf einen geschäftlichen
            Vorteil oder eine geldwerte Vergütung gerichtet sind
              (<quote>nicht-kommerzielle Nutzung</quote>,
              <quote>Non-commercial-Option</quote>). Wird Ihnen in
            Zusammenhang mit dem Schutzgegenstand dieser Lizenz ein
            anderer Schutzgegenstand überlassen, ohne dass eine
            vertragliche Verpflichtung hierzu besteht (etwa im Wege von
            File-Sharing), so wird dies nicht als auf geschäftlichen
            Vorteil oder geldwerte Vergütung gerichtet angesehen, wenn
            in Verbindung mit dem Austausch der Schutzgegenstände
            tatsächlich keine Zahlung oder geldwerte Vergütung geleistet
            wird.</para>
        </listitem>
        <listitem xml:id="cc-de.restrictions.d">
          <para>Die Verbreitung und das öffentliche Zeigen des
            Schutzgegenstandes oder auf ihm aufbauender Abwandlungen
            oder ihn enthaltender Sammelwerke ist Ihnen nur unter der
            Bedingung gestattet, dass Sie, vorbehaltlich etwaiger
            Mitteilungen im Sinne von Abschnitt <!--4.a)--><xref linkend="cc-de.restrictions.a"/>, alle dazu gehörenden
            Rechtevermerke unberührt lassen. Sie sind verpflichtet, die
            Rechteinhaberschaft in einer der Nutzung entsprechenden,
            angemessenen Form anzuerkennen, indem Sie – soweit bekannt –
            Folgendes angeben:</para>
          <orderedlist numeration="lowerroman">
            <listitem>
              <para>Den Namen (oder das Pseudonym, falls ein solches
                verwendet wird) des Rechteinhabers und / oder, falls der
                Lizenzgeber im Rechtevermerk, in den Nutzungsbedingungen
                oder auf andere angemessene Weise eine Zuschreibung an
                Dritte vorgenommen hat (z.B. an eine Stiftung, ein
                Verlagshaus oder eine Zeitung)
                (<quote>Zuschreibungsempfänger</quote>), Namen bzw. Bezeichnung
                dieses oder dieser Dritten;</para>
            </listitem>
            <listitem>
              <para>den Titel des Inhaltes;</para>
            </listitem>
            <listitem>
              <para>in einer praktikablen Form den
                Uniform-Resource-Identifier (URI, z.B. Internetadresse),
                den der Lizenzgeber zum Schutzgegenstand angegeben hat,
                es sei denn, dieser URI verweist nicht auf den
                Rechtevermerk oder die Lizenzinformationen zum
                Schutzgegenstand;</para>
            </listitem>
            <listitem>
              <para>und im Falle einer Abwandlung des Schutzgegenstandes
                in Übereinstimmung mit Abschnitt <!--3.b)--><xref linkend="cc-de.license-grant.b" xrefstyle="template:                   3.%n"/> einen Hinweis
                darauf, dass es sich um eine Abwandlung handelt.</para>
            </listitem>
          </orderedlist>
          <para>Die nach diesem Abschnitt <!--4.d)--><xref linkend="cc-de.restrictions.d"/> erforderlichen Angaben
            können in jeder angemessenen Form gemacht werden; im Falle
            einer Abwandlung des Schutzgegenstandes oder eines
            Sammelwerkes müssen diese Angaben das Minimum darstellen und
            bei gemeinsamer Nennung mehrerer Rechteinhaber dergestalt
            erfolgen, dass sie zumindest ebenso hervorgehoben sind wie
            die Hinweise auf die übrigen Rechteinhaber. Die Angaben nach
            diesem Abschnitt dürfen Sie ausschließlich zur Angabe der
            Rechteinhaberschaft in der oben bezeichneten Weise
            verwenden. Durch die Ausübung Ihrer Rechte aus dieser Lizenz
            dürfen Sie ohne eine vorherige, separat und schriftlich
            vorliegende Zustimmung des Lizenzgebers und / oder des
            Zuschreibungsempfängers weder explizit noch implizit
            irgendeine Verbindung zum Lizenzgeber oder
            Zuschreibungsempfänger und ebenso wenig eine Unterstützung
            oder Billigung durch ihn andeuten.</para>
        </listitem>
        <listitem xml:id="cc-de.restrictions.e">
          <para>Die oben unter <!--4.a)--><xref linkend="cc-de.restrictions.a"/> bis <!--d)--><xref linkend="cc-de.restrictions.d"/> genannten Einschränkungen
            gelten nicht für solche Teile des Schutzgegenstandes, die
            allein deshalb unter den Schutzgegenstandsbegriff fallen,
            weil sie als Datenbanken oder Zusammenstellungen von Daten
            einen immaterialgüterrechtlichen Schutz eigener Art
            genießen.</para>
        </listitem>
        <listitem xml:id="cc-de.restrictions.f">
          <para>Bezüglich Vergütung für die Nutzung des
          Schutzgegenstandes gilt Folgendes:</para>
          <orderedlist numeration="lowerroman">
            <listitem xml:id="cc-de.restrictions.f.i">
              <formalpara>
                <title>Unverzichtbare gesetzliche Vergütungsansprüche:</title>
                <para>Soweit unverzichtbare Vergütungsansprüche im
                  Gegenzug für gesetzliche Lizenzen vorgesehen oder
                  Pauschalabgabensysteme (zum Beispiel für Leermedien)
                  vorhanden sind, behält sich der Lizenzgeber das
                  ausschließliche Recht vor, die entsprechende Vergütung
                  einzuziehen für jede Ausübung eines Rechts aus dieser
                  Lizenz durch Sie.</para>
              </formalpara>
            </listitem>
            <listitem xml:id="cc-de.restrictions.f.ii">
              <formalpara>
                <title>Vergütung bei Zwangslizenzen:</title>
                <para>Sofern Zwangslizenzen außerhalb dieser Lizenz
                  vorgesehen sind und zustande kommen, behält sich der
                  Lizenzgeber das ausschließliche Recht auf Einziehung
                  der entsprechenden Vergütung für den Fall vor, dass
                  Sie eine Nutzung des Schutzgegenstandes für andere als
                  die in Abschnitt <!--4.c)--><xref linkend="cc-de.restrictions.c"/> als nicht-kommerziell
                  definierten Zwecke vornehmen, verzichtet für alle
                  übrigen, lizenzgerechten Fälle von Nutzung jedoch auf
                  jegliche Vergütung.</para>
              </formalpara>
            </listitem>
            <listitem>
              <formalpara>
                <title>Vergütung in sonstigen Fällen:</title>
                <para>Bezüglich lizenzgerechter Nutzung des
                  Schutzgegenstandes durch Sie, die nicht unter die
                  beiden vorherigen Abschnitte <!--(i)--><xref linkend="cc-de.restrictions.f.i" xrefstyle="template: (%n) "/> und <!--(ii)--><xref linkend="cc-de.restrictions.f.ii" xrefstyle="template: (%n) "/> fällt,
                  verzichtet der Lizenzgeber auf jegliche Vergütung,
                  unabhängig davon, ob eine Einziehung der Vergütung
                  durch ihn selbst oder nur durch eine
                  Verwertungsgesellschaft möglich wäre. Der Lizenzgeber
                  behält sich jedoch das ausschließliche Recht auf
                  Einziehung der entsprechenden Vergütung (durch ihn
                  selbst oder eine Verwertungsgesellschaft) für den Fall
                  vor, dass Sie eine Nutzung des Schutzgegenstandes für
                  andere als die in Abschnitt <!--4.c)--><xref linkend="cc-de.restrictions.c"/> als nicht-kommerziell
                  definierten Zwecke vornehmen.</para>
              </formalpara>
            </listitem>
          </orderedlist>
        </listitem>
        <listitem>
          <para>Persönlichkeitsrechte bleiben – soweit sie bestehen –
            von dieser Lizenz unberührt.</para>
        </listitem>
      </orderedlist>
    </listitem>
    <listitem xml:id="cc-de.representation-warranties-disclaimer">
        <formalpara>
          <title>Gewährleistung</title>
        <para>SOFERN KEINE ANDERS LAUTENDE, SCHRIFTLICHE VEREINBARUNG
          ZWISCHEN DEM LIZENZGEBER UND IHNEN GESCHLOSSEN WURDE UND
          SOWEIT MÄNGEL NICHT ARGLISTIG VERSCHWIEGEN WURDEN, BIETET DER
          LIZENZGEBER DEN SCHUTZGEGENSTAND UND DIE EINRÄUMUNG VON
          RECHTEN UNTER AUSSCHLUSS JEGLICHER GEWÄHRLEISTUNG AN UND
          ÜBERNIMMT WEDER AUSDRÜCKLICH NOCH KONKLUDENT GARANTIEN
          IRGENDEINER ART. DIES UMFASST INSBESONDERE DAS FREISEIN VON
          SACH- UND RECHTSMÄNGELN, UNABHÄNGIG VON DEREN ERKENNBARKEIT
          FÜR DEN LIZENZGEBER, DIE VERKEHRSFÄHIGKEIT DES
          SCHUTZGEGENSTANDES, SEINE VERWENDBARKEIT FÜR EINEN BESTIMMTEN
          ZWECK SOWIE DIE KORREKTHEIT VON BESCHREIBUNGEN. DIESE
          GEWÄHRLEISTUNGSBESCHRÄNKUNG GILT NICHT, SOWEIT MÄNGEL ZU
          SCHÄDEN DER IN ABSCHNITT <!--6--><xref linkend="cc-de.limitation-on-liability"/> BEZEICHNETEN ART FÜHREN UND AUF
          SEITEN DES LIZENZGEBERS DAS JEWEILS GENANNTE VERSCHULDEN BZW.
          VERTRETENMÜSSEN EBENFALLS VORLIEGT.</para>
        </formalpara>
    </listitem>
    <listitem xml:id="cc-de.limitation-on-liability">
      <formalpara>
        <title>Haftungsbeschränkung</title>
        <para>DER LIZENZGEBER HAFTET IHNEN GEGENÜBER IN BEZUG AUF
          SCHÄDEN AUS DER VERLETZUNG DES LEBENS, DES KÖRPERS ODER DER
          GESUNDHEIT NUR, SOFERN IHM WENIGSTENS FAHRLÄSSIGKEIT
          VORZUWERFEN IST, FÜR SONSTIGE SCHÄDEN NUR BEI GROBER
          FAHRLÄSSIGKEIT ODER VORSATZ, UND ÜBERNIMMT DARÜBER HINAUS
          KEINERLEI FREIWILLIGE HAFTUNG.</para>
      </formalpara>
    </listitem>
    <listitem xml:id="cc-de.termination">
      <formalpara>
        <title>Erlöschen</title>
        <para/>
      </formalpara>
      <orderedlist numeration="loweralpha" inheritnum="inherit">
        <listitem>
          <para>Diese Lizenz und die durch sie eingeräumten
            Nutzungsrechte erlöschen mit Wirkung für die Zukunft im
            Falle eines Verstoßes gegen die Lizenzbedingungen durch Sie,
            ohne dass es dazu der Kenntnis des Lizenzgebers vom Verstoß
            oder einer weiteren Handlung einer der Vertragsparteien
            bedarf. Mit natürlichen oder juristischen Personen, die
            Abwandlungen des Schutzgegenstandes oder diesen enthaltende
            Sammelwerke unter den Bedingungen dieser Lizenz von Ihnen
            erhalten haben, bestehen nachträglich entstandene
            Lizenzbeziehungen jedoch solange weiter, wie die genannten
            Personen sich ihrerseits an sämtliche Lizenzbedingungen
            halten. Darüber hinaus gelten die Ziffern <!--1--><xref linkend="cc-de.def"/>, <!--2--><xref linkend="cc-de.fair-dealing-rights"/>, <!--5--><xref linkend="cc-de.representation-warranties-disclaimer"/>,
              <!--6--><xref linkend="cc-de.limitation-on-liability"/>,
              <!--7--><xref linkend="cc-de.termination"/> und
              <!--8--><xref linkend="cc-de.misc"/> auch nach einem
            Erlöschen dieser Lizenz fort. </para>
        </listitem>
        <listitem>
          <para>Vorbehaltlich der oben genannten Bedingungen gilt diese
            Lizenz unbefristet bis der rechtliche Schutz für den
            Schutzgegenstand ausläuft. Davon abgesehen behält der
            Lizenzgeber das Recht, den Schutzgegenstand unter anderen
            Lizenzbedingungen anzubieten oder die eigene Weitergabe des
            Schutzgegenstandes jederzeit einzustellen, solange die
            Ausübung dieses Rechts nicht einer Kündigung oder einem
            Widerruf dieser Lizenz (oder irgendeiner Weiterlizenzierung,
            die auf Grundlage dieser Lizenz bereits erfolgt ist bzw.
            zukünftig noch erfolgen muss) dient und diese Lizenz unter
            Berücksichtigung der oben zum Erlöschen genannten
            Bedingungen vollumfänglich wirksam bleibt.</para>
        </listitem>
      </orderedlist>
    </listitem>
    <listitem xml:id="cc-de.misc">
      <formalpara>
        <title>Sonstige Bestimmungen</title>
        <para/>
      </formalpara>
      <orderedlist numeration="loweralpha" inheritnum="inherit">
        <listitem xml:id="cc-de.misc.a">
          <para>Jedes Mal wenn Sie den Schutzgegenstand für sich
            genommen oder als Teil eines Sammelwerkes verbreiten oder
            öffentlich zeigen, bietet der Lizenzgeber dem Empfänger eine
            Lizenz zu den gleichen Bedingungen und im gleichen Umfang
            an, wie Ihnen in Form dieser Lizenz.</para>
        </listitem>
        <listitem xml:id="cc-de.misc.b">
          <para>Jedes Mal wenn Sie eine Abwandlung des
            Schutzgegenstandes verbreiten oder öffentlich zeigen, bietet
            der Lizenzgeber dem Empfänger eine Lizenz am ursprünglichen
            Schutzgegenstand zu den gleichen Bedingungen und im gleichen
            Umfang an, wie Ihnen in Form dieser Lizenz.</para>
        </listitem>
        <listitem xml:id="cc-de.misc.c">
          <para>Sollte eine Bestimmung dieser Lizenz unwirksam sein, so
            bleibt davon die Wirksamkeit der Lizenz im Übrigen
            unberührt.</para>
        </listitem>
        <listitem xml:id="cc-de.misc.d">
          <para>Keine Bestimmung dieser Lizenz soll als abbedungen und
            kein Verstoß gegen sie als zulässig gelten, solange die von
            dem Verzicht oder von dem Verstoß betroffene Seite nicht
            schriftlich zugestimmt hat.</para>
        </listitem>
        <listitem xml:id="cc-de.misc.e">
          <para>Diese Lizenz (zusammen mit in ihr ausdrücklich
            vorgesehenen Erlaubnissen, Mitteilungen und Zustimmungen,
            soweit diese tatsächlich vorliegen) stellt die vollständige
            Vereinbarung zwischen dem Lizenzgeber und Ihnen in Bezug auf
            den Schutzgegenstand dar. Es bestehen keine Abreden,
            Vereinbarungen oder Erklärungen in Bezug auf den
            Schutzgegenstand, die in dieser Lizenz nicht genannt sind.
            Rechtsgeschäftliche Änderungen des Verhältnisses zwischen
            dem Lizenzgeber und Ihnen sind nur über Modifikationen
            dieser Lizenz möglich. Der Lizenzgeber ist an etwaige
            zusätzliche, einseitig durch Sie übermittelte Bestimmungen
            nicht gebunden. Diese Lizenz kann nur durch schriftliche
            Vereinbarung zwischen Ihnen und dem Lizenzgeber modifiziert
            werden. Derlei Modifikationen wirken ausschließlich zwischen
            dem Lizenzgeber und Ihnen und wirken sich nicht auf die
            Dritten gemäß Ziffern <!--8.a)--><xref linkend="cc-de.misc.a"/> und
            <!--b)--><xref linkend="cc-de.misc.b"/> angeboteten Lizenzen
            aus.</para>
        </listitem>
        <listitem xml:id="cc-de.misc.f">
          <para>Sofern zwischen Ihnen und dem Lizenzgeber keine
            anderweitige Vereinbarung getroffen wurde und soweit
            Wahlfreiheit besteht, findet auf diesen Lizenzvertrag das
            Recht der Bundesrepublik Deutschland Anwendung.</para>
        </listitem>
      </orderedlist>
    </listitem>
  </orderedlist>

  <sidebar>
    <title>Creative Commons Notice</title>
    <para>Creative Commons ist nicht Partei dieser Lizenz und übernimmt
      keinerlei Gewähr oder dergleichen in Bezug auf den
      Schutzgegenstand. Creative Commons haftet Ihnen oder einer anderen
      Partei unter keinem rechtlichen Gesichtspunkt für irgendwelche
      Schäden, die – abstrakt oder konkret, zufällig oder vorhersehbar –
      im Zusammenhang mit dieser Lizenz entstehen. Unbeschadet der
      vorangegangen beiden Sätze, hat Creative Commons alle Rechte und
      Pflichten eines Lizenzgebers, wenn es sich ausdrücklich als
      Lizenzgeber im Sinne dieser Lizenz bezeichnet.</para>
    <para>Creative Commons gewährt den Parteien nur insoweit das Recht,
      das Logo und die Marke "Creative Commons" zu nutzen, als dies
      notwendig ist, um der Öffentlichkeit gegenüber kenntlich zu
      machen, dass der Schutzgegenstand unter einer CCPL steht. Ein
      darüber hinaus gehender Gebrauch der Marke "Creative Commons" oder
      einer verwandten Marke oder eines verwandten Logos bedarf der
      vorherigen schriftlichen Zustimmung von Creative Commons. Jeder
      erlaubte Gebrauch richtet sich nach der Creative Commons
      Marken-Nutzungs-Richtlinie in der jeweils aktuellen Fassung, die
      von Zeit zu Zeit auf der Website veröffentlicht oder auf andere
      Weise auf Anfrage zugänglich gemacht wird. Zur Klarstellung: Die
      genannten Einschränkungen der Markennutzung sind nicht Bestandteil
      dieser Lizenz. </para>
    <para>Creative Commons kann kontaktiert werden über <link xlink:href="http://creativecommons.org"/>.</para>
  </sidebar>
</appendix>
  <!--<?xml-model href="file:5.1/dbref.rnc" type="application/relax-ng-compact-syntax"?>--><appendix xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="cc-by-nc-sa-30-unported">
  <title>Attribution-NonCommercial-ShareAlike 3.0 Unported</title>
  <para>Taken from <link xlink:href="http://creativecommons.org/licenses/by-nc-sa/3.0/de/deed.en"/>.</para>
  <blockquote>
    <para>CREATIVE COMMONS CORPORATION IS NOT A LAW FIRM AND DOES NOT
      PROVIDE LEGAL SERVICES. DISTRIBUTION OF THIS LICENSE DOES NOT
      CREATE AN ATTORNEY-CLIENT RELATIONSHIP. CREATIVE COMMONS PROVIDES
      THIS INFORMATION ON AN "AS-IS" BASIS. CREATIVE COMMONS MAKES NO
      WARRANTIES REGARDING THE INFORMATION PROVIDED, AND DISCLAIMS
      LIABILITY FOR DAMAGES RESULTING FROM ITS USE.</para>
  </blockquote>

  <blockquote>
    <title>License</title>
    <para>THE WORK (AS DEFINED BELOW) IS PROVIDED UNDER THE TERMS OF
      THIS CREATIVE COMMONS PUBLIC LICENSE ("CCPL" OR "LICENSE"). THE
      WORK IS PROTECTED BY COPYRIGHT AND/OR OTHER APPLICABLE LAW. ANY
      USE OF THE WORK OTHER THAN AS AUTHORIZED UNDER THIS LICENSE OR
      COPYRIGHT LAW IS PROHIBITED.</para>
    <para>BY EXERCISING ANY RIGHTS TO THE WORK PROVIDED HERE, YOU ACCEPT
      AND AGREE TO BE BOUND BY THE TERMS OF THIS LICENSE. TO THE EXTENT
      THIS LICENSE MAY BE CONSIDERED TO BE A CONTRACT, THE LICENSOR
      GRANTS YOU THE RIGHTS CONTAINED HERE IN CONSIDERATION OF YOUR
      ACCEPTANCE OF SUCH TERMS AND CONDITIONS.</para>
  </blockquote>

  <orderedlist>
    <listitem xml:id="cc.def">
      <para>Definitions</para>
      <orderedlist numeration="loweralpha" inheritnum="inherit">
        <listitem xml:id="cc.def.adaption">
          <formalpara>
            <title><quote>Adaptation</quote></title>
            <para>means a work based upon the Work, or upon the Work and
              other pre-existing works, such as a translation,
              adaptation, derivative work, arrangement of music or other
              alterations of a literary or artistic work, or phonogram
              or performance and includes cinematographic adaptations or
              any other form in which the Work may be recast,
              transformed, or adapted including in any form recognizably
              derived from the original, except that a work that
              constitutes a Collection will not be considered an
              Adaptation for the purpose of this License. For the
              avoidance of doubt, where the Work is a musical work,
              performance or phonogram, the synchronization of the Work
              in timed-relation with a moving image
                (<quote>synching</quote>) will be considered an
              Adaptation for the purpose of this License.</para>
          </formalpara>
        </listitem>
        <listitem xml:id="cc.def.collection">
          <formalpara>
            <title><quote>Collection</quote></title>
            <para>means a collection of literary or artistic works, such
              as encyclopedias and anthologies, or performances,
              phonograms or broadcasts, or other works or subject matter
              other than works listed in Section <xref linkend="cc.def.work"/> below, which, by reason of the
              selection and arrangement of their contents, constitute
              intellectual creations, in which the Work is included in
              its entirety in unmodified form along with one or more
              other contributions, each constituting separate and
              independent works in themselves, which together are
              assembled into a collective whole. A work that constitutes
              a Collection will not be considered an Adaptation (as
              defined above) for the purposes of this License.</para>
          </formalpara>
        </listitem>
        <listitem xml:id="cc.def.distribute">
          <formalpara>
            <title><quote>Distribute</quote></title>
            <para>means to make available to the public the original and
              copies of the Work or Adaptation, as appropriate, through
              sale or other transfer of ownership.</para>
          </formalpara>
        </listitem>
        <listitem xml:id="cc.def.license-elements">
          <formalpara>
            <title><quote>License Elements</quote></title>
            <para>means the following high-level license attributes as
              selected by Licensor and indicated in the title of this
              License: Attribution, Noncommercial, ShareAlike.</para>
          </formalpara>
        </listitem>
        <listitem xml:id="cc.def.licensor">
          <formalpara>
            <title><quote>Licensor</quote></title>
            <para>means the individual, individuals, entity or entities
              that offer(s) the Work under the terms of this
              License.</para>
          </formalpara>
        </listitem>
        <listitem xml:id="cc.def.original-author">
          <formalpara>
            <title><quote>Original Author</quote></title>
            <para>means, in the case of a literary or artistic work, the
              individual, individuals, entity or entities who created
              the Work or if no individual or entity can be identified,
              the publisher; and in addition (i) in the case of a
              performance the actors, singers, musicians, dancers, and
              other persons who act, sing, deliver, declaim, play in,
              interpret or otherwise perform literary or artistic works
              or expressions of folklore; (ii) in the case of a
              phonogram the producer being the person or legal entity
              who first fixes the sounds of a performance or other
              sounds; and, (iii) in the case of broadcasts, the
              organization that transmits the broadcast.</para>
          </formalpara>
        </listitem>
        <listitem xml:id="cc.def.work">
          <formalpara>
            <title><quote>Work</quote></title>
            <para>means the literary and/or artistic work offered under
              the terms of this License including without limitation any
              production in the literary, scientific and artistic
              domain, whatever may be the mode or form of its expression
              including digital form, such as a book, pamphlet and other
              writing; a lecture, address, sermon or other work of the
              same nature; a dramatic or dramatico-musical work; a
              choreographic work or entertainment in dumb show; a
              musical composition with or without words; a
              cinematographic work to which are assimilated works
              expressed by a process analogous to cinematography; a work
              of drawing, painting, architecture, sculpture, engraving
              or lithography; a photographic work to which are
              assimilated works expressed by a process analogous to
              photography; a work of applied art; an illustration, map,
              plan, sketch or three-dimensional work relative to
              geography, topography, architecture or science; a
              performance; a broadcast; a phonogram; a compilation of
              data to the extent it is protected as a copyrightable
              work; or a work performed by a variety or circus performer
              to the extent it is not otherwise considered a literary or
              artistic work.</para>
          </formalpara>
        </listitem>
        <listitem xml:id="cc.def.you">
          <formalpara>
            <title><quote>You</quote></title>
            <para>means an individual or entity exercising rights under
              this License who has not previously violated the terms of
              this License with respect to the Work, or who has received
              express permission from the Licensor to exercise rights
              under this License despite a previous violation.</para>
          </formalpara>
        </listitem>
        <listitem xml:id="cc.def.publicly-perform">
          <formalpara>
            <title><quote>Publicly Perform</quote></title>
            <para>means to perform public recitations of the Work and to
              communicate to the public those public recitations, by any
              means or process, including by wire or wireless means or
              public digital performances; to make available to the
              public Works in such a way that members of the public may
              access these Works from a place and at a place
              individually chosen by them; to perform the Work to the
              public by any means or process and the communication to
              the public of the performances of the Work, including by
              public digital performance; to broadcast and rebroadcast
              the Work by any means including signs, sounds or
              images.</para>
          </formalpara>
        </listitem>
        <listitem xml:id="cc.def.reproduce">
          <formalpara>
            <title><quote>Reproduce</quote></title>
            <para>means to make copies of the Work by any means
              including without limitation by sound or visual recordings
              and the right of fixation and reproducing fixations of the
              Work, including storage of a protected performance or
              phonogram in digital form or other electronic
              medium.</para>
          </formalpara>
        </listitem>
      </orderedlist>
    </listitem>
    <listitem xml:id="cc.fair-dealing-rights">
      <formalpara>
        <title>Fair Dealing Rights.</title>
        <para>Nothing in this License is intended to reduce, limit, or
          restrict any uses free from copyright or rights arising from
          limitations or exceptions that are provided for in connection
          with the copyright protection under copyright law or other
          applicable laws.</para>
      </formalpara>
    </listitem>
    <listitem xml:id="cc.license-grant">
      <formalpara>
        <title>License Grant.</title>
        <para>Subject to the terms and conditions of this License,
          Licensor hereby grants You a worldwide, royalty-free,
          non-exclusive, perpetual (for the duration of the applicable
          copyright) license to exercise the rights in the Work as
          stated below:</para>
      </formalpara>
      <orderedlist numeration="loweralpha">
        <listitem xml:id="cc.license-grant.a">
          <para>to Reproduce the Work, to incorporate the Work into one
            or more Collections, and to Reproduce the Work as
            incorporated in the Collections;</para>
        </listitem>
        <listitem xml:id="cc.license-grant.b">
          <para>to create and Reproduce Adaptations provided that any
            such Adaptation, including any translation in any medium,
            takes reasonable steps to clearly label, demarcate or
            otherwise identify that changes were made to the original
            Work. For example, a translation could be marked <quote>The
              original work was translated from English to
              Spanish,</quote> or a modification could indicate
              <quote>The original work has been
            modified.</quote>;</para>
        </listitem>
        <listitem xml:id="cc.license-grant.c">
          <para>to Distribute and Publicly Perform the Work including as
            incorporated in Collections; and,</para>
        </listitem>
        <listitem xml:id="cc.license-grant.d">
          <para>to Distribute and Publicly Perform Adaptations.</para>
        </listitem>
      </orderedlist>
      <para>The above rights may be exercised in all media and formats
        whether now known or hereafter devised. The above rights include
        the right to make such modifications as are technically
        necessary to exercise the rights in other media and formats.
        Subject to Section <!--8(f)--><xref linkend="cc.misc.rightsgranted"/>,
        all rights not expressly granted by Licensor are hereby
        reserved, including but not limited to the rights described in
        Section <!--4(e)--><xref linkend="cc.restrictions.e"/>.</para>
    </listitem>
    <listitem xml:id="cc.restrictions">
      <formalpara>
        <title>Restrictions.</title>
        <para>The license granted in Section <!--3--><xref linkend="cc.license-grant"/> above is expressly made subject
          to and limited by the following restrictions:</para>
      </formalpara>
      <orderedlist numeration="loweralpha" inheritnum="inherit">
        <listitem xml:id="cc.restrictions.a">
          <para>You may Distribute or Publicly Perform the Work only
            under the terms of this License. You must include a copy of,
            or the Uniform Resource Identifier (URI) for, this License
            with every copy of the Work You Distribute or Publicly
            Perform. You may not offer or impose any terms on the Work
            that restrict the terms of this License or the ability of
            the recipient of the Work to exercise the rights granted to
            that recipient under the terms of the License. You may not
            sublicense the Work. You must keep intact all notices that
            refer to this License and to the disclaimer of warranties
            with every copy of the Work You Distribute or Publicly
            Perform. When You Distribute or Publicly Perform the Work,
            You may not impose any effective technological measures on
            the Work that restrict the ability of a recipient of the
            Work from You to exercise the rights granted to that
            recipient under the terms of the License. This Section
              <!--4(a)--><xref linkend="cc.restrictions.a"/> applies to the
            Work as incorporated in a Collection, but this does not
            require the Collection apart from the Work itself to be made
            subject to the terms of this License. If You create a
            Collection, upon notice from any Licensor You must, to the
            extent practicable, remove from the Collection any credit as
            required by Section <!--4(d)--><xref linkend="cc.restrictions.d"/>,
            as requested. If You create an Adaptation, upon notice from
            any Licensor You must, to the extent practicable, remove
            from the Adaptation any credit as required by Section
              <!--4(d)--><xref linkend="cc.restrictions.d"/>, as
            requested.</para>
        </listitem>
        <listitem xml:id="cc.restrictions.b">
          <para>You may Distribute or Publicly Perform an Adaptation
            only under: (i) the terms of this License; (ii) a later
            version of this License with the same License Elements as
            this License; (iii) a Creative Commons jurisdiction license
            (either this or a later license version) that contains the
            same License Elements as this License (e.g.,
            Attribution-NonCommercial-ShareAlike 3.0 US)
              (<quote>Applicable License</quote>). You must include a
            copy of, or the URI, for Applicable License with every copy
            of each Adaptation You Distribute or Publicly Perform. You
            may not offer or impose any terms on the Adaptation that
            restrict the terms of the Applicable License or the ability
            of the recipient of the Adaptation to exercise the rights
            granted to that recipient under the terms of the Applicable
            License. You must keep intact all notices that refer to the
            Applicable License and to the disclaimer of warranties with
            every copy of the Work as included in the Adaptation You
            Distribute or Publicly Perform. When You Distribute or
            Publicly Perform the Adaptation, You may not impose any
            effective technological measures on the Adaptation that
            restrict the ability of a recipient of the Adaptation from
            You to exercise the rights granted to that recipient under
            the terms of the Applicable License. This Section <!--4(b)--><xref linkend="cc.restrictions.b"/> applies to the Adaptation as
            incorporated in a Collection, but this does not require the
            Collection apart from the Adaptation itself to be made
            subject to the terms of the Applicable License.</para>
        </listitem>
        <listitem xml:id="cc.restrictions.c">
          <para>You may not exercise any of the rights granted to You in
            Section <xref linkend="cc.license-grant"/> above in any
            manner that is primarily intended for or directed toward
            commercial advantage or private monetary compensation. The
            exchange of the Work for other copyrighted works by means of
            digital file-sharing or otherwise shall not be considered to
            be intended for or directed toward commercial advantage or
            private monetary compensation, provided there is no payment
            of any monetary compensation in con-nection with the
            exchange of copyrighted works.</para>
        </listitem>
        <listitem xml:id="cc.restrictions.d">
          <para>If You Distribute, or Publicly Perform the Work or any
            Adaptations or Collections, You must, unless a request has
            been made pursuant to Section <!--4(a)--><xref linkend="cc.restrictions.a"/>, keep intact all copyright
            notices for the Work and provide, reasonable to the medium
            or means You are utilizing: (i) the name of the Original
            Author (or pseudonym, if applicable) if supplied, and/or if
            the Original Author and/or Licensor designate another party
            or parties (e.g., a sponsor institute, publishing entity,
            journal) for attribution (<quote>Attribution
            Parties</quote>) in Licensor's copyright notice, terms of
            service or by other reasonable means, the name of such party
            or parties; (ii) the title of the Work if supplied; (iii) to
            the extent reasonably practicable, the URI, if any, that
            Licensor specifies to be associated with the Work, unless
            such URI does not refer to the copyright notice or licensing
            information for the Work; and, (iv) consistent with Section
              <!--3(b)--><xref linkend="cc.license-grant.b"/>, in the case of
            an Adaptation, a credit identifying the use of the Work in
            the Adaptation (e.g., <quote>French translation of the Work
              by Original Author,</quote> or <quote>Screenplay based on
              original Work by Original Author</quote>). The credit
            required by this Section <!--4(d)--><xref linkend="cc.restrictions.d"/> may be implemented in any
            reasonable manner; provided, however, that in the case of a
            Adaptation or Collection, at a minimum such credit will
            appear, if a credit for all contributing authors of the
            Adaptation or Collection appears, then as part of these
            credits and in a manner at least as prominent as the credits
            for the other contributing authors. For the avoidance of
            doubt, You may only use the credit required by this Section
            for the purpose of attribution in the manner set out above
            and, by exercising Your rights under this License, You may
            not implicitly or explicitly assert or imply any connection
            with, sponsorship or endorsement by the Original Author,
            Licensor and/or Attribution Parties, as appropriate, of You
            or Your use of the Work, without the separate, express prior
            written permission of the Original Author, Licensor and/or
            Attribution Parties.</para>
        </listitem>
        <listitem xml:id="cc.restrictions.e">
          <para>For the avoidance of doubt:</para>
          <orderedlist numeration="lowerroman" inheritnum="inherit">
            <listitem xml:id="cc.restriction.e.i">
              <formalpara>
                <title>Non-waivable Compulsory License Schemes.</title>
                <para>In those jurisdictions in which the right to
                  collect royalties through any statutory or compulsory
                  licensing scheme cannot be waived, the Licensor
                  reserves the exclusive right to collect such royalties
                  for any exercise by You of the rights granted under
                  this License;</para>
              </formalpara>
            </listitem>
            <listitem xml:id="cc.restriction.e.ii">
              <formalpara>
                <title>Waivable Compulsory License Schemes.</title>
                <para>In those jurisdictions in which the right to
                  collect royalties through any statutory or compulsory
                  licensing scheme can be waived, the Licensor reserves
                  the exclusive right to collect such royalties for any
                  exercise by You of the rights granted under this
                  License if Your exercise of such rights is for a
                  purpose or use which is otherwise than noncommercial
                  as permitted under Section <!--4(c)--><xref linkend="cc.restrictions.c"/> and otherwise waives
                  the right to collect royalties through any statutory
                  or compulsory licensing scheme; and,</para>
              </formalpara>
            </listitem>
            <listitem xml:id="cc.restriction.e.iii">
              <formalpara>
                <title>Voluntary License Schemes.</title>
                <para>The Licensor reserves the right to collect
                  royalties, whether individually or, in the event that
                  the Licensor is a member of a collecting society that
                  administers voluntary licensing schemes, via that
                  society, from any exercise by You of the rights
                  granted under this License that is for a purpose or
                  use which is otherwise than noncommercial as permitted
                  under Section <!--4(c)--><xref linkend="cc.restrictions.c"/>.</para>
              </formalpara>
            </listitem>
          </orderedlist>
        </listitem>
        <listitem>
          <para>Except as otherwise agreed in writing by the Licensor or
            as may be otherwise permitted by applicable law, if You
            Reproduce, Distribute or Publicly Perform the Work either by
            itself or as part of any Adaptations or Collections, You
            must not distort, mutilate, modify or take other derogatory
            action in relation to the Work which would be prejudicial to
            the Original Author's honor or reputation. Licensor agrees
            that in those jurisdictions (e.g. Japan), in which any
            exercise of the right granted in Section <!--3(b)--><xref linkend="cc.license-grant.b"/> of this License (the right
            to make Adaptations) would be deemed to be a distortion,
            mutilation, modification or other derogatory action
            prejudicial to the Original Author's honor and reputation,
            the Licensor will waive or not assert, as appropriate, this
            Section, to the fullest extent permitted by the applicable
            national law, to enable You to reasonably exercise Your
            right under Section <!--3(b)--><xref linkend="cc.license-grant.b"/>
            of this License (right to make Adaptations) but not
            otherwise.</para>
        </listitem>
      </orderedlist>
    </listitem>
    <listitem xml:id="cc.representation-warranties-disclaimer">
      <formalpara>
        <title>Representations, Warranties and Disclaimer</title>
        <para>UNLESS OTHERWISE MUTUALLY AGREED TO BY THE PARTIES IN
          WRITING AND TO THE FULLEST EXTENT PERMITTED BY APPLICABLE LAW,
          LICENSOR OFFERS THE WORK AS-IS AND MAKES NO REPRESENTATIONS OR
          WARRANTIES OF ANY KIND CONCERNING THE WORK, EXPRESS, IMPLIED,
          STATUTORY OR OTHERWISE, INCLUDING, WITHOUT LIMITATION,
          WARRANTIES OF TITLE, MERCHANTABILITY, FITNESS FOR A PARTICULAR
          PURPOSE, NONINFRINGEMENT, OR THE ABSENCE OF LATENT OR OTHER
          DEFECTS, ACCURACY, OR THE PRESENCE OF ABSENCE OF ERRORS,
          WHETHER OR NOT DISCOVERABLE. SOME JURISDICTIONS DO NOT ALLOW
          THE EXCLUSION OF IMPLIED WARRANTIES, SO THIS EXCLUSION MAY NOT
          APPLY TO YOU.</para>
      </formalpara>
    </listitem>
    <listitem xml:id="cc.limitation-on-liability">
      <formalpara>
        <title>Limitation on Liability.</title>
        <para>EXCEPT TO THE EXTENT REQUIRED BY APPLICABLE LAW, IN NO
          EVENT WILL LICENSOR BE LIABLE TO YOU ON ANY LEGAL THEORY FOR
          ANY SPECIAL, INCIDENTAL, CONSEQUENTIAL, PUNITIVE OR EXEMPLARY
          DAMAGES ARISING OUT OF THIS LICENSE OR THE USE OF THE WORK,
          EVEN IF LICENSOR HAS BEEN ADVISED OF THE POSSIBILITY OF SUCH
          DAMAGES.</para>
      </formalpara>
    </listitem>
    <listitem xml:id="cc.termination">
      <formalpara>
        <title>Termination</title>
        <para/>
      </formalpara>
      <orderedlist numeration="loweralpha" inheritnum="inherit">
        <listitem>
          <para>This License and the rights granted hereunder will
            terminate automatically upon any breach by You of the terms
            of this License. Individuals or entities who have received
            Adaptations or Collections from You under this License,
            however, will not have their licenses terminated provided
            such individuals or entities remain in full compliance with
            those licenses. Sections <!--1--><xref linkend="cc.def"/>, 
            <!--2--><xref linkend="cc.fair-dealing-rights"/>, <!--5--><xref linkend="cc.representation-warranties-disclaimer"/>,
              <!--6--><xref linkend="cc.limitation-on-liability"/>, <!--7--><xref linkend="cc.termination"/>, and <!--8--><xref linkend="cc.misc"/>
            will survive any termination of this License.</para>
        </listitem>
        <listitem>
          <para>Subject to the above terms and conditions, the license
            granted here is perpetual (for the duration of the
            applicable copyright in the Work). Notwithstanding the
            above, Licensor reserves the right to release the Work under
            different license terms or to stop distributing the Work at
            any time; provided, however that any such election will not
            serve to withdraw this License (or any other license that
            has been, or is required to be, granted under the terms of
            this License), and this License will continue in full force
            and effect unless terminated as stated above.</para>
        </listitem>
      </orderedlist>
    </listitem>
    <listitem xml:id="cc.misc">
      <formalpara>
        <title>Miscellaneous</title>
        <para/>
      </formalpara>
      <orderedlist numeration="loweralpha" inheritnum="inherit">
        <listitem>
          <para>Each time You Distribute or Publicly Perform the Work or
            a Collection, the Licensor offers to the recipient a license
            to the Work on the same terms and conditions as the license
            granted to You under this License.</para>
        </listitem>
        <listitem>
          <para>Each time You Distribute or Publicly Perform an
            Adaptation, Licensor offers to the recipient a license to
            the original Work on the same terms and conditions as the
            license granted to You under this License.</para>
        </listitem>
        <listitem>
          <para>If any provision of this License is invalid or
            unenforceable under applicable law, it shall not affect the
            validity or enforceability of the remainder of the terms of
            this License, and without further action by the parties to
            this agreement, such provision shall be reformed to the
            minimum extent necessary to make such provision valid and
            enforceable.</para>
        </listitem>
        <listitem>
          <para>No term or provision of this License shall be deemed
            waived and no breach consented to unless such waiver or
            consent shall be in writing and signed by the party to be
            charged with such waiver or consent.</para>
        </listitem>
        <listitem>
          <para>This License constitutes the entire agreement between
            the parties with respect to the Work licensed here. There
            are no understandings, agreements or representations with
            respect to the Work not specified here. Licensor shall not
            be bound by any additional provisions that may appear in any
            communication from You. This License may not be modified
            without the mutual written agreement of the Licensor and
            You.</para>
        </listitem>
        <listitem xml:id="cc.misc.rightsgranted">
          <para>The rights granted under, and the subject matter
            referenced, in this License were drafted utilizing the
            terminology of the Berne Convention for the Protection of
            Literary and Artistic Works (as amended on September 28,
            1979), the Rome Convention of 1961, the WIPO Copyright
            Treaty of 1996, the WIPO Performances and Phonograms Treaty
            of 1996 and the Universal Copyright Convention (as revised
            on July 24, 1971). These rights and subject matter take
            effect in the relevant jurisdiction in which the License
            terms are sought to be enforced according to the
            corresponding provisions of the implementation of those
            treaty provisions in the applicable national law. If the
            standard suite of rights granted under applicable copyright
            law includes additional rights not granted under this
            License, such additional rights are deemed to be included in
            the License; this License is not intended to restrict the
            license of any rights under applicable law.</para>
        </listitem>
      </orderedlist>
    </listitem>
  </orderedlist>

  <sidebar>
    <title>Creative Commons Notice</title>
    <para>Creative Commons is not a party to this License, and makes no
      warranty whatsoever in connection with the Work. Creative Commons
      will not be liable to You or any party on any legal theory for any
      damages whatsoever, including without limitation any general,
      special, incidental or consequential damages arising in connection
      to this license. Notwithstanding the foregoing two (2) sentences,
      if Creative Commons has expressly identified itself as the
      Licensor hereunder, it shall have all rights and obligations of
      Licensor.</para>
    <para>Except for the limited purpose of indicating to the public
      that the Work is licensed under the CCPL, Creative Commons does
      not authorize the use by either party of the trademark
        <quote>Creative Commons</quote> or any related trademark or logo
      of Creative Commons without the prior written consent of Creative
      Commons. Any permitted use will be in compliance with Creative
      Commons' then-current trademark usage guidelines, as may be
      published on its website or otherwise made available upon request
      from time to time. For the avoidance of doubt, this trademark
      restriction does not form part of this License.</para>
    <para>Creative Commons may be contacted at <link xlink:href="http://creativecommons.org"/>.</para>
  </sidebar>
</appendix>
  
  <colophon xmlns="http://docbook.org/ns/docbook" version="5.1" xml:id="colophon" status="draft">
  <title>Colophon</title>
  <para><remark>toms, 2012-05-17: FIXME</remark></para>
</colophon>

</book>
